<!-- MHonArc v2.6.19 -->
<!--X-Subject: Re: [PATCH 1/7] vfs &#45; merge path_is_mountpoint() and path_is_mountpoint_rcu() -->
<!--X-From-R13: Wna Yrag &#60;eniraNgurznj.arg> -->
<!--X-Date: Sat, 3 Dec 2016 18:19:06 &#45;0800 -->
<!--X-Message-Id: 1480817915.3157.14.camel@themaw.net -->
<!--X-Content-Type: text/plain -->
<!--X-Reference: 148029910861.27779.4517883721395202453.stgit@pluto.themaw.net -->
<!--X-Reference: 20161203051322.GA24765@ZenIV.linux.org.uk -->
<!--X-Reference: 20161203232912.GE1555@ZenIV.linux.org.uk -->
<!--X-Head-End-->
<!doctype html public "-//W3C//DTD HTML//EN">
<html>
<head>
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({
          google_ad_client: "ca-pub-3422782820843221",
          enable_page_level_ads: true
     });
</script>
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="description" content="Re: [PATCH 1/7] vfs - merge path_is_mountpoint() and path_is_mountpoint_rcu() &mdash; Linux AutoFS">
<style>
<!--
 pre {white-space: pre-wrap;}
-->
</style>
<title>Re: [PATCH 1/7] vfs - merge path_is_mountpoint() and path_is_mountpoint_rcu() &mdash; Linux AutoFS</title>
<link rel="alternate" type="application/rss+xml" title="Linux AutoFS" href="//feeds.feedburner.com/autofs">
<script type="text/javascript">
var addthis_config = addthis_config||{};
addthis_config.data_track_addressbar = false;
</script>
</head>
<body itemscope itemtype="//schema.org/Article" vlink=green>
<!--X-Body-Begin-->
<!--X-User-Header-->
<!--X-User-Header-End-->
<!--X-TopPNI-->
<form action="//www.google.com/cse" id="cse-search-box" target="_blank">
  <div>
    <input type="hidden" name="cx" value="partner-pub-3422782820843221:isdiegq275o" />
    <input type="hidden" name="ie" value="ISO-8859-1" />
    <input type="text" name="q" size="37" />
    <input type="submit" name="sa" value="Search" />
  </div>
</form>
<script type="text/javascript" src="//www.google.com/cse/brand?form=cse-search-box&amp;lang=en"></script>
<h1 itemprop="name">Re: [PATCH 1/7] vfs - merge path_is_mountpoint() and path_is_mountpoint_rcu()</h1>
[<a href="msg01509.html">Date Prev</a>][<a href="msg01511.html">Date Next</a>][<a href="msg01508.html">Thread Prev</a>][<a href="msg01511.html">Thread Next</a>][<a href="maillist.html#01510">Date Index</a>][<a href="index.html#01510">Thread Index</a>]


<p>&nbsp;<br>
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- responsive test for archives -->
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-3422782820843221"
     data-ad-slot="6345952567"
     data-ad-format="auto"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>

<!--X-TopPNI-End-->
<!--X-MsgBody-->
<!--X-Subject-Header-Begin-->
<hr>
<!--X-Subject-Header-End-->
<!--X-Head-of-Message-->
<ul>
<li><em>To</em>: Al Viro &lt;viro@xxxxxxxxxxxxxxxxxx&gt;</li>
<li><em>Subject</em>: Re: [PATCH 1/7] vfs - merge path_is_mountpoint() and path_is_mountpoint_rcu()</li>
<li><em>From</em>: Ian Kent &lt;raven@xxxxxxxxxx&gt;</li>
<li><em>Date</em>: Sun, 04 Dec 2016 10:18:35 +0800</li>
<li><em>Cc</em>: Andrew Morton &lt;akpm@xxxxxxxxxxxxxxxxxxxx&gt;,        autofs mailing list &lt;autofs@xxxxxxxxxxxxxxx&gt;,        Kernel Mailing List &lt;linux-kernel@xxxxxxxxxxxxxxx&gt;,        &quot;Eric W. Biederman&quot; &lt;ebiederm@xxxxxxxxxxxx&gt;,        linux-fsdevel &lt;linux-fsdevel@xxxxxxxxxxxxxxx&gt;,        Omar Sandoval &lt;osandov@xxxxxxxxxxx&gt;</li>
<li><em>In-reply-to</em>: &lt;<a href="msg01508.html">20161203232912.GE1555@ZenIV.linux.org.uk</a>&gt;</li>
<li><em>References</em>: &lt;<a href="msg01498.html">148029910861.27779.4517883721395202453.stgit@pluto.themaw.net</a>&gt;         &lt;<a href="msg01507.html">20161203051322.GA24765@ZenIV.linux.org.uk</a>&gt;         &lt;<a href="msg01508.html">20161203232912.GE1555@ZenIV.linux.org.uk</a>&gt;</li>
</ul>
<!--X-Head-of-Message-End-->
<!--X-Head-Body-Sep-Begin-->
<!-- AddThis Button BEGIN -->
<div class="addthis_toolbox addthis_default_style ">
<a class="addthis_button_preferred_1"></a>
<a class="addthis_button_preferred_2"></a>
<a class="addthis_button_preferred_3"></a>
<a class="addthis_button_preferred_4"></a>
<a class="addthis_button_compact"></a>
<a class="addthis_counter addthis_bubble_style"></a>
</div>
<script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5196c2ae1be43d18&async=1&domready=1" async></script>
<!-- AddThis Button END -->
<hr>
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- responsive link 1 -->
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-3422782820843221"
     data-ad-slot="8681825769"
     data-ad-format="link"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
<p>
<div class="content" itemprop="articleBody">
<!--X-Head-Body-Sep-End-->
<!--X-Body-of-Message-->
<pre>On Sat, 2016-12-03 at 23:29 +0000, Al Viro wrote:
&gt; On Sat, Dec 03, 2016 at 05:13:22AM +0000, Al Viro wrote:
&gt; &gt; 
&gt; &gt; 	* path_has_submounts() is broken.&#xA0;&#xA0;At the very least, it's
&gt; &gt; AB-BA between mount_lock and rename_lock.&#xA0;&#xA0;I would suggest trying to
&gt; &gt; put read_seqlock_excl(&amp;mount_lock) around the call of d_walk() in there,
&gt; &gt; and using __lookup_mnt() in the callback (without retries on the mount_lock,
&gt; &gt; of course - read_seqlock_excl done on the outside is enough).&#xA0;&#xA0;I'm not sure
&gt; &gt; if it won't cause trouble with contention, though; that needs testing.&#xA0;&#xA0;As
&gt; &gt; it is, that function is broken in #work.autofs, same as it is in -mm and
&gt; &gt; -next.
&gt; 	Fix for path_has_submounts() (as above) force-pushed.&#xA0;&#xA0;It does
&gt; need testing and profiling, obviously.

I'll run my tests against it and re-run with oprofile if all goes well.

The submount-test I use should show contention if it's a problem but I'm not
sure the number of mounts used will be sufficient to show up scale problems.

Basically each case of the test (there are two) runs for 100 iterations using 10
processes with timing set to promote expire to mount contention, mainly to test
for expire to mount races.

If I don't see contention I might need to analyse further whether the test has
adequate coverage.

Ian
--
To unsubscribe from this list: send the line &quot;unsubscribe autofs&quot; in


</pre>
<!--X-Body-of-Message-End-->
<!--X-MsgBody-End-->
<!--X-Follow-Ups-->
</div>
<hr>
<ul><li><strong>Follow-Ups</strong>:
<ul>
<li><strong><a name="01511" href="msg01511.html">Re: [PATCH 1/7] vfs - merge path_is_mountpoint() and path_is_mountpoint_rcu()</a></strong>
<ul><li><em>From:</em> Ian Kent</li></ul></li>
</ul></li></ul>
<!--X-Follow-Ups-End-->
<!--X-References-->
<ul><li><strong>References</strong>:
<ul>
<li><strong><a name="01498" href="msg01498.html">[PATCH 1/7] vfs - merge path_is_mountpoint() and path_is_mountpoint_rcu()</a></strong>
<ul><li><em>From:</em> Ian Kent</li></ul></li>
<li><strong><a name="01507" href="msg01507.html">Re: [PATCH 1/7] vfs - merge path_is_mountpoint() and path_is_mountpoint_rcu()</a></strong>
<ul><li><em>From:</em> Al Viro</li></ul></li>
<li><strong><a name="01508" href="msg01508.html">Re: [PATCH 1/7] vfs - merge path_is_mountpoint() and path_is_mountpoint_rcu()</a></strong>
<ul><li><em>From:</em> Al Viro</li></ul></li>
</ul></li></ul>
<!--X-References-End-->
<!--X-BotPNI-->
<ul>
<li>Prev by Date:
<strong><a href="msg01509.html">Re: [PATCH 1/7] vfs - merge path_is_mountpoint() and path_is_mountpoint_rcu()</a></strong>
</li>
<li>Next by Date:
<strong><a href="msg01511.html">Re: [PATCH 1/7] vfs - merge path_is_mountpoint() and path_is_mountpoint_rcu()</a></strong>
</li>
<li>Previous by thread:
<strong><a href="msg01508.html">Re: [PATCH 1/7] vfs - merge path_is_mountpoint() and path_is_mountpoint_rcu()</a></strong>
</li>
<li>Next by thread:
<strong><a href="msg01511.html">Re: [PATCH 1/7] vfs - merge path_is_mountpoint() and path_is_mountpoint_rcu()</a></strong>
</li>
<li>Index(es):
<ul>
<li><a href="maillist.html#01510"><strong>Date</strong></a></li>
<li><a href="index.html#01510"><strong>Thread</strong></a></li>
</ul>
</li>
</ul>

<!--X-BotPNI-End-->
<!--X-User-Footer-->
<center>
<font size=-1>
<a href=/lists/>[Index&nbsp;of&nbsp;Archives]</a>
&nbsp;
&nbsp;
<a href=/lists/linux-fsdevel/>[Linux&nbsp;Filesystem&nbsp;Development]</a>
&nbsp;
&nbsp;
<a href=/lists/linux-ext4/>[Linux&nbsp;Ext4]</a>
&nbsp;
&nbsp;
<a href=/lists/arm-kernel/>[Linux&nbsp;ARM&nbsp;Kernel]</a>
&nbsp;
&nbsp;
<a href=/lists/arm/>[Linux&nbsp;ARM]</a>
&nbsp;
&nbsp;
<a href=/lists/linux-omap/>[Linux&nbsp;Omap]</a>
&nbsp;
&nbsp;
<a href=/linux/fedora/fedora-arm/>[Fedora&nbsp;ARM]</a>
&nbsp;
&nbsp;
<a href=/lists/ietf-ann/>[IETF&nbsp;Annouce]</a>
&nbsp;
&nbsp;
<a href=/lists/security/>[Security]</a>
&nbsp;
&nbsp;
<a href=/lists/bugtraq/>[Bugtraq]</a>
&nbsp;
&nbsp;
<a href=/linux/>[Linux]</a>
&nbsp;
&nbsp;
<a href=/lists/linux-omap/>[Linux&nbsp;OMAP]</a>
&nbsp;
&nbsp;
<a href=/lists/mips/>[Linux&nbsp;MIPS]</a>
&nbsp;
&nbsp;
<a href=/lists/ecos/>[ECOS]</a>
&nbsp;
&nbsp;
<a href=/lists/asterisk/>[Asterisk&nbsp;Internet&nbsp;PBX]</a>
&nbsp;
&nbsp;
<a href=/lists/linux-api/>[Linux&nbsp;API]</a>
</font>
</center>
<hr>
<p>
<div>
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<ins class="adsbygoogle"
     style="display:block"
     data-ad-format="autorelaxed"
     data-ad-client="ca-pub-3422782820843221"
     data-ad-slot="1424524564"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
</div>
<table width=100%>
<tr>
<td align=left>&nbsp;</td>
<td align=right><a href=/lists/><img src=/button_01.gif border=0 alt="Powered by Linux"></a></td>
</tr>
</table>
<!--X-User-Footer-End-->
<script type="text/javascript"> 
 function initAddThis() {
    addthis.init()
 }
initAddThis();
</script>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-760190-1', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
