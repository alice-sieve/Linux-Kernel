<!-- MHonArc v2.6.19 -->
<!--X-Subject: [PATCH 51/87] drm/amd/display: put back front end initialization sequence -->
<!--X-From-R13: &#60;fhacrat.yvNnzq.pbz> -->
<!--X-Date: Mon, 15 Jul 2019 14:21:50 &#45;0700 -->
<!--X-Message-Id: 20190715212049.4584&#45;52&#45;sunpeng.li@amd.com -->
<!--X-Content-Type: text/plain -->
<!--X-Reference: 20190715212049.4584&#45;1&#45;sunpeng.li@amd.com -->
<!--X-Head-End-->
<!doctype html public "-//W3C//DTD HTML//EN">
<html>
<head>
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({
          google_ad_client: "ca-pub-3422782820843221",
          enable_page_level_ads: true
     });
</script>
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="description" content="AMD GFX: [PATCH 51/87] drm/amd/display: put back front end initialization sequence">
<style>
<!--
 pre {white-space: pre-wrap;}
-->
</style>
<title>[PATCH 51/87] drm/amd/display: put back front end initialization sequence &mdash; Linux AMD GFX</title>
<link rel="alternate" type="application/rss+xml" title="Linux AMD GFX" href="//feeds.feedburner.com/LinuxAmdGraphics">
</head>
<body itemscope itemtype="//schema.org/Article" bgcolor=white vlink=green link=blue>
<!--X-Body-Begin-->
<!--X-User-Header-->
<!--X-User-Header-End-->
<!--X-TopPNI-->
<form action="//www.google.com" id="cse-search-box" target="_blank">
  <div>
    <input type="hidden" name="cx" value="partner-pub-3422782820843221:9580497365" />
    <input type="hidden" name="ie" value="UTF-8" />
    <input type="text" name="q" size="25" />
    <input type="submit" name="sa" value="Search" />
  </div>
</form>
<script type="text/javascript" src="//www.google.com/coop/cse/brand?form=cse-search-box&amp;lang=en" async defer></script>
<h1 itemprop="name">[PATCH 51/87] drm/amd/display: put back front end initialization sequence</h1>
[<a href="msg35895.html">Date Prev</a>][<a href="msg35897.html">Date Next</a>][<a href="msg35895.html">Thread Prev</a>][<a href="msg35897.html">Thread Next</a>][<a href="maillist.html#35896">Date Index</a>][<a href="index.html#35896">Thread Index</a>]


<p>&nbsp;<br>
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- responsive test for archives -->
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-3422782820843221"
     data-ad-slot="6345952567"
     data-ad-format="auto"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>

<!--X-TopPNI-End-->
<!--X-MsgBody-->
<!--X-Subject-Header-Begin-->
<hr>
<!--X-Subject-Header-End-->
<!--X-Head-of-Message-->
<ul>
<li><em>To</em>: &lt;amd-gfx@xxxxxxxxxxxxxxxxxxxxx&gt;</li>
<li><em>Subject</em>: [PATCH 51/87] drm/amd/display: put back front end initialization sequence</li>
<li><em>From</em>: &lt;sunpeng.li@xxxxxxx&gt;</li>
<li><em>Date</em>: Mon, 15 Jul 2019 17:20:13 -0400</li>
<li><em>Cc</em>: Leo Li &lt;sunpeng.li@xxxxxxx&gt;, Tony Cheng &lt;Tony.Cheng@xxxxxxx&gt;,        Anthony Koo &lt;Anthony.Koo@xxxxxxx&gt;, Eric Yang &lt;Eric.Yang2@xxxxxxx&gt;</li>
<li><em>In-reply-to</em>: &lt;<a href="msg35850.html">20190715212049.4584-1-sunpeng.li@amd.com</a>&gt;</li>
<li><em>References</em>: &lt;<a href="msg35850.html">20190715212049.4584-1-sunpeng.li@amd.com</a>&gt;</li>
</ul>
<!--X-Head-of-Message-End-->
<!--X-Head-Body-Sep-Begin-->
<!-- AddThis Button BEGIN -->
<div class="addthis_toolbox addthis_default_style ">
<a class="addthis_button_preferred_1"></a>
<a class="addthis_button_preferred_2"></a>
<a class="addthis_button_preferred_3"></a>
<a class="addthis_button_preferred_4"></a>
<a class="addthis_button_compact"></a>
<a class="addthis_counter addthis_bubble_style"></a>
</div>
<script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5196c2ae1be43d18&async=1&domready=1" async></script>
<!-- AddThis Button END -->
<hr>
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- responsive link 1 -->
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-3422782820843221"
     data-ad-slot="8681825769"
     data-ad-format="link"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
<p>
<div class="content" itemprop="articleBody">
<!--X-Head-Body-Sep-End-->
<!--X-Body-of-Message-->
<pre>From: Eric Yang &lt;Eric.Yang2@xxxxxxx&gt;

[Why]
Seamless boot optimization removed proper front end power off sequence.
In driver disable enable case, this causes driver to power gate hubp
and dpp while there is still memory fetching going on, this can cause
invalid memory requests to be generated which will hang data fabric.

[How]
Put back proper front end power off sequence

Signed-off-by: Eric Yang &lt;Eric.Yang2@xxxxxxx&gt;
Reviewed-by: Anthony Koo &lt;Anthony.Koo@xxxxxxx&gt;
Acked-by: Leo Li &lt;sunpeng.li@xxxxxxx&gt;
Acked-by: Tony Cheng &lt;Tony.Cheng@xxxxxxx&gt;
---
 .../drm/amd/display/dc/dcn10/dcn10_hw_sequencer.c | 15 +--------------
 1 file changed, 1 insertion(+), 14 deletions(-)

diff --git a/drivers/gpu/drm/amd/display/dc/dcn10/dcn10_hw_sequencer.c b/drivers/gpu/drm/amd/display/dc/dcn10/dcn10_hw_sequencer.c
index 9f08bfb7f238..40a8198ce934 100644
--- a/drivers/gpu/drm/amd/display/dc/dcn10/dcn10_hw_sequencer.c
+++ b/drivers/gpu/drm/amd/display/dc/dcn10/dcn10_hw_sequencer.c
@@ -1194,16 +1194,7 @@ static void dcn10_init_hw(struct dc *dc)
 	 * everything down.
 	 */
 	if (dcb-&gt;funcs-&gt;is_accelerated_mode(dcb) || dc-&gt;config.power_down_display_on_boot) {
-		for (i = 0; i &lt; dc-&gt;res_pool-&gt;pipe_count; i++) {
-			struct hubp *hubp = dc-&gt;res_pool-&gt;hubps[i];
-			struct dpp *dpp = dc-&gt;res_pool-&gt;dpps[i];
-
-			hubp-&gt;funcs-&gt;hubp_init(hubp);
-			dc-&gt;res_pool-&gt;opps[i]-&gt;mpc_tree_params.opp_id = dc-&gt;res_pool-&gt;opps[i]-&gt;inst;
-			plane_atomic_power_down(dc, dpp, hubp);
-		}
-
-		apply_DEGVIDCN10_253_wa(dc);
+		dc-&gt;hwss.init_pipes(dc, dc-&gt;current_state);
 	}
 
 	for (i = 0; i &lt; dc-&gt;res_pool-&gt;audio_count; i++) {
@@ -1374,10 +1365,6 @@ static bool dcn10_set_input_transfer_func(struct pipe_ctx *pipe_ctx,
 	return result;
 }
 
-
-
-
-
 static bool
 dcn10_set_output_transfer_func(struct pipe_ctx *pipe_ctx,
 			       const struct dc_stream_state *stream)
-- 
2.22.0

_______________________________________________
amd-gfx mailing list
amd-gfx@xxxxxxxxxxxxxxxxxxxxx
<a  rel="nofollow" href="https://lists.freedesktop.org/mailman/listinfo/amd-gfx">https://lists.freedesktop.org/mailman/listinfo/amd-gfx</a>



</pre>
<!--X-Body-of-Message-End-->
<!--X-MsgBody-End-->
<!--X-Follow-Ups-->
</div>
<hr>
<!--X-Follow-Ups-End-->
<!--X-References-->
<ul><li><strong>References</strong>:
<ul>
<li><strong><a name="35850" href="msg35850.html">[PATCH 00/87] DC Patches 15 Jul, 2019</a></strong>
<ul><li><em>From:</em> sunpeng.li</li></ul></li>
</ul></li></ul>
<!--X-References-End-->
<!--X-BotPNI-->
<ul>
<li>Prev by Date:
<strong><a href="msg35895.html">[PATCH 37/87] drm/amd/display: Power-gate all DSCs at driver init time</a></strong>
</li>
<li>Next by Date:
<strong><a href="msg35897.html">[PATCH 45/87] drm/amd/display: Remove second initialization of pp_smu</a></strong>
</li>
<li>Previous by thread:
<strong><a href="msg35895.html">[PATCH 37/87] drm/amd/display: Power-gate all DSCs at driver init time</a></strong>
</li>
<li>Next by thread:
<strong><a href="msg35897.html">[PATCH 45/87] drm/amd/display: Remove second initialization of pp_smu</a></strong>
</li>
<li>Index(es):
<ul>
<li><a href="maillist.html#35896"><strong>Date</strong></a></li>
<li><a href="index.html#35896"><strong>Thread</strong></a></li>
</ul>
</li>
</ul>

<!--X-BotPNI-End-->
<!--X-User-Footer-->
<center>
<font size=-1>
<a href=/lists/>[Index&nbsp;of&nbsp;Archives]</a>
&nbsp;
&nbsp;
<a href=/lists/linux-usb/>[Linux&nbsp;USB&nbsp;Devel]</a>
&nbsp;
&nbsp;
<a href=/lists/linux-audio-users/>[Linux&nbsp;Audio&nbsp;Users]</a>
&nbsp;
&nbsp;
<a href=https://yosemitenews.info/>[Yosemite&nbsp;News]</a>
&nbsp;
&nbsp;
<a href=/lists/kernel/>[Linux&nbsp;Kernel]</a>
&nbsp;
&nbsp;
<a href=/lists/linux-scsi/>[Linux&nbsp;SCSI]</a>
</font>
</center>
<hr>
<p>
<div>
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<ins class="adsbygoogle"
     style="display:block"
     data-ad-format="autorelaxed"
     data-ad-client="ca-pub-3422782820843221"
     data-ad-slot="1424524564"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
</div>
<table width=100%>
<tr>
<td align=left>&nbsp;</td>
<td align=right><a href=/lists/><img src=/button_01.gif border=0 alt="Powered by Linux"></a></td>
</tr>
</table>
<!--X-User-Footer-End-->
<script type="text/javascript"> 
 function initAddThis() {
    addthis.init()
 }
initAddThis();
</script>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-760190-1', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
