<!-- MHonArc v2.6.19 -->
<!--X-Subject: [PATCH AUTOSEL 4.19 026/101] drm/amd/display: Always allocate initial connector state state -->
<!--X-From-R13: Enfun Zriva &#60;fnfunyNxreary.bet> -->
<!--X-Date: Thu, 18 Jul 2019 21:08:31 &#45;0700 -->
<!--X-Message-Id: 20190719040732.17285&#45;26&#45;sashal@kernel.org -->
<!--X-Content-Type: text/plain -->
<!--X-Reference: 20190719040732.17285&#45;1&#45;sashal@kernel.org -->
<!--X-Head-End-->
<!doctype html public "-//W3C//DTD HTML//EN">
<html>
<head>
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({
          google_ad_client: "ca-pub-3422782820843221",
          enable_page_level_ads: true
     });
</script>
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="description" content="AMD GFX: [PATCH AUTOSEL 4.19 026/101] drm/amd/display: Always allocate initial connector state state">
<style>
<!--
 pre {white-space: pre-wrap;}
-->
</style>
<title>[PATCH AUTOSEL 4.19 026/101] drm/amd/display: Always allocate initial connector state state &mdash; Linux AMD GFX</title>
<link rel="alternate" type="application/rss+xml" title="Linux AMD GFX" href="//feeds.feedburner.com/LinuxAmdGraphics">
</head>
<body itemscope itemtype="//schema.org/Article" bgcolor=white vlink=green link=blue>
<!--X-Body-Begin-->
<!--X-User-Header-->
<!--X-User-Header-End-->
<!--X-TopPNI-->
<form action="//www.google.com" id="cse-search-box" target="_blank">
  <div>
    <input type="hidden" name="cx" value="partner-pub-3422782820843221:9580497365" />
    <input type="hidden" name="ie" value="UTF-8" />
    <input type="text" name="q" size="25" />
    <input type="submit" name="sa" value="Search" />
  </div>
</form>
<script type="text/javascript" src="//www.google.com/coop/cse/brand?form=cse-search-box&amp;lang=en" async defer></script>
<h1 itemprop="name">[PATCH AUTOSEL 4.19 026/101] drm/amd/display: Always allocate initial connector state state</h1>
[<a href="msg36222.html">Date Prev</a>][<a href="msg36224.html">Date Next</a>][<a href="msg36222.html">Thread Prev</a>][<a href="msg36224.html">Thread Next</a>][<a href="maillist.html#36223">Date Index</a>][<a href="index.html#36223">Thread Index</a>]


<p>&nbsp;<br>
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- responsive test for archives -->
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-3422782820843221"
     data-ad-slot="6345952567"
     data-ad-format="auto"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>

<!--X-TopPNI-End-->
<!--X-MsgBody-->
<!--X-Subject-Header-Begin-->
<hr>
<!--X-Subject-Header-End-->
<!--X-Head-of-Message-->
<ul>
<li><em>To</em>: linux-kernel@xxxxxxxxxxxxxxx, stable@xxxxxxxxxxxxxxx</li>
<li><em>Subject</em>: [PATCH AUTOSEL 4.19 026/101] drm/amd/display: Always allocate initial connector state state</li>
<li><em>From</em>: Sasha Levin &lt;sashal@xxxxxxxxxx&gt;</li>
<li><em>Date</em>: Fri, 19 Jul 2019 00:06:17 -0400</li>
<li><em>Cc</em>: Sasha Levin &lt;sashal@xxxxxxxxxx&gt;, Leo Li &lt;sunpeng.li@xxxxxxx&gt;,        dri-devel@xxxxxxxxxxxxxxxxxxxxx, amd-gfx@xxxxxxxxxxxxxxxxxxxxx,        Alex Deucher &lt;alexander.deucher@xxxxxxx&gt;,        Nicholas Kazlauskas &lt;nicholas.kazlauskas@xxxxxxx&gt;</li>
<li><em>In-reply-to</em>: &lt;20190719040732.17285-1-sashal@kernel.org&gt;</li>
<li><em>References</em>: &lt;20190719040732.17285-1-sashal@kernel.org&gt;</li>
</ul>
<!--X-Head-of-Message-End-->
<!--X-Head-Body-Sep-Begin-->
<!-- AddThis Button BEGIN -->
<div class="addthis_toolbox addthis_default_style ">
<a class="addthis_button_preferred_1"></a>
<a class="addthis_button_preferred_2"></a>
<a class="addthis_button_preferred_3"></a>
<a class="addthis_button_preferred_4"></a>
<a class="addthis_button_compact"></a>
<a class="addthis_counter addthis_bubble_style"></a>
</div>
<script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5196c2ae1be43d18&async=1&domready=1" async></script>
<!-- AddThis Button END -->
<hr>
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- responsive link 1 -->
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-3422782820843221"
     data-ad-slot="8681825769"
     data-ad-format="link"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
<p>
<div class="content" itemprop="articleBody">
<!--X-Head-Body-Sep-End-->
<!--X-Body-of-Message-->
<pre>From: Nicholas Kazlauskas &lt;nicholas.kazlauskas@xxxxxxx&gt;

[ Upstream commit f04bee34d6e35df26cbb2d65e801adfd0d8fe20d ]

[Why]
Unlike our regular connectors, MST connectors don't start off with
an initial connector state. This causes a NULL pointer dereference to
occur when attaching the bpc property since it tries to modify the
connector state.

We need an initial connector state on the connector to avoid the crash.

[How]
Use our reset helper to allocate an initial state and reset the values
to their defaults. We were already doing this before, just not for
MST connectors.

Signed-off-by: Nicholas Kazlauskas &lt;nicholas.kazlauskas@xxxxxxx&gt;
Reviewed-by: Leo Li &lt;sunpeng.li@xxxxxxx&gt;
Signed-off-by: Alex Deucher &lt;alexander.deucher@xxxxxxx&gt;
Signed-off-by: Sasha Levin &lt;sashal@xxxxxxxxxx&gt;
---
 drivers/gpu/drm/amd/display/amdgpu_dm/amdgpu_dm.c | 10 +++++++---
 1 file changed, 7 insertions(+), 3 deletions(-)

diff --git a/drivers/gpu/drm/amd/display/amdgpu_dm/amdgpu_dm.c b/drivers/gpu/drm/amd/display/amdgpu_dm/amdgpu_dm.c
index dac7978f5ee1..221de241535a 100644
--- a/drivers/gpu/drm/amd/display/amdgpu_dm/amdgpu_dm.c
+++ b/drivers/gpu/drm/amd/display/amdgpu_dm/amdgpu_dm.c
@@ -3644,6 +3644,13 @@ void amdgpu_dm_connector_init_helper(struct amdgpu_display_manager *dm,
 {
 	struct amdgpu_device *adev = dm-&gt;ddev-&gt;dev_private;
 
+	/*
+	 * Some of the properties below require access to state, like bpc.
+	 * Allocate some default initial connector state with our reset helper.
+	 */
+	if (aconnector-&gt;base.funcs-&gt;reset)
+		aconnector-&gt;base.funcs-&gt;reset(&amp;aconnector-&gt;base);
+
 	aconnector-&gt;connector_id = link_index;
 	aconnector-&gt;dc_link = link;
 	aconnector-&gt;base.interlace_allowed = false;
@@ -3811,9 +3818,6 @@ static int amdgpu_dm_connector_init(struct amdgpu_display_manager *dm,
 			&amp;aconnector-&gt;base,
 			&amp;amdgpu_dm_connector_helper_funcs);
 
-	if (aconnector-&gt;base.funcs-&gt;reset)
-		aconnector-&gt;base.funcs-&gt;reset(&amp;aconnector-&gt;base);
-
 	amdgpu_dm_connector_init_helper(
 		dm,
 		aconnector,
-- 
2.20.1

_______________________________________________
amd-gfx mailing list
amd-gfx@xxxxxxxxxxxxxxxxxxxxx
<a  rel="nofollow" href="https://lists.freedesktop.org/mailman/listinfo/amd-gfx">https://lists.freedesktop.org/mailman/listinfo/amd-gfx</a>



</pre>
<!--X-Body-of-Message-End-->
<!--X-MsgBody-End-->
<!--X-Follow-Ups-->
</div>
<hr>
<!--X-Follow-Ups-End-->
<!--X-References-->
<!--X-References-End-->
<!--X-BotPNI-->
<ul>
<li>Prev by Date:
<strong><a href="msg36222.html">[PATCH AUTOSEL 4.19 014/101] drm/amdkfd: Fix sdma queue map issue</a></strong>
</li>
<li>Next by Date:
<strong><a href="msg36224.html">[PATCH AUTOSEL 4.19 029/101] drm/amd/display: fix compilation error</a></strong>
</li>
<li>Previous by thread:
<strong><a href="msg36222.html">[PATCH AUTOSEL 4.19 014/101] drm/amdkfd: Fix sdma queue map issue</a></strong>
</li>
<li>Next by thread:
<strong><a href="msg36224.html">[PATCH AUTOSEL 4.19 029/101] drm/amd/display: fix compilation error</a></strong>
</li>
<li>Index(es):
<ul>
<li><a href="maillist.html#36223"><strong>Date</strong></a></li>
<li><a href="index.html#36223"><strong>Thread</strong></a></li>
</ul>
</li>
</ul>

<!--X-BotPNI-End-->
<!--X-User-Footer-->
<center>
<font size=-1>
<a href=/lists/>[Index&nbsp;of&nbsp;Archives]</a>
&nbsp;
&nbsp;
<a href=/lists/linux-usb/>[Linux&nbsp;USB&nbsp;Devel]</a>
&nbsp;
&nbsp;
<a href=/lists/linux-audio-users/>[Linux&nbsp;Audio&nbsp;Users]</a>
&nbsp;
&nbsp;
<a href=https://yosemitenews.info/>[Yosemite&nbsp;News]</a>
&nbsp;
&nbsp;
<a href=/lists/kernel/>[Linux&nbsp;Kernel]</a>
&nbsp;
&nbsp;
<a href=/lists/linux-scsi/>[Linux&nbsp;SCSI]</a>
</font>
</center>
<hr>
<p>
<div>
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<ins class="adsbygoogle"
     style="display:block"
     data-ad-format="autorelaxed"
     data-ad-client="ca-pub-3422782820843221"
     data-ad-slot="1424524564"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
</div>
<table width=100%>
<tr>
<td align=left>&nbsp;</td>
<td align=right><a href=/lists/><img src=/button_01.gif border=0 alt="Powered by Linux"></a></td>
</tr>
</table>
<!--X-User-Footer-End-->
<script type="text/javascript"> 
 function initAddThis() {
    addthis.init()
 }
initAddThis();
</script>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-760190-1', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
