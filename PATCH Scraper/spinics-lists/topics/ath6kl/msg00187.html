<!-- MHonArc v2.6.19 -->
<!--X-Subject: [PATCH] ath6kl: ignore WMI_TXE_NOTIFY_EVENTID based on fw capability flags -->
<!--X-From-R13: Egrir qrDbfvre &#60;qrebfvreNtznvy.pbz> -->
<!--X-Date: Mon, 7 Mar 2016 17:02:25 &#45;0800 -->
<!--X-Message-Id: 1457398730&#45;31088&#45;1&#45;git&#45;send&#45;email&#45;steve.derosier@lairdtech.com -->
<!--X-Content-Type: text/plain -->
<!--X-Head-End-->
<!doctype html public "-//W3C//DTD HTML//EN">
<html>
<head>
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({
          google_ad_client: "ca-pub-3422782820843221",
          enable_page_level_ads: true
     });
</script>
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="description" content="Linux ATH6KL: [PATCH] ath6kl: ignore WMI_TXE_NOTIFY_EVENTID based on fw capability flags">
<style>
<!--
 pre {white-space: pre-wrap;}
-->
</style>
<title>[PATCH] ath6kl: ignore WMI_TXE_NOTIFY_EVENTID based on fw capability flags (Linux ATH6KL)</title>
<link rel="alternate" type="application/rss+xml" title="Linux ATH6KL" href="//feedproxy.google.com/LinuxATH6KL">
<script type="text/javascript">
var addthis_config = addthis_config||{};
addthis_config.data_track_addressbar = false;
</script>
</head>
<body itemscope itemtype="//schema.org/Article" vlink=green>
<!--X-Body-Begin-->
<!--X-User-Header-->
<!--X-User-Header-End-->
<!--X-TopPNI-->
<form action="//www.google.com" id="cse-search-box" target="_blank">
  <div>
    <input type="hidden" name="cx" value="partner-pub-3422782820843221:6308783764" />
    <input type="hidden" name="ie" value="UTF-8" />
    <input type="text" name="q" size="55" />
    <input type="submit" name="sa" value="Search" />
  </div>
</form>
<script type="text/javascript" src="//www.google.com/coop/cse/brand?form=cse-search-box&amp;lang=en"></script>
<h1 itemprop="name">[PATCH] ath6kl: ignore WMI_TXE_NOTIFY_EVENTID based on fw capability flags</h1>
[<a href="msg00186.html">Date Prev</a>][<a href="msg00188.html">Date Next</a>][<a href="msg00177.html">Thread Prev</a>][<a href="msg00188.html">Thread Next</a>][<a href="maillist.html#00187">Date Index</a>][<a href="index.html#00187">Thread Index</a>] 


<p>&nbsp;<br>
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- responsive test for archives -->
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-3422782820843221"
     data-ad-slot="6345952567"
     data-ad-format="auto"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>

<!--X-TopPNI-End-->
<!--X-MsgBody-->
<!--X-Subject-Header-Begin-->
<hr>
<!--X-Subject-Header-End-->
<!--X-Head-of-Message-->
<ul>
<li><em>To</em>: Kalle Valo &lt;kvalo@xxxxxxxxxxxxxxxx&gt;</li>
<li><em>Subject</em>: [PATCH] ath6kl: ignore WMI_TXE_NOTIFY_EVENTID based on fw capability flags</li>
<li><em>From</em>: Steve deRosier &lt;derosier@xxxxxxxxx&gt;</li>
<li><em>Date</em>: Mon,  7 Mar 2016 16:58:50 -0800</li>
<li><em>Cc</em>: Steve deRosier &lt;steve.derosier@xxxxxxxxxxxxx&gt;, ath6kl@xxxxxxxxxxxxxxxxxxx,        linux-wireless@xxxxxxxxxxxxxxx</li>
</ul>
<!--X-Head-of-Message-End-->
<!--X-Head-Body-Sep-Begin-->
<!-- AddThis Button BEGIN -->
<div class="addthis_toolbox addthis_default_style ">
<a class="addthis_button_preferred_1"></a>
<a class="addthis_button_preferred_2"></a>
<a class="addthis_button_preferred_3"></a>
<a class="addthis_button_preferred_4"></a>
<a class="addthis_button_compact"></a>
<a class="addthis_counter addthis_bubble_style"></a>
</div>
<script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5196c2ae1be43d18&async=1&domready=1" async></script>
<!-- AddThis Button END -->
<hr>
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- responsive link 1 -->
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-3422782820843221"
     data-ad-slot="8681825769"
     data-ad-format="link"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
<p>
<div class="content" itemprop="articleBody">
<!--X-Head-Body-Sep-End-->
<!--X-Body-of-Message-->
<pre>Certain 6004 firmware releases redefine the WMI_TXE_NOTIFY_EVENTID event
number and sends the new event frequently. However it doesn't have the
tx-err-notify feature and thus this firmware capability flag isn't set on
the firmware package. By guarding the processing of this event by the same
method we guard the sending of the WMI_SET_TXE_NOTIFY_CMDID command, we
can ignore the spurious event that we don't know how to process.

Without this change we call cfg80211_cqm_txe_notify() with possibly bad
data.

Signed-off-by: Steve deRosier &lt;steve.derosier@xxxxxxxxxxxxx&gt;
---
 drivers/net/wireless/ath/ath6kl/wmi.c | 5 +++++
 1 file changed, 5 insertions(+)

diff --git a/drivers/net/wireless/ath/ath6kl/wmi.c b/drivers/net/wireless/ath/ath6kl/wmi.c
index a5e1de7..0b3e9c0 100644
--- a/drivers/net/wireless/ath/ath6kl/wmi.c
+++ b/drivers/net/wireless/ath/ath6kl/wmi.c
@@ -1584,6 +1584,11 @@ static int ath6kl_wmi_txe_notify_event_rx(struct wmi *wmi, u8 *datap, int len,
 	if (len &lt; sizeof(*ev))
 		return -EINVAL;
 
+	if (vif-&gt;nw_type != INFRA_NETWORK ||
+	    !test_bit(ATH6KL_FW_CAPABILITY_TX_ERR_NOTIFY,
+		      vif-&gt;ar-&gt;fw_capabilities))
+		return -EOPNOTSUPP;
+
 	if (vif-&gt;sme_state != SME_CONNECTED)
 		return -ENOTCONN;
 
-- 
1.9.1


_______________________________________________
ath6kl mailing list
ath6kl@xxxxxxxxxxxxxxxxxxx
<a  rel="nofollow" href="http://lists.infradead.org/mailman/listinfo/ath6kl">http://lists.infradead.org/mailman/listinfo/ath6kl</a>


</pre>
<!--X-Body-of-Message-End-->
<!--X-MsgBody-End-->
<!--X-Follow-Ups-->
</div>
<hr>
<ul><li><strong>Follow-Ups</strong>:
<ul>
<li><strong><a name="00188" href="msg00188.html">Re: [PATCH] ath6kl: ignore WMI_TXE_NOTIFY_EVENTID based on fw capability flags</a></strong>
<ul><li><em>From:</em> Valo, Kalle</li></ul></li>
</ul></li></ul>
<!--X-Follow-Ups-End-->
<!--X-References-->
<!--X-References-End-->
<!--X-BotPNI-->
<ul>
<li>Prev by Date:
<strong><a href="msg00186.html">Re: [ath6kl]: Concurrent mode (STA+P2P) or (AP+P2P)</a></strong>
</li>
<li>Next by Date:
<strong><a href="msg00188.html">Re: [PATCH] ath6kl: ignore WMI_TXE_NOTIFY_EVENTID based on fw capability flags</a></strong>
</li>
<li>Previous by thread:
<strong><a href="msg00177.html">[ATH6KL]: driver only supports limited channels in 5GHz band</a></strong>
</li>
<li>Next by thread:
<strong><a href="msg00188.html">Re: [PATCH] ath6kl: ignore WMI_TXE_NOTIFY_EVENTID based on fw capability flags</a></strong>
</li>
<li>Index(es):
<ul>
<li><a href="maillist.html#00187"><strong>Date</strong></a></li>
<li><a href="index.html#00187"><strong>Thread</strong></a></li>
</ul>
</li>
</ul>

<!--X-BotPNI-End-->
<!--X-User-Footer-->
<center>
<font size=-1>
<a href=/lists/>[Index&nbsp;of&nbsp;Archives]</a>
&nbsp;
&nbsp;
<a href=/lists/kernel/>[Linux&nbsp;Kernel]</a>
&nbsp;
&nbsp;
<a href=/lists/linux-wireless/>[Linux&nbsp;Wireless]</a>
&nbsp;
&nbsp;
<a href=/lists/linux-bluetooth/>[Linux&nbsp;Bluetooth]</a>
&nbsp;
&nbsp;
<a href=/lists/linux-wpan/>[Linux&nbsp;WPAN]</a>
&nbsp;
&nbsp;
<a href=/lists/netdev/>[Linux&nbsp;Netdev]</a>
&nbsp;
&nbsp;
<a href=/lists/newbies/>[Kernel&nbsp;Newbies]</a>
&nbsp;
&nbsp;
<a href=/lists/linux-ide/>[IDE]</a>
&nbsp;
&nbsp;
<a href=/lists/security/>[Security]</a>
&nbsp;
&nbsp;
<a href=/lists/git/>[Git]</a>
&nbsp;
&nbsp;
<a href=/lists/netfilter/>[Netfilter]</a>
&nbsp;
&nbsp;
<a href=/lists/bugtraq/>[Bugtraq]</a>
&nbsp;
&nbsp;
<a href=https://yosemitenews.info/>[Yosemite&nbsp;News]</a>
&nbsp;
&nbsp;
<a href=/lists/mips/>[MIPS&nbsp;Linux]</a>
&nbsp;
&nbsp;
<a href=/lists/arm/>[ARM&nbsp;Linux]</a>
&nbsp;
&nbsp;
<a href=/lists/security/>[Linux&nbsp;Security]</a>
&nbsp;
&nbsp;
<a href=/lists/raid/>[Linux&nbsp;RAID]</a>
&nbsp;
&nbsp;
<a href=/lists/ataraid/>[Linux&nbsp;ATA&nbsp;RAID]</a>
&nbsp;
&nbsp;
<a href=/lists/samba/>[Samba]</a>
</font>
</center>
<hr>
<p>
<div>
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<ins class="adsbygoogle"
     style="display:block"
     data-ad-format="autorelaxed"
     data-ad-client="ca-pub-3422782820843221"
     data-ad-slot="1424524564"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
</div>
<table width=100%>
<tr>
<td align=left>&nbsp;</td>
<td align=right><a href=/lists/><img src=/button_01.gif border=0 alt="Powered by Linux"></a></td>
</tr>
</table>
<!--X-User-Footer-End-->
<script type="text/javascript"> 
 function initAddThis() {
    addthis.init()
 }
initAddThis();
</script>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-760190-1', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
