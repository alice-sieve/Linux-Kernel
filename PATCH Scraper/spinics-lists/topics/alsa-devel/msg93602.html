<!-- MHonArc v2.6.19 -->
<!--X-Subject: [PATCH 3/7] ALSA: firewire&#45;lib: fix initial value of	data block count for IR context without CIP_DBC_IS_END_EVENT -->
<!--X-From-R13: Fnxnfuv Enxnzbgb &#60;b&#45;gnxnfuvNfnxnzbppuv.wc> -->
<!--X-Date: Sun, 7 Jul 2019 05:11:33 &#45;0700 -->
<!--X-Message-Id: 20190707120759.16371&#45;4&#45;o&#45;takashi@sakamocchi.jp -->
<!--X-Content-Type: text/plain -->
<!--X-Reference: 20190707120759.16371&#45;1&#45;o&#45;takashi@sakamocchi.jp -->
<!--X-Head-End-->
<!doctype html public "-//W3C//DTD HTML//EN">
<html>
<head>
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({
          google_ad_client: "ca-pub-3422782820843221",
          enable_page_level_ads: true
     });
</script>
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="description" content="[PATCH 3/7] ALSA: firewire-lib: fix initial value of	data block count for IR context without CIP_DBC_IS_END_EVENT &mdash; ALSA Devel">
<style>
<!--
 pre {white-space: pre-wrap;}
-->
</style>
<title>[PATCH 3/7] ALSA: firewire-lib: fix initial value of	data block count for IR context without CIP_DBC_IS_END_EVENT &mdash; ALSA Devel</title>
<link rel="alternate" type="application/rss+xml" title="ALSA Devel" href="//feedproxy.google.com/AlsaDevel">
</head>
<body itemscope itemtype="//schema.org/Article" vlink=green>
<!--X-Body-Begin-->
<!--X-User-Header-->
<!--X-User-Header-End-->
<!--X-TopPNI-->
<form action="//www.google.com" id="cse-search-box" target="_blank">
  <div>
    <input type="hidden" name="cx" value="partner-pub-3422782820843221:9580497365" />
    <input type="hidden" name="ie" value="UTF-8" />
    <input type="text" name="q" size="25" />
    <input type="submit" name="sa" value="Search" />
  </div>
</form>
<script type="text/javascript" src="//www.google.com/coop/cse/brand?form=cse-search-box&amp;lang=en"></script>
<h1 itemprop="name">[PATCH 3/7] ALSA: firewire-lib: fix initial value of	data block count for IR context without CIP_DBC_IS_END_EVENT</h1>
[<a href="msg93601.html">Date Prev</a>][<a href="msg93603.html">Date Next</a>][<a href="msg93601.html">Thread Prev</a>][<a href="msg93603.html">Thread Next</a>][<a href="maillist.html#93602">Date Index</a>][<a href="threads.html#93602">Thread Index</a>]


<p>&nbsp;<br>
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- responsive test for archives -->
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-3422782820843221"
     data-ad-slot="6345952567"
     data-ad-format="auto"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>

<!--X-TopPNI-End-->
<!--X-MsgBody-->
<!--X-Subject-Header-Begin-->
<hr>
<!--X-Subject-Header-End-->
<!--X-Head-of-Message-->
<ul>
<li><em>To</em>: clemens@xxxxxxxxxx, tiwai@xxxxxxx</li>
<li><em>Subject</em>: [PATCH 3/7] ALSA: firewire-lib: fix initial value of	data block count for IR context without CIP_DBC_IS_END_EVENT</li>
<li><em>From</em>: Takashi Sakamoto &lt;o-takashi@xxxxxxxxxxxxx&gt;</li>
<li><em>Date</em>: Sun,  7 Jul 2019 21:07:55 +0900</li>
<li><em>Cc</em>: alsa-devel@xxxxxxxxxxxxxxxx</li>
<li><em>In-reply-to</em>: &lt;<a href="msg93600.html">20190707120759.16371-1-o-takashi@sakamocchi.jp</a>&gt;</li>
<li><em>References</em>: &lt;<a href="msg93600.html">20190707120759.16371-1-o-takashi@sakamocchi.jp</a>&gt;</li>
</ul>
<!--X-Head-of-Message-End-->
<!--X-Head-Body-Sep-Begin-->
<!-- AddThis Button BEGIN -->
<div class="addthis_toolbox addthis_default_style ">
<a class="addthis_button_preferred_1"></a>
<a class="addthis_button_preferred_2"></a>
<a class="addthis_button_preferred_3"></a>
<a class="addthis_button_preferred_4"></a>
<a class="addthis_button_compact"></a>
<a class="addthis_counter addthis_bubble_style"></a>
</div>
<script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5196c2ae1be43d18&async=1&domready=1" async></script>
<!-- AddThis Button END -->
<hr>
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- responsive link 1 -->
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-3422782820843221"
     data-ad-slot="8681825769"
     data-ad-format="link"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
<p>
<div class="content" itemprop="articleBody">
<!--X-Head-Body-Sep-End-->
<!--X-Body-of-Message-->
<pre>For IR context, ALSA IEC 61883-1/6 engine uses initial value of data
block counter as UINT_MAX, to detect first isochronous packet in the
middle of packet streaming.

At present, when CIP_DBC_IS_END_EVENT is not used (i.e. for drivers except
for ALSA fireworks driver), the initial value is used as is for
tracepoints event. However, the engine can detect the value of dbc field
in the payload of first isochronous packet and the value should be assigned
to the event.

This commit fixes the bug.

Fixes: 76864868dbab (&quot;ALSA: firewire-lib: cache next data_block_counter after probing tracepoints event for IR context&quot;)
Signed-off-by: Takashi Sakamoto &lt;o-takashi@xxxxxxxxxxxxx&gt;
---
 sound/firewire/amdtp-stream.c | 6 ++++--
 1 file changed, 4 insertions(+), 2 deletions(-)

diff --git a/sound/firewire/amdtp-stream.c b/sound/firewire/amdtp-stream.c
index c8d77bb05798..c5daef7872a5 100644
--- a/sound/firewire/amdtp-stream.c
+++ b/sound/firewire/amdtp-stream.c
@@ -654,8 +654,10 @@ static int parse_ir_ctx_header(struct amdtp_stream *s, unsigned int cycle,
 			*dbc = 0;
 	}
 
-	if (err &gt;= 0 &amp;&amp; s-&gt;flags &amp; CIP_DBC_IS_END_EVENT)
-		s-&gt;data_block_counter = *dbc;
+	if (err &lt; 0)
+		return err;
+
+	s-&gt;data_block_counter = *dbc;
 
 	trace_amdtp_packet(s, cycle, cip_header, *payload_length, *data_blocks,
 			   index);
-- 
2.20.1

_______________________________________________
Alsa-devel mailing list
Alsa-devel@xxxxxxxxxxxxxxxx
<a  rel="nofollow" href="https://mailman.alsa-project.org/mailman/listinfo/alsa-devel">https://mailman.alsa-project.org/mailman/listinfo/alsa-devel</a>


</pre>
<!--X-Body-of-Message-End-->
<!--X-MsgBody-End-->
<!--X-Follow-Ups-->
</div>
<hr>
<!--X-Follow-Ups-End-->
<!--X-References-->
<ul><li><strong>References</strong>:
<ul>
<li><strong><a name="93600" href="msg93600.html">[PATCH 0/7] ALSA: firewire-lib: some fixes for	tracepoints events</a></strong>
<ul><li><em>From:</em> Takashi Sakamoto</li></ul></li>
</ul></li></ul>
<!--X-References-End-->
<!--X-BotPNI-->
<ul>
<li>Prev by Date:
<strong><a href="msg93601.html">[PATCH 2/7] ALSA: firewire-lib/fireface: fix initial	value of data block counter for IR context with CIP_NO_HEADER</a></strong>
</li>
<li>Next by Date:
<strong><a href="msg93603.html">[PATCH 4/7] ALSA: firewire-lib: fix different data	block counter between probed event and transferred	isochronous packet</a></strong>
</li>
<li>Previous by thread:
<strong><a href="msg93601.html">[PATCH 2/7] ALSA: firewire-lib/fireface: fix initial	value of data block counter for IR context with CIP_NO_HEADER</a></strong>
</li>
<li>Next by thread:
<strong><a href="msg93603.html">[PATCH 4/7] ALSA: firewire-lib: fix different data	block counter between probed event and transferred	isochronous packet</a></strong>
</li>
<li>Index(es):
<ul>
<li><a href="maillist.html#93602"><strong>Date</strong></a></li>
<li><a href="threads.html#93602"><strong>Thread</strong></a></li>
</ul>
</li>
</ul>

<!--X-BotPNI-End-->
<!--X-User-Footer-->
<center>
<font size=-1>
<a href=/lists/>[Index&nbsp;of&nbsp;Archives]</a>
&nbsp;
&nbsp;
<a href=/linux/fedora/alsa-user/>[ALSA&nbsp;User]</a>
&nbsp;
&nbsp;
<a href=/lists/linux-audio-users/>[Linux&nbsp;Audio&nbsp;Users]</a>
&nbsp;
&nbsp;
<a href=/lists/pulse-audio/>[Pulse&nbsp;Audio]</a>
&nbsp;
&nbsp;
<a href=/lists/kernel/>[Kernel&nbsp;Archive]</a>
&nbsp;
&nbsp;
<a href=/lists/asterisk/>[Asterisk&nbsp;PBX]</a>
&nbsp;
&nbsp;
<a href=http://yosemitephotos.net/>[Photo&nbsp;Sharing]</a>
&nbsp;
&nbsp;
<a href=/linux/fedora/linux-sound/>[Linux&nbsp;Sound]</a>
&nbsp;
&nbsp;
<a href=/lists/linux-media/>[Video&nbsp;4&nbsp;Linux]</a>
&nbsp;
&nbsp;
<a href=/lists/gimp/>[Gimp]</a>
&nbsp;
&nbsp;
<a href=https://yosemitenews.info>[Yosemite&nbsp;News]</a>
</font>
</center>
<hr>
<p>
<div>
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<ins class="adsbygoogle"
     style="display:block"
     data-ad-format="autorelaxed"
     data-ad-client="ca-pub-3422782820843221"
     data-ad-slot="1424524564"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
</div>
<table width=100%>
<tr>
<td align=left>&nbsp;</td>
<td align=right><a href=/lists/><img src=/button_01.gif border=0 alt="Powered by Linux"></a></td>
</tr>
</table>
<!--X-User-Footer-End-->
<script type="text/javascript"> 
 function initAddThis() {
    addthis.init()
 }
initAddThis();
</script>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-760190-1', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
