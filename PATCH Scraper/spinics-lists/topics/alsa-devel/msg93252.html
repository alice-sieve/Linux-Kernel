<!-- MHonArc v2.6.19 -->
<!--X-Subject: [PATCH 38/46] ASoC: ti: omap&#45;abe&#45;twl6040: consider	CPU&#45;Platform possibility -->
<!--X-From-R13: Yhavabev [bevzbgb &#60;xhavabev.zbevzbgb.tkNerarfnf.pbz> -->
<!--X-Date: Thu, 27 Jun 2019 19:12:49 &#45;0700 -->
<!--X-Message-Id: 87r27etrao.wl&#45;kuninori.morimoto.gx@renesas.com -->
<!--X-Content-Type: text/plain -->
<!--X-Reference: 87a7e2wkll.wl&#45;kuninori.morimoto.gx@renesas.com -->
<!--X-Head-End-->
<!doctype html public "-//W3C//DTD HTML//EN">
<html>
<head>
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({
          google_ad_client: "ca-pub-3422782820843221",
          enable_page_level_ads: true
     });
</script>
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="description" content="[PATCH 38/46] ASoC: ti: omap-abe-twl6040: consider	CPU-Platform possibility &mdash; ALSA Devel">
<style>
<!--
 pre {white-space: pre-wrap;}
-->
</style>
<title>[PATCH 38/46] ASoC: ti: omap-abe-twl6040: consider	CPU-Platform possibility &mdash; ALSA Devel</title>
<link rel="alternate" type="application/rss+xml" title="ALSA Devel" href="//feedproxy.google.com/AlsaDevel">
</head>
<body itemscope itemtype="//schema.org/Article" vlink=green>
<!--X-Body-Begin-->
<!--X-User-Header-->
<!--X-User-Header-End-->
<!--X-TopPNI-->
<form action="//www.google.com" id="cse-search-box" target="_blank">
  <div>
    <input type="hidden" name="cx" value="partner-pub-3422782820843221:9580497365" />
    <input type="hidden" name="ie" value="UTF-8" />
    <input type="text" name="q" size="25" />
    <input type="submit" name="sa" value="Search" />
  </div>
</form>
<script type="text/javascript" src="//www.google.com/coop/cse/brand?form=cse-search-box&amp;lang=en"></script>
<h1 itemprop="name">[PATCH 38/46] ASoC: ti: omap-abe-twl6040: consider	CPU-Platform possibility</h1>
[<a href="msg93251.html">Date Prev</a>][<a href="msg93253.html">Date Next</a>][<a href="msg93328.html">Thread Prev</a>][<a href="msg93333.html">Thread Next</a>][<a href="maillist.html#93252">Date Index</a>][<a href="threads.html#93252">Thread Index</a>]


<p>&nbsp;<br>
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- responsive test for archives -->
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-3422782820843221"
     data-ad-slot="6345952567"
     data-ad-format="auto"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>

<!--X-TopPNI-End-->
<!--X-MsgBody-->
<!--X-Subject-Header-Begin-->
<hr>
<!--X-Subject-Header-End-->
<!--X-Head-of-Message-->
<ul>
<li><em>To</em>: Mark Brown &lt;broonie@xxxxxxxxxx&gt;</li>
<li><em>Subject</em>: [PATCH 38/46] ASoC: ti: omap-abe-twl6040: consider	CPU-Platform possibility</li>
<li><em>From</em>: Kuninori Morimoto &lt;kuninori.morimoto.gx@xxxxxxxxxxx&gt;</li>
<li><em>Date</em>: 28 Jun 2019 10:49:22 +0900</li>
<li><em>Cc</em>: Linux-ALSA &lt;alsa-devel@xxxxxxxxxxxxxxxx&gt;</li>
<li><em>In-reply-to</em>: &lt;<a href="msg93214.html">87a7e2wkll.wl-kuninori.morimoto.gx@renesas.com</a>&gt;</li>
<li><em>References</em>: &lt;<a href="msg93214.html">87a7e2wkll.wl-kuninori.morimoto.gx@renesas.com</a>&gt;</li>
<li><em>User-agent</em>: Wanderlust/2.15.9 Emacs/24.5 Mule/6.0</li>
</ul>
<!--X-Head-of-Message-End-->
<!--X-Head-Body-Sep-Begin-->
<!-- AddThis Button BEGIN -->
<div class="addthis_toolbox addthis_default_style ">
<a class="addthis_button_preferred_1"></a>
<a class="addthis_button_preferred_2"></a>
<a class="addthis_button_preferred_3"></a>
<a class="addthis_button_preferred_4"></a>
<a class="addthis_button_compact"></a>
<a class="addthis_counter addthis_bubble_style"></a>
</div>
<script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5196c2ae1be43d18&async=1&domready=1" async></script>
<!-- AddThis Button END -->
<hr>
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- responsive link 1 -->
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-3422782820843221"
     data-ad-slot="8681825769"
     data-ad-format="link"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
<p>
<div class="content" itemprop="articleBody">
<!--X-Head-Body-Sep-End-->
<!--X-Body-of-Message-->
<pre>From: Kuninori Morimoto &lt;kuninori.morimoto.gx@xxxxxxxxxxx&gt;

commit 1306ab2eddd1 (&quot;ASoC: ti: omap-abe-twl6040: don't select unnecessary
Platform&quot;)

Current ALSA SoC avoid to add duplicate component to rtd,
and this driver was selecting CPU component as Platform component.
Thus, above patch removed Platform settings from this driver,
because it assumed these are same component.

But, some CPU driver is using generic DMAEngine, in such case, both
CPU component and Platform component will have same of_node/name.
In other words, there are some components which are different but
have same of_node/name.

In such case, Card driver definitely need to select Platform even
though it is same as CPU.
It is depends on CPU driver, but is difficult to know it from Card driver.
This patch reverts above patch.

Fixes: commit 1306ab2eddd1 (&quot;ASoC: ti: omap-abe-twl6040: don't select unnecessary Platform&quot;)
Signed-off-by: Kuninori Morimoto &lt;kuninori.morimoto.gx@xxxxxxxxxxx&gt;
---
 sound/soc/ti/omap-abe-twl6040.c | 22 ++++++++++++++--------
 1 file changed, 14 insertions(+), 8 deletions(-)

diff --git a/sound/soc/ti/omap-abe-twl6040.c b/sound/soc/ti/omap-abe-twl6040.c
index 5572f5a..6d564ab 100644
--- a/sound/soc/ti/omap-abe-twl6040.c
+++ b/sound/soc/ti/omap-abe-twl6040.c
@@ -21,17 +21,17 @@
 #include &quot;omap-mcpdm.h&quot;
 #include &quot;../codecs/twl6040.h&quot;
 
-SND_SOC_DAILINK_DEF(link0_cpus,
-	DAILINK_COMP_ARRAY(COMP_EMPTY()));
-SND_SOC_DAILINK_DEF(link0_codecs,
+SND_SOC_DAILINK_DEFS(link0,
+	DAILINK_COMP_ARRAY(COMP_EMPTY()),
 	DAILINK_COMP_ARRAY(COMP_CODEC(&quot;twl6040-codec&quot;,
-				      &quot;twl6040-legacy&quot;)));
-
-SND_SOC_DAILINK_DEF(link1_cpus,
+				      &quot;twl6040-legacy&quot;)),
 	DAILINK_COMP_ARRAY(COMP_EMPTY()));
-SND_SOC_DAILINK_DEF(link1_codecs,
+
+SND_SOC_DAILINK_DEFS(link1,
+	DAILINK_COMP_ARRAY(COMP_EMPTY()),
 	DAILINK_COMP_ARRAY(COMP_CODEC(&quot;dmic-codec&quot;,
-				      &quot;dmic-hifi&quot;)));
+				      &quot;dmic-hifi&quot;)),
+	DAILINK_COMP_ARRAY(COMP_EMPTY()));
 
 struct abe_twl6040 {
 	struct snd_soc_card card;
@@ -256,6 +256,9 @@ static int omap_abe_probe(struct platform_device *pdev)
 	priv-&gt;dai_links[0].cpus = link0_cpus;
 	priv-&gt;dai_links[0].num_cpus = 1;
 	priv-&gt;dai_links[0].cpus-&gt;of_node = dai_node;
+	priv-&gt;dai_links[0].platforms = link0_platforms;
+	priv-&gt;dai_links[0].num_platforms = 1;
+	priv-&gt;dai_links[0].platforms-&gt;of_node = dai_node;
 	priv-&gt;dai_links[0].codecs = link0_codecs;
 	priv-&gt;dai_links[0].num_codecs = 1;
 	priv-&gt;dai_links[0].init = omap_abe_twl6040_init;
@@ -269,6 +272,9 @@ static int omap_abe_probe(struct platform_device *pdev)
 		priv-&gt;dai_links[1].cpus = link1_cpus;
 		priv-&gt;dai_links[1].num_cpus = 1;
 		priv-&gt;dai_links[1].cpus-&gt;of_node = dai_node;
+		priv-&gt;dai_links[1].platforms = link1_platforms;
+		priv-&gt;dai_links[1].num_platforms = 1;
+		priv-&gt;dai_links[1].platforms-&gt;of_node = dai_node;
 		priv-&gt;dai_links[1].codecs = link1_codecs;
 		priv-&gt;dai_links[1].num_codecs = 1;
 		priv-&gt;dai_links[1].init = omap_abe_dmic_init;
-- 
2.7.4

_______________________________________________
Alsa-devel mailing list
Alsa-devel@xxxxxxxxxxxxxxxx
<a  rel="nofollow" href="https://mailman.alsa-project.org/mailman/listinfo/alsa-devel">https://mailman.alsa-project.org/mailman/listinfo/alsa-devel</a>


</pre>
<!--X-Body-of-Message-End-->
<!--X-MsgBody-End-->
<!--X-Follow-Ups-->
</div>
<hr>
<ul><li><strong>Follow-Ups</strong>:
<ul>
<li><strong><a name="93333" href="msg93333.html">Applied &quot;ASoC: ti: omap-abe-twl6040: consider	CPU-Platform possibility&quot; to the asoc tree</a></strong>
<ul><li><em>From:</em> Mark Brown</li></ul></li>
</ul></li></ul>
<!--X-Follow-Ups-End-->
<!--X-References-->
<ul><li><strong>References</strong>:
<ul>
<li><strong><a name="93214" href="msg93214.html">[PATCH 00/46] ASoC: consider CPU-Platform possibility</a></strong>
<ul><li><em>From:</em> Kuninori Morimoto</li></ul></li>
</ul></li></ul>
<!--X-References-End-->
<!--X-BotPNI-->
<ul>
<li>Prev by Date:
<strong><a href="msg93251.html">[PATCH 37/46] ASoC: ti: davinci-evm: consider	CPU-Platform possibility</a></strong>
</li>
<li>Next by Date:
<strong><a href="msg93253.html">[PATCH 39/46] ASoC: ti: omap-hdmi: consider	CPU-Platform possibility</a></strong>
</li>
<li>Previous by thread:
<strong><a href="msg93328.html">Applied &quot;ASoC: ti: davinci-evm: consider CPU-Platform	possibility&quot; to the asoc tree</a></strong>
</li>
<li>Next by thread:
<strong><a href="msg93333.html">Applied &quot;ASoC: ti: omap-abe-twl6040: consider	CPU-Platform possibility&quot; to the asoc tree</a></strong>
</li>
<li>Index(es):
<ul>
<li><a href="maillist.html#93252"><strong>Date</strong></a></li>
<li><a href="threads.html#93252"><strong>Thread</strong></a></li>
</ul>
</li>
</ul>

<!--X-BotPNI-End-->
<!--X-User-Footer-->
<center>
<font size=-1>
<a href=/lists/>[Index&nbsp;of&nbsp;Archives]</a>
&nbsp;
&nbsp;
<a href=/linux/fedora/alsa-user/>[ALSA&nbsp;User]</a>
&nbsp;
&nbsp;
<a href=/lists/linux-audio-users/>[Linux&nbsp;Audio&nbsp;Users]</a>
&nbsp;
&nbsp;
<a href=/lists/pulse-audio/>[Pulse&nbsp;Audio]</a>
&nbsp;
&nbsp;
<a href=/lists/kernel/>[Kernel&nbsp;Archive]</a>
&nbsp;
&nbsp;
<a href=/lists/asterisk/>[Asterisk&nbsp;PBX]</a>
&nbsp;
&nbsp;
<a href=http://yosemitephotos.net/>[Photo&nbsp;Sharing]</a>
&nbsp;
&nbsp;
<a href=/linux/fedora/linux-sound/>[Linux&nbsp;Sound]</a>
&nbsp;
&nbsp;
<a href=/lists/linux-media/>[Video&nbsp;4&nbsp;Linux]</a>
&nbsp;
&nbsp;
<a href=/lists/gimp/>[Gimp]</a>
&nbsp;
&nbsp;
<a href=https://yosemitenews.info>[Yosemite&nbsp;News]</a>
</font>
</center>
<hr>
<p>
<div>
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<ins class="adsbygoogle"
     style="display:block"
     data-ad-format="autorelaxed"
     data-ad-client="ca-pub-3422782820843221"
     data-ad-slot="1424524564"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
</div>
<table width=100%>
<tr>
<td align=left>&nbsp;</td>
<td align=right><a href=/lists/><img src=/button_01.gif border=0 alt="Powered by Linux"></a></td>
</tr>
</table>
<!--X-User-Footer-End-->
<script type="text/javascript"> 
 function initAddThis() {
    addthis.init()
 }
initAddThis();
</script>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-760190-1', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
