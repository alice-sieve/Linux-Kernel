<!-- MHonArc v2.6.19 -->
<!--X-Subject: Re: [PATCH RFC 0/4] Add support to directly attach BPF program to ftrace -->
<!--X-From-R13: Xbry Treanaqrf &#60;wbryNwbrysreanaqrf.bet> -->
<!--X-Date: Wed, 17 Jul 2019 06:01:31 &#45;0700 -->
<!--X-Message-Id: 20190717130119.GA138030@google.com -->
<!--X-Content-Type: text/plain -->
<!--X-Reference: 20190710141548.132193&#45;1&#45;joel@joelfernandes.org -->
<!--X-Reference: 20190716205455.iimn3pqpvsc3k4ry@ast&#45;mbp.dhcp.thefacebook.com -->
<!--X-Reference: 20190716213050.GA161922@google.com -->
<!--X-Reference: 20190716222650.tk2coihjtsxszarf@ast&#45;mbp.dhcp.thefacebook.com -->
<!--X-Reference: 20190716224150.GC172157@google.com -->
<!--X-Reference: 20190716235500.GA199237@google.com -->
<!--X-Reference: 20190717012406.lugqemvubixfdd6v@ast&#45;mbp.dhcp.thefacebook.com -->
<!--X-Head-End-->
<!doctype html public "-//W3C//DTD HTML//EN">
<html>
<head>
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({
          google_ad_client: "ca-pub-3422782820843221",
          enable_page_level_ads: true
     });
</script>
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="description" content="BPF: Re: [PATCH RFC 0/4] Add support to directly attach BPF program to ftrace">
<style>
<!--
 pre {white-space: pre-wrap;}
-->
</style>
<title>Re: [PATCH RFC 0/4] Add support to directly attach BPF program to ftrace &mdash; BPF</title>
<link rel="alternate" type="application/rss+xml" title="BPF" href="//feeds.feedburner.com/packetfilters">
<script type="text/javascript">
var addthis_config = addthis_config||{};
addthis_config.data_track_addressbar = false;
</script>
</head>
<body itemscope itemtype="//schema.org/Article" bgcolor=white vlink=green link=blue>
<!--X-Body-Begin-->
<!--X-User-Header-->
<!--X-User-Header-End-->
<!--X-TopPNI-->
<form action="//www.google.com" id="cse-search-box" target="_blank">
  <div>
    <input type="hidden" name="cx" value="partner-pub-3422782820843221:9580497365" />
    <input type="hidden" name="ie" value="UTF-8" />
    <input type="text" name="q" size="25" />
    <input type="submit" name="sa" value="Search" />
  </div>
</form>
<script type="text/javascript" src="//www.google.com/coop/cse/brand?form=cse-search-box&amp;lang=en"></script>
<h1 itemprop="name">Re: [PATCH RFC 0/4] Add support to directly attach BPF program to ftrace</h1>
[<a href="msg05484.html">Date Prev</a>][<a href="msg05486.html">Date Next</a>][<a href="msg05469.html">Thread Prev</a>][<a href="msg05488.html">Thread Next</a>][<a href="maillist.html#05485">Date Index</a>][<a href="index.html#05485">Thread Index</a>]


<p>&nbsp;<br>
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- responsive test for archives -->
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-3422782820843221"
     data-ad-slot="6345952567"
     data-ad-format="auto"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>

<!--X-TopPNI-End-->
<!--X-MsgBody-->
<!--X-Subject-Header-Begin-->
<hr>
<!--X-Subject-Header-End-->
<!--X-Head-of-Message-->
<ul>
<li><em>Subject</em>: Re: [PATCH RFC 0/4] Add support to directly attach BPF program to ftrace</li>
<li><em>From</em>: Joel Fernandes &lt;joel@xxxxxxxxxxxxxxxxx&gt;</li>
<li><em>Date</em>: Wed, 17 Jul 2019 09:01:19 -0400</li>
<li><em>Cc</em>: linux-kernel@xxxxxxxxxxxxxxx,        Adrian Ratiu &lt;adrian.ratiu@xxxxxxxxxxxxx&gt;,        Alexei Starovoitov &lt;ast@xxxxxxxxxx&gt;, bpf@xxxxxxxxxxxxxxx,        Brendan Gregg &lt;brendan.d.gregg@xxxxxxxxx&gt;, connoro@xxxxxxxxxx,        Daniel Borkmann &lt;daniel@xxxxxxxxxxxxx&gt;,        duyuchao &lt;yuchao.du@xxxxxxxxxx&gt;, Ingo Molnar &lt;mingo@xxxxxxxxxx&gt;,        jeffv@xxxxxxxxxx, Karim Yaghmour &lt;karim.yaghmour@xxxxxxxxxxx&gt;,        kernel-team@xxxxxxxxxxx, linux-kselftest@xxxxxxxxxxxxxxx,        Manali Shukla &lt;manalishukla14@xxxxxxxxx&gt;,        Manjo Raja Rao &lt;linux@xxxxxxxxxxxxxxxx&gt;,        Martin KaFai Lau &lt;kafai@xxxxxx&gt;,        Masami Hiramatsu &lt;mhiramat@xxxxxxxxxx&gt;, Matt Mullins &lt;mmullins@xxxxxx&gt;,        Michal Gregorczyk &lt;michalgr@xxxxxx&gt;,        Michal Gregorczyk &lt;michalgr@xxxxxxxx&gt;,        Mohammad Husain &lt;russoue@xxxxxxxxx&gt;, namhyung@xxxxxxxxxx,        namhyung@xxxxxxxxxx, netdev@xxxxxxxxxxxxxxx, paul.chaignon@xxxxxxxxx,        primiano@xxxxxxxxxx, Qais Yousef &lt;qais.yousef@xxxxxxx&gt;,        Shuah Khan &lt;shuah@xxxxxxxxxx&gt;, Song Liu &lt;songliubraving@xxxxxx&gt;,        Srinivas Ramana &lt;sramana@xxxxxxxxxxxxxx&gt;,        Steven Rostedt &lt;rostedt@xxxxxxxxxxx&gt;,        Tamir Carmeli &lt;carmeli.tamir@xxxxxxxxx&gt;, Yonghong Song &lt;yhs@xxxxxx&gt;</li>
<li><em>In-reply-to</em>: &lt;<a href="msg05469.html">20190717012406.lugqemvubixfdd6v@ast-mbp.dhcp.thefacebook.com</a>&gt;</li>
<li><em>User-agent</em>: Mutt/1.10.1 (2018-07-13)</li>
</ul>
<!--X-Head-of-Message-End-->
<!--X-Head-Body-Sep-Begin-->
<!-- AddThis Button BEGIN -->
<div class="addthis_toolbox addthis_default_style ">
<a class="addthis_button_preferred_1"></a>
<a class="addthis_button_preferred_2"></a>
<a class="addthis_button_preferred_3"></a>
<a class="addthis_button_preferred_4"></a>
<a class="addthis_button_compact"></a>
<a class="addthis_counter addthis_bubble_style"></a>
</div>
<script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5196c2ae1be43d18&async=1&domready=1" async></script>
<!-- AddThis Button END -->
<hr>
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- responsive link 1 -->
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-3422782820843221"
     data-ad-slot="8681825769"
     data-ad-format="link"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
<p>
<div class="content" itemprop="articleBody">
<!--X-Head-Body-Sep-End-->
<!--X-Body-of-Message-->
<pre>On Tue, Jul 16, 2019 at 06:24:07PM -0700, Alexei Starovoitov wrote:
[snip]
&gt;<i> &gt; &gt; &gt; &gt; I don't see why a new bpf node for a trace event is a bad idea, really.</i>
&gt;<i> &gt; &gt; &gt; </i>
&gt;<i> &gt; &gt; &gt; See the patches for kprobe/uprobe FD-based api and the reasons behind it.</i>
&gt;<i> &gt; &gt; &gt; tldr: text is racy, doesn't scale, poor security, etc.</i>
&gt;<i> &gt; &gt; </i>
&gt;<i> &gt; &gt; Is it possible to use perf without CAP_SYS_ADMIN and control security at the</i>
&gt;<i> &gt; &gt; per-event level? We are selective about who can access which event, using</i>
&gt;<i> &gt; &gt; selinux. That's how our ftrace-based tracers work. Its fine grained per-event</i>
&gt;<i> &gt; &gt; control. That's where I was going with the tracefs approach since we get that</i>
&gt;<i> &gt; &gt; granularity using the file system.</i>
&gt;<i> </i>
&gt;<i> android's choice of selinux is not a factor in deciding kernel apis.</i>
&gt;<i> It's completely separate discusion wether disallowing particular tracepoints</i>
&gt;<i> for given user make sense at all.</i>
&gt;<i> Just because you can hack it in via selinux blocking particular</i>
&gt;<i> /sys/debug/tracing/ directory and convince yourself that it's somehow</i>
&gt;<i> makes android more secure. It doesn't mean that all new api should fit</i>
&gt;<i> into this model.</i>

Its not like a hack, it is just control of which tracefs node can be
accessed and which cannot be since the tracing can run on production systems
out in the field and there are several concerns to address like security,
privacy etc. It is not just for debugging usecases. We do collect traces out
in the field where these issues are real and cannot be ignored.

SELinux model is deny everything, and then selectively grant access to what
is needed. The VFS and security LSM hooks provide this control quite well. I am
not sure if such control is possible through perf hence I asked the question.

&gt;<i> I think allowing one tracepoint and disallowing another is pointless</i>
&gt;<i> from security point of view. Tracing bpf program can do bpf_probe_read</i>
&gt;<i> of anything.</i>

I think the assumption here is the user controls the program instructions at
runtime, but that's not the case. The BPF program we are loading is not
dynamically generated, it is built at build time and it is loaded from a
secure verified partition, so even though it can do bpf_probe_read, it is
still not something that the user can change. And, we are planning to make it
even more secure by making it kernel verify the program at load time as well
(you were on some discussions about that a few months ago).

thanks,

 - Joel



</pre>
<!--X-Body-of-Message-End-->
<!--X-MsgBody-End-->
<!--X-Follow-Ups-->
</div>
<hr>
<ul><li><strong>Follow-Ups</strong>:
<ul>
<li><strong><a name="05488" href="msg05488.html">Re: [PATCH RFC 0/4] Add support to directly attach BPF program to ftrace</a></strong>
<ul><li><em>From:</em> Alexei Starovoitov</li></ul></li>
</ul></li></ul>
<!--X-Follow-Ups-End-->
<!--X-References-->
<ul><li><strong>References</strong>:
<ul>
<li><strong><a name="05170" href="msg05170.html">[PATCH RFC 0/4] Add support to directly attach BPF program to ftrace</a></strong>
<ul><li><em>From:</em> Joel Fernandes (Google)</li></ul></li>
<li><strong><a name="05452" href="msg05452.html">Re: [PATCH RFC 0/4] Add support to directly attach BPF program to ftrace</a></strong>
<ul><li><em>From:</em> Alexei Starovoitov</li></ul></li>
<li><strong><a name="05453" href="msg05453.html">Re: [PATCH RFC 0/4] Add support to directly attach BPF program to ftrace</a></strong>
<ul><li><em>From:</em> Joel Fernandes</li></ul></li>
<li><strong><a name="05456" href="msg05456.html">Re: [PATCH RFC 0/4] Add support to directly attach BPF program to ftrace</a></strong>
<ul><li><em>From:</em> Alexei Starovoitov</li></ul></li>
<li><strong><a name="05458" href="msg05458.html">Re: [PATCH RFC 0/4] Add support to directly attach BPF program to ftrace</a></strong>
<ul><li><em>From:</em> Joel Fernandes</li></ul></li>
<li><strong><a name="05463" href="msg05463.html">Re: [PATCH RFC 0/4] Add support to directly attach BPF program to ftrace</a></strong>
<ul><li><em>From:</em> Joel Fernandes</li></ul></li>
<li><strong><a name="05469" href="msg05469.html">Re: [PATCH RFC 0/4] Add support to directly attach BPF program to ftrace</a></strong>
<ul><li><em>From:</em> Alexei Starovoitov</li></ul></li>
</ul></li></ul>
<!--X-References-End-->
<!--X-BotPNI-->
<ul>
<li>Prev by Date:
<strong><a href="msg05484.html">[PATCH bpf] selftests/bpf: fix test_xdp_noinline on s390</a></strong>
</li>
<li>Next by Date:
<strong><a href="msg05486.html">Re: [PATCH bpf] bpf: fix narrower loads on s390</a></strong>
</li>
<li>Previous by thread:
<strong><a href="msg05469.html">Re: [PATCH RFC 0/4] Add support to directly attach BPF program to ftrace</a></strong>
</li>
<li>Next by thread:
<strong><a href="msg05488.html">Re: [PATCH RFC 0/4] Add support to directly attach BPF program to ftrace</a></strong>
</li>
<li>Index(es):
<ul>
<li><a href="maillist.html#05485"><strong>Date</strong></a></li>
<li><a href="index.html#05485"><strong>Thread</strong></a></li>
</ul>
</li>
</ul>

<!--X-BotPNI-End-->
<!--X-User-Footer-->
<center>
<font size=-1>
<a href=/lists/>[Index&nbsp;of&nbsp;Archives]</a>
&nbsp;
&nbsp;
<a href=/lists/linux-samsung-soc/>[Linux&nbsp;Samsung&nbsp;SoC]</a>
&nbsp;
&nbsp;
<a href=/lists/linux-rockchip/>[Linux&nbsp;Rockchip&nbsp;SoC]</a>
&nbsp;
&nbsp;
<a href=/lists/linux-actions/>[Linux&nbsp;Actions&nbsp;SoC]</a>
&nbsp;
&nbsp;
<a href=/lists/linux-snps-arc/>[Linux&nbsp;for&nbsp;Synopsys&nbsp;ARC&nbsp;Processors]</a>
&nbsp;
&nbsp;
<a href=/lists/linux-nfs/>[Linux&nbsp;NFS]</a>
&nbsp;
&nbsp;
<a href=/lists/linux-nilfs/>[Linux&nbsp;NILFS]</a>
&nbsp;
&nbsp;
<a href=/lists/linux-usb/>[Linux&nbsp;USB&nbsp;Devel]</a>
&nbsp;
&nbsp;
<a href=/lists/vfl/>[Video&nbsp;for&nbsp;Linux]</a>
&nbsp;
&nbsp;
<a href=/lists/linux-audio-users/>[Linux&nbsp;Audio&nbsp;Users]</a>
&nbsp;
&nbsp;
<a href=https://yosemitenews.info/>[Yosemite&nbsp;News]</a>
&nbsp;
&nbsp;
<a href=/lists/kernel/>[Linux&nbsp;Kernel]</a>
&nbsp;
&nbsp;
<a href=/lists/linux-scsi/>[Linux&nbsp;SCSI]</a>
</font>
</center>
<p>
<hr>
<div>
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<ins class="adsbygoogle"
     style="display:block"
     data-ad-format="autorelaxed"
     data-ad-client="ca-pub-3422782820843221"
     data-ad-slot="1424524564"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
</div>
<table width=100%>
<tr>
<td align=left>&nbsp;</td>
<td align=right><a href=/lists/><img src=/button_01.gif border=0 alt="Powered by Linux"></a></td>
</tr>
</table>
<!--X-User-Footer-End-->
<script type="text/javascript"> 
 function initAddThis() {
    addthis.init()
 }
initAddThis();
</script>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-760190-1', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
