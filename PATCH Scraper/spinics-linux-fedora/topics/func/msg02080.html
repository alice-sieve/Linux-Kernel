<!-- MHonArc v2.6.19 -->
<!--X-Subject: PATCH: Remove old "copyfile" method from copyfile minion code -->
<!--X-From-R13: [nephf Znhre &#60;znephfynhreNalp.ee.pbz> -->
<!--X-Date: Wed, 12 Sep 2012 16:24:28 &#45;0700 -->
<!--X-Message-Id: 46480415.U0haWpcvWu@workstation -->
<!--X-Content-Type: multipart/mixed -->
<!--X-Head-End-->
<!doctype html public "-//W3C//DTD HTML//EN">
<html>
<head>
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({
          google_ad_client: "ca-pub-3422782820843221",
          enable_page_level_ads: true
     });
</script>
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="description" content="Fedora Universal Network Connector, PATCH: Remove old &quot;copyfile&quot; method from copyfile minion code">
<style>
<!--
 pre {white-space: pre-wrap;}
-->
</style>
<title>Fedora Universal Network Connector &mdash; PATCH: Remove old &quot;copyfile&quot; method from copyfile minion code</title>
<link rel="alternate" type="application/rss+xml" title="Fedora Universal Network Connector" href="//feeds.feedburner.com/FedoraUniversalNetworkConnector">
</head>
<body itemscope itemtype="//schema.org/Article" vlink=green>
<!--X-Body-Begin-->
<!--X-User-Header-->
<!--X-User-Header-End-->
<!--X-TopPNI-->
<form action="//www.google.com" id="cse-search-box" target="_blank">
  <div>
    <input type="hidden" name="cx" value="partner-pub-3422782820843221:9580497365" />
    <input type="hidden" name="ie" value="UTF-8" />
    <input type="text" name="q" size="25" />
    <input type="submit" name="sa" value="Search" />
  </div>
</form>
<script type="text/javascript" src="//www.google.com/coop/cse/brand?form=cse-search-box&amp;lang=en"></script>
<h1 itemprop="name">PATCH: Remove old &quot;copyfile&quot; method from copyfile minion code</h1>
[<a href="msg02079.html">Date Prev</a>][<a href="msg02081.html">Date Next</a>][<a href="msg02079.html">Thread Prev</a>][<a href="msg02083.html">Thread Next</a>][<a href="maillist.html#02080">Date Index</a>][<a href="index.html#02080">Thread Index</a>]


<p>&nbsp;<br>
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- responsive test for archives -->
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-3422782820843221"
     data-ad-slot="6345952567"
     data-ad-format="auto"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>

<!--X-TopPNI-End-->
<!--X-MsgBody-->
<!--X-Subject-Header-Begin-->
<hr>
<!--X-Subject-Header-End-->
<!--X-Head-of-Message-->
<ul>
<li><em>Subject</em>: PATCH: Remove old &quot;copyfile&quot; method from copyfile minion code</li>
<li><em>From</em>: Marcus Lauer &lt;<a href="mailto:marcuslauer@DOMAIN.HIDDEN">marcuslauer@xxxxxxxxxx</a>&gt;</li>
<li><em>Date</em>: Wed, 12 Sep 2012 19:24:10 -0400</li>
<li><em>Delivered-to</em>: <a href="mailto:func@DOMAIN.HIDDEN">func@xxxxxxxxxxxxxxxxxxxxxx</a></li>
<li><em>Reply-to</em>: <a href="mailto:marcuslauer@DOMAIN.HIDDEN">marcuslauer@xxxxxxxxxx</a>, <a href="mailto:func@DOMAIN.HIDDEN">func@xxxxxxxxxxxxxxxxxxxxxx</a></li>
<li><em>User-agent</em>: KMail/4.7.2 (Linux/3.1.10-1.16-desktop; KDE/4.7.2; x86_64; ; )</li>
</ul>
<!--X-Head-of-Message-End-->
<!--X-Head-Body-Sep-Begin-->
<!-- AddThis Button BEGIN -->
<div class="addthis_toolbox addthis_default_style ">
<a class="addthis_button_preferred_1"></a>
<a class="addthis_button_preferred_2"></a>
<a class="addthis_button_preferred_3"></a>
<a class="addthis_button_preferred_4"></a>
<a class="addthis_button_compact"></a>
<a class="addthis_counter addthis_bubble_style"></a>
</div>
<script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5196c2ae1be43d18&async=1&domready=1" async></script>
<!-- AddThis Button END -->
<hr>
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- responsive link 1 -->
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-3422782820843221"
     data-ad-slot="8681825769"
     data-ad-format="link"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
<p>
<div class="content" itemprop="articleBody">
<!--X-Head-Body-Sep-End-->
<!--X-Body-of-Message-->
<pre>        It appears that once upon a time the act of copying a file involved 
reading a file into memory and passing all of that data to a single method on 
the minion side.  That method was called &quot;copyfile&quot;.

        For some reason this method still exists even though it is unused.  
This patch removes that method.

        Note that there are several other bits of code in copyfile which are 
currently unused including the &quot;checksum&quot;, &quot;_checksum_blob&quot; and &quot;_backuplocal&quot; 
methods on the minion side and code supporting the &quot;--force&quot; option in the 
cmd_module.  I think that all of these could be useful in the future which is 
why I decided not to remove them.

--
Marcus</pre><pre>&gt;From f7ad8836e01664aaaed9884d81c4726c82d580d8 Mon Sep 17 00:00:00 2001
From: Marcus Lauer &lt;marcuslauer@xxxxxxxxxx&gt;
Date: Wed, 12 Sep 2012 18:56:57 -0400
Subject: [PATCH] CopyFile: remove old copyfile method from minion

---
 func/minion/modules/copyfile.py |   46 ---------------------------------------
 1 files changed, 0 insertions(+), 46 deletions(-)

diff --git a/func/minion/modules/copyfile.py b/func/minion/modules/copyfile.py
index 61c6a4f..d8122b9 100644
--- a/func/minion/modules/copyfile.py
+++ b/func/minion/modules/copyfile.py
@@ -98,52 +98,6 @@ class CopyFile(func_module.FuncModule):
 
         return 1
 
-
-    def copyfile(self, filepath, filebuf, mode=0644, uid=0, gid=0, force=None):
-        # -1 = problem file was not copied
-        # 1 =  file was copied
-        # 0 = file was not copied b/c file is unchanged
-
-
-        # we should probably verify mode,uid,gid are valid as well
-
-        dirpath = os.path.dirname(filepath)
-        if not os.path.exists(dirpath):
-            os.makedirs(dirpath)
-
-        remote_sum = self._checksum_blob(filebuf.data)
-        local_sum = 0
-        if os.path.exists(filepath):
-            local_sum = self.checksum(filepath)
-
-        if remote_sum != local_sum or force is not None:
-            # back up the localone
-            if os.path.exists(filepath):
-                if not self._backuplocal(filepath):
-                    return -1
-
-            # do the new write
-            try:
-                fo = open(filepath, 'w')
-                fo.write(filebuf.data)
-                fo.close()
-                del fo
-            except (IOError, OSError), e:
-                # XXX logger output here
-                return -1
-        else:
-            return 0
-
-        # hmm, need to figure out proper exceptions -akl
-        try:
-            # we could intify the mode here if it's a string
-            os.chmod(filepath, mode)
-            os.chown(filepath, uid, gid)
-        except (IOError, OSError), e:
-            return -1
-
-        return 1
-
     def _backuplocal(self, fn):
         &quot;&quot;&quot;
         make a date-marked backup of the specified file,
-- 
1.7.7

</pre><pre>_______________________________________________
func mailing list
func@xxxxxxxxxxxxxxxxxxxxxx
<a  rel="nofollow" href="https://lists.fedorahosted.org/mailman/listinfo/func">https://lists.fedorahosted.org/mailman/listinfo/func</a>
</pre>
<!--X-Body-of-Message-End-->
<!--X-MsgBody-End-->
<!--X-Follow-Ups-->
</div>
<hr>
<!--X-Follow-Ups-End-->
<!--X-References-->
<!--X-References-End-->
<!--X-BotPNI-->
<ul>
<li>Prev by Date:
<strong><a href="msg02079.html">PATCH: Improve help info for copyfile</a></strong>
</li>
<li>Next by Date:
<strong><a href="msg02081.html">PATCH (Re: Changes to copyfile functionality)</a></strong>
</li>
<li>Previous by thread:
<strong><a href="msg02079.html">PATCH: Improve help info for copyfile</a></strong>
</li>
<li>Next by thread:
<strong><a href="msg02083.html">Taking over orphaned Func and Certmaster packages</a></strong>
</li>
<li>Index(es):
<ul>
<li><a href="maillist.html#02080"><strong>Date</strong></a></li>
<li><a href="index.html#02080"><strong>Thread</strong></a></li>
</ul>
</li>
</ul>

<!--X-BotPNI-End-->
<!--X-User-Footer-->
<center>
<font size=-1>
<a href=/lists/>[Index&nbsp;of&nbsp;Archives]</a>
&nbsp;
&nbsp;
<a href=/linux/fedora/fedora-users/>[Fedora&nbsp;Users]</a>
&nbsp;
&nbsp;
<a href=/lists/netdev/>[Linux&nbsp;Networking]</a>
&nbsp;
&nbsp;
<a href=/lists/fll/>[Fedora&nbsp;Legacy&nbsp;List]</a>
&nbsp;
&nbsp;
<a href=/lists/fedora-desktop/>[Fedora&nbsp;Desktop]</a>
&nbsp;
&nbsp;
<a href=/lists/fedora-selinux/>[Fedora&nbsp;SELinux]</a>
&nbsp;
&nbsp;
<a href=http://www.ske-art.com/z//biglist.html>[Big&nbsp;List&nbsp;of&nbsp;Linux&nbsp;Books]</a>
&nbsp;
&nbsp;
<a href=https://yosemitenews.info>[Yosemite&nbsp;News]</a>
&nbsp;
&nbsp;
<a href=/lists/kde/>[KDE&nbsp;Users]</a>
</font>
</center>
<hr>
<p>
<div>
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<ins class="adsbygoogle"
     style="display:block"
     data-ad-format="autorelaxed"
     data-ad-client="ca-pub-3422782820843221"
     data-ad-slot="1424524564"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
</div>
<table width=100%>
<tr>
<td align=left>&nbsp;</td>
<td align=right><a href=/lists/><img src=/button_01.gif border=0 alt="Powered by Linux"></a></td>
</tr>
</table>
<!--X-User-Footer-End-->
<script type="text/javascript"> 
 function initAddThis() {
    addthis.init()
 }
initAddThis();
</script>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-760190-1', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
