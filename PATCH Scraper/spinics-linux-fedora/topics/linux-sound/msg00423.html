<!-- MHonArc v2.6.19 -->
<!--X-Subject: Re: [RFC PATCH] ASoC: wm8904: add CCF support -->
<!--X-From-R13: Pbevf PDSLWZZA@ &#60;o.oermvyyba.qriNtznvy.pbz> -->
<!--X-Date: Mon, 24 Mar 2014 02:44:41 &#45;0700 -->
<!--X-Message-Id: 532FFE7B.2040507@gmail.com -->
<!--X-Content-Type: text/plain -->
<!--X-Reference: 1395370262&#45;23305&#45;1&#45;git&#45;send&#45;email&#45;voice.shen@atmel.com -->
<!--X-Reference: 20140321103747.GK23372@e106331&#45;lin.cambridge.arm.com -->
<!--X-Reference: 20140321115511.GM11706@sirena.org.uk -->
<!--X-Head-End-->
<!doctype html public "-//W3C//DTD HTML//EN">
<html>
<head>
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({
          google_ad_client: "ca-pub-3422782820843221",
          enable_page_level_ads: true
     });
</script>
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="description" content="Linux Sound: Re: [RFC PATCH] ASoC: wm8904: add CCF support">
<style>
<!--
 pre {white-space: pre-wrap;}
-->
</style>
<title>Linux Sound &mdash; Re: [RFC PATCH] ASoC: wm8904: add CCF support</title>
<link rel="alternate" type="application/rss+xml" title="Linux Sound" href="//feeds.feedburner.com/LinuxSound">
</head>
<body vlink=green>
<!--X-Body-Begin-->
<!--X-User-Header-->
<!--X-User-Header-End-->
<!--X-TopPNI-->
<form action="//www.google.com" id="cse-search-box" target="_blank">
  <div>
    <input type="hidden" name="cx" value="partner-pub-3422782820843221:6612422167" />
    <input type="hidden" name="ie" value="UTF-8" />
    <input type="text" name="q" size="55" />
    <input type="submit" name="sa" value="Search" />
  </div>
</form>
<script type="text/javascript" src="//www.google.com/coop/cse/brand?form=cse-search-box&amp;lang=en"></script>
<h1 itemprop="name">Re: [RFC PATCH] ASoC: wm8904: add CCF support</h1>
[<a href="msg00422.html">Date Prev</a>][<a href="msg00424.html">Date Next</a>][<a href="msg00427.html">Thread Prev</a>][<a href="msg00425.html">Thread Next</a>][<a href="maillist.html#00423">Date Index</a>][<a href="index.html#00423">Thread Index</a>]
<script src="https://apis.google.com/js/platform.js" async defer></script>
<g:plusone size="small"></g:plusone>
<p>
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- responsive test for archives -->
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-3422782820843221"
     data-ad-slot="6345952567"
     data-ad-format="auto"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
</div>

<!--X-TopPNI-End-->
<!--X-MsgBody-->
<!--X-Subject-Header-Begin-->
<hr>
<!--X-Subject-Header-End-->
<!--X-Head-of-Message-->
<ul>
<li><em>Subject</em>: Re: [RFC PATCH] ASoC: wm8904: add CCF support</li>
<li><em>From</em>: Boris BREZILLON &lt;<a href="mailto:b.brezillon.dev@DOMAIN.HIDDEN">b.brezillon.dev@xxxxxxxxx</a>&gt;</li>
<li><em>Date</em>: Mon, 24 Mar 2014 10:44:27 +0100</li>
<li><em>Cc</em>: Bo Shen &lt;<a href="mailto:voice.shen@DOMAIN.HIDDEN">voice.shen@xxxxxxxxx</a>&gt;,        &quot;<a href="mailto:alsa-devel@DOMAIN.HIDDEN">alsa-devel@xxxxxxxxxxxxxxxx</a>&quot; &lt;<a href="mailto:alsa-devel@DOMAIN.HIDDEN">alsa-devel@xxxxxxxxxxxxxxxx</a>&gt;,        &quot;<a href="mailto:nicolas.ferre@DOMAIN.HIDDEN">nicolas.ferre@xxxxxxxxx</a>&quot; &lt;<a href="mailto:nicolas.ferre@DOMAIN.HIDDEN">nicolas.ferre@xxxxxxxxx</a>&gt;,        &quot;<a href="mailto:linux-sound@DOMAIN.HIDDEN">linux-sound@xxxxxxxxxxxxxxx</a>&quot; &lt;<a href="mailto:linux-sound@DOMAIN.HIDDEN">linux-sound@xxxxxxxxxxxxxxx</a>&gt;,        &quot;<a href="mailto:linux-arm-kernel@DOMAIN.HIDDEN">linux-arm-kernel@xxxxxxxxxxxxxxxxxxx</a>&quot; 	&lt;<a href="mailto:linux-arm-kernel@DOMAIN.HIDDEN">linux-arm-kernel@xxxxxxxxxxxxxxxxxxx</a>&gt;</li>
<li><em>In-reply-to</em>: &lt;<a href="msg00421.html">20140321115511.GM11706@sirena.org.uk</a>&gt;</li>
<li><em>User-agent</em>: Mozilla/5.0 (X11; Linux x86_64; rv:24.0) Gecko/20100101 Thunderbird/24.3.0</li>
</ul>
<!--X-Head-of-Message-End-->
<!--X-Head-Body-Sep-Begin-->
<!-- AddThis Button BEGIN -->
<div class="addthis_toolbox addthis_default_style ">
<a class="addthis_button_preferred_1"></a>
<a class="addthis_button_preferred_2"></a>
<a class="addthis_button_preferred_3"></a>
<a class="addthis_button_preferred_4"></a>
<a class="addthis_button_compact"></a>
<a class="addthis_counter addthis_bubble_style"></a>
</div>
<script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5196c2ae1be43d18&async=1&domready=1" async></script>
<!-- AddThis Button END -->
<hr>
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- responsive link 1 -->
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-3422782820843221"
     data-ad-slot="8681825769"
     data-ad-format="link"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
<p>
<div class="content" itemprop="articleBody">
<!--X-Head-Body-Sep-End-->
<!--X-Body-of-Message-->
<pre style="margin: 0em;">
Le 21/03/2014 12:55, Mark Brown a &#xE9;crit :
</pre><blockquote style="border-left: #5555EE solid 0.2em; margin: 0em; padding-left: 0.85em"><pre style="margin: 0em;">
On Fri, Mar 21, 2014 at 10:37:47AM +0000, Mark Rutland wrote:
</pre><blockquote style="border-left: #5555EE solid 0.2em; margin: 0em; padding-left: 0.85em"><pre style="margin: 0em;">
On Fri, Mar 21, 2014 at 02:51:02AM +0000, Bo Shen wrote:
</pre><blockquote style="border-left: #5555EE solid 0.2em; margin: 0em; padding-left: 0.85em"><pre style="margin: 0em;">
+  - wlf,sysclk-from-mclk: set the sys clock is driven from mclk,
</pre></blockquote><pre style="margin: 0em;">
Why can the kernel not decide this?
</pre></blockquote><pre style="margin: 0em;">
It can.

</pre><blockquote style="border-left: #5555EE solid 0.2em; margin: 0em; padding-left: 0.85em"><blockquote style="border-left: #5555EE solid 0.2em; margin: 0em; padding-left: 0.85em"><pre style="margin: 0em;">
+    - wlf,mclk-use-xtal: if the mclk is generated by crystal.
+      if without this property, the mclk is generated from SOC.
</pre></blockquote><pre style="margin: 0em;">
Huh? What exact property do you actually are about here?
</pre></blockquote><pre style="margin: 0em;">
This should just be omitted - based on the previous posting it's saying
if this is a fixed or variable rate clock.

</pre><blockquote style="border-left: #5555EE solid 0.2em; margin: 0em; padding-left: 0.85em"><blockquote style="border-left: #5555EE solid 0.2em; margin: 0em; padding-left: 0.85em"><pre style="margin: 0em;">
+    - wlf,mclk-freq: mclk's frequency
</pre></blockquote><pre style="margin: 0em;">
If you expect mclk, you should be able to query this from it. You don't
need a separate property.
Unless this is a frequency to set it to? If so, why can the kernel not
choose this?
</pre></blockquote><pre style="margin: 0em;">
Yes, quite - and even if it needs to be set explicitly the clock API
generic bindings should be able to support this (I *think* that is due
to go in during the next merge window but iddn't check yet).
</pre></blockquote><pre style="margin: 0em;">
I guess you're talking about this: <a  rel="nofollow" href="https://lkml.org/lkml/2014/3/3/324">https://lkml.org/lkml/2014/3/3/324</a>.
AFAIK this has not been accepted yet, but this is definitely the way to
go if we need to specify a default-rate from the DT.

On the whole subject, I'd like to have your opinion on how we should
implement clk handling within the wm8904 driver.

From my point of view we have 2 choices:

1) Expose the wm8904 clock tree using the CCF (and its DT bindings)

From what I read in the datasheet this would give the following DT
definition:

wm8904@xx {
    compatible=&quot;wm8904&quot;;
    [...]

    clocks {
        fll {
            compatible = &quot;wolfson,wm8904-fll&quot;
            #clock-cells = &lt;0&gt;;
            clocks = &lt;&amp;pck0&gt;;
            clock-output-names = &quot;wm8904-fll&quot;;
        };

        sysclk {
            compatible = &quot;wolfson,wm8904-sysclk&quot;
            clocks = &lt;&amp;pck0 &amp;fll&gt;;
            clock-output-names = &quot;wm8904-sysclk&quot;;
        };

        /* other clk derived from sysclk */
    };
};

If we use the CCF in the wm8904 driver, we'll have to move all users
of this chip to the CCF too (in other terms, we need to move the sam9n12
SoC and boards to the CCF).


2) keep the driver as it is except for the mclk retrieval.

wm8904@xx {
    compatible=&quot;wm8904&quot;;
    clocks = &lt;&amp;pck0&gt;;
    clock-names = &quot;mclk&quot;;
    clock-rates = &lt;32768&gt;;
};


</pre><tt>The first solution is obviously more complicated to implement (and 
</tt><tt>requires the
</tt><tt>CCF), but in the other hand, it gives fine-grained control over clk 
</tt><tt>configuration
</tt><pre style="margin: 0em;">
and use a standard way to expose/manipulate clks.

Best Regards,

Boris


--
To unsubscribe from this list: send the line &quot;unsubscribe linux-sound&quot; in
the body of a message to majordomo@xxxxxxxxxxxxxxx
More majordomo info at  <a  rel="nofollow" href="http://vger.kernel.org/majordomo-info.html">http://vger.kernel.org/majordomo-info.html</a>



</pre>
<!--X-Body-of-Message-End-->
<!--X-MsgBody-End-->
<!--X-Follow-Ups-->
<hr>
<ul><li><strong>Follow-Ups</strong>:
<ul>
<li><strong><a name="00425" href="msg00425.html">Re: [RFC PATCH] ASoC: wm8904: add CCF support</a></strong>
<ul><li><em>From:</em> Mark Brown</li></ul></li>
</ul></li></ul>
<!--X-Follow-Ups-End-->
<!--X-References-->
<ul><li><strong>References</strong>:
<ul>
<li><strong><a name="00419" href="msg00419.html">[RFC PATCH] ASoC: wm8904: add CCF support</a></strong>
<ul><li><em>From:</em> Bo Shen</li></ul></li>
<li><strong><a name="00420" href="msg00420.html">Re: [RFC PATCH] ASoC: wm8904: add CCF support</a></strong>
<ul><li><em>From:</em> Mark Rutland</li></ul></li>
<li><strong><a name="00421" href="msg00421.html">Re: [RFC PATCH] ASoC: wm8904: add CCF support</a></strong>
<ul><li><em>From:</em> Mark Brown</li></ul></li>
</ul></li></ul>
<!--X-References-End-->
<!--X-BotPNI-->
<ul>
<li>Prev by Date:
<strong><a href="msg00422.html">Re: [RFC PATCH] ASoC: wm8904: add CCF support</a></strong>
</li>
<li>Next by Date:
<strong><a href="msg00424.html">Re: [RFC PATCH] ASoC: wm8904: add CCF support</a></strong>
</li>
<li>Previous by thread:
<strong><a href="msg00427.html">Re: [RFC PATCH] ASoC: wm8904: add CCF support</a></strong>
</li>
<li>Next by thread:
<strong><a href="msg00425.html">Re: [RFC PATCH] ASoC: wm8904: add CCF support</a></strong>
</li>
<li>Index(es):
<ul>
<li><a href="maillist.html#00423"><strong>Date</strong></a></li>
<li><a href="index.html#00423"><strong>Thread</strong></a></li>
</ul>
</li>
</ul>

<!--X-BotPNI-End-->
<!--X-User-Footer-->
<center>
<font size=-1>
<a href=/lists/>[Index&nbsp;of&nbsp;Archives]</a>
&nbsp;
&nbsp;
<a href=/lists/Pulseaudio/>[Pulseaudio]</a>
&nbsp;
&nbsp;
<a href=/lists/linux-audio-users/>[Linux&nbsp;Audio&nbsp;Users]</a>
&nbsp;
&nbsp;
<a href=/lists/alsa-devel/>[ALSA&nbsp;Devel]</a>
&nbsp;
&nbsp;
<a href=/lists/fedora-desktop/>[Fedora&nbsp;Desktop]</a>
&nbsp;
&nbsp;
<a href=/lists/fedora-selinux/>[Fedora&nbsp;SELinux]</a>
&nbsp;
&nbsp;
<a href=http://www.ske-art.com/z/biglist.html>[Big&nbsp;List&nbsp;of&nbsp;Linux&nbsp;Books]</a>
&nbsp;
&nbsp;
<a href=https://yosemitenews.info>[Yosemite&nbsp;News]</a>
&nbsp;
&nbsp;
<a href=/lists/kde/>[KDE&nbsp;Users]</a>
</font>
</center>
<hr>
<p>
<div>
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<ins class="adsbygoogle"
     style="display:block"
     data-ad-format="autorelaxed"
     data-ad-client="ca-pub-3422782820843221"
     data-ad-slot="1424524564"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
</div>
<table width="100%">
<tr>
<td valign=top align=left>&nbsp;</td>
<td valign=top align=right>
<a href=/lists/><img src=/button_01.gif border=0 alt="Powered by Linux"></a></td>
</tr></table>
<!--X-User-Footer-End-->
<script type="text/javascript"> 
 function initAddThis() {
    addthis.init()
 }
initAddThis();
</script>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-760190-1', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
