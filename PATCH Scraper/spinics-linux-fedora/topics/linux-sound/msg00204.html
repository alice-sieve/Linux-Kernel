<!-- MHonArc v2.6.19 -->
<!--X-Subject: [Resend PATCH v3 2/4] ARM: at91: atmel&#45;ssc: add device tree support -->
<!--X-From-R13: Pb Eura &#60;ibvpr.furaNngzry.pbz> -->
<!--X-Date: Tue, 6 Nov 2012 19:45:59 &#45;0800 -->
<!--X-Message-Id: 1352259701&#45;19847&#45;1&#45;git&#45;send&#45;email&#45;voice.shen@atmel.com -->
<!--X-Content-Type: text/plain -->
<!--X-Head-End-->
<!doctype html public "-//W3C//DTD HTML//EN">
<html>
<head>
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({
          google_ad_client: "ca-pub-3422782820843221",
          enable_page_level_ads: true
     });
</script>
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="description" content="Linux Sound: [Resend PATCH v3 2/4] ARM: at91: atmel-ssc: add device tree support">
<style>
<!--
 pre {white-space: pre-wrap;}
-->
</style>
<title>Linux Sound &mdash; [Resend PATCH v3 2/4] ARM: at91: atmel-ssc: add device tree support</title>
<link rel="alternate" type="application/rss+xml" title="Linux Sound" href="//feeds.feedburner.com/LinuxSound">
</head>
<body vlink=green>
<!--X-Body-Begin-->
<!--X-User-Header-->
<!--X-User-Header-End-->
<!--X-TopPNI-->
<form action="//www.google.com" id="cse-search-box" target="_blank">
  <div>
    <input type="hidden" name="cx" value="partner-pub-3422782820843221:6612422167" />
    <input type="hidden" name="ie" value="UTF-8" />
    <input type="text" name="q" size="55" />
    <input type="submit" name="sa" value="Search" />
  </div>
</form>
<script type="text/javascript" src="//www.google.com/coop/cse/brand?form=cse-search-box&amp;lang=en"></script>
<h1 itemprop="name">[Resend PATCH v3 2/4] ARM: at91: atmel-ssc: add device tree support</h1>
[<a href="msg00203.html">Date Prev</a>][<a href="msg00205.html">Date Next</a>][<a href="msg00192.html">Thread Prev</a>][<a href="msg00206.html">Thread Next</a>][<a href="maillist.html#00204">Date Index</a>][<a href="index.html#00204">Thread Index</a>]
<script src="https://apis.google.com/js/platform.js" async defer></script>
<g:plusone size="small"></g:plusone>
<p>
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- responsive test for archives -->
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-3422782820843221"
     data-ad-slot="6345952567"
     data-ad-format="auto"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
</div>

<!--X-TopPNI-End-->
<!--X-MsgBody-->
<!--X-Subject-Header-Begin-->
<hr>
<!--X-Subject-Header-End-->
<!--X-Head-of-Message-->
<ul>
<li><em>Subject</em>: [Resend PATCH v3 2/4] ARM: at91: atmel-ssc: add device tree support</li>
<li><em>From</em>: Bo Shen &lt;<a href="mailto:voice.shen@DOMAIN.HIDDEN">voice.shen@xxxxxxxxx</a>&gt;</li>
<li><em>Date</em>: Wed,  7 Nov 2012 11:41:41 +0800</li>
<li><em>Cc</em>: <a href="mailto:linux-arm-kernel@DOMAIN.HIDDEN">linux-arm-kernel@xxxxxxxxxxxxxxxxxxx</a>, <a href="mailto:devicetree-discuss@DOMAIN.HIDDEN">devicetree-discuss@xxxxxxxxxxxxxxxx</a>,        <a href="mailto:linux-sound@DOMAIN.HIDDEN">linux-sound@xxxxxxxxxxxxxxx</a>, <a href="mailto:alsa-devel@DOMAIN.HIDDEN">alsa-devel@xxxxxxxxxxxxxxxx</a>,        <a href="mailto:plagnioj@DOMAIN.HIDDEN">plagnioj@xxxxxxxxxxxx</a>, <a href="mailto:fengguang.wu@DOMAIN.HIDDEN">fengguang.wu@xxxxxxxxx</a>,        Bo Shen &lt;<a href="mailto:voice.shen@DOMAIN.HIDDEN">voice.shen@xxxxxxxxx</a>&gt;</li>
</ul>
<!--X-Head-of-Message-End-->
<!--X-Head-Body-Sep-Begin-->
<!-- AddThis Button BEGIN -->
<div class="addthis_toolbox addthis_default_style ">
<a class="addthis_button_preferred_1"></a>
<a class="addthis_button_preferred_2"></a>
<a class="addthis_button_preferred_3"></a>
<a class="addthis_button_preferred_4"></a>
<a class="addthis_button_compact"></a>
<a class="addthis_counter addthis_bubble_style"></a>
</div>
<script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5196c2ae1be43d18&async=1&domready=1" async></script>
<!-- AddThis Button END -->
<hr>
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- responsive link 1 -->
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-3422782820843221"
     data-ad-slot="8681825769"
     data-ad-format="link"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
<p>
<div class="content" itemprop="articleBody">
<!--X-Head-Body-Sep-End-->
<!--X-Body-of-Message-->
<pre>Add atmel-ssc for device tree support

Match &quot;atmel,at91rm9200-ssc&quot; for using pdc for data transfer
Match &quot;atmel,at91sam9g45-ssc&quot; for using dma for data transfer

Signed-off-by: Bo Shen &lt;voice.shen@xxxxxxxxx&gt;
Acked-by: Nicolas Ferre &lt;nicolas.ferre@xxxxxxxxx&gt;
---
Resend
  Fix a error find by Fengguang Yu

  Although there is a NACK from Jean-Christophe PLAGNIOL-VILLARD,
  however the pinctrl for at91 is not in mainline. So, plan to add
  pinctrl support after the pinctrl driver for at91 is merged.

Change since v2
  No change
Change since v1
  change the underscore to dash in atmel-ssc binding document
---
 .../devicetree/bindings/misc/atmel-ssc.txt         |   15 ++++++
 arch/arm/boot/dts/at91sam9260.dtsi                 |    8 ++++
 arch/arm/boot/dts/at91sam9263.dtsi                 |   16 +++++++
 arch/arm/boot/dts/at91sam9g45.dtsi                 |   16 +++++++
 arch/arm/boot/dts/at91sam9x5.dtsi                  |    8 ++++
 arch/arm/mach-at91/at91rm9200.c                    |    3 ++
 arch/arm/mach-at91/at91sam9260.c                   |    1 +
 arch/arm/mach-at91/at91sam9261.c                   |    3 ++
 arch/arm/mach-at91/at91sam9263.c                   |    2 +
 arch/arm/mach-at91/at91sam9g45.c                   |    2 +
 arch/arm/mach-at91/at91sam9rl.c                    |    2 +
 arch/arm/mach-at91/at91sam9x5.c                    |    1 +
 drivers/misc/atmel-ssc.c                           |   49 ++++++++++++++++++--
 13 files changed, 123 insertions(+), 3 deletions(-)
 create mode 100644 Documentation/devicetree/bindings/misc/atmel-ssc.txt

diff --git a/Documentation/devicetree/bindings/misc/atmel-ssc.txt b/Documentation/devicetree/bindings/misc/atmel-ssc.txt
new file mode 100644
index 0000000..38e51ad
--- /dev/null
+++ b/Documentation/devicetree/bindings/misc/atmel-ssc.txt
@@ -0,0 +1,15 @@
+* Atmel SSC driver.
+
+Required properties:
+- compatible: &quot;atmel,at91rm9200-ssc&quot; or &quot;atmel,at91sam9g45-ssc&quot;
+	- atmel,at91rm9200-ssc: support pdc transfer
+	- atmel,at91sam9g45-ssc: support dma transfer
+- reg: Should contain SSC registers location and length
+- interrupts: Should contain SSC interrupt
+
+Example:
+ssc0: ssc@fffbc000 {
+	compatible = &quot;atmel,at91rm9200-ssc&quot;;
+	reg = &lt;0xfffbc000 0x4000&gt;;
+	interrupts = &lt;14 4 5&gt;;
+};
diff --git a/arch/arm/boot/dts/at91sam9260.dtsi b/arch/arm/boot/dts/at91sam9260.dtsi
index d410581..aaa42d8 100644
--- a/arch/arm/boot/dts/at91sam9260.dtsi
+++ b/arch/arm/boot/dts/at91sam9260.dtsi
@@ -29,6 +29,7 @@
 		tcb0 = &amp;tcb0;
 		tcb1 = &amp;tcb1;
 		i2c0 = &amp;i2c0;
+		ssc0 = &amp;ssc0;
 	};
 	cpus {
 		cpu@0 {
@@ -212,6 +213,13 @@
 				status = &quot;disabled&quot;;
 			};
 
+			ssc0: ssc@fffbc000 {
+				compatible = &quot;atmel,at91rm9200-ssc&quot;;
+				reg = &lt;0xfffbc000 0x4000&gt;;
+				interrupts = &lt;14 4 5&gt;;
+				status = &quot;disable&quot;;
+			};
+
 			adc0: adc@fffe0000 {
 				compatible = &quot;atmel,at91sam9260-adc&quot;;
 				reg = &lt;0xfffe0000 0x100&gt;;
diff --git a/arch/arm/boot/dts/at91sam9263.dtsi b/arch/arm/boot/dts/at91sam9263.dtsi
index 3e6e5c1..3b721ee 100644
--- a/arch/arm/boot/dts/at91sam9263.dtsi
+++ b/arch/arm/boot/dts/at91sam9263.dtsi
@@ -25,6 +25,8 @@
 		gpio4 = &amp;pioE;
 		tcb0 = &amp;tcb0;
 		i2c0 = &amp;i2c0;
+		ssc0 = &amp;ssc0;
+		ssc1 = &amp;ssc1;
 	};
 	cpus {
 		cpu@0 {
@@ -173,6 +175,20 @@
 				status = &quot;disabled&quot;;
 			};
 
+			ssc0: ssc@fff98000 {
+				compatible = &quot;atmel,at91rm9200-ssc&quot;;
+				reg = &lt;0xfff98000 0x4000&gt;;
+				interrupts = &lt;16 4 5&gt;;
+				status = &quot;disable&quot;;
+			};
+
+			ssc1: ssc@fff9c000 {
+				compatible = &quot;atmel,at91rm9200-ssc&quot;;
+				reg = &lt;0xfff9c000 0x4000&gt;;
+				interrupts = &lt;17 4 5&gt;;
+				status = &quot;disable&quot;;
+			};
+
 			macb0: ethernet@fffbc000 {
 				compatible = &quot;cdns,at32ap7000-macb&quot;, &quot;cdns,macb&quot;;
 				reg = &lt;0xfffbc000 0x100&gt;;
diff --git a/arch/arm/boot/dts/at91sam9g45.dtsi b/arch/arm/boot/dts/at91sam9g45.dtsi
index 3add030..acfa207 100644
--- a/arch/arm/boot/dts/at91sam9g45.dtsi
+++ b/arch/arm/boot/dts/at91sam9g45.dtsi
@@ -31,6 +31,8 @@
 		tcb1 = &amp;tcb1;
 		i2c0 = &amp;i2c0;
 		i2c1 = &amp;i2c1;
+		ssc0 = &amp;ssc0;
+		ssc1 = &amp;ssc1;
 	};
 	cpus {
 		cpu@0 {
@@ -226,6 +228,20 @@
 				status = &quot;disabled&quot;;
 			};
 
+			ssc0: ssc@fff9c000 {
+				compatible = &quot;atmel,at91sam9g45-ssc&quot;;
+				reg = &lt;0xfff9c000 0x4000&gt;;
+				interrupts = &lt;16 4 5&gt;;
+				status = &quot;disable&quot;;
+			};
+
+			ssc1: ssc@fffa0000 {
+				compatible = &quot;atmel,at91sam9g45-ssc&quot;;
+				reg = &lt;0xfffa0000 0x4000&gt;;
+				interrupts = &lt;17 4 5&gt;;
+				status = &quot;disable&quot;;
+			};
+
 			adc0: adc@fffb0000 {
 				compatible = &quot;atmel,at91sam9260-adc&quot;;
 				reg = &lt;0xfffb0000 0x100&gt;;
diff --git a/arch/arm/boot/dts/at91sam9x5.dtsi b/arch/arm/boot/dts/at91sam9x5.dtsi
index 03fc136..69667d0 100644
--- a/arch/arm/boot/dts/at91sam9x5.dtsi
+++ b/arch/arm/boot/dts/at91sam9x5.dtsi
@@ -30,6 +30,7 @@
 		i2c0 = &amp;i2c0;
 		i2c1 = &amp;i2c1;
 		i2c2 = &amp;i2c2;
+		ssc0 = &amp;ssc0;
 	};
 	cpus {
 		cpu@0 {
@@ -87,6 +88,13 @@
 				interrupts = &lt;1 4 7&gt;;
 			};
 
+			ssc0: ssc@f0010000 {
+				compatible = &quot;atmel,at91sam9g45-ssc&quot;;
+				reg = &lt;0xf0010000 0x4000&gt;;
+				interrupts = &lt;28 4 5&gt;;
+				status = &quot;disable&quot;;
+			};
+
 			tcb0: timer@f8008000 {
 				compatible = &quot;atmel,at91sam9x5-tcb&quot;;
 				reg = &lt;0xf8008000 0x100&gt;;
diff --git a/arch/arm/mach-at91/at91rm9200.c b/arch/arm/mach-at91/at91rm9200.c
index 400d1a3..af47c75 100644
--- a/arch/arm/mach-at91/at91rm9200.c
+++ b/arch/arm/mach-at91/at91rm9200.c
@@ -187,6 +187,9 @@ static struct clk_lookup periph_clocks_lookups[] = {
 	CLKDEV_CON_DEV_ID(&quot;pclk&quot;, &quot;at91rm9200_ssc.0&quot;, &amp;ssc0_clk),
 	CLKDEV_CON_DEV_ID(&quot;pclk&quot;, &quot;at91rm9200_ssc.1&quot;, &amp;ssc1_clk),
 	CLKDEV_CON_DEV_ID(&quot;pclk&quot;, &quot;at91rm9200_ssc.2&quot;, &amp;ssc2_clk),
+	CLKDEV_CON_DEV_ID(&quot;pclk&quot;, &quot;fffd0000.ssc&quot;, &amp;ssc0_clk),
+	CLKDEV_CON_DEV_ID(&quot;pclk&quot;, &quot;fffd4000.ssc&quot;, &amp;ssc1_clk),
+	CLKDEV_CON_DEV_ID(&quot;pclk&quot;, &quot;fffd8000.ssc&quot;, &amp;ssc2_clk),
 	CLKDEV_CON_DEV_ID(NULL, &quot;i2c-at91rm9200.0&quot;, &amp;twi_clk),
 	/* fake hclk clock */
 	CLKDEV_CON_DEV_ID(&quot;hclk&quot;, &quot;at91_ohci&quot;, &amp;ohci_clk),
diff --git a/arch/arm/mach-at91/at91sam9260.c b/arch/arm/mach-at91/at91sam9260.c
index d14ab6a..a41eb3d 100644
--- a/arch/arm/mach-at91/at91sam9260.c
+++ b/arch/arm/mach-at91/at91sam9260.c
@@ -211,6 +211,7 @@ static struct clk_lookup periph_clocks_lookups[] = {
 	CLKDEV_CON_DEV_ID(&quot;t1_clk&quot;, &quot;atmel_tcb.1&quot;, &amp;tc4_clk),
 	CLKDEV_CON_DEV_ID(&quot;t2_clk&quot;, &quot;atmel_tcb.1&quot;, &amp;tc5_clk),
 	CLKDEV_CON_DEV_ID(&quot;pclk&quot;, &quot;at91rm9200_ssc.0&quot;, &amp;ssc_clk),
+	CLKDEV_CON_DEV_ID(&quot;pclk&quot;, &quot;fffbc000.ssc&quot;, &amp;ssc_clk),
 	CLKDEV_CON_DEV_ID(NULL, &quot;i2c-at91sam9260.0&quot;, &amp;twi_clk),
 	CLKDEV_CON_DEV_ID(NULL, &quot;i2c-at91sam9g20.0&quot;, &amp;twi_clk),
 	/* more usart lookup table for DT entries */
diff --git a/arch/arm/mach-at91/at91sam9261.c b/arch/arm/mach-at91/at91sam9261.c
index c7b6057..7fcbe05 100644
--- a/arch/arm/mach-at91/at91sam9261.c
+++ b/arch/arm/mach-at91/at91sam9261.c
@@ -177,6 +177,9 @@ static struct clk_lookup periph_clocks_lookups[] = {
 	CLKDEV_CON_DEV_ID(&quot;pclk&quot;, &quot;at91rm9200_ssc.0&quot;, &amp;ssc0_clk),
 	CLKDEV_CON_DEV_ID(&quot;pclk&quot;, &quot;at91rm9200_ssc.1&quot;, &amp;ssc1_clk),
 	CLKDEV_CON_DEV_ID(&quot;pclk&quot;, &quot;at91rm9200_ssc.2&quot;, &amp;ssc2_clk),
+	CLKDEV_CON_DEV_ID(&quot;pclk&quot;, &quot;fffbc000.ssc&quot;, &amp;ssc0_clk),
+	CLKDEV_CON_DEV_ID(&quot;pclk&quot;, &quot;fffc0000.ssc&quot;, &amp;ssc1_clk),
+	CLKDEV_CON_DEV_ID(&quot;pclk&quot;, &quot;fffc4000.ssc&quot;, &amp;ssc2_clk),
 	CLKDEV_CON_DEV_ID(&quot;hclk&quot;, &quot;at91_ohci&quot;, &amp;hck0),
 	CLKDEV_CON_DEV_ID(NULL, &quot;i2c-at91sam9261.0&quot;, &amp;twi_clk),
 	CLKDEV_CON_DEV_ID(NULL, &quot;i2c-at91sam9g10.0&quot;, &amp;twi_clk),
diff --git a/arch/arm/mach-at91/at91sam9263.c b/arch/arm/mach-at91/at91sam9263.c
index b87be18..c0f4c8c 100644
--- a/arch/arm/mach-at91/at91sam9263.c
+++ b/arch/arm/mach-at91/at91sam9263.c
@@ -188,6 +188,8 @@ static struct clk_lookup periph_clocks_lookups[] = {
 	CLKDEV_CON_ID(&quot;hclk&quot;, &amp;macb_clk),
 	CLKDEV_CON_DEV_ID(&quot;pclk&quot;, &quot;at91rm9200_ssc.0&quot;, &amp;ssc0_clk),
 	CLKDEV_CON_DEV_ID(&quot;pclk&quot;, &quot;at91rm9200_ssc.1&quot;, &amp;ssc1_clk),
+	CLKDEV_CON_DEV_ID(&quot;pclk&quot;, &quot;fff98000.ssc&quot;, &amp;ssc0_clk),
+	CLKDEV_CON_DEV_ID(&quot;pclk&quot;, &quot;fff9c000.ssc&quot;, &amp;ssc1_clk),
 	CLKDEV_CON_DEV_ID(&quot;mci_clk&quot;, &quot;atmel_mci.0&quot;, &amp;mmc0_clk),
 	CLKDEV_CON_DEV_ID(&quot;mci_clk&quot;, &quot;atmel_mci.1&quot;, &amp;mmc1_clk),
 	CLKDEV_CON_DEV_ID(&quot;spi_clk&quot;, &quot;atmel_spi.0&quot;, &amp;spi0_clk),
diff --git a/arch/arm/mach-at91/at91sam9g45.c b/arch/arm/mach-at91/at91sam9g45.c
index f4f96a6..a4282d3 100644
--- a/arch/arm/mach-at91/at91sam9g45.c
+++ b/arch/arm/mach-at91/at91sam9g45.c
@@ -241,6 +241,8 @@ static struct clk_lookup periph_clocks_lookups[] = {
 	CLKDEV_CON_DEV_ID(NULL, &quot;i2c-at91sam9g10.1&quot;, &amp;twi1_clk),
 	CLKDEV_CON_DEV_ID(&quot;pclk&quot;, &quot;at91sam9g45_ssc.0&quot;, &amp;ssc0_clk),
 	CLKDEV_CON_DEV_ID(&quot;pclk&quot;, &quot;at91sam9g45_ssc.1&quot;, &amp;ssc1_clk),
+	CLKDEV_CON_DEV_ID(&quot;pclk&quot;, &quot;fff9c000.ssc&quot;, &amp;ssc0_clk),
+	CLKDEV_CON_DEV_ID(&quot;pclk&quot;, &quot;fffa0000.ssc&quot;, &amp;ssc1_clk),
 	CLKDEV_CON_DEV_ID(NULL, &quot;atmel-trng&quot;, &amp;trng_clk),
 	CLKDEV_CON_DEV_ID(NULL, &quot;atmel_sha&quot;, &amp;aestdessha_clk),
 	CLKDEV_CON_DEV_ID(NULL, &quot;atmel_tdes&quot;, &amp;aestdessha_clk),
diff --git a/arch/arm/mach-at91/at91sam9rl.c b/arch/arm/mach-at91/at91sam9rl.c
index 4110b54..b683fdc 100644
--- a/arch/arm/mach-at91/at91sam9rl.c
+++ b/arch/arm/mach-at91/at91sam9rl.c
@@ -186,6 +186,8 @@ static struct clk_lookup periph_clocks_lookups[] = {
 	CLKDEV_CON_DEV_ID(&quot;t2_clk&quot;, &quot;atmel_tcb.0&quot;, &amp;tc2_clk),
 	CLKDEV_CON_DEV_ID(&quot;pclk&quot;, &quot;at91rm9200_ssc.0&quot;, &amp;ssc0_clk),
 	CLKDEV_CON_DEV_ID(&quot;pclk&quot;, &quot;at91rm9200_ssc.1&quot;, &amp;ssc1_clk),
+	CLKDEV_CON_DEV_ID(&quot;pclk&quot;, &quot;fffc0000.ssc&quot;, &amp;ssc0_clk),
+	CLKDEV_CON_DEV_ID(&quot;pclk&quot;, &quot;fffc4000.ssc&quot;, &amp;ssc1_clk),
 	CLKDEV_CON_DEV_ID(NULL, &quot;i2c-at91sam9g20.0&quot;, &amp;twi0_clk),
 	CLKDEV_CON_DEV_ID(NULL, &quot;i2c-at91sam9g20.1&quot;, &amp;twi1_clk),
 	CLKDEV_CON_ID(&quot;pioA&quot;, &amp;pioA_clk),
diff --git a/arch/arm/mach-at91/at91sam9x5.c b/arch/arm/mach-at91/at91sam9x5.c
index e503538..18fbbb2 100644
--- a/arch/arm/mach-at91/at91sam9x5.c
+++ b/arch/arm/mach-at91/at91sam9x5.c
@@ -231,6 +231,7 @@ static struct clk_lookup periph_clocks_lookups[] = {
 	CLKDEV_CON_DEV_ID(&quot;t0_clk&quot;, &quot;f800c000.timer&quot;, &amp;tcb0_clk),
 	CLKDEV_CON_DEV_ID(&quot;dma_clk&quot;, &quot;ffffec00.dma-controller&quot;, &amp;dma0_clk),
 	CLKDEV_CON_DEV_ID(&quot;dma_clk&quot;, &quot;ffffee00.dma-controller&quot;, &amp;dma1_clk),
+	CLKDEV_CON_DEV_ID(&quot;pclk&quot;, &quot;f0010000.ssc&quot;, &amp;ssc_clk),
 	CLKDEV_CON_DEV_ID(NULL, &quot;f8010000.i2c&quot;, &amp;twi0_clk),
 	CLKDEV_CON_DEV_ID(NULL, &quot;f8014000.i2c&quot;, &amp;twi1_clk),
 	CLKDEV_CON_DEV_ID(NULL, &quot;f8018000.i2c&quot;, &amp;twi2_clk),
diff --git a/drivers/misc/atmel-ssc.c b/drivers/misc/atmel-ssc.c
index f40abd8..a769719 100644
--- a/drivers/misc/atmel-ssc.c
+++ b/drivers/misc/atmel-ssc.c
@@ -18,6 +18,8 @@
 #include &lt;linux/slab.h&gt;
 #include &lt;linux/module.h&gt;
 
+#include &lt;linux/of.h&gt;
+
 /* Serialize access to ssc_list and user count */
 static DEFINE_SPINLOCK(user_lock);
 static LIST_HEAD(ssc_list);
@@ -29,7 +31,13 @@ struct ssc_device *ssc_request(unsigned int ssc_num)
 
 	spin_lock(&amp;user_lock);
 	list_for_each_entry(ssc, &amp;ssc_list, list) {
-		if (ssc-&gt;pdev-&gt;id == ssc_num) {
+		if (ssc-&gt;pdev-&gt;dev.of_node) {
+			if (of_alias_get_id(ssc-&gt;pdev-&gt;dev.of_node, &quot;ssc&quot;)
+				== ssc_num) {
+				ssc_valid = 1;
+				break;
+			}
+		} else if (ssc-&gt;pdev-&gt;id == ssc_num) {
 			ssc_valid = 1;
 			break;
 		}
@@ -88,10 +96,41 @@ static const struct platform_device_id atmel_ssc_devtypes[] = {
 	}
 };
 
+#ifdef CONFIG_OF
+static const struct of_device_id atmel_ssc_dt_ids[] = {
+	{
+		.compatible = &quot;atmel,at91rm9200-ssc&quot;,
+		.data = &amp;at91rm9200_config,
+	}, {
+		.compatible = &quot;atmel,at91sam9g45-ssc&quot;,
+		.data = &amp;at91sam9g45_config,
+	}, {
+		/* sentinel */
+	}
+};
+MODULE_DEVICE_TABLE(of, atmel_ssc_dt_ids);
+#endif
+
+static inline const struct atmel_ssc_platform_data * __init
+	atmel_ssc_get_driver_data(struct platform_device *pdev)
+{
+	if (pdev-&gt;dev.of_node) {
+		const struct of_device_id *match;
+		match = of_match_node(atmel_ssc_dt_ids, pdev-&gt;dev.of_node);
+		if (match == NULL)
+			return NULL;
+		return match-&gt;data;
+	}
+
+	return (struct atmel_ssc_platform_data *)
+		platform_get_device_id(pdev)-&gt;driver_data;
+}
+
 static int ssc_probe(struct platform_device *pdev)
 {
 	struct resource *regs;
 	struct ssc_device *ssc;
+	const struct atmel_ssc_platform_data *plat_dat;
 
 	ssc = devm_kzalloc(&amp;pdev-&gt;dev, sizeof(struct ssc_device), GFP_KERNEL);
 	if (!ssc) {
@@ -100,8 +139,11 @@ static int ssc_probe(struct platform_device *pdev)
 	}
 
 	ssc-&gt;pdev = pdev;
-	ssc-&gt;pdata = (struct atmel_ssc_platform_data *)
-			platform_get_device_id(pdev)-&gt;driver_data;
+
+	plat_dat = atmel_ssc_get_driver_data(pdev);
+	if (!plat_dat)
+		return -ENODEV;
+	ssc-&gt;pdata = (struct atmel_ssc_platform_data *)plat_dat;
 
 	regs = platform_get_resource(pdev, IORESOURCE_MEM, 0);
 	if (!regs) {
@@ -160,6 +202,7 @@ static struct platform_driver ssc_driver = {
 	.driver		= {
 		.name		= &quot;ssc&quot;,
 		.owner		= THIS_MODULE,
+		.of_match_table	= of_match_ptr(atmel_ssc_dt_ids),
 	},
 	.id_table	= atmel_ssc_devtypes,
 	.probe		= ssc_probe,
-- 
1.7.9.5

--
To unsubscribe from this list: send the line &quot;unsubscribe linux-sound&quot; in
the body of a message to majordomo@xxxxxxxxxxxxxxx
More majordomo info at  <a  rel="nofollow" href="http://vger.kernel.org/majordomo-info.html">http://vger.kernel.org/majordomo-info.html</a>

</pre>
<!--X-Body-of-Message-End-->
<!--X-MsgBody-End-->
<!--X-Follow-Ups-->
<hr>
<ul><li><strong>Follow-Ups</strong>:
<ul>
<li><strong><a name="00208" href="msg00208.html">Re: [Resend PATCH v3 2/4] ARM: at91: atmel-ssc: add device tree support</a></strong>
<ul><li><em>From:</em> Jean-Christophe PLAGNIOL-VILLARD</li></ul></li>
<li><strong><a name="00206" href="msg00206.html">Re: [Resend PATCH v3 2/4] ARM: at91: atmel-ssc: add device tree support</a></strong>
<ul><li><em>From:</em> Mark Brown</li></ul></li>
</ul></li></ul>
<!--X-Follow-Ups-End-->
<!--X-References-->
<!--X-References-End-->
<!--X-BotPNI-->
<ul>
<li>Prev by Date:
<strong><a href="msg00203.html">Re: [RFC patch v3 1/4] ARM: at91: atmel-ssc: add platform device id table</a></strong>
</li>
<li>Next by Date:
<strong><a href="msg00205.html">Re: [RFC patch v3 3/4] ASoC: atmel-ssc-dai: register dai and pcm directly</a></strong>
</li>
<li>Previous by thread:
<strong><a href="msg00192.html">[RFC patch v3 1/4] ARM: at91: atmel-ssc: add platform device id table</a></strong>
</li>
<li>Next by thread:
<strong><a href="msg00206.html">Re: [Resend PATCH v3 2/4] ARM: at91: atmel-ssc: add device tree support</a></strong>
</li>
<li>Index(es):
<ul>
<li><a href="maillist.html#00204"><strong>Date</strong></a></li>
<li><a href="index.html#00204"><strong>Thread</strong></a></li>
</ul>
</li>
</ul>

<!--X-BotPNI-End-->
<!--X-User-Footer-->
<center>
<font size=-1>
<a href=/lists/>[Index&nbsp;of&nbsp;Archives]</a>
&nbsp;
&nbsp;
<a href=/lists/Pulseaudio/>[Pulseaudio]</a>
&nbsp;
&nbsp;
<a href=/lists/linux-audio-users/>[Linux&nbsp;Audio&nbsp;Users]</a>
&nbsp;
&nbsp;
<a href=/lists/alsa-devel/>[ALSA&nbsp;Devel]</a>
&nbsp;
&nbsp;
<a href=/lists/fedora-desktop/>[Fedora&nbsp;Desktop]</a>
&nbsp;
&nbsp;
<a href=/lists/fedora-selinux/>[Fedora&nbsp;SELinux]</a>
&nbsp;
&nbsp;
<a href=http://www.ske-art.com/z/biglist.html>[Big&nbsp;List&nbsp;of&nbsp;Linux&nbsp;Books]</a>
&nbsp;
&nbsp;
<a href=https://yosemitenews.info>[Yosemite&nbsp;News]</a>
&nbsp;
&nbsp;
<a href=/lists/kde/>[KDE&nbsp;Users]</a>
</font>
</center>
<hr>
<p>
<div>
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<ins class="adsbygoogle"
     style="display:block"
     data-ad-format="autorelaxed"
     data-ad-client="ca-pub-3422782820843221"
     data-ad-slot="1424524564"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
</div>
<table width="100%">
<tr>
<td valign=top align=left>&nbsp;</td>
<td valign=top align=right>
<a href=/lists/><img src=/button_01.gif border=0 alt="Powered by Linux"></a></td>
</tr></table>
<!--X-User-Footer-End-->
<script type="text/javascript"> 
 function initAddThis() {
    addthis.init()
 }
initAddThis();
</script>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-760190-1', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
