<!-- MHonArc v2.6.19 -->
<!--X-Subject: [PATCH v2 05/19] rpc: avoid unlinking sockets passed in	from systemd -->
<!--X-From-R13: =?GFT&#45;8?d?Rnavry=20B=2S=20Preenat=Q3=O9?= &#60;oreenatrNerqung.pbz> -->
<!--X-Date: Thu, 11 Jul 2019 07:07:59 &#45;0700 -->
<!--X-Message-Id: 20190711140742.31029&#45;6&#45;berrange@redhat.com -->
<!--X-Content-Type: text/plain -->
<!--X-Reference: 20190711140742.31029&#45;1&#45;berrange@redhat.com -->
<!--X-Head-End-->
<!doctype html public "-//W3C//DTD HTML//EN">
<html>
<head>
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({
          google_ad_client: "ca-pub-3422782820843221",
          enable_page_level_ads: true
     });
</script>
<style>
<!--
 pre {white-space: pre-wrap;}
-->
</style>
<title>libvirt &mdash; [PATCH v2 05/19] rpc: avoid unlinking sockets passed in	from systemd</title>
<meta name="description" content="libvirt: [PATCH v2 05/19] rpc: avoid unlinking sockets passed in	from systemd">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="alternate" type="application/rss+xml" title="Libvirt Development" href="//feeds.feedburner.com/Libvir">
</head>
<body itemscope itemtype="//schema.org/Article" vlink=green>
<!--X-Body-Begin-->
<!--X-User-Header-->
<!--X-User-Header-End-->
<!--X-TopPNI-->
<form action="//www.google.com" id="cse-search-box" target="_blank">
  <div>
    <input type="hidden" name="cx" value="partner-pub-3422782820843221:8422278960" />
    <input type="hidden" name="ie" value="UTF-8" />
    <input type="text" name="q" size="55" />
    <input type="submit" name="sa" value="Search" />
  </div>
</form>
<script type="text/javascript" src="//www.google.com/coop/cse/brand?form=cse-search-box&amp;lang=en"></script>
<h1>[PATCH v2 05/19] rpc: avoid unlinking sockets passed in	from systemd</h1>
[<a href="msg187142.html">Date Prev</a>][<a href="msg187139.html">Date Next</a>][<a href="msg187142.html">Thread Prev</a>][<a href="msg187139.html">Thread Next</a>][<a href="maillist.html#187138">Date Index</a>][<a href="index.html#187138">Thread Index</a>] 


<p>&nbsp;<br>
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- responsive test for archives -->
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-3422782820843221"
     data-ad-slot="6345952567"
     data-ad-format="auto"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>

<!--X-TopPNI-End-->
<!--X-MsgBody-->
<!--X-Subject-Header-Begin-->
<hr>
<!--X-Subject-Header-End-->
<!--X-Head-of-Message-->
<ul>
<li><em>Subject</em>: [PATCH v2 05/19] rpc: avoid unlinking sockets passed in	from systemd</li>
<li><em>From</em>: Daniel P. Berrang&#xE9; &lt;berrange@xxxxxxxxxx&gt;</li>
<li><em>Date</em>: Thu, 11 Jul 2019 15:07:28 +0100</li>
<li><em>In-reply-to</em>: &lt;<a href="msg187133.html">20190711140742.31029-1-berrange@redhat.com</a>&gt;</li>
<li><em>References</em>: &lt;<a href="msg187133.html">20190711140742.31029-1-berrange@redhat.com</a>&gt;</li>
</ul>
<!--X-Head-of-Message-End-->
<!--X-Head-Body-Sep-Begin-->
<!-- AddThis Button BEGIN -->
<div class="addthis_toolbox addthis_default_style ">
<a class="addthis_button_preferred_1"></a>
<a class="addthis_button_preferred_2"></a>
<a class="addthis_button_preferred_3"></a>
<a class="addthis_button_preferred_4"></a>
<a class="addthis_button_compact"></a>
<a class="addthis_counter addthis_bubble_style"></a>
</div>
<script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5196c2ae1be43d18&async=1&domready=1" async></script>
<!-- AddThis Button END -->
<hr>
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- responsive link 1 -->
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-3422782820843221"
     data-ad-slot="8681825769"
     data-ad-format="link"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
<p>
<div class="content" itemprop="articleBody">
<!--X-Head-Body-Sep-End-->
<!--X-Body-of-Message-->
<pre>Currently the socket code will unlink any UNIX socket path which is
associated with a server socket. This is not fine grained enough, as we
need to avoid unlinking server sockets we were passed by systemd.

To deal with this we must explicitly track whether each socket needs to
be unlinked when closed, separately of the client vs server state.

Signed-off-by: Daniel P. Berrang&#xE9; &lt;berrange@xxxxxxxxxx&gt;
---
 src/locking/lock_daemon.c                     |  1 +
 src/logging/log_daemon.c                      |  1 +
 src/rpc/virnetserverservice.c                 |  3 +
 src/rpc/virnetserverservice.h                 |  1 +
 src/rpc/virnetsocket.c                        | 55 ++++++++++++-------
 src/rpc/virnetsocket.h                        |  1 +
 .../input-data-anon-clients.json              | 12 ++--
 .../output-data-admin-server-names.json       | 24 +++++---
 tests/virnetdaemondata/output-data-admin.json | 24 +++++---
 .../output-data-anon-clients.json             | 12 ++--
 .../output-data-client-auth-pending.json      | 12 ++--
 .../output-data-client-ids.json               | 12 ++--
 .../output-data-client-timestamp.json         | 12 ++--
 .../virnetdaemondata/output-data-initial.json | 12 ++--
 .../output-data-no-keepalive-required.json    | 24 +++++---
 15 files changed, 138 insertions(+), 68 deletions(-)

diff --git a/src/locking/lock_daemon.c b/src/locking/lock_daemon.c
index c10b2d383c..0f90606be6 100644
--- a/src/locking/lock_daemon.c
+++ b/src/locking/lock_daemon.c
@@ -619,6 +619,7 @@ virLockDaemonSetupNetworkingSystemD(virNetServerPtr lockSrv, virNetServerPtr adm
          * so the first FD we'll get is '3'. */
         if (!(svc = virNetServerServiceNewFDs(fds,
                                               ARRAY_CARDINALITY(fds),
+                                              false,
                                               0,
                                               NULL,
                                               false, 0, 1)))
diff --git a/src/logging/log_daemon.c b/src/logging/log_daemon.c
index 6531999381..30c70a20dd 100644
--- a/src/logging/log_daemon.c
+++ b/src/logging/log_daemon.c
@@ -554,6 +554,7 @@ virLogDaemonSetupNetworkingSystemD(virNetServerPtr logSrv, virNetServerPtr admin
          * so the first FD we'll get is '3'. */
         if (!(svc = virNetServerServiceNewFDs(fds,
                                               ARRAY_CARDINALITY(fds),
+                                              false,
                                               0,
                                               NULL,
                                               false, 0, 1)))
diff --git a/src/rpc/virnetserverservice.c b/src/rpc/virnetserverservice.c
index 0d2f264696..315a4950df 100644
--- a/src/rpc/virnetserverservice.c
+++ b/src/rpc/virnetserverservice.c
@@ -121,6 +121,7 @@ virNetServerServiceNewFDOrUNIX(const char *path,
          */
         return virNetServerServiceNewFDs(fds,
                                          ARRAY_CARDINALITY(fds),
+                                         false,
                                          auth,
                                          tls,
                                          readonly,
@@ -257,6 +258,7 @@ virNetServerServicePtr virNetServerServiceNewUNIX(const char *path,
 
 virNetServerServicePtr virNetServerServiceNewFDs(int *fds,
                                                  size_t nfds,
+                                                 bool unlinkUNIX,
                                                  int auth,
                                                  virNetTLSContextPtr tls,
                                                  bool readonly,
@@ -272,6 +274,7 @@ virNetServerServicePtr virNetServerServiceNewFDs(int *fds,
 
     for (i = 0; i &lt; nfds; i++) {
         if (virNetSocketNewListenFD(fds[i],
+                                    unlinkUNIX,
                                     &amp;socks[i]) &lt; 0)
             goto cleanup;
     }
diff --git a/src/rpc/virnetserverservice.h b/src/rpc/virnetserverservice.h
index 59ee51e5ee..73d61dde99 100644
--- a/src/rpc/virnetserverservice.h
+++ b/src/rpc/virnetserverservice.h
@@ -62,6 +62,7 @@ virNetServerServicePtr virNetServerServiceNewUNIX(const char *path,
                                                   size_t nrequests_client_max);
 virNetServerServicePtr virNetServerServiceNewFDs(int *fd,
                                                  size_t nfds,
+                                                 bool unlinkUNIX,
                                                  int auth,
                                                  virNetTLSContextPtr tls,
                                                  bool readonly,
diff --git a/src/rpc/virnetsocket.c b/src/rpc/virnetsocket.c
index fc13b1654a..e23f6a648c 100644
--- a/src/rpc/virnetsocket.c
+++ b/src/rpc/virnetsocket.c
@@ -78,9 +78,10 @@ struct _virNetSocket {
     int watch;
     pid_t pid;
     int errfd;
-    bool client;
+    bool isClient;
     bool ownsFd;
     bool quietEOF;
+    bool unlinkUNIX;
 
     /* Event callback fields */
     virNetSocketIOFunc func;
@@ -216,10 +217,14 @@ int virNetSocketCheckProtocols(bool *hasIPv4,
 }
 
 
-static virNetSocketPtr virNetSocketNew(virSocketAddrPtr localAddr,
-                                       virSocketAddrPtr remoteAddr,
-                                       bool isClient,
-                                       int fd, int errfd, pid_t pid)
+static virNetSocketPtr
+virNetSocketNew(virSocketAddrPtr localAddr,
+                virSocketAddrPtr remoteAddr,
+                bool isClient,
+                int fd,
+                int errfd,
+                pid_t pid,
+                bool unlinkUNIX)
 {
     virNetSocketPtr sock;
     int no_slow_start = 1;
@@ -254,6 +259,8 @@ static virNetSocketPtr virNetSocketNew(virSocketAddrPtr localAddr,
     sock-&gt;pid = pid;
     sock-&gt;watch = -1;
     sock-&gt;ownsFd = true;
+    sock-&gt;isClient = isClient;
+    sock-&gt;unlinkUNIX = unlinkUNIX;
 
     /* Disable nagle for TCP sockets */
     if (sock-&gt;localAddr.data.sa.sa_family == AF_INET ||
@@ -280,8 +287,6 @@ static virNetSocketPtr virNetSocketNew(virSocketAddrPtr localAddr,
         !(sock-&gt;remoteAddrStrURI = virSocketAddrFormatFull(remoteAddr, true, NULL)))
         goto error;
 
-    sock-&gt;client = isClient;
-
     PROBE(RPC_SOCKET_NEW,
           &quot;sock=%p fd=%d errfd=%d pid=%lld localAddr=%s, remoteAddr=%s&quot;,
           sock, fd, errfd, (long long)pid,
@@ -427,7 +432,7 @@ int virNetSocketNewListenTCP(const char *nodename,
         if (VIR_EXPAND_N(socks, nsocks, 1) &lt; 0)
             goto error;
 
-        if (!(socks[nsocks-1] = virNetSocketNew(&amp;addr, NULL, false, fd, -1, 0)))
+        if (!(socks[nsocks-1] = virNetSocketNew(&amp;addr, NULL, false, fd, -1, 0, false)))
             goto error;
         runp = runp-&gt;ai_next;
         fd = -1;
@@ -513,7 +518,7 @@ int virNetSocketNewListenUNIX(const char *path,
         goto error;
     }
 
-    if (!(*retsock = virNetSocketNew(&amp;addr, NULL, false, fd, -1, 0)))
+    if (!(*retsock = virNetSocketNew(&amp;addr, NULL, false, fd, -1, 0, true)))
         goto error;
 
     return 0;
@@ -538,6 +543,7 @@ int virNetSocketNewListenUNIX(const char *path ATTRIBUTE_UNUSED,
 #endif
 
 int virNetSocketNewListenFD(int fd,
+                            bool unlinkUNIX,
                             virNetSocketPtr *retsock)
 {
     virSocketAddr addr;
@@ -551,7 +557,7 @@ int virNetSocketNewListenFD(int fd,
         return -1;
     }
 
-    if (!(*retsock = virNetSocketNew(&amp;addr, NULL, false, fd, -1, 0)))
+    if (!(*retsock = virNetSocketNew(&amp;addr, NULL, false, fd, -1, 0, unlinkUNIX)))
         return -1;
 
     return 0;
@@ -627,7 +633,7 @@ int virNetSocketNewConnectTCP(const char *nodename,
         goto error;
     }
 
-    if (!(*retsock = virNetSocketNew(&amp;localAddr, &amp;remoteAddr, true, fd, -1, 0)))
+    if (!(*retsock = virNetSocketNew(&amp;localAddr, &amp;remoteAddr, true, fd, -1, 0, false)))
         goto error;
 
     freeaddrinfo(ai);
@@ -752,7 +758,7 @@ int virNetSocketNewConnectUNIX(const char *path,
         goto cleanup;
     }
 
-    if (!(*retsock = virNetSocketNew(&amp;localAddr, &amp;remoteAddr, true, fd, -1, 0)))
+    if (!(*retsock = virNetSocketNew(&amp;localAddr, &amp;remoteAddr, true, fd, -1, 0, false)))
         goto cleanup;
 
     ret = 0;
@@ -820,7 +826,7 @@ int virNetSocketNewConnectCommand(virCommandPtr cmd,
     VIR_FORCE_CLOSE(sv[1]);
     VIR_FORCE_CLOSE(errfd[1]);
 
-    if (!(*retsock = virNetSocketNew(NULL, NULL, true, sv[0], errfd[0], pid)))
+    if (!(*retsock = virNetSocketNew(NULL, NULL, true, sv[0], errfd[0], pid, false)))
         goto error;
 
     virCommandFree(cmd);
@@ -1219,7 +1225,7 @@ int virNetSocketNewConnectSockFD(int sockfd,
         return -1;
     }
 
-    if (!(*retsock = virNetSocketNew(&amp;localAddr, NULL, true, sockfd, -1, -1)))
+    if (!(*retsock = virNetSocketNew(&amp;localAddr, NULL, true, sockfd, -1, -1, false)))
         return -1;
 
     return 0;
@@ -1232,6 +1238,7 @@ virNetSocketPtr virNetSocketNewPostExecRestart(virJSONValuePtr object)
     virSocketAddr remoteAddr;
     int fd, thepid, errfd;
     bool isClient;
+    bool unlinkUNIX;
 
     if (virJSONValueObjectGetNumberInt(object, &quot;fd&quot;, &amp;fd) &lt; 0) {
         virReportError(VIR_ERR_INTERNAL_ERROR, &quot;%s&quot;,
@@ -1250,12 +1257,16 @@ virNetSocketPtr virNetSocketNewPostExecRestart(virJSONValuePtr object)
                        _(&quot;Missing errfd data in JSON document&quot;));
         return NULL;
     }
+
     if (virJSONValueObjectGetBoolean(object, &quot;isClient&quot;, &amp;isClient) &lt; 0) {
         virReportError(VIR_ERR_INTERNAL_ERROR, &quot;%s&quot;,
                        _(&quot;Missing isClient data in JSON document&quot;));
         return NULL;
     }
 
+    if (virJSONValueObjectGetBoolean(object, &quot;unlinkUNIX&quot;, &amp;unlinkUNIX) &lt; 0)
+        unlinkUNIX = !isClient;
+
     memset(&amp;localAddr, 0, sizeof(localAddr));
     memset(&amp;remoteAddr, 0, sizeof(remoteAddr));
 
@@ -1271,8 +1282,8 @@ virNetSocketPtr virNetSocketNewPostExecRestart(virJSONValuePtr object)
         return NULL;
     }
 
-    return virNetSocketNew(&amp;localAddr, &amp;remoteAddr,
-                           isClient, fd, errfd, thepid);
+    return virNetSocketNew(&amp;localAddr, &amp;remoteAddr, isClient,
+                           fd, errfd, thepid, unlinkUNIX);
 }
 
 
@@ -1309,7 +1320,10 @@ virJSONValuePtr virNetSocketPreExecRestart(virNetSocketPtr sock)
     if (virJSONValueObjectAppendNumberInt(object, &quot;pid&quot;, sock-&gt;pid) &lt; 0)
         goto error;
 
-    if (virJSONValueObjectAppendBoolean(object, &quot;isClient&quot;, sock-&gt;client) &lt; 0)
+    if (virJSONValueObjectAppendBoolean(object, &quot;isClient&quot;, sock-&gt;isClient) &lt; 0)
+        goto error;
+
+    if (virJSONValueObjectAppendBoolean(object, &quot;unlinkUNIX&quot;, sock-&gt;unlinkUNIX) &lt; 0)
         goto error;
 
     if (virSetInherit(sock-&gt;fd, true) &lt; 0) {
@@ -1350,7 +1364,7 @@ void virNetSocketDispose(void *obj)
 
 #ifdef HAVE_SYS_UN_H
     /* If a server socket, then unlink UNIX path */
-    if (!sock-&gt;client &amp;&amp;
+    if (sock-&gt;unlinkUNIX &amp;&amp;
         sock-&gt;localAddr.data.sa.sa_family == AF_UNIX &amp;&amp;
         sock-&gt;localAddr.data.un.sun_path[0] != '\0')
         unlink(sock-&gt;localAddr.data.un.sun_path);
@@ -2141,7 +2155,8 @@ int virNetSocketAccept(virNetSocketPtr sock, virNetSocketPtr *clientsock)
     if (!(*clientsock = virNetSocketNew(&amp;localAddr,
                                         &amp;remoteAddr,
                                         true,
-                                        fd, -1, 0)))
+                                        fd, -1, 0,
+                                        false)))
         goto cleanup;
 
     fd = -1;
@@ -2272,7 +2287,7 @@ void virNetSocketClose(virNetSocketPtr sock)
 
 #ifdef HAVE_SYS_UN_H
     /* If a server socket, then unlink UNIX path */
-    if (!sock-&gt;client &amp;&amp;
+    if (sock-&gt;unlinkUNIX &amp;&amp;
         sock-&gt;localAddr.data.sa.sa_family == AF_UNIX &amp;&amp;
         sock-&gt;localAddr.data.un.sun_path[0] != '\0') {
         if (unlink(sock-&gt;localAddr.data.un.sun_path) == 0)
diff --git a/src/rpc/virnetsocket.h b/src/rpc/virnetsocket.h
index de5a465cde..2f626cb08f 100644
--- a/src/rpc/virnetsocket.h
+++ b/src/rpc/virnetsocket.h
@@ -58,6 +58,7 @@ int virNetSocketNewListenUNIX(const char *path,
                               virNetSocketPtr *addr);
 
 int virNetSocketNewListenFD(int fd,
+                            bool unlinkUNIX,
                             virNetSocketPtr *addr);
 
 int virNetSocketNewConnectTCP(const char *nodename,
diff --git a/tests/virnetdaemondata/input-data-anon-clients.json b/tests/virnetdaemondata/input-data-anon-clients.json
index 8058fe0a43..3ca2af3899 100644
--- a/tests/virnetdaemondata/input-data-anon-clients.json
+++ b/tests/virnetdaemondata/input-data-anon-clients.json
@@ -17,7 +17,8 @@
                     &quot;fd&quot;: 100,
                     &quot;errfd&quot;: -1,
                     &quot;pid&quot;: 0,
-                    &quot;isClient&quot;: false
+                    &quot;isClient&quot;: false,
+                    &quot;unlinkUNIX&quot;: true
                 }
             ]
         },
@@ -30,7 +31,8 @@
                     &quot;fd&quot;: 101,
                     &quot;errfd&quot;: -1,
                     &quot;pid&quot;: 0,
-                    &quot;isClient&quot;: false
+                    &quot;isClient&quot;: false,
+                    &quot;unlinkUNIX&quot;: true
                 }
             ]
         }
@@ -44,7 +46,8 @@
                 &quot;fd&quot;: 102,
                 &quot;errfd&quot;: -1,
                 &quot;pid&quot;: -1,
-                &quot;isClient&quot;: true
+                &quot;isClient&quot;: true,
+                &quot;unlinkUNIX&quot;: false
             },
 	    &quot;privateData&quot;: 1729
         },
@@ -56,7 +59,8 @@
                 &quot;fd&quot;: 103,
                 &quot;errfd&quot;: -1,
                 &quot;pid&quot;: -1,
-                &quot;isClient&quot;: true
+                &quot;isClient&quot;: true,
+                &quot;unlinkUNIX&quot;: false
             },
 	    &quot;privateData&quot;: 1729
         }
diff --git a/tests/virnetdaemondata/output-data-admin-server-names.json b/tests/virnetdaemondata/output-data-admin-server-names.json
index 04cb5e6bb3..4488a23291 100644
--- a/tests/virnetdaemondata/output-data-admin-server-names.json
+++ b/tests/virnetdaemondata/output-data-admin-server-names.json
@@ -19,7 +19,8 @@
               &quot;fd&quot;: 100,
               &quot;errfd&quot;: -1,
               &quot;pid&quot;: 0,
-              &quot;isClient&quot;: false
+              &quot;isClient&quot;: false,
+              &quot;unlinkUNIX&quot;: true
             }
           ]
         },
@@ -32,7 +33,8 @@
               &quot;fd&quot;: 101,
               &quot;errfd&quot;: -1,
               &quot;pid&quot;: 0,
-              &quot;isClient&quot;: false
+              &quot;isClient&quot;: false,
+              &quot;unlinkUNIX&quot;: true
             }
           ]
         }
@@ -48,7 +50,8 @@
             &quot;fd&quot;: 102,
             &quot;errfd&quot;: -1,
             &quot;pid&quot;: -1,
-            &quot;isClient&quot;: true
+            &quot;isClient&quot;: true,
+            &quot;unlinkUNIX&quot;: false
           },
           &quot;privateData&quot;: 1729
         },
@@ -62,7 +65,8 @@
             &quot;fd&quot;: 103,
             &quot;errfd&quot;: -1,
             &quot;pid&quot;: -1,
-            &quot;isClient&quot;: true
+            &quot;isClient&quot;: true,
+            &quot;unlinkUNIX&quot;: false
           },
           &quot;privateData&quot;: 1729
         }
@@ -87,7 +91,8 @@
               &quot;fd&quot;: 100,
               &quot;errfd&quot;: -1,
               &quot;pid&quot;: 0,
-              &quot;isClient&quot;: false
+              &quot;isClient&quot;: false,
+              &quot;unlinkUNIX&quot;: true
             }
           ]
         },
@@ -100,7 +105,8 @@
               &quot;fd&quot;: 101,
               &quot;errfd&quot;: -1,
               &quot;pid&quot;: 0,
-              &quot;isClient&quot;: false
+              &quot;isClient&quot;: false,
+              &quot;unlinkUNIX&quot;: true
             }
           ]
         }
@@ -116,7 +122,8 @@
             &quot;fd&quot;: 102,
             &quot;errfd&quot;: -1,
             &quot;pid&quot;: -1,
-            &quot;isClient&quot;: true
+            &quot;isClient&quot;: true,
+            &quot;unlinkUNIX&quot;: false
           },
           &quot;privateData&quot;: 1729
         },
@@ -130,7 +137,8 @@
             &quot;fd&quot;: 103,
             &quot;errfd&quot;: -1,
             &quot;pid&quot;: -1,
-            &quot;isClient&quot;: true
+            &quot;isClient&quot;: true,
+            &quot;unlinkUNIX&quot;: false
           },
           &quot;privateData&quot;: 1729
         }
diff --git a/tests/virnetdaemondata/output-data-admin.json b/tests/virnetdaemondata/output-data-admin.json
index 04cb5e6bb3..4488a23291 100644
--- a/tests/virnetdaemondata/output-data-admin.json
+++ b/tests/virnetdaemondata/output-data-admin.json
@@ -19,7 +19,8 @@
               &quot;fd&quot;: 100,
               &quot;errfd&quot;: -1,
               &quot;pid&quot;: 0,
-              &quot;isClient&quot;: false
+              &quot;isClient&quot;: false,
+              &quot;unlinkUNIX&quot;: true
             }
           ]
         },
@@ -32,7 +33,8 @@
               &quot;fd&quot;: 101,
               &quot;errfd&quot;: -1,
               &quot;pid&quot;: 0,
-              &quot;isClient&quot;: false
+              &quot;isClient&quot;: false,
+              &quot;unlinkUNIX&quot;: true
             }
           ]
         }
@@ -48,7 +50,8 @@
             &quot;fd&quot;: 102,
             &quot;errfd&quot;: -1,
             &quot;pid&quot;: -1,
-            &quot;isClient&quot;: true
+            &quot;isClient&quot;: true,
+            &quot;unlinkUNIX&quot;: false
           },
           &quot;privateData&quot;: 1729
         },
@@ -62,7 +65,8 @@
             &quot;fd&quot;: 103,
             &quot;errfd&quot;: -1,
             &quot;pid&quot;: -1,
-            &quot;isClient&quot;: true
+            &quot;isClient&quot;: true,
+            &quot;unlinkUNIX&quot;: false
           },
           &quot;privateData&quot;: 1729
         }
@@ -87,7 +91,8 @@
               &quot;fd&quot;: 100,
               &quot;errfd&quot;: -1,
               &quot;pid&quot;: 0,
-              &quot;isClient&quot;: false
+              &quot;isClient&quot;: false,
+              &quot;unlinkUNIX&quot;: true
             }
           ]
         },
@@ -100,7 +105,8 @@
               &quot;fd&quot;: 101,
               &quot;errfd&quot;: -1,
               &quot;pid&quot;: 0,
-              &quot;isClient&quot;: false
+              &quot;isClient&quot;: false,
+              &quot;unlinkUNIX&quot;: true
             }
           ]
         }
@@ -116,7 +122,8 @@
             &quot;fd&quot;: 102,
             &quot;errfd&quot;: -1,
             &quot;pid&quot;: -1,
-            &quot;isClient&quot;: true
+            &quot;isClient&quot;: true,
+            &quot;unlinkUNIX&quot;: false
           },
           &quot;privateData&quot;: 1729
         },
@@ -130,7 +137,8 @@
             &quot;fd&quot;: 103,
             &quot;errfd&quot;: -1,
             &quot;pid&quot;: -1,
-            &quot;isClient&quot;: true
+            &quot;isClient&quot;: true,
+            &quot;unlinkUNIX&quot;: false
           },
           &quot;privateData&quot;: 1729
         }
diff --git a/tests/virnetdaemondata/output-data-anon-clients.json b/tests/virnetdaemondata/output-data-anon-clients.json
index 49fe89be48..c7090d2ed8 100644
--- a/tests/virnetdaemondata/output-data-anon-clients.json
+++ b/tests/virnetdaemondata/output-data-anon-clients.json
@@ -19,7 +19,8 @@
               &quot;fd&quot;: 100,
               &quot;errfd&quot;: -1,
               &quot;pid&quot;: 0,
-              &quot;isClient&quot;: false
+              &quot;isClient&quot;: false,
+              &quot;unlinkUNIX&quot;: true
             }
           ]
         },
@@ -32,7 +33,8 @@
               &quot;fd&quot;: 101,
               &quot;errfd&quot;: -1,
               &quot;pid&quot;: 0,
-              &quot;isClient&quot;: false
+              &quot;isClient&quot;: false,
+              &quot;unlinkUNIX&quot;: true
             }
           ]
         }
@@ -48,7 +50,8 @@
             &quot;fd&quot;: 102,
             &quot;errfd&quot;: -1,
             &quot;pid&quot;: -1,
-            &quot;isClient&quot;: true
+            &quot;isClient&quot;: true,
+            &quot;unlinkUNIX&quot;: false
           },
           &quot;privateData&quot;: 1729
         },
@@ -62,7 +65,8 @@
             &quot;fd&quot;: 103,
             &quot;errfd&quot;: -1,
             &quot;pid&quot;: -1,
-            &quot;isClient&quot;: true
+            &quot;isClient&quot;: true,
+            &quot;unlinkUNIX&quot;: false
           },
           &quot;privateData&quot;: 1729
         }
diff --git a/tests/virnetdaemondata/output-data-client-auth-pending.json b/tests/virnetdaemondata/output-data-client-auth-pending.json
index 0675404e6c..9011588d8d 100644
--- a/tests/virnetdaemondata/output-data-client-auth-pending.json
+++ b/tests/virnetdaemondata/output-data-client-auth-pending.json
@@ -19,7 +19,8 @@
               &quot;fd&quot;: 100,
               &quot;errfd&quot;: -1,
               &quot;pid&quot;: 0,
-              &quot;isClient&quot;: false
+              &quot;isClient&quot;: false,
+              &quot;unlinkUNIX&quot;: true
             }
           ]
         },
@@ -32,7 +33,8 @@
               &quot;fd&quot;: 101,
               &quot;errfd&quot;: -1,
               &quot;pid&quot;: 0,
-              &quot;isClient&quot;: false
+              &quot;isClient&quot;: false,
+              &quot;unlinkUNIX&quot;: true
             }
           ]
         }
@@ -48,7 +50,8 @@
             &quot;fd&quot;: 102,
             &quot;errfd&quot;: -1,
             &quot;pid&quot;: -1,
-            &quot;isClient&quot;: true
+            &quot;isClient&quot;: true,
+            &quot;unlinkUNIX&quot;: false
           },
           &quot;privateData&quot;: 1729
         },
@@ -62,7 +65,8 @@
             &quot;fd&quot;: 103,
             &quot;errfd&quot;: -1,
             &quot;pid&quot;: -1,
-            &quot;isClient&quot;: true
+            &quot;isClient&quot;: true,
+            &quot;unlinkUNIX&quot;: false
           },
           &quot;privateData&quot;: 1729
         }
diff --git a/tests/virnetdaemondata/output-data-client-ids.json b/tests/virnetdaemondata/output-data-client-ids.json
index 90c3383a93..5840757614 100644
--- a/tests/virnetdaemondata/output-data-client-ids.json
+++ b/tests/virnetdaemondata/output-data-client-ids.json
@@ -19,7 +19,8 @@
               &quot;fd&quot;: 100,
               &quot;errfd&quot;: -1,
               &quot;pid&quot;: 0,
-              &quot;isClient&quot;: false
+              &quot;isClient&quot;: false,
+              &quot;unlinkUNIX&quot;: true
             }
           ]
         },
@@ -32,7 +33,8 @@
               &quot;fd&quot;: 101,
               &quot;errfd&quot;: -1,
               &quot;pid&quot;: 0,
-              &quot;isClient&quot;: false
+              &quot;isClient&quot;: false,
+              &quot;unlinkUNIX&quot;: true
             }
           ]
         }
@@ -48,7 +50,8 @@
             &quot;fd&quot;: 102,
             &quot;errfd&quot;: -1,
             &quot;pid&quot;: -1,
-            &quot;isClient&quot;: true
+            &quot;isClient&quot;: true,
+            &quot;unlinkUNIX&quot;: false
           },
           &quot;privateData&quot;: 1729
         },
@@ -62,7 +65,8 @@
             &quot;fd&quot;: 103,
             &quot;errfd&quot;: -1,
             &quot;pid&quot;: -1,
-            &quot;isClient&quot;: true
+            &quot;isClient&quot;: true,
+            &quot;unlinkUNIX&quot;: false
           },
           &quot;privateData&quot;: 1729
         }
diff --git a/tests/virnetdaemondata/output-data-client-timestamp.json b/tests/virnetdaemondata/output-data-client-timestamp.json
index 9cfb069793..e685475c4a 100644
--- a/tests/virnetdaemondata/output-data-client-timestamp.json
+++ b/tests/virnetdaemondata/output-data-client-timestamp.json
@@ -19,7 +19,8 @@
               &quot;fd&quot;: 100,
               &quot;errfd&quot;: -1,
               &quot;pid&quot;: 0,
-              &quot;isClient&quot;: false
+              &quot;isClient&quot;: false,
+              &quot;unlinkUNIX&quot;: true
             }
           ]
         },
@@ -32,7 +33,8 @@
               &quot;fd&quot;: 101,
               &quot;errfd&quot;: -1,
               &quot;pid&quot;: 0,
-              &quot;isClient&quot;: false
+              &quot;isClient&quot;: false,
+              &quot;unlinkUNIX&quot;: true
             }
           ]
         }
@@ -49,7 +51,8 @@
             &quot;fd&quot;: 102,
             &quot;errfd&quot;: -1,
             &quot;pid&quot;: -1,
-            &quot;isClient&quot;: true
+            &quot;isClient&quot;: true,
+            &quot;unlinkUNIX&quot;: false
           },
           &quot;privateData&quot;: 1729
         },
@@ -64,7 +67,8 @@
             &quot;fd&quot;: 103,
             &quot;errfd&quot;: -1,
             &quot;pid&quot;: -1,
-            &quot;isClient&quot;: true
+            &quot;isClient&quot;: true,
+            &quot;unlinkUNIX&quot;: false
           },
           &quot;privateData&quot;: 1729
         }
diff --git a/tests/virnetdaemondata/output-data-initial.json b/tests/virnetdaemondata/output-data-initial.json
index 916297c59d..f887d37379 100644
--- a/tests/virnetdaemondata/output-data-initial.json
+++ b/tests/virnetdaemondata/output-data-initial.json
@@ -19,7 +19,8 @@
               &quot;fd&quot;: 100,
               &quot;errfd&quot;: -1,
               &quot;pid&quot;: 0,
-              &quot;isClient&quot;: false
+              &quot;isClient&quot;: false,
+              &quot;unlinkUNIX&quot;: true
             }
           ]
         },
@@ -32,7 +33,8 @@
               &quot;fd&quot;: 101,
               &quot;errfd&quot;: -1,
               &quot;pid&quot;: 0,
-              &quot;isClient&quot;: false
+              &quot;isClient&quot;: false,
+              &quot;unlinkUNIX&quot;: true
             }
           ]
         }
@@ -48,7 +50,8 @@
             &quot;fd&quot;: 102,
             &quot;errfd&quot;: -1,
             &quot;pid&quot;: -1,
-            &quot;isClient&quot;: true
+            &quot;isClient&quot;: true,
+            &quot;unlinkUNIX&quot;: false
           },
           &quot;privateData&quot;: 1729
         },
@@ -62,7 +65,8 @@
             &quot;fd&quot;: 103,
             &quot;errfd&quot;: -1,
             &quot;pid&quot;: -1,
-            &quot;isClient&quot;: true
+            &quot;isClient&quot;: true,
+            &quot;unlinkUNIX&quot;: false
           },
           &quot;privateData&quot;: 1729
         }
diff --git a/tests/virnetdaemondata/output-data-no-keepalive-required.json b/tests/virnetdaemondata/output-data-no-keepalive-required.json
index 04cb5e6bb3..4488a23291 100644
--- a/tests/virnetdaemondata/output-data-no-keepalive-required.json
+++ b/tests/virnetdaemondata/output-data-no-keepalive-required.json
@@ -19,7 +19,8 @@
               &quot;fd&quot;: 100,
               &quot;errfd&quot;: -1,
               &quot;pid&quot;: 0,
-              &quot;isClient&quot;: false
+              &quot;isClient&quot;: false,
+              &quot;unlinkUNIX&quot;: true
             }
           ]
         },
@@ -32,7 +33,8 @@
               &quot;fd&quot;: 101,
               &quot;errfd&quot;: -1,
               &quot;pid&quot;: 0,
-              &quot;isClient&quot;: false
+              &quot;isClient&quot;: false,
+              &quot;unlinkUNIX&quot;: true
             }
           ]
         }
@@ -48,7 +50,8 @@
             &quot;fd&quot;: 102,
             &quot;errfd&quot;: -1,
             &quot;pid&quot;: -1,
-            &quot;isClient&quot;: true
+            &quot;isClient&quot;: true,
+            &quot;unlinkUNIX&quot;: false
           },
           &quot;privateData&quot;: 1729
         },
@@ -62,7 +65,8 @@
             &quot;fd&quot;: 103,
             &quot;errfd&quot;: -1,
             &quot;pid&quot;: -1,
-            &quot;isClient&quot;: true
+            &quot;isClient&quot;: true,
+            &quot;unlinkUNIX&quot;: false
           },
           &quot;privateData&quot;: 1729
         }
@@ -87,7 +91,8 @@
               &quot;fd&quot;: 100,
               &quot;errfd&quot;: -1,
               &quot;pid&quot;: 0,
-              &quot;isClient&quot;: false
+              &quot;isClient&quot;: false,
+              &quot;unlinkUNIX&quot;: true
             }
           ]
         },
@@ -100,7 +105,8 @@
               &quot;fd&quot;: 101,
               &quot;errfd&quot;: -1,
               &quot;pid&quot;: 0,
-              &quot;isClient&quot;: false
+              &quot;isClient&quot;: false,
+              &quot;unlinkUNIX&quot;: true
             }
           ]
         }
@@ -116,7 +122,8 @@
             &quot;fd&quot;: 102,
             &quot;errfd&quot;: -1,
             &quot;pid&quot;: -1,
-            &quot;isClient&quot;: true
+            &quot;isClient&quot;: true,
+            &quot;unlinkUNIX&quot;: false
           },
           &quot;privateData&quot;: 1729
         },
@@ -130,7 +137,8 @@
             &quot;fd&quot;: 103,
             &quot;errfd&quot;: -1,
             &quot;pid&quot;: -1,
-            &quot;isClient&quot;: true
+            &quot;isClient&quot;: true,
+            &quot;unlinkUNIX&quot;: false
           },
           &quot;privateData&quot;: 1729
         }
-- 
2.21.0

--
libvir-list mailing list
libvir-list@xxxxxxxxxx
<a  rel="nofollow" href="https://www.redhat.com/mailman/listinfo/libvir-list">https://www.redhat.com/mailman/listinfo/libvir-list</a>



</pre>
<!--X-Body-of-Message-End-->
<!--X-MsgBody-End-->
<!--X-Follow-Ups-->
</div>
<hr>
<!--X-Follow-Ups-End-->
<!--X-References-->
<!--X-References-End-->
<!--X-BotPNI-->
<ul>
<li>Prev by Date:
<strong><a href="msg187142.html">[PATCH v2 03/19] rpc: refactor RPC service constructors	to share more code</a></strong>
</li>
<li>Next by Date:
<strong><a href="msg187139.html">[PATCH v2 04/19] rpc: allow creating RPC service from an	array of FDs</a></strong>
</li>
<li>Previous by thread:
<strong><a href="msg187142.html">[PATCH v2 03/19] rpc: refactor RPC service constructors	to share more code</a></strong>
</li>
<li>Next by thread:
<strong><a href="msg187139.html">[PATCH v2 04/19] rpc: allow creating RPC service from an	array of FDs</a></strong>
</li>
<li>Index(es):
<ul>
<li><a href="maillist.html#187138"><strong>Date</strong></a></li>
<li><a href="index.html#187138"><strong>Thread</strong></a></li>
</ul>
</li>
</ul>

<!--X-BotPNI-End-->
<!--X-User-Footer-->
<center>
<font size=-1>
<a href=/lists/>[Index&nbsp;of&nbsp;Archives]</a>
&nbsp;
&nbsp;
<a href=/lists/virt-tools/>[Virt&nbsp;Tools]</a>
&nbsp;
&nbsp;
<a href=/linux/fedora/libvirt-users/>[Libvirt&nbsp;Users]</a>
&nbsp;
&nbsp;
<a href=/linux/fedora/libosinfo/>[Lib&nbsp;OS&nbsp;Info]</a>
&nbsp;
&nbsp;
<a href=/linux/fedora/fedora-users/>[Fedora&nbsp;Users]</a>
&nbsp;
&nbsp;
<a href=/lists/fedora-desktop/>[Fedora&nbsp;Desktop]</a>
&nbsp;
&nbsp;
<a href=/lists/fedora-selinux/>[Fedora&nbsp;SELinux]</a>
&nbsp;
&nbsp;
<a href=http://www.ske-art.com/z/biglist.php>[Big&nbsp;List&nbsp;of&nbsp;Linux&nbsp;Books]</a>
&nbsp;
&nbsp;
<a href=https://yosemitenews.info>[Yosemite&nbsp;News]</a>
&nbsp;
&nbsp;
<a href=/lists/kde/>[KDE&nbsp;Users]</a>
&nbsp;
&nbsp;
<a href=/lists/fedora-tools/>[Fedora&nbsp;Tools]</a>
</font>
</center>
<hr>
<p>
<div>
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<ins class="adsbygoogle"
     style="display:block"
     data-ad-format="autorelaxed"
     data-ad-client="ca-pub-3422782820843221"
     data-ad-slot="1424524564"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
</div>
<table width=100%>
<tr>
<td align=left>&nbsp;</td>
<td align=right><a href=/lists/><img src=/button_01.gif border=0 alt="Powered by Linux"></a></td>
</tr>
</table>
<!--X-User-Footer-End-->
<script type="text/javascript"> 
 function initAddThis() {
    addthis.init()
 }
initAddThis();
</script>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-760190-1', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
