<!-- MHonArc v2.6.19 -->
<!--X-Subject: Re:  [PATCH v1 11/31] conf: Format and parse NVMe type disk -->
<!--X-From-R13: [vpuny Bevibmavx &#60;zcevibmaNerqung.pbz> -->
<!--X-Date: Wed, 17 Jul 2019 08:05:18 &#45;0700 -->
<!--X-Message-Id: f02daab5&#45;c7f0&#45;fcec&#45;18bd&#45;2f43f0fc58a3@redhat.com -->
<!--X-Content-Type: text/plain -->
<!--X-Reference: cover.1562859733.git.mprivozn@redhat.com -->
<!--X-Reference: ff5dbd208442af172c661aa470d828cb11878c50.1562859733.git.mprivozn@redhat.com -->
<!--X-Reference: 20190716130035.GT2061@angien.pipo.sk -->
<!--X-Head-End-->
<!doctype html public "-//W3C//DTD HTML//EN">
<html>
<head>
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({
          google_ad_client: "ca-pub-3422782820843221",
          enable_page_level_ads: true
     });
</script>
<style>
<!--
 pre {white-space: pre-wrap;}
-->
</style>
<title>libvirt &mdash; Re:  [PATCH v1 11/31] conf: Format and parse NVMe type disk</title>
<meta name="description" content="libvirt: Re:  [PATCH v1 11/31] conf: Format and parse NVMe type disk">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="alternate" type="application/rss+xml" title="Libvirt Development" href="//feeds.feedburner.com/Libvir">
</head>
<body itemscope itemtype="//schema.org/Article" vlink=green>
<!--X-Body-Begin-->
<!--X-User-Header-->
<!--X-User-Header-End-->
<!--X-TopPNI-->
<form action="//www.google.com" id="cse-search-box" target="_blank">
  <div>
    <input type="hidden" name="cx" value="partner-pub-3422782820843221:8422278960" />
    <input type="hidden" name="ie" value="UTF-8" />
    <input type="text" name="q" size="55" />
    <input type="submit" name="sa" value="Search" />
  </div>
</form>
<script type="text/javascript" src="//www.google.com/coop/cse/brand?form=cse-search-box&amp;lang=en"></script>
<h1>Re:  [PATCH v1 11/31] conf: Format and parse NVMe type disk</h1>
[<a href="msg187584.html">Date Prev</a>][<a href="msg187586.html">Date Next</a>][<a href="msg187473.html">Thread Prev</a>][<a href="msg187588.html">Thread Next</a>][<a href="maillist.html#187585">Date Index</a>][<a href="index.html#187585">Thread Index</a>] 


<p>&nbsp;<br>
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- responsive test for archives -->
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-3422782820843221"
     data-ad-slot="6345952567"
     data-ad-format="auto"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>

<!--X-TopPNI-End-->
<!--X-MsgBody-->
<!--X-Subject-Header-Begin-->
<hr>
<!--X-Subject-Header-End-->
<!--X-Head-of-Message-->
<ul>
<li><em>Subject</em>: Re:  [PATCH v1 11/31] conf: Format and parse NVMe type disk</li>
<li><em>From</em>: Michal Privoznik &lt;mprivozn@xxxxxxxxxx&gt;</li>
<li><em>Date</em>: Wed, 17 Jul 2019 17:05:08 +0200</li>
<li><em>Cc</em>: libvir-list@xxxxxxxxxx</li>
<li><em>In-reply-to</em>: &lt;<a href="msg187473.html">20190716130035.GT2061@angien.pipo.sk</a>&gt;</li>
<li><em>References</em>: &lt;<a href="msg187163.html">cover.1562859733.git.mprivozn@redhat.com</a>&gt;	&lt;<a href="msg187171.html">ff5dbd208442af172c661aa470d828cb11878c50.1562859733.git.mprivozn@redhat.com</a>&gt;	&lt;<a href="msg187473.html">20190716130035.GT2061@angien.pipo.sk</a>&gt;</li>
<li><em>User-agent</em>: Mozilla/5.0 (X11; Linux x86_64; rv:60.0) Gecko/20100101	Thunderbird/60.7.2</li>
</ul>
<!--X-Head-of-Message-End-->
<!--X-Head-Body-Sep-Begin-->
<!-- AddThis Button BEGIN -->
<div class="addthis_toolbox addthis_default_style ">
<a class="addthis_button_preferred_1"></a>
<a class="addthis_button_preferred_2"></a>
<a class="addthis_button_preferred_3"></a>
<a class="addthis_button_preferred_4"></a>
<a class="addthis_button_compact"></a>
<a class="addthis_counter addthis_bubble_style"></a>
</div>
<script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5196c2ae1be43d18&async=1&domready=1" async></script>
<!-- AddThis Button END -->
<hr>
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- responsive link 1 -->
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-3422782820843221"
     data-ad-slot="8681825769"
     data-ad-format="link"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
<p>
<div class="content" itemprop="articleBody">
<!--X-Head-Body-Sep-End-->
<!--X-Body-of-Message-->
<pre style="margin: 0em;">
On 7/16/19 3:00 PM, Peter Krempa wrote:
</pre><blockquote style="border-left: #5555EE solid 0.2em; margin: 0em; padding-left: 0.85em"><pre style="margin: 0em;">
On Thu, Jul 11, 2019 at 17:53:58 +0200, Michal Privoznik wrote:
</pre><blockquote style="border-left: #5555EE solid 0.2em; margin: 0em; padding-left: 0.85em"><pre style="margin: 0em;">
To simplify implementation, some restrictions are added. For
instance, an NVMe disk can't go to any bus but virtio and has to
be type of 'disk' and can't have startupPolicy set.

Signed-off-by: Michal Privoznik &lt;mprivozn@xxxxxxxxxx&gt;
---
  src/conf/domain_conf.c                 | 129 +++++++++++++++++++++++++
  src/libvirt_private.syms               |   1 +
  src/qemu/qemu_block.c                  |   1 +
  src/qemu/qemu_command.c                |   1 +
  src/qemu/qemu_driver.c                 |   4 +
  src/qemu/qemu_migration.c              |   1 +
  src/util/virstoragefile.c              |  59 +++++++++++
  src/util/virstoragefile.h              |  15 +++
  src/xenconfig/xen_xl.c                 |   1 +
  tests/qemuxml2argvdata/disk-nvme.xml   |  12 ++-
  tests/qemuxml2xmloutdata/disk-nvme.xml |   1 +
  tests/qemuxml2xmltest.c                |   1 +
  12 files changed, 224 insertions(+), 2 deletions(-)
  create mode 120000 tests/qemuxml2xmloutdata/disk-nvme.xml

diff --git a/src/conf/domain_conf.c b/src/conf/domain_conf.c
index 3323c9a5b1..73f5e1fa0f 100644
--- a/src/conf/domain_conf.c
+++ b/src/conf/domain_conf.c
</pre></blockquote><pre style="margin: 0em;">

[...]

</pre><blockquote style="border-left: #5555EE solid 0.2em; margin: 0em; padding-left: 0.85em"><pre style="margin: 0em;">
@@ -5938,6 +5943,38 @@ virDomainDiskDefValidate(const virDomainDiskDef *disk)
          return -1;
      }
</pre><tt>  
</tt><tt>+    if (disk-&gt;src-&gt;type == VIR_STORAGE_TYPE_NVME) {
</tt><pre style="margin: 0em;">
+        /* These might not be valid for all hypervisors, but be
+         * strict now and possibly refine in the future. */
+        if (disk-&gt;device != VIR_DOMAIN_DISK_DEVICE_DISK) {
+            virReportError(VIR_ERR_CONFIG_UNSUPPORTED,
+                           _(&quot;Unsupported disk type '%s' for NVMe disk&quot;),
+                           virDomainDiskDeviceTypeToString(disk-&gt;device));
+            return -1;
+        }
+
+        if (disk-&gt;bus != VIR_DOMAIN_DISK_BUS_VIRTIO) {
+            virReportError(VIR_ERR_CONFIG_UNSUPPORTED,
+                           _(&quot;Unsupported bus '%s' for NVMe disk&quot;),
+                           virDomainDiskBusTypeToString(disk-&gt;bus));
+            return -1;
+        }
+
+        if (disk-&gt;startupPolicy != VIR_DOMAIN_STARTUP_POLICY_DEFAULT &amp;&amp;
+            disk-&gt;startupPolicy != VIR_DOMAIN_STARTUP_POLICY_MANDATORY) {
+            virReportError(VIR_ERR_CONFIG_UNSUPPORTED,
+                           _(&quot;Unsupported startup policy '%s' for NVMe disk&quot;),
+                           virDomainStartupPolicyTypeToString(disk-&gt;startupPolicy));
+            return -1;
+        }
+
+        if (disk-&gt;src-&gt;shared) {
+            virReportError(VIR_ERR_CONFIG_UNSUPPORTED, &quot;%s&quot;,
+                           _(&quot;Unsupported &lt;shareable/&gt; for NVMe disk&quot;));
+            return -1;
+        }
+    }
+
      return 0;
  }
</pre></blockquote><pre style="margin: 0em;">

As noted in the other thread, this really should be extracted, placed in
the validation callback rather than post parse and must iterate the
backing chain if you want this to keep working with -blockdev.
</pre></blockquote><pre style="margin: 0em;">

</pre><tt>I'm not sure I understand what you mean. This function is called 
</tt><tt>virDomainDiskDefValidate() and therefore it is validation callback 
</tt><tt>rather than post parse callback. Where do you want me to put these checks?
</tt><pre style="margin: 0em;">

</pre><blockquote style="border-left: #5555EE solid 0.2em; margin: 0em; padding-left: 0.85em"><pre style="margin: 0em;">

</pre><blockquote style="border-left: #5555EE solid 0.2em; margin: 0em; padding-left: 0.85em"><tt>  
</tt><tt>@@ -9184,6 +9221,76 @@ virDomainDiskSourceNetworkParse(xmlNodePtr node,
</tt><pre style="margin: 0em;">
  }
</pre><tt>  
</tt><tt>  
</tt><tt>+static int
</tt><pre style="margin: 0em;">
+virDomainDiskSourceNVMeParse(xmlNodePtr node,
+                             xmlXPathContextPtr ctxt,
+                             virStorageSourcePtr src)
+{
+    VIR_AUTOPTR(virStorageSourceNVMeDef) nvme = NULL;
+    VIR_AUTOFREE(char *) type = NULL;
+    VIR_AUTOFREE(char *) namespace = NULL;
+    VIR_AUTOFREE(char *) managed = NULL;
+    xmlNodePtr address;
+
+    if (VIR_ALLOC(nvme) &lt; 0)
+        return -1;
+
+    if (!(type = virXMLPropString(node, &quot;type&quot;))) {
+        virReportError(VIR_ERR_XML_ERROR, &quot;%s&quot;,
+                       _(&quot;missing 'type' attribute to disk source&quot;));
+        return -1;
+    }
+
+    if (STRNEQ(type, &quot;pci&quot;)) {
+        virReportError(VIR_ERR_XML_ERROR,
+                       _(&quot;unsupported source type '%s'&quot;),
+                       type);
+        return -1;
+    }
+
+    if (!(namespace = virXMLPropString(node, &quot;namespace&quot;))) {
+        virReportError(VIR_ERR_XML_ERROR, &quot;%s&quot;,
+                       _(&quot;missing 'namespace' attribute to disk source&quot;));
+        return -1;
+    }
+
+    if (virStrToLong_ul(namespace, NULL, 10, &amp;nvme-&gt;namespace) &lt; 0) {
+        virReportError(VIR_ERR_XML_ERROR,
+                       _(&quot;malformed namespace '%s'&quot;),
+                       namespace);
+        return -1;
+    }
+
+    /* NVMe namespaces start from 1 */
+    if (nvme-&gt;namespace == 0) {
+        virReportError(VIR_ERR_XML_ERROR, &quot;%s&quot;,
+                       _(&quot;NVMe namespace can't be zero&quot;));
+        return -1;
+    }
+
+    if ((managed = virXMLPropString(node, &quot;managed&quot;))) {
+        if ((nvme-&gt;managed = virTristateBoolTypeFromString(managed)) &lt;= 0) {
+            virReportError(VIR_ERR_XML_ERROR,
+                           _(&quot;malformed managed value '%s'&quot;),
+                           managed);
+            return -1;
+        }
+    }
+
+    if (!(address = virXPathNode(&quot;./address&quot;, ctxt))) {
+        virReportError(VIR_ERR_XML_ERROR, &quot;%s&quot;,
+                       _(&quot;NVMe disk source is missing address&quot;));
+        return -1;
+    }
</pre></blockquote><pre style="margin: 0em;">

I'm displeased that this is yet another function adding validation in
the parser. You don't make the status quo any worse though so this is
not a request to change it.
</pre></blockquote><pre style="margin: 0em;">

</pre><tt>What validation do you mean? namespace != 0 check? Well, that stems 
</tt><tt>straight from NVMe specs, so it is completely independent of any driver.
</tt><pre style="margin: 0em;">
Or do you mean this !address check? Well, it's needed later in the parsing.

</pre><blockquote style="border-left: #5555EE solid 0.2em; margin: 0em; padding-left: 0.85em"><pre style="margin: 0em;">

</pre><blockquote style="border-left: #5555EE solid 0.2em; margin: 0em; padding-left: 0.85em"><pre style="margin: 0em;">
+
+    if (virPCIDeviceAddressParseXML(address, &amp;nvme-&gt;pciAddr) &lt; 0)
+        return -1;
+
+    VIR_STEAL_PTR(src-&gt;nvme, nvme);
+    return 0;
+}
+
+
  static int
  virDomainDiskSourcePRParse(xmlNodePtr node,
                             xmlXPathContextPtr ctxt,
</pre></blockquote><pre style="margin: 0em;">

[...]

</pre><blockquote style="border-left: #5555EE solid 0.2em; margin: 0em; padding-left: 0.85em"><pre style="margin: 0em;">
diff --git a/src/qemu/qemu_migration.c b/src/qemu/qemu_migration.c
index 2436f5051b..87adccab3d 100644
--- a/src/qemu/qemu_migration.c
+++ b/src/qemu/qemu_migration.c
</pre></blockquote><pre style="margin: 0em;">

Missing change to 'qemuMigrationSrcIsSafe' to reject VMs containing NVMe
disks not having shared source.
</pre></blockquote><pre style="margin: 0em;">

</pre><tt>A NVMe disk can't be shared. It's even explicitly denied in the 
</tt><tt>validation callback. The reason is that there is no way to share a 
</tt><tt>single PCI device with multiple domains.
</tt><pre style="margin: 0em;">

</pre><tt>But this is a good point. I'll probably put it into a different commt 
</tt><tt>though. Even though I'm changing some parts of qemu driver here it's 
</tt><tt>only because of the way we handle switch() with enums.
</tt><pre style="margin: 0em;">

</pre><blockquote style="border-left: #5555EE solid 0.2em; margin: 0em; padding-left: 0.85em"><pre style="margin: 0em;">

Plus that function should probably check the full backing chain rather
than the top element only.
</pre></blockquote><pre style="margin: 0em;">

Pre-existing, but I can try to fix it. Okay.

</pre><blockquote style="border-left: #5555EE solid 0.2em; margin: 0em; padding-left: 0.85em"><pre style="margin: 0em;">

</pre><blockquote style="border-left: #5555EE solid 0.2em; margin: 0em; padding-left: 0.85em"><pre style="margin: 0em;">
diff --git a/src/util/virstoragefile.c b/src/util/virstoragefile.c
index 269d0050fd..18aa33fe05 100644
--- a/src/util/virstoragefile.c
+++ b/src/util/virstoragefile.c
</pre></blockquote><pre style="margin: 0em;">

[...]

</pre><blockquote style="border-left: #5555EE solid 0.2em; margin: 0em; padding-left: 0.85em"><pre style="margin: 0em;">
@@ -2114,6 +2115,48 @@ virStoragePRDefCopy(virStoragePRDefPtr src)
  }
</pre><tt>  
</tt><tt>  
</tt><tt>+static virStorageSourceNVMeDefPtr
</tt><pre style="margin: 0em;">
+virStorageSourceNVMeDefCopy(const virStorageSourceNVMeDef *src)
+{
+    VIR_AUTOPTR(virStorageSourceNVMeDef) ret = NULL;
+
+    if (VIR_ALLOC(ret) &lt; 0)
+        return NULL;
+
+    *ret = *src;
</pre></blockquote><pre style="margin: 0em;">

You opted to use memcpy for the pci address few patches ago.
</pre></blockquote><pre style="margin: 0em;">

Darn! You're right.

</pre><tt>Honestly, I wanted to use coccinelle to adapt our code to 
</tt><tt>virPCIDeviceAddressCopy(); I've written the spatch to do that but then 
</tt><tt>failed to install coccinelle on my rawhide box. And then I've simply 
</tt><tt>forgot about it. Ehm.
</tt><pre style="margin: 0em;">

</pre><blockquote style="border-left: #5555EE solid 0.2em; margin: 0em; padding-left: 0.85em"><pre style="margin: 0em;">

</pre><blockquote style="border-left: #5555EE solid 0.2em; margin: 0em; padding-left: 0.85em"><pre style="margin: 0em;">
+    VIR_RETURN_PTR(ret);
+}
</pre></blockquote><pre style="margin: 0em;">

[...]

</pre><blockquote style="border-left: #5555EE solid 0.2em; margin: 0em; padding-left: 0.85em"><pre style="margin: 0em;">
@@ -2463,6 +2514,7 @@ virStorageSourceIsLocalStorage(const virStorageSource *src)
</pre><tt>  
</tt><tt>      case VIR_STORAGE_TYPE_NETWORK:
</tt><pre style="margin: 0em;">
      case VIR_STORAGE_TYPE_VOLUME:
+    case VIR_STORAGE_TYPE_NVME:
</pre></blockquote><pre style="margin: 0em;">

Welp. While I agree that virStorageSourceIsLocalStorage should return
false you should really add a documentation comment explaining why NVMe
is different. (e.g. regular code accessing src-&gt;path would not work).
</pre></blockquote><pre style="margin: 0em;">

</pre><tt>I think I'm mentioning this somewhere later in the series, but it makes 
</tt><tt>sense to add it here. Okay.
</tt><pre style="margin: 0em;">

</pre><blockquote style="border-left: #5555EE solid 0.2em; margin: 0em; padding-left: 0.85em"><pre style="margin: 0em;">

</pre><blockquote style="border-left: #5555EE solid 0.2em; margin: 0em; padding-left: 0.85em"><pre style="margin: 0em;">
      case VIR_STORAGE_TYPE_LAST:
      case VIR_STORAGE_TYPE_NONE:
          return false;
@@ -2493,6 +2545,10 @@ virStorageSourceIsEmpty(virStorageSourcePtr src)
          src-&gt;protocol == VIR_STORAGE_NET_PROTOCOL_NONE)
          return true;
</pre><tt>  
</tt><tt>+    if (src-&gt;type == VIR_STORAGE_TYPE_NVME &amp;&amp;
</tt><pre style="margin: 0em;">
+        !src-&gt;nvme)
+        return true;
</pre></blockquote><pre style="margin: 0em;">

Formating a disk type='nvme' without any data would not be parseable in
our parser, so this will never happen.

</pre><blockquote style="border-left: #5555EE solid 0.2em; margin: 0em; padding-left: 0.85em"><pre style="margin: 0em;">
+
      return false;
  }

</pre></blockquote><pre style="margin: 0em;">

[...]

</pre><blockquote style="border-left: #5555EE solid 0.2em; margin: 0em; padding-left: 0.85em"><pre style="margin: 0em;">
diff --git a/src/util/virstoragefile.h b/src/util/virstoragefile.h
index 38ba901858..a1294ea608 100644
--- a/src/util/virstoragefile.h
+++ b/src/util/virstoragefile.h
</pre></blockquote><pre style="margin: 0em;">

[...]

</pre><blockquote style="border-left: #5555EE solid 0.2em; margin: 0em; padding-left: 0.85em"><pre style="margin: 0em;">
@@ -231,6 +233,14 @@ struct _virStorageSourceInitiatorDef {
      char *iqn; /* Initiator IQN */
  };
</pre><tt>  
</tt></blockquote><pre style="margin: 0em;">

Add a comment noting that the copy function needs to be fixed if this is
ever being updated

</pre><blockquote style="border-left: #5555EE solid 0.2em; margin: 0em; padding-left: 0.85em"><pre style="margin: 0em;">
+typedef struct _virStorageSourceNVMeDef virStorageSourceNVMeDef;
+typedef virStorageSourceNVMeDef *virStorageSourceNVMeDefPtr;
+struct _virStorageSourceNVMeDef {
+    unsigned long namespace;
</pre></blockquote><pre style="margin: 0em;">

'long' is either 32 or 64 bit depending on the architecture, please use
unsigned int or unsigned long long.

</pre><blockquote style="border-left: #5555EE solid 0.2em; margin: 0em; padding-left: 0.85em"><pre style="margin: 0em;">
+    int managed; /* enum virTristateBool */
+    virPCIDeviceAddress pciAddr;
+};
+
  typedef struct _virStorageDriverData virStorageDriverData;
  typedef virStorageDriverData *virStorageDriverDataPtr;
</pre><tt>  
</tt></blockquote><pre style="margin: 0em;">

[...]

</pre><blockquote style="border-left: #5555EE solid 0.2em; margin: 0em; padding-left: 0.85em"><pre style="margin: 0em;">
@@ -416,6 +428,9 @@ bool virStoragePRDefIsManaged(virStoragePRDefPtr prd);
  bool
  virStorageSourceChainHasManagedPR(virStorageSourcePtr src);
</pre><tt>  
</tt><tt>+void virStorageSourceNVMeDefFree(virStorageSourceNVMeDefPtr def);
</tt><pre style="margin: 0em;">
+VIR_DEFINE_AUTOPTR_FUNC(virStorageSourceNVMeDef, virStorageSourceNVMeDefFree);
</pre></blockquote><pre style="margin: 0em;">

Do these need to be exposed?
</pre></blockquote><pre style="margin: 0em;">

</pre><tt>Yes. In fact, you can see it used right in this patch in 
</tt><tt>virDomainDiskSourceNVMeParse() which lives in src/conf/domain_conf.c.
</tt><pre style="margin: 0em;">

</pre><blockquote style="border-left: #5555EE solid 0.2em; margin: 0em; padding-left: 0.85em"><pre style="margin: 0em;">

</pre><blockquote style="border-left: #5555EE solid 0.2em; margin: 0em; padding-left: 0.85em"><pre style="margin: 0em;">
+
  virSecurityDeviceLabelDefPtr
  virStorageSourceGetSecurityLabelDef(virStorageSourcePtr src,
                                      const char *model);
</pre></blockquote><pre style="margin: 0em;">

[...]

</pre><blockquote style="border-left: #5555EE solid 0.2em; margin: 0em; padding-left: 0.85em"><pre style="margin: 0em;">
diff --git a/tests/qemuxml2argvdata/disk-nvme.xml b/tests/qemuxml2argvdata/disk-nvme.xml
index 0b3dbad4eb..fe956d5ab6 100644
--- a/tests/qemuxml2argvdata/disk-nvme.xml
+++ b/tests/qemuxml2argvdata/disk-nvme.xml
@@ -20,6 +20,7 @@
          &lt;address domain='0x0000' bus='0x01' slot='0x00' function='0x0'/&gt;
        &lt;/source&gt;
        &lt;target dev='vda' bus='virtio'/&gt;
+      &lt;address type='pci' domain='0x0000' bus='0x00' slot='0x04' function='0x0'/&gt;
      &lt;/disk&gt;
      &lt;disk type='nvme' device='disk'&gt;
        &lt;driver name='qemu' type='raw'/&gt;
@@ -27,6 +28,7 @@
          &lt;address domain='0x0000' bus='0x01' slot='0x00' function='0x0'/&gt;
        &lt;/source&gt;
        &lt;target dev='vdb' bus='virtio'/&gt;
+      &lt;address type='pci' domain='0x0000' bus='0x00' slot='0x05' function='0x0'/&gt;
      &lt;/disk&gt;
      &lt;disk type='nvme' device='disk'&gt;
        &lt;driver name='qemu' type='raw'/&gt;
@@ -34,6 +36,7 @@
          &lt;address domain='0x0000' bus='0x02' slot='0x00' function='0x0'/&gt;
        &lt;/source&gt;
        &lt;target dev='vdc' bus='virtio'/&gt;
+      &lt;address type='pci' domain='0x0000' bus='0x00' slot='0x06' function='0x0'/&gt;
      &lt;/disk&gt;
      &lt;disk type='nvme' device='disk'&gt;
        &lt;driver name='qemu' type='raw'/&gt;
@@ -44,10 +47,15 @@
          &lt;/encryption&gt;
        &lt;/source&gt;
        &lt;target dev='vdd' bus='virtio'/&gt;
+      &lt;address type='pci' domain='0x0000' bus='0x00' slot='0x07' function='0x0'/&gt;
      &lt;/disk&gt;
-    &lt;controller type='usb' index='0'/&gt;
+    &lt;controller type='usb' index='0'&gt;
+      &lt;address type='pci' domain='0x0000' bus='0x00' slot='0x01' function='0x2'/&gt;
+    &lt;/controller&gt;
      &lt;controller type='pci' index='0' model='pci-root'/&gt;
-    &lt;controller type='scsi' index='0' model='virtio-scsi'/&gt;
+    &lt;controller type='scsi' index='0' model='virtio-scsi'&gt;
+      &lt;address type='pci' domain='0x0000' bus='0x00' slot='0x03' function='0x0'/&gt;
+    &lt;/controller&gt;
      &lt;input type='mouse' bus='ps2'/&gt;
      &lt;input type='keyboard' bus='ps2'/&gt;
      &lt;memballoon model='none'/&gt;
</pre></blockquote><pre style="margin: 0em;">

All of these belong to the previous patch adding the test file in the
first place.

</pre></blockquote><pre style="margin: 0em;">

Okay.

Michal

--
libvir-list mailing list
libvir-list@xxxxxxxxxx
<a  rel="nofollow" href="https://www.redhat.com/mailman/listinfo/libvir-list">https://www.redhat.com/mailman/listinfo/libvir-list</a>


</pre>
<!--X-Body-of-Message-End-->
<!--X-MsgBody-End-->
<!--X-Follow-Ups-->
</div>
<hr>
<!--X-Follow-Ups-End-->
<!--X-References-->
<!--X-References-End-->
<!--X-BotPNI-->
<ul>
<li>Prev by Date:
<strong><a href="msg187584.html">Re:  [PATCH 1/2] docs: news: remove sed sorcery</a></strong>
</li>
<li>Next by Date:
<strong><a href="msg187586.html">Re:  [PATCH 1/2] docs: news: remove sed sorcery</a></strong>
</li>
<li>Previous by thread:
<strong><a href="msg187473.html">Re:  [PATCH v1 11/31] conf: Format and parse NVMe type disk</a></strong>
</li>
<li>Next by thread:
<strong><a href="msg187588.html">Re:  [PATCH v1 11/31] conf: Format and parse NVMe type disk</a></strong>
</li>
<li>Index(es):
<ul>
<li><a href="maillist.html#187585"><strong>Date</strong></a></li>
<li><a href="index.html#187585"><strong>Thread</strong></a></li>
</ul>
</li>
</ul>

<!--X-BotPNI-End-->
<!--X-User-Footer-->
<center>
<font size=-1>
<a href=/lists/>[Index&nbsp;of&nbsp;Archives]</a>
&nbsp;
&nbsp;
<a href=/lists/virt-tools/>[Virt&nbsp;Tools]</a>
&nbsp;
&nbsp;
<a href=/linux/fedora/libvirt-users/>[Libvirt&nbsp;Users]</a>
&nbsp;
&nbsp;
<a href=/linux/fedora/libosinfo/>[Lib&nbsp;OS&nbsp;Info]</a>
&nbsp;
&nbsp;
<a href=/linux/fedora/fedora-users/>[Fedora&nbsp;Users]</a>
&nbsp;
&nbsp;
<a href=/lists/fedora-desktop/>[Fedora&nbsp;Desktop]</a>
&nbsp;
&nbsp;
<a href=/lists/fedora-selinux/>[Fedora&nbsp;SELinux]</a>
&nbsp;
&nbsp;
<a href=http://www.ske-art.com/z/biglist.php>[Big&nbsp;List&nbsp;of&nbsp;Linux&nbsp;Books]</a>
&nbsp;
&nbsp;
<a href=https://yosemitenews.info>[Yosemite&nbsp;News]</a>
&nbsp;
&nbsp;
<a href=/lists/kde/>[KDE&nbsp;Users]</a>
&nbsp;
&nbsp;
<a href=/lists/fedora-tools/>[Fedora&nbsp;Tools]</a>
</font>
</center>
<hr>
<p>
<div>
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<ins class="adsbygoogle"
     style="display:block"
     data-ad-format="autorelaxed"
     data-ad-client="ca-pub-3422782820843221"
     data-ad-slot="1424524564"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
</div>
<table width=100%>
<tr>
<td align=left>&nbsp;</td>
<td align=right><a href=/lists/><img src=/button_01.gif border=0 alt="Powered by Linux"></a></td>
</tr>
</table>
<!--X-User-Footer-End-->
<script type="text/javascript"> 
 function initAddThis() {
    addthis.init()
 }
initAddThis();
</script>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-760190-1', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
