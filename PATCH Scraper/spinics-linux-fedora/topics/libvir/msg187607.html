<!-- MHonArc v2.6.19 -->
<!--X-Subject: [PATCH 1/1] Revert "Revert "qemu: Temporary disable owner	remembering"" -->
<!--X-From-R13: Rnavry Vraevdhr Pneobmn &#60;qnavryuo413Ntznvy.pbz> -->
<!--X-Date: Wed, 17 Jul 2019 10:20:23 &#45;0700 -->
<!--X-Message-Id: 20190717172004.666&#45;1&#45;danielhb413@gmail.com -->
<!--X-Content-Type: text/plain -->
<!--X-Head-End-->
<!doctype html public "-//W3C//DTD HTML//EN">
<html>
<head>
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({
          google_ad_client: "ca-pub-3422782820843221",
          enable_page_level_ads: true
     });
</script>
<style>
<!--
 pre {white-space: pre-wrap;}
-->
</style>
<title>libvirt &mdash; [PATCH 1/1] Revert &quot;Revert &quot;qemu: Temporary disable owner	remembering&quot;&quot;</title>
<meta name="description" content="libvirt: [PATCH 1/1] Revert &quot;Revert &quot;qemu: Temporary disable owner	remembering&quot;&quot;">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="alternate" type="application/rss+xml" title="Libvirt Development" href="//feeds.feedburner.com/Libvir">
</head>
<body itemscope itemtype="//schema.org/Article" vlink=green>
<!--X-Body-Begin-->
<!--X-User-Header-->
<!--X-User-Header-End-->
<!--X-TopPNI-->
<form action="//www.google.com" id="cse-search-box" target="_blank">
  <div>
    <input type="hidden" name="cx" value="partner-pub-3422782820843221:8422278960" />
    <input type="hidden" name="ie" value="UTF-8" />
    <input type="text" name="q" size="55" />
    <input type="submit" name="sa" value="Search" />
  </div>
</form>
<script type="text/javascript" src="//www.google.com/coop/cse/brand?form=cse-search-box&amp;lang=en"></script>
<h1>[PATCH 1/1] Revert &quot;Revert &quot;qemu: Temporary disable owner	remembering&quot;&quot;</h1>
[<a href="msg187606.html">Date Prev</a>][<a href="msg187608.html">Date Next</a>][<a href="msg187580.html">Thread Prev</a>][<a href="msg187627.html">Thread Next</a>][<a href="maillist.html#187607">Date Index</a>][<a href="index.html#187607">Thread Index</a>] 


<p>&nbsp;<br>
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- responsive test for archives -->
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-3422782820843221"
     data-ad-slot="6345952567"
     data-ad-format="auto"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>

<!--X-TopPNI-End-->
<!--X-MsgBody-->
<!--X-Subject-Header-Begin-->
<hr>
<!--X-Subject-Header-End-->
<!--X-Head-of-Message-->
<ul>
<li><em>Subject</em>: [PATCH 1/1] Revert &quot;Revert &quot;qemu: Temporary disable owner	remembering&quot;&quot;</li>
<li><em>From</em>: Daniel Henrique Barboza &lt;danielhb413@xxxxxxxxx&gt;</li>
<li><em>Date</em>: Wed, 17 Jul 2019 14:20:04 -0300</li>
<li><em>Cc</em>: mprivozn@xxxxxxxxxx, Daniel Henrique Barboza &lt;danielhb413@xxxxxxxxx&gt;</li>
</ul>
<!--X-Head-of-Message-End-->
<!--X-Head-Body-Sep-Begin-->
<!-- AddThis Button BEGIN -->
<div class="addthis_toolbox addthis_default_style ">
<a class="addthis_button_preferred_1"></a>
<a class="addthis_button_preferred_2"></a>
<a class="addthis_button_preferred_3"></a>
<a class="addthis_button_preferred_4"></a>
<a class="addthis_button_compact"></a>
<a class="addthis_counter addthis_bubble_style"></a>
</div>
<script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5196c2ae1be43d18&async=1&domready=1" async></script>
<!-- AddThis Button END -->
<hr>
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- responsive link 1 -->
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-3422782820843221"
     data-ad-slot="8681825769"
     data-ad-format="link"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
<p>
<div class="content" itemprop="articleBody">
<!--X-Head-Body-Sep-End-->
<!--X-Body-of-Message-->
<pre>After this commit, QEMU domains with PCI hostdevs running with
managed=true started to fail to launch with the following error:

error : virProcessRunInFork:1170 : internal error: child reported (status=125): unable to open /dev/vfio/1: Device or resource busy

One way to avoid this issue is to disable this new feature
in qemu.conf, setting remember_owner=0. However, given that
this feature is enabled by default and it is breaking domains that
were running before it, it is best to revert the change until
it is fixed for this scenario as well.

This reverts commit 8695793d726e37e31498f9fcbf0bce0adc56dc91.

Signed-off-by: Daniel Henrique Barboza &lt;danielhb413@xxxxxxxxx&gt;
---
 docs/news.xml                      | 13 -------------
 src/qemu/libvirtd_qemu.aug         |  1 -
 src/qemu/qemu.conf                 |  5 -----
 src/qemu/qemu_conf.c               |  4 ----
 src/qemu/test_libvirtd_qemu.aug.in |  1 -
 5 files changed, 24 deletions(-)

diff --git a/docs/news.xml b/docs/news.xml
index 07d4575a65..8931f74bb9 100644
--- a/docs/news.xml
+++ b/docs/news.xml
@@ -25,19 +25,6 @@
     &lt;section title=&quot;New features&quot;&gt;
     &lt;/section&gt;
     &lt;section title=&quot;Improvements&quot;&gt;
-      &lt;change&gt;
-        &lt;summary&gt;
-          Remember original owners and SELinux labels of files
-        &lt;/summary&gt;
-        &lt;description&gt;
-          When a domain is starting up libvirt changes DAC and
-          SELinux labels so that domain can access it. However,
-          it never remembered the original labels and therefore
-          the file was returned back to &lt;code&gt;root:root&lt;/code&gt;.
-          With this release, the original labels are remembered
-          and restored properly.
-        &lt;/description&gt;
-      &lt;/change&gt;
     &lt;/section&gt;
     &lt;section title=&quot;Bug fixes&quot;&gt;
     &lt;/section&gt;
diff --git a/src/qemu/libvirtd_qemu.aug b/src/qemu/libvirtd_qemu.aug
index eea9094d39..6821cc4a29 100644
--- a/src/qemu/libvirtd_qemu.aug
+++ b/src/qemu/libvirtd_qemu.aug
@@ -72,7 +72,6 @@ module Libvirtd_qemu =
                  | str_entry &quot;user&quot;
                  | str_entry &quot;group&quot;
                  | bool_entry &quot;dynamic_ownership&quot;
-                 | bool_entry &quot;remember_owner&quot;
                  | str_array_entry &quot;cgroup_controllers&quot;
                  | str_array_entry &quot;cgroup_device_acl&quot;
                  | int_entry &quot;seccomp_sandbox&quot;
diff --git a/src/qemu/qemu.conf b/src/qemu/qemu.conf
index fd2ed9dc21..1969b3f0a1 100644
--- a/src/qemu/qemu.conf
+++ b/src/qemu/qemu.conf
@@ -456,11 +456,6 @@
 # Set to 0 to disable file ownership changes.
 #dynamic_ownership = 1
 
-# Whether libvirt should remember and restore the original
-# ownership over files it is relabeling. Defaults to 1, set
-# to 0 to disable the feature.
-#remember_owner = 1
-
 # What cgroup controllers to make use of with QEMU guests
 #
 #  - 'cpu' - use for scheduler tunables
diff --git a/src/qemu/qemu_conf.c b/src/qemu/qemu_conf.c
index e0195dac29..8312f99f80 100644
--- a/src/qemu/qemu_conf.c
+++ b/src/qemu/qemu_conf.c
@@ -125,7 +125,6 @@ virQEMUDriverConfigPtr virQEMUDriverConfigNew(bool privileged)
         cfg-&gt;group = (gid_t)-1;
     }
     cfg-&gt;dynamicOwnership = privileged;
-    cfg-&gt;rememberOwner = privileged;
 
     cfg-&gt;cgroupControllers = -1; /* -1 == auto-detect */
 
@@ -891,9 +890,6 @@ virQEMUDriverConfigLoadSecurityEntry(virQEMUDriverConfigPtr cfg,
     if (virConfGetValueBool(conf, &quot;dynamic_ownership&quot;, &amp;cfg-&gt;dynamicOwnership) &lt; 0)
         return -1;
 
-    if (virConfGetValueBool(conf, &quot;remember_owner&quot;, &amp;cfg-&gt;rememberOwner) &lt; 0)
-        return -1;
-
     if (virConfGetValueStringList(conf, &quot;cgroup_controllers&quot;, false,
                                   &amp;controllers) &lt; 0)
         return -1;
diff --git a/src/qemu/test_libvirtd_qemu.aug.in b/src/qemu/test_libvirtd_qemu.aug.in
index 388ba24b8b..50b728ad22 100644
--- a/src/qemu/test_libvirtd_qemu.aug.in
+++ b/src/qemu/test_libvirtd_qemu.aug.in
@@ -44,7 +44,6 @@ module Test_libvirtd_qemu =
 { &quot;user&quot; = &quot;root&quot; }
 { &quot;group&quot; = &quot;root&quot; }
 { &quot;dynamic_ownership&quot; = &quot;1&quot; }
-{ &quot;remember_owner&quot; = &quot;1&quot; }
 { &quot;cgroup_controllers&quot;
     { &quot;1&quot; = &quot;cpu&quot; }
     { &quot;2&quot; = &quot;devices&quot; }
-- 
2.21.0

--
libvir-list mailing list
libvir-list@xxxxxxxxxx
<a  rel="nofollow" href="https://www.redhat.com/mailman/listinfo/libvir-list">https://www.redhat.com/mailman/listinfo/libvir-list</a>


</pre>
<!--X-Body-of-Message-End-->
<!--X-MsgBody-End-->
<!--X-Follow-Ups-->
</div>
<hr>
<!--X-Follow-Ups-End-->
<!--X-References-->
<!--X-References-End-->
<!--X-BotPNI-->
<ul>
<li>Prev by Date:
<strong><a href="msg187606.html">Re:  [jenkins-ci PATCH v2 11/20] quayadmin: Add support for the PUT method</a></strong>
</li>
<li>Next by Date:
<strong><a href="msg187608.html">Re:  [jenkins-ci PATCH v2 12/20] quayadmin: Add list-triggers command</a></strong>
</li>
<li>Previous by thread:
<strong><a href="msg187580.html">[PATCH 0/2] docs: news: add per-release links</a></strong>
</li>
<li>Next by thread:
<strong><a href="msg187627.html">Re:  [PATCH 1/1] Revert &quot;Revert &quot;qemu: Temporary disable owner remembering&quot;&quot;</a></strong>
</li>
<li>Index(es):
<ul>
<li><a href="maillist.html#187607"><strong>Date</strong></a></li>
<li><a href="index.html#187607"><strong>Thread</strong></a></li>
</ul>
</li>
</ul>

<!--X-BotPNI-End-->
<!--X-User-Footer-->
<center>
<font size=-1>
<a href=/lists/>[Index&nbsp;of&nbsp;Archives]</a>
&nbsp;
&nbsp;
<a href=/lists/virt-tools/>[Virt&nbsp;Tools]</a>
&nbsp;
&nbsp;
<a href=/linux/fedora/libvirt-users/>[Libvirt&nbsp;Users]</a>
&nbsp;
&nbsp;
<a href=/linux/fedora/libosinfo/>[Lib&nbsp;OS&nbsp;Info]</a>
&nbsp;
&nbsp;
<a href=/linux/fedora/fedora-users/>[Fedora&nbsp;Users]</a>
&nbsp;
&nbsp;
<a href=/lists/fedora-desktop/>[Fedora&nbsp;Desktop]</a>
&nbsp;
&nbsp;
<a href=/lists/fedora-selinux/>[Fedora&nbsp;SELinux]</a>
&nbsp;
&nbsp;
<a href=http://www.ske-art.com/z/biglist.php>[Big&nbsp;List&nbsp;of&nbsp;Linux&nbsp;Books]</a>
&nbsp;
&nbsp;
<a href=https://yosemitenews.info>[Yosemite&nbsp;News]</a>
&nbsp;
&nbsp;
<a href=/lists/kde/>[KDE&nbsp;Users]</a>
&nbsp;
&nbsp;
<a href=/lists/fedora-tools/>[Fedora&nbsp;Tools]</a>
</font>
</center>
<hr>
<p>
<div>
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<ins class="adsbygoogle"
     style="display:block"
     data-ad-format="autorelaxed"
     data-ad-client="ca-pub-3422782820843221"
     data-ad-slot="1424524564"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
</div>
<table width=100%>
<tr>
<td align=left>&nbsp;</td>
<td align=right><a href=/lists/><img src=/button_01.gif border=0 alt="Powered by Linux"></a></td>
</tr>
</table>
<!--X-User-Footer-End-->
<script type="text/javascript"> 
 function initAddThis() {
    addthis.init()
 }
initAddThis();
</script>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-760190-1', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
