<!-- MHonArc v2.6.19 -->
<!--X-Subject: Re:  [PATCH 5/5] libvirt_nss: Report newer addresses first -->
<!--X-From-R13: [vpuny Bevibmavx &#60;zcevibmaNerqung.pbz> -->
<!--X-Date: Mon, 15 Jul 2019 04:49:21 &#45;0700 -->
<!--X-Message-Id: f1c4ef29&#45;49a5&#45;7dc3&#45;f436&#45;06649a4da9fc@redhat.com -->
<!--X-Content-Type: text/plain -->
<!--X-Reference: cover.1563015448.git.mprivozn@redhat.com -->
<!--X-Reference: 34130559f6c7ff29bb0a57f53f76372559cfcb8c.1563015448.git.mprivozn@redhat.com -->
<!--X-Reference: 20190715081640.GE11722@ridgehead -->
<!--X-Head-End-->
<!doctype html public "-//W3C//DTD HTML//EN">
<html>
<head>
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({
          google_ad_client: "ca-pub-3422782820843221",
          enable_page_level_ads: true
     });
</script>
<style>
<!--
 pre {white-space: pre-wrap;}
-->
</style>
<title>libvirt &mdash; Re:  [PATCH 5/5] libvirt_nss: Report newer addresses first</title>
<meta name="description" content="libvirt: Re:  [PATCH 5/5] libvirt_nss: Report newer addresses first">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="alternate" type="application/rss+xml" title="Libvirt Development" href="//feeds.feedburner.com/Libvir">
</head>
<body itemscope itemtype="//schema.org/Article" vlink=green>
<!--X-Body-Begin-->
<!--X-User-Header-->
<!--X-User-Header-End-->
<!--X-TopPNI-->
<form action="//www.google.com" id="cse-search-box" target="_blank">
  <div>
    <input type="hidden" name="cx" value="partner-pub-3422782820843221:8422278960" />
    <input type="hidden" name="ie" value="UTF-8" />
    <input type="text" name="q" size="55" />
    <input type="submit" name="sa" value="Search" />
  </div>
</form>
<script type="text/javascript" src="//www.google.com/coop/cse/brand?form=cse-search-box&amp;lang=en"></script>
<h1>Re:  [PATCH 5/5] libvirt_nss: Report newer addresses first</h1>
[<a href="msg187399.html">Date Prev</a>][<a href="msg187401.html">Date Next</a>][<a href="msg187395.html">Thread Prev</a>][<a href="msg187378.html">Thread Next</a>][<a href="maillist.html#187400">Date Index</a>][<a href="index.html#187400">Thread Index</a>] 


<p>&nbsp;<br>
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- responsive test for archives -->
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-3422782820843221"
     data-ad-slot="6345952567"
     data-ad-format="auto"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>

<!--X-TopPNI-End-->
<!--X-MsgBody-->
<!--X-Subject-Header-Begin-->
<hr>
<!--X-Subject-Header-End-->
<!--X-Head-of-Message-->
<ul>
<li><em>Subject</em>: Re:  [PATCH 5/5] libvirt_nss: Report newer addresses first</li>
<li><em>From</em>: Michal Privoznik &lt;mprivozn@xxxxxxxxxx&gt;</li>
<li><em>Date</em>: Mon, 15 Jul 2019 13:49:14 +0200</li>
<li><em>Cc</em>: libvir-list@xxxxxxxxxx, abologna@xxxxxxxxxx</li>
<li><em>In-reply-to</em>: &lt;20190715081640.GE11722@ridgehead&gt;</li>
<li><em>References</em>: &lt;<a href="msg187373.html">cover.1563015448.git.mprivozn@redhat.com</a>&gt;	&lt;<a href="msg187377.html">34130559f6c7ff29bb0a57f53f76372559cfcb8c.1563015448.git.mprivozn@redhat.com</a>&gt;	&lt;20190715081640.GE11722@ridgehead&gt;</li>
<li><em>User-agent</em>: Mozilla/5.0 (X11; Linux x86_64; rv:60.0) Gecko/20100101	Thunderbird/60.7.2</li>
</ul>
<!--X-Head-of-Message-End-->
<!--X-Head-Body-Sep-Begin-->
<!-- AddThis Button BEGIN -->
<div class="addthis_toolbox addthis_default_style ">
<a class="addthis_button_preferred_1"></a>
<a class="addthis_button_preferred_2"></a>
<a class="addthis_button_preferred_3"></a>
<a class="addthis_button_preferred_4"></a>
<a class="addthis_button_compact"></a>
<a class="addthis_counter addthis_bubble_style"></a>
</div>
<script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5196c2ae1be43d18&async=1&domready=1" async></script>
<!-- AddThis Button END -->
<hr>
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- responsive link 1 -->
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-3422782820843221"
     data-ad-slot="8681825769"
     data-ad-format="link"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
<p>
<div class="content" itemprop="articleBody">
<!--X-Head-Body-Sep-End-->
<!--X-Body-of-Message-->
<pre style="margin: 0em;">
On 7/15/19 10:16 AM, Erik Skultety wrote:
</pre><blockquote style="border-left: #5555EE solid 0.2em; margin: 0em; padding-left: 0.85em"><pre style="margin: 0em;">
On Sat, Jul 13, 2019 at 12:58:38PM +0200, Michal Privoznik wrote:
</pre><blockquote style="border-left: #5555EE solid 0.2em; margin: 0em; padding-left: 0.85em"><pre style="margin: 0em;">
Ideally, a software that's translating domain names would iterate
over all addresses the NSS returned, but some software does not
bother (e.g. ping). What happens is that for instance when
installing a guest, it's assigned one IP address but once it's
installed and rebooted it gets a different IP address (because
client ID used for the first DHCP traffic when installing the
guest was generated dynamically and never saved so after reboot
the guest generated new ID which resulted in different IP address
to be assigned). This results in 'ping $domain' not working
properly as it still pings the old IP address. Well, it might -
NSS plugin does not guarantee any order of addresses.

To resolve this problem, we can sort the array just before
returning it to the caller (ping) so that the newer IP addresses
come before older ones.

Reported-by: Andrea Bolognani &lt;abologna@xxxxxxxxxx&gt;
Signed-off-by: Michal Privoznik &lt;mprivozn@xxxxxxxxxx&gt;
---
</pre></blockquote><pre style="margin: 0em;">
...

</pre><blockquote style="border-left: #5555EE solid 0.2em; margin: 0em; padding-left: 0.85em"><pre style="margin: 0em;">
      {
          &quot;ip-address&quot;: &quot;192.168.122.254&quot;,
          &quot;mac-address&quot;: &quot;52:54:00:3a:b5:0c&quot;,
          &quot;hostname&quot;: &quot;gentoo&quot;,
-        &quot;expiry-time&quot;: 2000000000
+        &quot;expiry-time&quot;: 2000000001
</pre></blockquote><pre style="margin: 0em;">

So, why is ^this specific change needed? In the test, you're expecting
192.168.122.[197-199], 192.168.122.199 has expiry time of 1900000000, so the
test would still work.

192.168.122.254 is only assumed in a gentoo test twice, but there are no other
addresses to sort in those cases, so the expiry time in there should not matter
right?

With the explanation of the above:
Reviewed-by: Erik Skultety &lt;eskultet@xxxxxxxxxx&gt;

</pre></blockquote><pre style="margin: 0em;">

</pre><tt>Oh right, I don't understand how it got there. I'm removing it before 
</tt><tt>pushing.
</tt><pre style="margin: 0em;">

Thanks for the review!

Michal

--
libvir-list mailing list
libvir-list@xxxxxxxxxx
<a  rel="nofollow" href="https://www.redhat.com/mailman/listinfo/libvir-list">https://www.redhat.com/mailman/listinfo/libvir-list</a>


</pre>
<!--X-Body-of-Message-End-->
<!--X-MsgBody-End-->
<!--X-Follow-Ups-->
</div>
<hr>
<!--X-Follow-Ups-End-->
<!--X-References-->
<!--X-References-End-->
<!--X-BotPNI-->
<ul>
<li>Prev by Date:
<strong><a href="msg187399.html">Re:  [PATCH] security: aa-helper: allow virt-aa-helper to	read .vhd images</a></strong>
</li>
<li>Next by Date:
<strong><a href="msg187401.html">[PATCH] all: don't wait for driver lock during startup</a></strong>
</li>
<li>Previous by thread:
<strong><a href="msg187395.html">Re:  [PATCH 5/5] libvirt_nss: Report newer addresses first</a></strong>
</li>
<li>Next by thread:
<strong><a href="msg187378.html">[PATCH 3/5] libvirt_nss: Drop some needless cleanup labels</a></strong>
</li>
<li>Index(es):
<ul>
<li><a href="maillist.html#187400"><strong>Date</strong></a></li>
<li><a href="index.html#187400"><strong>Thread</strong></a></li>
</ul>
</li>
</ul>

<!--X-BotPNI-End-->
<!--X-User-Footer-->
<center>
<font size=-1>
<a href=/lists/>[Index&nbsp;of&nbsp;Archives]</a>
&nbsp;
&nbsp;
<a href=/lists/virt-tools/>[Virt&nbsp;Tools]</a>
&nbsp;
&nbsp;
<a href=/linux/fedora/libvirt-users/>[Libvirt&nbsp;Users]</a>
&nbsp;
&nbsp;
<a href=/linux/fedora/libosinfo/>[Lib&nbsp;OS&nbsp;Info]</a>
&nbsp;
&nbsp;
<a href=/linux/fedora/fedora-users/>[Fedora&nbsp;Users]</a>
&nbsp;
&nbsp;
<a href=/lists/fedora-desktop/>[Fedora&nbsp;Desktop]</a>
&nbsp;
&nbsp;
<a href=/lists/fedora-selinux/>[Fedora&nbsp;SELinux]</a>
&nbsp;
&nbsp;
<a href=http://www.ske-art.com/z/biglist.php>[Big&nbsp;List&nbsp;of&nbsp;Linux&nbsp;Books]</a>
&nbsp;
&nbsp;
<a href=https://yosemitenews.info>[Yosemite&nbsp;News]</a>
&nbsp;
&nbsp;
<a href=/lists/kde/>[KDE&nbsp;Users]</a>
&nbsp;
&nbsp;
<a href=/lists/fedora-tools/>[Fedora&nbsp;Tools]</a>
</font>
</center>
<hr>
<p>
<div>
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<ins class="adsbygoogle"
     style="display:block"
     data-ad-format="autorelaxed"
     data-ad-client="ca-pub-3422782820843221"
     data-ad-slot="1424524564"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
</div>
<table width=100%>
<tr>
<td align=left>&nbsp;</td>
<td align=right><a href=/lists/><img src=/button_01.gif border=0 alt="Powered by Linux"></a></td>
</tr>
</table>
<!--X-User-Footer-End-->
<script type="text/javascript"> 
 function initAddThis() {
    addthis.init()
 }
initAddThis();
</script>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-760190-1', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
