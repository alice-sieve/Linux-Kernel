<!-- MHonArc v2.6.19 -->
<!--X-Subject: Re:  [PATCH v2] logging: ensure virtlogd rollover takes priority over logrotate -->
<!--X-From-R13: Rnavry =?hgs&#45;8?P?GQ4tCzHlpzThL8Ac?= &#60;oreenatrNerqung.pbz> -->
<!--X-Date: Fri, 12 Jul 2019 01:18:07 &#45;0700 -->
<!--X-Message-Id: 20190712081750.GA5068@redhat.com -->
<!--X-Content-Type: text/plain -->
<!--X-Reference: 20190710171425.25262&#45;1&#45;berrange@redhat.com -->
<!--X-Reference: e6a303e8&#45;5da7&#45;9d30&#45;92dc&#45;a3541428e6c6@suse.com -->
<!--X-Head-End-->
<!doctype html public "-//W3C//DTD HTML//EN">
<html>
<head>
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({
          google_ad_client: "ca-pub-3422782820843221",
          enable_page_level_ads: true
     });
</script>
<style>
<!--
 pre {white-space: pre-wrap;}
-->
</style>
<title>libvirt &mdash; Re:  [PATCH v2] logging: ensure virtlogd rollover takes priority over logrotate</title>
<meta name="description" content="libvirt: Re:  [PATCH v2] logging: ensure virtlogd rollover takes priority over logrotate">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="alternate" type="application/rss+xml" title="Libvirt Development" href="//feeds.feedburner.com/Libvir">
</head>
<body itemscope itemtype="//schema.org/Article" vlink=green>
<!--X-Body-Begin-->
<!--X-User-Header-->
<!--X-User-Header-End-->
<!--X-TopPNI-->
<form action="//www.google.com" id="cse-search-box" target="_blank">
  <div>
    <input type="hidden" name="cx" value="partner-pub-3422782820843221:8422278960" />
    <input type="hidden" name="ie" value="UTF-8" />
    <input type="text" name="q" size="55" />
    <input type="submit" name="sa" value="Search" />
  </div>
</form>
<script type="text/javascript" src="//www.google.com/coop/cse/brand?form=cse-search-box&amp;lang=en"></script>
<h1>Re:  [PATCH v2] logging: ensure virtlogd rollover takes priority over logrotate</h1>
[<a href="msg187268.html">Date Prev</a>][<a href="msg187270.html">Date Next</a>][<a href="msg187264.html">Thread Prev</a>][<a href="msg187034.html">Thread Next</a>][<a href="maillist.html#187269">Date Index</a>][<a href="index.html#187269">Thread Index</a>] 


<p>&nbsp;<br>
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- responsive test for archives -->
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-3422782820843221"
     data-ad-slot="6345952567"
     data-ad-format="auto"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>

<!--X-TopPNI-End-->
<!--X-MsgBody-->
<!--X-Subject-Header-Begin-->
<hr>
<!--X-Subject-Header-End-->
<!--X-Head-of-Message-->
<ul>
<li><em>Subject</em>: Re:  [PATCH v2] logging: ensure virtlogd rollover takes priority over logrotate</li>
<li><em>From</em>: Daniel P. Berrang&#xE9; &lt;berrange@xxxxxxxxxx&gt;</li>
<li><em>Date</em>: Fri, 12 Jul 2019 09:17:50 +0100</li>
<li><em>Cc</em>: &quot;libvir-list@xxxxxxxxxx&quot; &lt;libvir-list@xxxxxxxxxx&gt;</li>
<li><em>In-reply-to</em>: &lt;<a href="msg187264.html">e6a303e8-5da7-9d30-92dc-a3541428e6c6@suse.com</a>&gt;</li>
<li><em>References</em>: &lt;<a href="msg187033.html">20190710171425.25262-1-berrange@redhat.com</a>&gt;	&lt;<a href="msg187264.html">e6a303e8-5da7-9d30-92dc-a3541428e6c6@suse.com</a>&gt;</li>
<li><em>Reply-to</em>: Daniel P. Berrang&#xE9; &lt;berrange@xxxxxxxxxx&gt;</li>
<li><em>User-agent</em>: Mutt/1.12.0 (2019-05-25)</li>
</ul>
<!--X-Head-of-Message-End-->
<!--X-Head-Body-Sep-Begin-->
<!-- AddThis Button BEGIN -->
<div class="addthis_toolbox addthis_default_style ">
<a class="addthis_button_preferred_1"></a>
<a class="addthis_button_preferred_2"></a>
<a class="addthis_button_preferred_3"></a>
<a class="addthis_button_preferred_4"></a>
<a class="addthis_button_compact"></a>
<a class="addthis_counter addthis_bubble_style"></a>
</div>
<script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5196c2ae1be43d18&async=1&domready=1" async></script>
<!-- AddThis Button END -->
<hr>
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- responsive link 1 -->
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-3422782820843221"
     data-ad-slot="8681825769"
     data-ad-format="link"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
<p>
<div class="content" itemprop="articleBody">
<!--X-Head-Body-Sep-End-->
<!--X-Body-of-Message-->
<pre>On Fri, Jul 12, 2019 at 02:55:25AM +0000, Jim Fehlig wrote:
&gt; On 7/10/19 11:14 AM, Daniel P. Berrang&#xE9;  wrote:
&gt; &gt; The virtlogd config is set to rollover logs every 2 MB.
&gt; &gt; 
&gt; &gt; Normally a logrotate config file is also installed to handle cases where
&gt; &gt; virtlogd is disabled. This is set to rollover weekly with no size
&gt; &gt; constraint.
&gt; &gt; 
&gt; &gt; As a result logrotate can interfere with virtlogd's, rolling over files
&gt; &gt; that virtlogd has already taken care of.
&gt; &gt; 
&gt; &gt; This changes logrotate configs to rollover based on a max size
&gt; &gt; constraint of 2 MB + 1 byte. When virtlogd is running the log files will
&gt; &gt; never get this large, making logrotate a no-op.
&gt; &gt; 
&gt; &gt; If the user changes the size in virtlogd's config to something larger,
&gt; &gt; they are responsible for also changing the logrotate config suitably.
&gt; &gt; 
&gt; &gt; The LXC driver doesn't use virtlogd, but its logrotate config is altered
&gt; &gt; to match the QEMU driver logrotate, just for the sake of consistency.
&gt; &gt; 
&gt; &gt; Signed-off-by: Daniel P. Berrang&#xE9; &lt;berrange@xxxxxxxxxx&gt;
&gt; &gt; ---
&gt; &gt;   src/logging/virtlogd.conf              |  6 ++++++
&gt; &gt;   src/remote/libvirtd.libxl.logrotate.in |  2 +-
&gt; &gt;   src/remote/libvirtd.lxc.logrotate.in   |  2 +-
&gt; &gt;   src/remote/libvirtd.qemu.logrotate.in  | 10 +++++++++-
&gt; &gt;   4 files changed, 17 insertions(+), 3 deletions(-)
&gt; 
&gt; This patch looks good based on requirement of logrotate not interfering with 
&gt; virtlogd rotation, and for that
&gt; 
&gt; Reviewed-by: Jim Fehlig &lt;jfehlig@xxxxxxxx&gt;
&gt; 
&gt; But the problem of unpurged log files that Jan was attempting to solve remains. 
&gt; If I understood your response to to his V2 patch [0], virtlogd needs to gain 
&gt; support for purging log files for old transient VMs after some configurable time?

I don't think it needs to be virtlogd really. I was suggesting a standalone
periodic task.

&gt; In the private bug (sorry) that initiated this discussion I suggested adjusting 
&gt; the logrotate config via cloud deployment tool, pushing rotation policy 
&gt; decisions off to the &quot;admin&quot;. What is your opinion on fixing this in upstream 
&gt; libvirt vs configuration at deployment?

A local admin is of course free to change the configuration is any way
they desire.  Just that from upstream POV, having logrotate touch files
that are managed by virtlogd puts you in an unsupportable situation.

Regards,
Daniel

&gt; [0] <a  rel="nofollow" href="https://www.redhat.com/archives/libvir-list/2019-July/msg00368.html">https://www.redhat.com/archives/libvir-list/2019-July/msg00368.html</a>
-- 
|: <a  rel="nofollow" href="https://berrange.com">https://berrange.com</a>      -o-    <a  rel="nofollow" href="https://www.flickr.com/photos/dberrange">https://www.flickr.com/photos/dberrange</a> :|
|: <a  rel="nofollow" href="https://libvirt.org">https://libvirt.org</a>         -o-            <a  rel="nofollow" href="https://fstop138.berrange.com">https://fstop138.berrange.com</a> :|
|: <a  rel="nofollow" href="https://entangle-photo.org">https://entangle-photo.org</a>    -o-    <a  rel="nofollow" href="https://www.instagram.com/dberrange">https://www.instagram.com/dberrange</a> :|

--
libvir-list mailing list
libvir-list@xxxxxxxxxx
<a  rel="nofollow" href="https://www.redhat.com/mailman/listinfo/libvir-list">https://www.redhat.com/mailman/listinfo/libvir-list</a>



</pre>
<!--X-Body-of-Message-End-->
<!--X-MsgBody-End-->
<!--X-Follow-Ups-->
</div>
<hr>
<!--X-Follow-Ups-End-->
<!--X-References-->
<!--X-References-End-->
<!--X-BotPNI-->
<ul>
<li>Prev by Date:
<strong><a href="msg187268.html">[PATCH v2 3/3] test_driver: testDomainSetMaxMemory should	simply forward the call</a></strong>
</li>
<li>Next by Date:
<strong><a href="msg187270.html">Re:  [PATCH v4 15/23] utils: Write a maximum of MAX_PIPE_WRITE_BYTES into a pipe</a></strong>
</li>
<li>Previous by thread:
<strong><a href="msg187264.html">Re:  [PATCH v2] logging: ensure virtlogd rollover takes priority over logrotate</a></strong>
</li>
<li>Next by thread:
<strong><a href="msg187034.html">[PATCH v2 00/21] Add support for vTPM state encryption</a></strong>
</li>
<li>Index(es):
<ul>
<li><a href="maillist.html#187269"><strong>Date</strong></a></li>
<li><a href="index.html#187269"><strong>Thread</strong></a></li>
</ul>
</li>
</ul>

<!--X-BotPNI-End-->
<!--X-User-Footer-->
<center>
<font size=-1>
<a href=/lists/>[Index&nbsp;of&nbsp;Archives]</a>
&nbsp;
&nbsp;
<a href=/lists/virt-tools/>[Virt&nbsp;Tools]</a>
&nbsp;
&nbsp;
<a href=/linux/fedora/libvirt-users/>[Libvirt&nbsp;Users]</a>
&nbsp;
&nbsp;
<a href=/linux/fedora/libosinfo/>[Lib&nbsp;OS&nbsp;Info]</a>
&nbsp;
&nbsp;
<a href=/linux/fedora/fedora-users/>[Fedora&nbsp;Users]</a>
&nbsp;
&nbsp;
<a href=/lists/fedora-desktop/>[Fedora&nbsp;Desktop]</a>
&nbsp;
&nbsp;
<a href=/lists/fedora-selinux/>[Fedora&nbsp;SELinux]</a>
&nbsp;
&nbsp;
<a href=http://www.ske-art.com/z/biglist.php>[Big&nbsp;List&nbsp;of&nbsp;Linux&nbsp;Books]</a>
&nbsp;
&nbsp;
<a href=https://yosemitenews.info>[Yosemite&nbsp;News]</a>
&nbsp;
&nbsp;
<a href=/lists/kde/>[KDE&nbsp;Users]</a>
&nbsp;
&nbsp;
<a href=/lists/fedora-tools/>[Fedora&nbsp;Tools]</a>
</font>
</center>
<hr>
<p>
<div>
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<ins class="adsbygoogle"
     style="display:block"
     data-ad-format="autorelaxed"
     data-ad-client="ca-pub-3422782820843221"
     data-ad-slot="1424524564"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
</div>
<table width=100%>
<tr>
<td align=left>&nbsp;</td>
<td align=right><a href=/lists/><img src=/button_01.gif border=0 alt="Powered by Linux"></a></td>
</tr>
</table>
<!--X-User-Footer-End-->
<script type="text/javascript"> 
 function initAddThis() {
    addthis.init()
 }
initAddThis();
</script>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-760190-1', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
