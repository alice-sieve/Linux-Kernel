<!-- MHonArc v2.6.19 -->
<!--X-Subject: Re:  [PATCH] test_driver: consider flags in testDomainSetMemoryFlags -->
<!--X-From-R13: Sevp Pynxr &#60;roynxrNerqung.pbz> -->
<!--X-Date: Thu, 11 Jul 2019 07:30:39 &#45;0700 -->
<!--X-Message-Id: ca6a6f3a&#45;40ca&#45;5aa0&#45;a166&#45;0dc5d48ed7ed@redhat.com -->
<!--X-Content-Type: multipart/mixed -->
<!--X-Reference: 20190711110450.16444&#45;1&#45;stamatis.iliass@gmail.com -->
<!--X-Reference: d4ae436b&#45;2604&#45;7780&#45;4d55&#45;62a2ddf1826d@redhat.com -->
<!--X-Reference: CAAfjAQO2kdbmn9rx1W+Lxg63UEJPxUwaBa8M6bRVVbhTR59t=w@mail.gmail.com -->
<!--X-Derived: pgp8GhJuxqmGP.pgp -->
<!--X-Head-End-->
<!doctype html public "-//W3C//DTD HTML//EN">
<html>
<head>
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({
          google_ad_client: "ca-pub-3422782820843221",
          enable_page_level_ads: true
     });
</script>
<style>
<!--
 pre {white-space: pre-wrap;}
-->
</style>
<title>libvirt &mdash; Re:  [PATCH] test_driver: consider flags in testDomainSetMemoryFlags</title>
<meta name="description" content="libvirt: Re:  [PATCH] test_driver: consider flags in testDomainSetMemoryFlags">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="alternate" type="application/rss+xml" title="Libvirt Development" href="//feeds.feedburner.com/Libvir">
</head>
<body itemscope itemtype="//schema.org/Article" vlink=green>
<!--X-Body-Begin-->
<!--X-User-Header-->
<!--X-User-Header-End-->
<!--X-TopPNI-->
<form action="//www.google.com" id="cse-search-box" target="_blank">
  <div>
    <input type="hidden" name="cx" value="partner-pub-3422782820843221:8422278960" />
    <input type="hidden" name="ie" value="UTF-8" />
    <input type="text" name="q" size="55" />
    <input type="submit" name="sa" value="Search" />
  </div>
</form>
<script type="text/javascript" src="//www.google.com/coop/cse/brand?form=cse-search-box&amp;lang=en"></script>
<h1>Re:  [PATCH] test_driver: consider flags in testDomainSetMemoryFlags</h1>
[<a href="msg187154.html">Date Prev</a>][<a href="msg187156.html">Date Next</a>][<a href="msg187153.html">Thread Prev</a>][<a href="msg187125.html">Thread Next</a>][<a href="maillist.html#187155">Date Index</a>][<a href="index.html#187155">Thread Index</a>] 


<p>&nbsp;<br>
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- responsive test for archives -->
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-3422782820843221"
     data-ad-slot="6345952567"
     data-ad-format="auto"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>

<!--X-TopPNI-End-->
<!--X-MsgBody-->
<!--X-Subject-Header-Begin-->
<hr>
<!--X-Subject-Header-End-->
<!--X-Head-of-Message-->
<ul>
<li><em>Subject</em>: Re:  [PATCH] test_driver: consider flags in testDomainSetMemoryFlags</li>
<li><em>From</em>: Eric Blake &lt;eblake@xxxxxxxxxx&gt;</li>
<li><em>Date</em>: Thu, 11 Jul 2019 09:30:27 -0500</li>
<li><em>Cc</em>: libvir-list@xxxxxxxxxx, Peter Krempa &lt;pkrempa@xxxxxxxxxx&gt;</li>
<li><em>In-reply-to</em>: &lt;CAAfjAQO2kdbmn9rx1W+Lxg63UEJPxUwaBa8M6bRVVbhTR59t=w@mail.gmail.com&gt;</li>
<li><em>Organization</em>: Red Hat, Inc.</li>
<li><em>References</em>: &lt;<a href="msg187120.html">20190711110450.16444-1-stamatis.iliass@gmail.com</a>&gt;	&lt;<a href="msg187132.html">d4ae436b-2604-7780-4d55-62a2ddf1826d@redhat.com</a>&gt;	&lt;CAAfjAQO2kdbmn9rx1W+Lxg63UEJPxUwaBa8M6bRVVbhTR59t=w@mail.gmail.com&gt;</li>
<li><em>User-agent</em>: Mozilla/5.0 (X11; Linux x86_64; rv:60.0) Gecko/20100101	Thunderbird/60.7.0</li>
</ul>
<!--X-Head-of-Message-End-->
<!--X-Head-Body-Sep-Begin-->
<!-- AddThis Button BEGIN -->
<div class="addthis_toolbox addthis_default_style ">
<a class="addthis_button_preferred_1"></a>
<a class="addthis_button_preferred_2"></a>
<a class="addthis_button_preferred_3"></a>
<a class="addthis_button_preferred_4"></a>
<a class="addthis_button_compact"></a>
<a class="addthis_counter addthis_bubble_style"></a>
</div>
<script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5196c2ae1be43d18&async=1&domready=1" async></script>
<!-- AddThis Button END -->
<hr>
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- responsive link 1 -->
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-3422782820843221"
     data-ad-slot="8681825769"
     data-ad-format="link"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
<p>
<div class="content" itemprop="articleBody">
<!--X-Head-Body-Sep-End-->
<!--X-Body-of-Message-->
<pre>On 7/11/19 9:15 AM, Ilias Stamatis wrote:
&gt; On Thu, Jul 11, 2019 at 4:03 PM Eric Blake &lt;eblake@xxxxxxxxxx&gt; wrote:
&gt;&gt;
&gt;&gt; On 7/11/19 6:04 AM, Ilias Stamatis wrote:
&gt;&gt;&gt; Update the current or max memory, on the persistent or live definition
&gt;&gt;&gt; depending on the flags which are currently ignored.
&gt;&gt;&gt;
&gt;&gt;&gt; Signed-off-by: Ilias Stamatis &lt;stamatis.iliass@xxxxxxxxx&gt;
&gt;&gt;&gt; ---
&gt;&gt;&gt;  src/test/test_driver.c | 51 +++++++++++++++++++++++++++++++++++-------
&gt;&gt;&gt;  1 file changed, 43 insertions(+), 8 deletions(-)
&gt;&gt;&gt;
&gt;&gt;
&gt;&gt; Incomplete. You also need to fix what I missed in commit 667ac11e, in
&gt;&gt; that testDomainSetMemory() should now forward to
&gt;&gt; testDomainSetMemoryFlags(, VIR_DOMAIN_AFFECT_LIVE); and it would also be
&gt;&gt; worth implementing testDomainSetMaxMemory() to forward to
&gt;&gt; testDomainSetMemoryFlags(, VIR_DOMAIN_MEM_MAXIMUM).
&gt; 
&gt; Sure. But do you think they should be on the same patch?
&gt; Maybe in a subsequent patch on the same series?

Separate patches in a series is fine.

&gt; 
&gt;&gt;
&gt;&gt; Oh, and thinking about it, maybe everywhere we have
&gt;&gt; xxxDomainSetMaxMemory forwarding on, it seems odd that it is affecting
&gt;&gt; VIR_DOMAIN_AFFECT_CURRENT instead of VIR_DOMAIN_AFFECT_LIVE; but then we
&gt;&gt; have to start worrying about back-compat issues. :(
&gt; 
&gt; According to the documentation this is hypervisor-dependent so in the
&gt; case of the test driver I think it's fine to call it with
&gt; VIR_DOMAIN_AFFECT_LIVE.

My eventual goal is to git rid of multiple driver callbacks, and have
JUST .drvDomainSetMemoryFlags() for drivers to implement. But for that
to work, we have to teach the remote driver to call the OLD RPC function
for every scenario where the old function is a trivial wrapper around
the new (in some cases, that's when flags==0, in others, when
flags==VIR_DOMAIN_AFFECT_CURRENT), in case the remote driver is talking
to an older libvirt that did not yet have the implementation of the new
callback function.  That is, if libvirt 5.7 as client calls
virDomainSetMaxMemory(), that will call into the remote driver as
.drvDomainSetMemoryFlags(, default_flags), then the remote driver will
see the default flags and call the RPC for DOMAIN_SET_MAX_MEMORY, in
case on the remote side is running 5.5 or older and has the older
.drvDomainSetMaxMemory() for a driver that did not yet have
.drvDomainSetMemoryFlags() support.  We don't want to fail the call just
because the new callback was missing in the older server.  But to do
that, we have to audit ALL of the drivers with paired APIs and ensure
that, at least in new libvirt, the pairings all use the same
default_flags (for knowing when to fall back to the old API), and that
for old libvirt, that falling back to the old API is not going to subtly
change semantics for whehter a libvirt 5.5 or libvirt 5.7 client made
the request.

&gt; 
&gt; However, changing it on other drivers raises compatibility issues as
&gt; you mentioned.

That's why it is a bigger issue, and needs some careful thought.  I
started on the topic, but it is now lower-priority for me than getting
incremental backup into 5.6, so it might not happen until 5.7.

-- 
Eric Blake, Principal Software Engineer
Red Hat, Inc.           +1-919-301-3226
Virtualization:  qemu.org | libvirt.org

</pre><p><strong>Attachment:
<a href="attachments/pgp8GhJuxqmGP.pgp" ><tt>signature.asc</tt></a></strong><br>
<em>Description:</em> OpenPGP digital signature</p>
<pre>--
libvir-list mailing list
libvir-list@xxxxxxxxxx
<a  rel="nofollow" href="https://www.redhat.com/mailman/listinfo/libvir-list">https://www.redhat.com/mailman/listinfo/libvir-list</a></pre>
<!--X-Body-of-Message-End-->
<!--X-MsgBody-End-->
<!--X-Follow-Ups-->
</div>
<hr>
<!--X-Follow-Ups-End-->
<!--X-References-->
<!--X-References-End-->
<!--X-BotPNI-->
<ul>
<li>Prev by Date:
<strong><a href="msg187154.html">Re:  [PATCH 04/10] qemu: stop formatting json='1' in status XML</a></strong>
</li>
<li>Next by Date:
<strong><a href="msg187156.html">[jenkins-ci PATCH] guests: Create java symlink on FreeBSD</a></strong>
</li>
<li>Previous by thread:
<strong><a href="msg187153.html">Re:  [PATCH] test_driver: consider flags in	testDomainSetMemoryFlags</a></strong>
</li>
<li>Next by thread:
<strong><a href="msg187125.html">[PATCH] test_driver: implement	virDomainSetMemoryStatsPeriod</a></strong>
</li>
<li>Index(es):
<ul>
<li><a href="maillist.html#187155"><strong>Date</strong></a></li>
<li><a href="index.html#187155"><strong>Thread</strong></a></li>
</ul>
</li>
</ul>

<!--X-BotPNI-End-->
<!--X-User-Footer-->
<center>
<font size=-1>
<a href=/lists/>[Index&nbsp;of&nbsp;Archives]</a>
&nbsp;
&nbsp;
<a href=/lists/virt-tools/>[Virt&nbsp;Tools]</a>
&nbsp;
&nbsp;
<a href=/linux/fedora/libvirt-users/>[Libvirt&nbsp;Users]</a>
&nbsp;
&nbsp;
<a href=/linux/fedora/libosinfo/>[Lib&nbsp;OS&nbsp;Info]</a>
&nbsp;
&nbsp;
<a href=/linux/fedora/fedora-users/>[Fedora&nbsp;Users]</a>
&nbsp;
&nbsp;
<a href=/lists/fedora-desktop/>[Fedora&nbsp;Desktop]</a>
&nbsp;
&nbsp;
<a href=/lists/fedora-selinux/>[Fedora&nbsp;SELinux]</a>
&nbsp;
&nbsp;
<a href=http://www.ske-art.com/z/biglist.php>[Big&nbsp;List&nbsp;of&nbsp;Linux&nbsp;Books]</a>
&nbsp;
&nbsp;
<a href=https://yosemitenews.info>[Yosemite&nbsp;News]</a>
&nbsp;
&nbsp;
<a href=/lists/kde/>[KDE&nbsp;Users]</a>
&nbsp;
&nbsp;
<a href=/lists/fedora-tools/>[Fedora&nbsp;Tools]</a>
</font>
</center>
<hr>
<p>
<div>
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<ins class="adsbygoogle"
     style="display:block"
     data-ad-format="autorelaxed"
     data-ad-client="ca-pub-3422782820843221"
     data-ad-slot="1424524564"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
</div>
<table width=100%>
<tr>
<td align=left>&nbsp;</td>
<td align=right><a href=/lists/><img src=/button_01.gif border=0 alt="Powered by Linux"></a></td>
</tr>
</table>
<!--X-User-Footer-End-->
<script type="text/javascript"> 
 function initAddThis() {
    addthis.init()
 }
initAddThis();
</script>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-760190-1', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
