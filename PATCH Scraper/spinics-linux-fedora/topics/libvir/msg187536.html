<!-- MHonArc v2.6.19 -->
<!--X-Subject: Re:  [PATCH v1 11/31] conf: Format and parse NVMe type disk -->
<!--X-From-R13: [vpuny Bevibmavx &#60;zcevibmaNerqung.pbz> -->
<!--X-Date: Wed, 17 Jul 2019 05:40:12 &#45;0700 -->
<!--X-Message-Id: db64fcd0&#45;0755&#45;acbb&#45;3059&#45;be16b0377331@redhat.com -->
<!--X-Content-Type: text/plain -->
<!--X-Reference: cover.1562859733.git.mprivozn@redhat.com -->
<!--X-Reference: ff5dbd208442af172c661aa470d828cb11878c50.1562859733.git.mprivozn@redhat.com -->
<!--X-Reference: 20190711160517.GE2061@angien.pipo.sk -->
<!--X-Reference: 9c506321&#45;173c&#45;940e&#45;3949&#45;d14558c97e0d@redhat.com -->
<!--X-Reference: 20190711161658.GG2061@angien.pipo.sk -->
<!--X-Reference: 20190716123805.GS2061@angien.pipo.sk -->
<!--X-Head-End-->
<!doctype html public "-//W3C//DTD HTML//EN">
<html>
<head>
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({
          google_ad_client: "ca-pub-3422782820843221",
          enable_page_level_ads: true
     });
</script>
<style>
<!--
 pre {white-space: pre-wrap;}
-->
</style>
<title>libvirt &mdash; Re:  [PATCH v1 11/31] conf: Format and parse NVMe type disk</title>
<meta name="description" content="libvirt: Re:  [PATCH v1 11/31] conf: Format and parse NVMe type disk">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="alternate" type="application/rss+xml" title="Libvirt Development" href="//feeds.feedburner.com/Libvir">
</head>
<body itemscope itemtype="//schema.org/Article" vlink=green>
<!--X-Body-Begin-->
<!--X-User-Header-->
<!--X-User-Header-End-->
<!--X-TopPNI-->
<form action="//www.google.com" id="cse-search-box" target="_blank">
  <div>
    <input type="hidden" name="cx" value="partner-pub-3422782820843221:8422278960" />
    <input type="hidden" name="ie" value="UTF-8" />
    <input type="text" name="q" size="55" />
    <input type="submit" name="sa" value="Search" />
  </div>
</form>
<script type="text/javascript" src="//www.google.com/coop/cse/brand?form=cse-search-box&amp;lang=en"></script>
<h1>Re:  [PATCH v1 11/31] conf: Format and parse NVMe type disk</h1>
[<a href="msg187535.html">Date Prev</a>][<a href="msg187537.html">Date Next</a>][<a href="msg187472.html">Thread Prev</a>][<a href="msg187473.html">Thread Next</a>][<a href="maillist.html#187536">Date Index</a>][<a href="index.html#187536">Thread Index</a>] 


<p>&nbsp;<br>
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- responsive test for archives -->
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-3422782820843221"
     data-ad-slot="6345952567"
     data-ad-format="auto"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>

<!--X-TopPNI-End-->
<!--X-MsgBody-->
<!--X-Subject-Header-Begin-->
<hr>
<!--X-Subject-Header-End-->
<!--X-Head-of-Message-->
<ul>
<li><em>Subject</em>: Re:  [PATCH v1 11/31] conf: Format and parse NVMe type disk</li>
<li><em>From</em>: Michal Privoznik &lt;mprivozn@xxxxxxxxxx&gt;</li>
<li><em>Date</em>: Wed, 17 Jul 2019 14:40:04 +0200</li>
<li><em>Cc</em>: libvir-list@xxxxxxxxxx</li>
<li><em>In-reply-to</em>: &lt;<a href="msg187472.html">20190716123805.GS2061@angien.pipo.sk</a>&gt;</li>
<li><em>References</em>: &lt;<a href="msg187163.html">cover.1562859733.git.mprivozn@redhat.com</a>&gt;	&lt;<a href="msg187171.html">ff5dbd208442af172c661aa470d828cb11878c50.1562859733.git.mprivozn@redhat.com</a>&gt;	&lt;<a href="msg187199.html">20190711160517.GE2061@angien.pipo.sk</a>&gt;	&lt;<a href="msg187229.html">9c506321-173c-940e-3949-d14558c97e0d@redhat.com</a>&gt;	&lt;<a href="msg187231.html">20190711161658.GG2061@angien.pipo.sk</a>&gt;	&lt;<a href="msg187472.html">20190716123805.GS2061@angien.pipo.sk</a>&gt;</li>
<li><em>User-agent</em>: Mozilla/5.0 (X11; Linux x86_64; rv:60.0) Gecko/20100101	Thunderbird/60.7.2</li>
</ul>
<!--X-Head-of-Message-End-->
<!--X-Head-Body-Sep-Begin-->
<!-- AddThis Button BEGIN -->
<div class="addthis_toolbox addthis_default_style ">
<a class="addthis_button_preferred_1"></a>
<a class="addthis_button_preferred_2"></a>
<a class="addthis_button_preferred_3"></a>
<a class="addthis_button_preferred_4"></a>
<a class="addthis_button_compact"></a>
<a class="addthis_counter addthis_bubble_style"></a>
</div>
<script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5196c2ae1be43d18&async=1&domready=1" async></script>
<!-- AddThis Button END -->
<hr>
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- responsive link 1 -->
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-3422782820843221"
     data-ad-slot="8681825769"
     data-ad-format="link"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
<p>
<div class="content" itemprop="articleBody">
<!--X-Head-Body-Sep-End-->
<!--X-Body-of-Message-->
<pre style="margin: 0em;">
On 7/16/19 2:38 PM, Peter Krempa wrote:
</pre><blockquote style="border-left: #5555EE solid 0.2em; margin: 0em; padding-left: 0.85em"><pre style="margin: 0em;">
On Thu, Jul 11, 2019 at 18:16:58 +0200, Peter Krempa wrote:
</pre><blockquote style="border-left: #5555EE solid 0.2em; margin: 0em; padding-left: 0.85em"><pre style="margin: 0em;">
On Thu, Jul 11, 2019 at 18:12:16 +0200, Michal Privoznik wrote:
</pre><blockquote style="border-left: #5555EE solid 0.2em; margin: 0em; padding-left: 0.85em"><pre style="margin: 0em;">
On 7/11/19 6:05 PM, Peter Krempa wrote:
</pre><blockquote style="border-left: #5555EE solid 0.2em; margin: 0em; padding-left: 0.85em"><pre style="margin: 0em;">
On Thu, Jul 11, 2019 at 17:53:58 +0200, Michal Privoznik wrote:
</pre><blockquote style="border-left: #5555EE solid 0.2em; margin: 0em; padding-left: 0.85em"><pre style="margin: 0em;">
To simplify implementation, some restrictions are added. For
instance, an NVMe disk can't go to any bus but virtio and has to
be type of 'disk' and can't have startupPolicy set.

Signed-off-by: Michal Privoznik &lt;mprivozn@xxxxxxxxxx&gt;
---
</pre></blockquote></blockquote></blockquote></blockquote><pre style="margin: 0em;">

[...]

</pre><blockquote style="border-left: #5555EE solid 0.2em; margin: 0em; padding-left: 0.85em"><pre style="margin: 0em;">
Yes it certainly will be possible with blockdev. Also you have such a
file in the backing chain which gets detected from the file metadata on
the disk, so such a check will probably need to be duplicated also when
starting the VM (the validate callback function may be better match).

</pre><blockquote style="border-left: #5555EE solid 0.2em; margin: 0em; padding-left: 0.85em"><pre style="margin: 0em;">

</pre><blockquote style="border-left: #5555EE solid 0.2em; margin: 0em; padding-left: 0.85em"><pre style="margin: 0em;">

Also this seems all to belong to the qemu specific post parse callback.
</pre></blockquote><pre style="margin: 0em;">

Possibly. But since other drivers would still use virNVMeDevice module I'm
adding later in this series, and since the module is build on these
assumptions I figured the best place to check for them is in driver agnostic
callback.
</pre></blockquote><pre style="margin: 0em;">

Fair enough.
</pre></blockquote><pre style="margin: 0em;">

Thinking about this a bit more, if there will be a separate module for
</pre><tt>this, that module should expose the validator. 
</tt></blockquote><pre style="margin: 0em;">

</pre><tt>Well, the module sees virNVMeDevice struct and not virDomainDiskDef 
</tt><tt>(these are two different structures). And since we do not want code from 
</tt><tt>src/util/ include anything in src/conf/ I'm not quite sure how to access 
</tt><tt>virDomainDiskDef from src/util/virnvme.c.
</tt><pre style="margin: 0em;">

</pre><blockquote style="border-left: #5555EE solid 0.2em; margin: 0em; padding-left: 0.85em"><pre style="margin: 0em;">
Also I'm not persuaded
about the universality of this code at all thus I doubt that it will be
reused in other hypervisors as it requires a userspace driver for NVMe
in the hypervisor, which is a pretty niche configuraion/use case.

</pre></blockquote><pre style="margin: 0em;">

</pre><tt>Well, nearly everything that we work on is qemu specific, because quite 
</tt><tt>frankly, we only touch other drivers when an internal API is changed and 
</tt><tt>a codebase wide adoption is needed.
</tt><pre style="margin: 0em;">

Michal

--
libvir-list mailing list
libvir-list@xxxxxxxxxx
<a  rel="nofollow" href="https://www.redhat.com/mailman/listinfo/libvir-list">https://www.redhat.com/mailman/listinfo/libvir-list</a>


</pre>
<!--X-Body-of-Message-End-->
<!--X-MsgBody-End-->
<!--X-Follow-Ups-->
</div>
<hr>
<!--X-Follow-Ups-End-->
<!--X-References-->
<!--X-References-End-->
<!--X-BotPNI-->
<ul>
<li>Prev by Date:
<strong><a href="msg187535.html">Re:  [jenkins-ci PATCH 10/20] quayadmin: Read configuration from file</a></strong>
</li>
<li>Next by Date:
<strong><a href="msg187537.html">[PATCH 0/7] docs: assorted cleanups (virtio-fs epopee)</a></strong>
</li>
<li>Previous by thread:
<strong><a href="msg187472.html">Re:  [PATCH v1 11/31] conf: Format and parse NVMe type disk</a></strong>
</li>
<li>Next by thread:
<strong><a href="msg187473.html">Re:  [PATCH v1 11/31] conf: Format and parse NVMe type disk</a></strong>
</li>
<li>Index(es):
<ul>
<li><a href="maillist.html#187536"><strong>Date</strong></a></li>
<li><a href="index.html#187536"><strong>Thread</strong></a></li>
</ul>
</li>
</ul>

<!--X-BotPNI-End-->
<!--X-User-Footer-->
<center>
<font size=-1>
<a href=/lists/>[Index&nbsp;of&nbsp;Archives]</a>
&nbsp;
&nbsp;
<a href=/lists/virt-tools/>[Virt&nbsp;Tools]</a>
&nbsp;
&nbsp;
<a href=/linux/fedora/libvirt-users/>[Libvirt&nbsp;Users]</a>
&nbsp;
&nbsp;
<a href=/linux/fedora/libosinfo/>[Lib&nbsp;OS&nbsp;Info]</a>
&nbsp;
&nbsp;
<a href=/linux/fedora/fedora-users/>[Fedora&nbsp;Users]</a>
&nbsp;
&nbsp;
<a href=/lists/fedora-desktop/>[Fedora&nbsp;Desktop]</a>
&nbsp;
&nbsp;
<a href=/lists/fedora-selinux/>[Fedora&nbsp;SELinux]</a>
&nbsp;
&nbsp;
<a href=http://www.ske-art.com/z/biglist.php>[Big&nbsp;List&nbsp;of&nbsp;Linux&nbsp;Books]</a>
&nbsp;
&nbsp;
<a href=https://yosemitenews.info>[Yosemite&nbsp;News]</a>
&nbsp;
&nbsp;
<a href=/lists/kde/>[KDE&nbsp;Users]</a>
&nbsp;
&nbsp;
<a href=/lists/fedora-tools/>[Fedora&nbsp;Tools]</a>
</font>
</center>
<hr>
<p>
<div>
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<ins class="adsbygoogle"
     style="display:block"
     data-ad-format="autorelaxed"
     data-ad-client="ca-pub-3422782820843221"
     data-ad-slot="1424524564"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
</div>
<table width=100%>
<tr>
<td align=left>&nbsp;</td>
<td align=right><a href=/lists/><img src=/button_01.gif border=0 alt="Powered by Linux"></a></td>
</tr>
</table>
<!--X-User-Footer-End-->
<script type="text/javascript"> 
 function initAddThis() {
    addthis.init()
 }
initAddThis();
</script>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-760190-1', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
