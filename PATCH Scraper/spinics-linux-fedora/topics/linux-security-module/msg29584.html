<!-- MHonArc v2.6.19 -->
<!--X-Subject: Re: Fwd: [PATCH v4 15/23] LSM: Specify which LSM to display -->
<!--X-From-R13: Qnfrl Epunhsyre &#60;pnfrlNfpunhsyre&#45;pn.pbz> -->
<!--X-Date: Sat, 29 Jun 2019 12:45:08 &#45;0700 -->
<!--X-Message-Id: fecdeb90&#45;ccd5&#45;9f23&#45;525f&#45;456ab325dd35@schaufler&#45;ca.com -->
<!--X-Content-Type: text/plain -->
<!--X-Reference: 20190626192234.11725&#45;1&#45;casey@schaufler&#45;ca.com -->
<!--X-Reference: 20190626192234.11725&#45;16&#45;casey@schaufler&#45;ca.com -->
<!--X-Reference: 89561452&#45;86f9&#45;fd9a&#45;1390&#45;0cd4bde1fd62@tycho.nsa.gov -->
<!--X-Reference: 7944672e&#45;a590&#45;44a3&#45;743a&#45;48c1785a5464@schaufler&#45;ca.com -->
<!--X-Reference: CAB9W1A1nwE7WBZqTe&#45;GV8xNb83_B2ybV7cco++nfMjtDz9NJrg@mail.gmail.com -->
<!--X-Reference: CAB9W1A29fCn=cH_Mx&#45;g&#45;P6M&#45;5t+832ayhMmjy3PFZ&#45;BOL3BuDQ@mail.gmail.com -->
<!--X-Head-End-->
<!doctype html public "-//W3C//DTD HTML//EN">
<html>
<head>
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({
          google_ad_client: "ca-pub-3422782820843221",
          enable_page_level_ads: true
     });
</script>
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="description" content="Linux Security Module, Re: Fwd: [PATCH v4 15/23] LSM: Specify which LSM to display">
<style>
<!--
 pre {white-space: pre-wrap;}
-->
</style>
<title>Linux Security Module -- Re: Fwd: [PATCH v4 15/23] LSM: Specify which LSM to display</title>
<link rel="alternate" type="application/rss+xml" title="Linux Security Module" href="//feeds.feedburner.com/LinuxSecurityModule">
</head>
<body vlink=green>
<!--X-Body-Begin-->
<!--X-User-Header-->
<!--X-User-Header-End-->
<!--X-TopPNI-->
<form action="//www.google.com" id="cse-search-box" target="_blank">
  <div>
    <input type="hidden" name="cx" value="partner-pub-3422782820843221:9580497365" />
    <input type="hidden" name="ie" value="UTF-8" />
    <input type="text" name="q" size="25" />
    <input type="submit" name="sa" value="Search" />
  </div>
</form>
<script type="text/javascript" src="//www.google.com/coop/cse/brand?form=cse-search-box&amp;lang=en"></script>
<h1 itemprop="name">Re: Fwd: [PATCH v4 15/23] LSM: Specify which LSM to display</h1>
[<a href="msg29583.html">Date Prev</a>][<a href="msg29585.html">Date Next</a>][<a href="msg29579.html">Thread Prev</a>][<a href="msg29624.html">Thread Next</a>][<a href="maillist.html#29584">Date Index</a>][<a href="index.html#29584">Thread Index</a>]


<p>&nbsp;<br>
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- responsive test for archives -->
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-3422782820843221"
     data-ad-slot="6345952567"
     data-ad-format="auto"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>

<!--X-TopPNI-End-->
<!--X-MsgBody-->
<!--X-Subject-Header-Begin-->
<hr>
<!--X-Subject-Header-End-->
<!--X-Head-of-Message-->
<ul>
<li><em>Subject</em>: Re: Fwd: [PATCH v4 15/23] LSM: Specify which LSM to display</li>
<li><em>From</em>: Casey Schaufler &lt;casey@xxxxxxxxxxxxxxxx&gt;</li>
<li><em>Date</em>: Sat, 29 Jun 2019 12:45:03 -0700</li>
<li><em>In-reply-to</em>: &lt;CAB9W1A29fCn=cH_Mx-g-P6M-5t+832ayhMmjy3PFZ-BOL3BuDQ@mail.gmail.com&gt;</li>
<li><em>Openpgp</em>: preference=signencrypt</li>
<li><em>References</em>: &lt;<a href="msg29370.html">20190626192234.11725-1-casey@schaufler-ca.com</a>&gt; &lt;<a href="msg29385.html">20190626192234.11725-16-casey@schaufler-ca.com</a>&gt; &lt;<a href="msg29546.html">89561452-86f9-fd9a-1390-0cd4bde1fd62@tycho.nsa.gov</a>&gt; &lt;<a href="msg29565.html">7944672e-a590-44a3-743a-48c1785a5464@schaufler-ca.com</a>&gt; &lt;CAB9W1A1nwE7WBZqTe-GV8xNb83_B2ybV7cco++nfMjtDz9NJrg@mail.gmail.com&gt; &lt;CAB9W1A29fCn=cH_Mx-g-P6M-5t+832ayhMmjy3PFZ-BOL3BuDQ@mail.gmail.com&gt;</li>
<li><em>User-agent</em>: Mozilla/5.0 (Windows NT 10.0; WOW64; rv:60.0) Gecko/20100101 Thunderbird/60.7.2</li>
</ul>
<!--X-Head-of-Message-End-->
<!--X-Head-Body-Sep-Begin-->
<!-- AddThis Button BEGIN -->
<div class="addthis_toolbox addthis_default_style ">
<a class="addthis_button_preferred_1"></a>
<a class="addthis_button_preferred_2"></a>
<a class="addthis_button_preferred_3"></a>
<a class="addthis_button_preferred_4"></a>
<a class="addthis_button_compact"></a>
<a class="addthis_counter addthis_bubble_style"></a>
</div>
<script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5196c2ae1be43d18&async=1&domready=1" async></script>
<!-- AddThis Button END -->
<hr>
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- responsive link 1 -->
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-3422782820843221"
     data-ad-slot="8681825769"
     data-ad-format="link"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
<p>
<div class="content" itemprop="articleBody">
<!--X-Head-Body-Sep-End-->
<!--X-Body-of-Message-->
<pre>On 6/28/2019 6:01 PM, Stephen Smalley wrote:
&gt; On Fri, Jun 28, 2019 at 12:15 PM Casey Schaufler &lt;casey@xxxxxxxxxxxxxxxx&gt; wrote:
&gt;&gt; On 6/28/2019 7:45 AM, Stephen Smalley wrote:
&gt;&gt;&gt; On 6/26/19 3:22 PM, Casey Schaufler wrote:
&gt;&gt;&gt;&gt; Create a new entry &quot;display&quot; in /proc/.../attr for controlling
&gt;&gt;&gt;&gt; which LSM security information is displayed for a process.
&gt;&gt;&gt;&gt; The name of an active LSM that supplies hooks for human readable
&gt;&gt;&gt;&gt; data may be written to &quot;display&quot; to set the value. The name of
&gt;&gt;&gt;&gt; the LSM currently in use can be read from &quot;display&quot;.
&gt;&gt;&gt;&gt; At this point there can only be one LSM capable of display
&gt;&gt;&gt;&gt; active.
&gt;&gt;&gt; IIUC, presently, at the end of the entire series,
&gt;&gt;&gt;
&gt;&gt;&gt; 1) Any process can change its display attribute to any enabled security module, and no security module can veto that change.
&gt;&gt; That is correct. If a security module could hoard the display it
&gt;&gt; could prevent user space from functioning in a multiple module
&gt;&gt; environment.
&gt;&gt;
&gt;&gt;&gt; 2) The display attribute is inherited across fork and exec, even execs that change credentials, and again no security module has control over the inheritance of this attribute.
&gt;&gt; Also correct. Scripts don't work otherwise.
&gt; It's a security hole waiting to happen. Unprivileged caller sets its
&gt; display value to Smack on a mostly SELinux system that happens to
&gt; enable Smack too, then exec's a credential-changing SELinux-aware
&gt; program that uses one of the libselinux APIs to set one of the
&gt; /proc/self/attr attributes to a different SELinux context. Due to the
&gt; change in display, the SELinux-aware program instead ends up setting
&gt; one of the Smack attributes and therefore the desired SELinux context
&gt; is never applied to the process or file or socket or whatever.

The credential-changing SELinux-aware program is getting
invoked by an unprivileged, Smack aware program? Would anyone
expect that to be a good idea? I'll admit it could happen,
but setting the Smack label of your SELinux-aware program
(which will need CAP_MAC_ADMIN, BTW) to &quot;system_u:system_r:wheehee_t&quot;
is unlikely to result in anything other than your SELinux-aware
program getting very frustrated. In the other direction, a
Smack-aware program that trys to set its SELinux context to &quot;^&quot;
is going to fail by SELinux policy. While I am willing to accept
that it is possible that there is a way to exploit this, it
would require convoluted SELinux and Smack policies. Anyone
who has reason to use a combination of Smack and SELinux on
a real system is already signing up for more configuration
headaches than I would wish on anyone.
&#xA0;
I have strongly advocated addition of /proc/.../attr/
subdirectories for all LSMs, and that all user space migrate
to using them. /proc/.../attr/selinux/current would not be
affected by the display setting. We know, and have known for
years that so long as &quot;current&quot; is shared there will be this
sort of problem.


&gt;
&gt;&gt;&gt; 3) Setting the display attribute affects more than just the contexts read or written by the process itself:
&gt;&gt;&gt; - Contexts reported in audit logs,
&gt;&gt;&gt; - Contexts passed across binder (generated in sender context, delivered to receiver),
&gt;&gt;&gt; - Contexts passed to NFS servers for new files,
&gt;&gt;&gt; - Contexts returned by NFS servers for existing files,
&gt;&gt;&gt; - Netlink-related contexts (?possibly generated in sender context rather than receiver context?),
&gt;&gt;&gt; - This list may not be complete.
&gt;&gt; Any of which can be changed should a more rational behavior be proposed.
&gt;&gt; One possibility is to use lsm='value',lsm='value' encoding for internal
&gt;&gt; communications, but there's been considerable resistance to anything
&gt;&gt; like that.
&gt; These are also security holes waiting to happen.  Processes can use it
&gt; to hide their SELinux contexts from the audit logs, forge different
&gt; SELinux contexts on binder IPC, forge file contexts to which they have
&gt; no SELinux permissions on new files, ... All they need is stacking to
&gt; be enabled and one other module that helpfully lets them set attribute
&gt; values that look like SELinux contexts, and then they can set those
&gt; and switch their display at the right time.

What would you propose as a more rational behavior?
Seriously, I could use some help here.


&gt;&gt;&gt; 4) A security_secid_to_secctx() in one process' context (e.g. sender) or with one display value followed later by a security_secctx_to_secid() call in a different process' context (e.g. receiver) or with a different display value may ask a different security module to perform the reverse translation of the context than the forward translation.
&gt;&gt; Do you have an example of where this might happen?
&gt;&gt; Contexts are rarely used within the kernel. The usual
&gt;&gt; behavior is to generate them, send them out to user space,
&gt;&gt; and delete them. They get cached in some networking code,
&gt;&gt; but not in cases where more than one (existing) security
&gt;&gt; module will ever use them. Binder may be an exception, but
&gt;&gt; only SELinux (currently) supports binder.
&gt; Haven't looked but I don't like the asymmetry of the interface.
&gt; Doesn't matter that only SELinux supports binder if  you ever want any
&gt; other security module other than SELinux enabled at the same time as
&gt; SELinux.

Binder needs another look then.

&gt;&gt; Is that correct?  If so, it seems problematic.
&gt;&gt; Balancing backward compatibility with new behavior is hard!
&gt;&gt; What would you suggest for audit logs? Should we put all LSM
&gt;&gt; data in every record? Is NFS a concern for anyone not using
&gt;&gt; SELinux?
&gt; Yes to all on audit if stacking is going to be real.  And yes, I think
&gt; other security modules will care about NFS if they are serious.

I would love to get feedback from the audit maintainers about
how they would like the multiple LSM data formatted.

NFS is ... challenging. It was supposed to work with Smack
when it went in, but to the best of my understanding never
actually demonstrated.

&gt;&gt; There is no user space that uses display, and it's going
&gt;&gt; to take some time to work out all the kinks before we even
&gt;&gt; think about teaching systemd about it.
&gt; That doesn't make it acceptable to introduce a mechanism that weakens
&gt; security now.

Agreed in principle, not necessarily in detail.





</pre>
<!--X-Body-of-Message-End-->
<!--X-MsgBody-End-->
<!--X-Follow-Ups-->
</div>
<hr>
<!--X-Follow-Ups-End-->
<!--X-References-->
<ul><li><strong>References</strong>:
<ul>
<li><strong><a name="29370" href="msg29370.html">[PATCH v4 00/23] LSM: Module stacking for AppArmor</a></strong>
<ul><li><em>From:</em> Casey Schaufler</li></ul></li>
<li><strong><a name="29385" href="msg29385.html">[PATCH v4 15/23] LSM: Specify which LSM to display</a></strong>
<ul><li><em>From:</em> Casey Schaufler</li></ul></li>
<li><strong><a name="29546" href="msg29546.html">Re: [PATCH v4 15/23] LSM: Specify which LSM to display</a></strong>
<ul><li><em>From:</em> Stephen Smalley</li></ul></li>
<li><strong><a name="29565" href="msg29565.html">Re: [PATCH v4 15/23] LSM: Specify which LSM to display</a></strong>
<ul><li><em>From:</em> Casey Schaufler</li></ul></li>
<li><strong><a name="29579" href="msg29579.html">Fwd: [PATCH v4 15/23] LSM: Specify which LSM to display</a></strong>
<ul><li><em>From:</em> Stephen Smalley</li></ul></li>
</ul></li></ul>
<!--X-References-End-->
<!--X-BotPNI-->
<ul>
<li>Prev by Date:
<strong><a href="msg29583.html">Re: [RFC PATCH v5 0/1] Add dm verity root hash pkcs7 sig validation.</a></strong>
</li>
<li>Next by Date:
<strong><a href="msg29585.html">Re: [RFC PATCH v2 1/3] x86/sgx: Add SGX specific LSM hooks</a></strong>
</li>
<li>Previous by thread:
<strong><a href="msg29579.html">Fwd: [PATCH v4 15/23] LSM: Specify which LSM to display</a></strong>
</li>
<li>Next by thread:
<strong><a href="msg29624.html">Re: Fwd: [PATCH v4 15/23] LSM: Specify which LSM to display</a></strong>
</li>
<li>Index(es):
<ul>
<li><a href="maillist.html#29584"><strong>Date</strong></a></li>
<li><a href="index.html#29584"><strong>Thread</strong></a></li>
</ul>
</li>
</ul>

<!--X-BotPNI-End-->
<!--X-User-Footer-->
<center>
<font size=-1>
<a href=/lists/>[Index&nbsp;of&nbsp;Archives]</a>
&nbsp;
&nbsp;
<a href=/linux/fedora/fedora-users/>[Fedora&nbsp;Users]</a>
&nbsp;
&nbsp;
<a href=/lists/fedora-desktop/>[Fedora&nbsp;Desktop]</a>
&nbsp;
&nbsp;
<a href=/lists/fedora-selinux/>[Fedora&nbsp;SELinux]</a>
&nbsp;
&nbsp;
<a href=https://yosemitenews.info>[Yosemite&nbsp;News]</a>
&nbsp;
&nbsp;
<a href=/lists/kde/>[KDE&nbsp;Users]</a>
</font>
</center>
<hr>
<p>
<div>
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<ins class="adsbygoogle"
     style="display:block"
     data-ad-format="autorelaxed"
     data-ad-client="ca-pub-3422782820843221"
     data-ad-slot="1424524564"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
</div>
<table width=100%>
<tr>
<td align=left>&nbsp;</td>
<td align=right><a href=/lists/><img src=/button_01.gif border=0 alt="Powered by Linux"></a></td>
</tr>
</table>
<!--X-User-Footer-End-->
<script type="text/javascript"> 
 function initAddThis() {
    addthis.init()
 }
initAddThis();
</script>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-760190-1', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
