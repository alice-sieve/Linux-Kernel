<!-- MHonArc v2.6.19 -->
<!--X-Subject: [PATCH v8 2/2] mm: init: report memory auto&#45;initialization features at boot time -->
<!--X-From-R13: Oyrknaqre Bbgncraxb &#60;tyvqreNtbbtyr.pbz> -->
<!--X-Date: Wed, 26 Jun 2019 05:19:59 &#45;0700 -->
<!--X-Message-Id: 20190626121943.131390&#45;3&#45;glider@google.com -->
<!--X-Content-Type: text/plain -->
<!--X-Reference: 20190626121943.131390&#45;1&#45;glider@google.com -->
<!--X-Head-End-->
<!doctype html public "-//W3C//DTD HTML//EN">
<html>
<head>
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({
          google_ad_client: "ca-pub-3422782820843221",
          enable_page_level_ads: true
     });
</script>
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="description" content="Linux Security Module, [PATCH v8 2/2] mm: init: report memory auto-initialization features at boot time">
<style>
<!--
 pre {white-space: pre-wrap;}
-->
</style>
<title>Linux Security Module -- [PATCH v8 2/2] mm: init: report memory auto-initialization features at boot time</title>
<link rel="alternate" type="application/rss+xml" title="Linux Security Module" href="//feeds.feedburner.com/LinuxSecurityModule">
</head>
<body vlink=green>
<!--X-Body-Begin-->
<!--X-User-Header-->
<!--X-User-Header-End-->
<!--X-TopPNI-->
<form action="//www.google.com" id="cse-search-box" target="_blank">
  <div>
    <input type="hidden" name="cx" value="partner-pub-3422782820843221:9580497365" />
    <input type="hidden" name="ie" value="UTF-8" />
    <input type="text" name="q" size="25" />
    <input type="submit" name="sa" value="Search" />
  </div>
</form>
<script type="text/javascript" src="//www.google.com/coop/cse/brand?form=cse-search-box&amp;lang=en"></script>
<h1 itemprop="name">[PATCH v8 2/2] mm: init: report memory auto-initialization features at boot time</h1>
[<a href="msg29361.html">Date Prev</a>][<a href="msg29363.html">Date Next</a>][<a href="msg29457.html">Thread Prev</a>][<a href="msg29363.html">Thread Next</a>][<a href="maillist.html#29362">Date Index</a>][<a href="index.html#29362">Thread Index</a>]


<p>&nbsp;<br>
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- responsive test for archives -->
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-3422782820843221"
     data-ad-slot="6345952567"
     data-ad-format="auto"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>

<!--X-TopPNI-End-->
<!--X-MsgBody-->
<!--X-Subject-Header-Begin-->
<hr>
<!--X-Subject-Header-End-->
<!--X-Head-of-Message-->
<ul>
<li><em>Subject</em>: [PATCH v8 2/2] mm: init: report memory auto-initialization features at boot time</li>
<li><em>From</em>: Alexander Potapenko &lt;glider@xxxxxxxxxx&gt;</li>
<li><em>Date</em>: Wed, 26 Jun 2019 14:19:43 +0200</li>
<li><em>Cc</em>: Alexander Potapenko &lt;glider@xxxxxxxxxx&gt;,        Kees Cook &lt;keescook@xxxxxxxxxxxx&gt;, Dmitry Vyukov &lt;dvyukov@xxxxxxxxxx&gt;,        James Morris &lt;jmorris@xxxxxxxxx&gt;, Jann Horn &lt;jannh@xxxxxxxxxx&gt;,        Kostya Serebryany &lt;kcc@xxxxxxxxxx&gt;, Laura Abbott &lt;labbott@xxxxxxxxxx&gt;,        Mark Rutland &lt;mark.rutland@xxxxxxx&gt;,        Masahiro Yamada &lt;yamada.masahiro@xxxxxxxxxxxxx&gt;,        Matthew Wilcox &lt;willy@xxxxxxxxxxxxx&gt;,        Nick Desaulniers &lt;ndesaulniers@xxxxxxxxxx&gt;,        Randy Dunlap &lt;rdunlap@xxxxxxxxxxxxx&gt;,        Sandeep Patil &lt;sspatil@xxxxxxxxxxx&gt;,        &quot;Serge E. Hallyn&quot; &lt;serge@xxxxxxxxxx&gt;,        Souptick Joarder &lt;jrdr.linux@xxxxxxxxx&gt;,        Marco Elver &lt;elver@xxxxxxxxxx&gt;,        Kaiwan N Billimoria &lt;kaiwan@xxxxxxxxxxxxxx&gt;,        kernel-hardening@xxxxxxxxxxxxxxxxxx, linux-mm@xxxxxxxxx,        linux-security-module@xxxxxxxxxxxxxxx</li>
<li><em>In-reply-to</em>: &lt;<a href="msg29360.html">20190626121943.131390-1-glider@google.com</a>&gt;</li>
<li><em>References</em>: &lt;<a href="msg29360.html">20190626121943.131390-1-glider@google.com</a>&gt;</li>
</ul>
<!--X-Head-of-Message-End-->
<!--X-Head-Body-Sep-Begin-->
<!-- AddThis Button BEGIN -->
<div class="addthis_toolbox addthis_default_style ">
<a class="addthis_button_preferred_1"></a>
<a class="addthis_button_preferred_2"></a>
<a class="addthis_button_preferred_3"></a>
<a class="addthis_button_preferred_4"></a>
<a class="addthis_button_compact"></a>
<a class="addthis_counter addthis_bubble_style"></a>
</div>
<script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5196c2ae1be43d18&async=1&domready=1" async></script>
<!-- AddThis Button END -->
<hr>
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- responsive link 1 -->
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-3422782820843221"
     data-ad-slot="8681825769"
     data-ad-format="link"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
<p>
<div class="content" itemprop="articleBody">
<!--X-Head-Body-Sep-End-->
<!--X-Body-of-Message-->
<pre>Print the currently enabled stack and heap initialization modes.

Stack initialization is enabled by a config flag, while heap
initialization is configured at boot time with defaults being set
in the config. It's more convenient for the user to have all information
about these hardening measures in one place at boot, so the user can
reason about the expected behavior of the running system.

The possible options for stack are:
 - &quot;all&quot; for CONFIG_INIT_STACK_ALL;
 - &quot;byref_all&quot; for CONFIG_GCC_PLUGIN_STRUCTLEAK_BYREF_ALL;
 - &quot;byref&quot; for CONFIG_GCC_PLUGIN_STRUCTLEAK_BYREF;
 - &quot;__user&quot; for CONFIG_GCC_PLUGIN_STRUCTLEAK_USER;
 - &quot;off&quot; otherwise.

Depending on the values of init_on_alloc and init_on_free boottime
options we also report &quot;heap alloc&quot; and &quot;heap free&quot; as &quot;on&quot;/&quot;off&quot;.

In the init_on_free mode initializing pages at boot time may take a
while, so print a notice about that as well. This depends on how much
memory is installed, the memory bandwidth, etc.
On a relatively modern x86 system, it takes about 0.75s/GB to wipe all
memory:

  [    0.418722] mem auto-init: stack:byref_all, heap alloc:off, heap free:on
  [    0.419765] mem auto-init: clearing system memory may take some time...
  [   12.376605] Memory: 16408564K/16776672K available (14339K kernel code, 1397K rwdata, 3756K rodata, 1636K init, 11460K bss, 368108K reserved, 0K cma-reserved)

Signed-off-by: Alexander Potapenko &lt;glider@xxxxxxxxxx&gt;
Suggested-by: Kees Cook &lt;keescook@xxxxxxxxxxxx&gt;
Acked-by: Kees Cook &lt;keescook@xxxxxxxxxxxx&gt;
To: Andrew Morton &lt;akpm@xxxxxxxxxxxxxxxxxxxx&gt;
To: Christoph Lameter &lt;cl@xxxxxxxxx&gt;
Cc: Dmitry Vyukov &lt;dvyukov@xxxxxxxxxx&gt;
Cc: James Morris &lt;jmorris@xxxxxxxxx&gt;
Cc: Jann Horn &lt;jannh@xxxxxxxxxx&gt;
Cc: Kostya Serebryany &lt;kcc@xxxxxxxxxx&gt;
Cc: Laura Abbott &lt;labbott@xxxxxxxxxx&gt;
Cc: Mark Rutland &lt;mark.rutland@xxxxxxx&gt;
Cc: Masahiro Yamada &lt;yamada.masahiro@xxxxxxxxxxxxx&gt;
Cc: Matthew Wilcox &lt;willy@xxxxxxxxxxxxx&gt;
Cc: Nick Desaulniers &lt;ndesaulniers@xxxxxxxxxx&gt;
Cc: Randy Dunlap &lt;rdunlap@xxxxxxxxxxxxx&gt;
Cc: Sandeep Patil &lt;sspatil@xxxxxxxxxxx&gt;
Cc: &quot;Serge E. Hallyn&quot; &lt;serge@xxxxxxxxxx&gt;
Cc: Souptick Joarder &lt;jrdr.linux@xxxxxxxxx&gt;
Cc: Marco Elver &lt;elver@xxxxxxxxxx&gt;
Cc: Kaiwan N Billimoria &lt;kaiwan@xxxxxxxxxxxxxx&gt;
Cc: kernel-hardening@xxxxxxxxxxxxxxxxxx
Cc: linux-mm@xxxxxxxxx
Cc: linux-security-module@xxxxxxxxxxxxxxx
Signed-off-by: Andrew Morton &lt;akpm@xxxxxxxxxxxxxxxxxxxx&gt;

---
 v6:
 - update patch description, fixed message about clearing memory
 v7:
 - rebase the patch, add the Acked-by: tag;
 - more description updates as suggested by Kees;
 - make report_meminit() static.
 v8:
 - added the Signed-off-by: tag
---
 init/main.c | 24 ++++++++++++++++++++++++
 1 file changed, 24 insertions(+)

diff --git a/init/main.c b/init/main.c
index 66a196c5e4c3..ff5803b0841c 100644
--- a/init/main.c
+++ b/init/main.c
@@ -520,6 +520,29 @@ static inline void initcall_debug_enable(void)
 }
 #endif
 
+/* Report memory auto-initialization states for this boot. */
+static void __init report_meminit(void)
+{
+	const char *stack;
+
+	if (IS_ENABLED(CONFIG_INIT_STACK_ALL))
+		stack = &quot;all&quot;;
+	else if (IS_ENABLED(CONFIG_GCC_PLUGIN_STRUCTLEAK_BYREF_ALL))
+		stack = &quot;byref_all&quot;;
+	else if (IS_ENABLED(CONFIG_GCC_PLUGIN_STRUCTLEAK_BYREF))
+		stack = &quot;byref&quot;;
+	else if (IS_ENABLED(CONFIG_GCC_PLUGIN_STRUCTLEAK_USER))
+		stack = &quot;__user&quot;;
+	else
+		stack = &quot;off&quot;;
+
+	pr_info(&quot;mem auto-init: stack:%s, heap alloc:%s, heap free:%s\n&quot;,
+		stack, want_init_on_alloc(GFP_KERNEL) ? &quot;on&quot; : &quot;off&quot;,
+		want_init_on_free() ? &quot;on&quot; : &quot;off&quot;);
+	if (want_init_on_free())
+		pr_info(&quot;mem auto-init: clearing system memory may take some time...\n&quot;);
+}
+
 /*
  * Set up kernel memory allocators
  */
@@ -530,6 +553,7 @@ static void __init mm_init(void)
 	 * bigger than MAX_ORDER unless SPARSEMEM.
 	 */
 	page_ext_init_flatmem();
+	report_meminit();
 	mem_init();
 	kmem_cache_init();
 	pgtable_init();
-- 
2.22.0.410.gd8fdbe21b5-goog



</pre>
<!--X-Body-of-Message-End-->
<!--X-MsgBody-End-->
<!--X-Follow-Ups-->
</div>
<hr>
<!--X-Follow-Ups-End-->
<!--X-References-->
<ul><li><strong>References</strong>:
<ul>
<li><strong><a name="29360" href="msg29360.html">[PATCH v8 0/3] add init_on_alloc/init_on_free boot options</a></strong>
<ul><li><em>From:</em> Alexander Potapenko</li></ul></li>
</ul></li></ul>
<!--X-References-End-->
<!--X-BotPNI-->
<ul>
<li>Prev by Date:
<strong><a href="msg29361.html">[PATCH v8 1/2] mm: security: introduce init_on_alloc=1 and init_on_free=1 boot options</a></strong>
</li>
<li>Next by Date:
<strong><a href="msg29363.html">Re: [PATCH v8 0/3] add init_on_alloc/init_on_free boot options</a></strong>
</li>
<li>Previous by thread:
<strong><a href="msg29457.html">Re: [PATCH v8 1/2] mm: security: introduce init_on_alloc=1 and init_on_free=1 boot options</a></strong>
</li>
<li>Next by thread:
<strong><a href="msg29363.html">Re: [PATCH v8 0/3] add init_on_alloc/init_on_free boot options</a></strong>
</li>
<li>Index(es):
<ul>
<li><a href="maillist.html#29362"><strong>Date</strong></a></li>
<li><a href="index.html#29362"><strong>Thread</strong></a></li>
</ul>
</li>
</ul>

<!--X-BotPNI-End-->
<!--X-User-Footer-->
<center>
<font size=-1>
<a href=/lists/>[Index&nbsp;of&nbsp;Archives]</a>
&nbsp;
&nbsp;
<a href=/linux/fedora/fedora-users/>[Fedora&nbsp;Users]</a>
&nbsp;
&nbsp;
<a href=/lists/fedora-desktop/>[Fedora&nbsp;Desktop]</a>
&nbsp;
&nbsp;
<a href=/lists/fedora-selinux/>[Fedora&nbsp;SELinux]</a>
&nbsp;
&nbsp;
<a href=https://yosemitenews.info>[Yosemite&nbsp;News]</a>
&nbsp;
&nbsp;
<a href=/lists/kde/>[KDE&nbsp;Users]</a>
</font>
</center>
<hr>
<p>
<div>
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<ins class="adsbygoogle"
     style="display:block"
     data-ad-format="autorelaxed"
     data-ad-client="ca-pub-3422782820843221"
     data-ad-slot="1424524564"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
</div>
<table width=100%>
<tr>
<td align=left>&nbsp;</td>
<td align=right><a href=/lists/><img src=/button_01.gif border=0 alt="Powered by Linux"></a></td>
</tr>
</table>
<!--X-User-Footer-End-->
<script type="text/javascript"> 
 function initAddThis() {
    addthis.init()
 }
initAddThis();
</script>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-760190-1', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
