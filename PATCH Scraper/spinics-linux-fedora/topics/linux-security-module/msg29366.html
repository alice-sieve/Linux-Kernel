<!-- MHonArc v2.6.19 -->
<!--X-Subject: Re: [PATCH v8 1/2] mm: security: introduce init_on_alloc=1 and init_on_free=1 boot options -->
<!--X-From-R13: Oyrknaqre Bbgncraxb &#60;tyvqreNtbbtyr.pbz> -->
<!--X-Date: Wed, 26 Jun 2019 08:00:57 &#45;0700 -->
<!--X-Message-Id: CAG_fn=Xf5yEuz7JyOt&#45;gmNx1uSM6mmM57_jFxCi+9VPZ4PSwJQ@mail.gmail.com -->
<!--X-Content-Type: text/plain -->
<!--X-Reference: 20190626121943.131390&#45;1&#45;glider@google.com -->
<!--X-Reference: 20190626121943.131390&#45;2&#45;glider@google.com -->
<!--X-Reference: 20190626144943.GY17798@dhcp22.suse.cz -->
<!--X-Head-End-->
<!doctype html public "-//W3C//DTD HTML//EN">
<html>
<head>
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({
          google_ad_client: "ca-pub-3422782820843221",
          enable_page_level_ads: true
     });
</script>
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="description" content="Linux Security Module, Re: [PATCH v8 1/2] mm: security: introduce init_on_alloc=1 and init_on_free=1 boot options">
<style>
<!--
 pre {white-space: pre-wrap;}
-->
</style>
<title>Linux Security Module -- Re: [PATCH v8 1/2] mm: security: introduce init_on_alloc=1 and init_on_free=1 boot options</title>
<link rel="alternate" type="application/rss+xml" title="Linux Security Module" href="//feeds.feedburner.com/LinuxSecurityModule">
</head>
<body vlink=green>
<!--X-Body-Begin-->
<!--X-User-Header-->
<!--X-User-Header-End-->
<!--X-TopPNI-->
<form action="//www.google.com" id="cse-search-box" target="_blank">
  <div>
    <input type="hidden" name="cx" value="partner-pub-3422782820843221:9580497365" />
    <input type="hidden" name="ie" value="UTF-8" />
    <input type="text" name="q" size="25" />
    <input type="submit" name="sa" value="Search" />
  </div>
</form>
<script type="text/javascript" src="//www.google.com/coop/cse/brand?form=cse-search-box&amp;lang=en"></script>
<h1 itemprop="name">Re: [PATCH v8 1/2] mm: security: introduce init_on_alloc=1 and init_on_free=1 boot options</h1>
[<a href="msg29365.html">Date Prev</a>][<a href="msg29367.html">Date Next</a>][<a href="msg29365.html">Thread Prev</a>][<a href="msg29367.html">Thread Next</a>][<a href="maillist.html#29366">Date Index</a>][<a href="index.html#29366">Thread Index</a>]


<p>&nbsp;<br>
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- responsive test for archives -->
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-3422782820843221"
     data-ad-slot="6345952567"
     data-ad-format="auto"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>

<!--X-TopPNI-End-->
<!--X-MsgBody-->
<!--X-Subject-Header-Begin-->
<hr>
<!--X-Subject-Header-End-->
<!--X-Head-of-Message-->
<ul>
<li><em>Subject</em>: Re: [PATCH v8 1/2] mm: security: introduce init_on_alloc=1 and init_on_free=1 boot options</li>
<li><em>From</em>: Alexander Potapenko &lt;glider@xxxxxxxxxx&gt;</li>
<li><em>Date</em>: Wed, 26 Jun 2019 17:00:43 +0200</li>
<li><em>Cc</em>: Andrew Morton &lt;akpm@xxxxxxxxxxxxxxxxxxxx&gt;,        Christoph Lameter &lt;cl@xxxxxxxxx&gt;, Kees Cook &lt;keescook@xxxxxxxxxxxx&gt;,        Masahiro Yamada &lt;yamada.masahiro@xxxxxxxxxxxxx&gt;,        James Morris &lt;jmorris@xxxxxxxxx&gt;, &quot;Serge E. Hallyn&quot; &lt;serge@xxxxxxxxxx&gt;,        Nick Desaulniers &lt;ndesaulniers@xxxxxxxxxx&gt;,        Kostya Serebryany &lt;kcc@xxxxxxxxxx&gt;, Dmitry Vyukov &lt;dvyukov@xxxxxxxxxx&gt;,        Sandeep Patil &lt;sspatil@xxxxxxxxxxx&gt;, Laura Abbott &lt;labbott@xxxxxxxxxx&gt;,        Randy Dunlap &lt;rdunlap@xxxxxxxxxxxxx&gt;, Jann Horn &lt;jannh@xxxxxxxxxx&gt;,        Mark Rutland &lt;mark.rutland@xxxxxxx&gt;, Marco Elver &lt;elver@xxxxxxxxxx&gt;,        Qian Cai &lt;cai@xxxxxx&gt;,        Linux Memory Management List &lt;linux-mm@xxxxxxxxx&gt;,        linux-security-module &lt;linux-security-module@xxxxxxxxxxxxxxx&gt;,        Kernel Hardening &lt;kernel-hardening@xxxxxxxxxxxxxxxxxx&gt;</li>
<li><em>In-reply-to</em>: &lt;<a href="msg29365.html">20190626144943.GY17798@dhcp22.suse.cz</a>&gt;</li>
<li><em>References</em>: &lt;<a href="msg29360.html">20190626121943.131390-1-glider@google.com</a>&gt; &lt;<a href="msg29361.html">20190626121943.131390-2-glider@google.com</a>&gt; &lt;<a href="msg29365.html">20190626144943.GY17798@dhcp22.suse.cz</a>&gt;</li>
</ul>
<!--X-Head-of-Message-End-->
<!--X-Head-Body-Sep-Begin-->
<!-- AddThis Button BEGIN -->
<div class="addthis_toolbox addthis_default_style ">
<a class="addthis_button_preferred_1"></a>
<a class="addthis_button_preferred_2"></a>
<a class="addthis_button_preferred_3"></a>
<a class="addthis_button_preferred_4"></a>
<a class="addthis_button_compact"></a>
<a class="addthis_counter addthis_bubble_style"></a>
</div>
<script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5196c2ae1be43d18&async=1&domready=1" async></script>
<!-- AddThis Button END -->
<hr>
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- responsive link 1 -->
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-3422782820843221"
     data-ad-slot="8681825769"
     data-ad-format="link"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
<p>
<div class="content" itemprop="articleBody">
<!--X-Head-Body-Sep-End-->
<!--X-Body-of-Message-->
<pre>On Wed, Jun 26, 2019 at 4:49 PM Michal Hocko &lt;mhocko@xxxxxxxxxx&gt; wrote:
&gt;
&gt; On Wed 26-06-19 14:19:42, Alexander Potapenko wrote:
&gt; [...]
&gt; &gt; diff --git a/mm/dmapool.c b/mm/dmapool.c
&gt; &gt; index 8c94c89a6f7e..fe5d33060415 100644
&gt; &gt; --- a/mm/dmapool.c
&gt; &gt; +++ b/mm/dmapool.c
&gt; [...]
&gt; &gt; @@ -428,6 +428,8 @@ void dma_pool_free(struct dma_pool *pool, void *vaddr, dma_addr_t dma)
&gt; &gt;       }
&gt; &gt;
&gt; &gt;       offset = vaddr - page-&gt;vaddr;
&gt; &gt; +     if (want_init_on_free())
&gt; &gt; +             memset(vaddr, 0, pool-&gt;size);
&gt;
&gt; any reason why this is not in DMAPOOL_DEBUG else branch? Why would you
&gt; want to both zero on free and poison on free?
This makes sense, thanks.

&gt; &gt;  #ifdef       DMAPOOL_DEBUG
&gt; &gt;       if ((dma - page-&gt;dma) != offset) {
&gt; &gt;               spin_unlock_irqrestore(&amp;pool-&gt;lock, flags);
&gt;
&gt; [...]
&gt;
&gt; &gt; @@ -1142,6 +1200,8 @@ static __always_inline bool free_pages_prepare(struct page *page,
&gt; &gt;       }
&gt; &gt;       arch_free_page(page, order);
&gt; &gt;       kernel_poison_pages(page, 1 &lt;&lt; order, 0);
&gt; &gt; +     if (want_init_on_free())
&gt; &gt; +             kernel_init_free_pages(page, 1 &lt;&lt; order);
&gt;
&gt; same here. If you don't want to make this exclusive then you have to
&gt; zero before poisoning otherwise you are going to blow up on the poison
&gt; check, right?
Note that we disable initialization if page poisoning is on.
As I mentioned on another thread we can eventually merge this code
with page poisoning, but right now it's better to make the user decide
which of the features they want instead of letting them guess how the
combination of the two is going to work.
&gt; &gt;       if (debug_pagealloc_enabled())
&gt; &gt;               kernel_map_pages(page, 1 &lt;&lt; order, 0);
&gt; &gt;
&gt; --
&gt; Michal Hocko
&gt; SUSE Labs



-- 
Alexander Potapenko
Software Engineer

Google Germany GmbH
Erika-Mann-Stra&#xDF;e, 33
80636 M&#xFC;nchen

Gesch&#xE4;ftsf&#xFC;hrer: Paul Manicle, Halimah DeLaine Prado
Registergericht und -nummer: Hamburg, HRB 86891
Sitz der Gesellschaft: Hamburg



</pre>
<!--X-Body-of-Message-End-->
<!--X-MsgBody-End-->
<!--X-Follow-Ups-->
</div>
<hr>
<ul><li><strong>Follow-Ups</strong>:
<ul>
<li><strong><a name="29367" href="msg29367.html">Re: [PATCH v8 1/2] mm: security: introduce init_on_alloc=1 and init_on_free=1 boot options</a></strong>
<ul><li><em>From:</em> Michal Hocko</li></ul></li>
</ul></li></ul>
<!--X-Follow-Ups-End-->
<!--X-References-->
<ul><li><strong>References</strong>:
<ul>
<li><strong><a name="29360" href="msg29360.html">[PATCH v8 0/3] add init_on_alloc/init_on_free boot options</a></strong>
<ul><li><em>From:</em> Alexander Potapenko</li></ul></li>
<li><strong><a name="29361" href="msg29361.html">[PATCH v8 1/2] mm: security: introduce init_on_alloc=1 and init_on_free=1 boot options</a></strong>
<ul><li><em>From:</em> Alexander Potapenko</li></ul></li>
<li><strong><a name="29365" href="msg29365.html">Re: [PATCH v8 1/2] mm: security: introduce init_on_alloc=1 and init_on_free=1 boot options</a></strong>
<ul><li><em>From:</em> Michal Hocko</li></ul></li>
</ul></li></ul>
<!--X-References-End-->
<!--X-BotPNI-->
<ul>
<li>Prev by Date:
<strong><a href="msg29365.html">Re: [PATCH v8 1/2] mm: security: introduce init_on_alloc=1 and init_on_free=1 boot options</a></strong>
</li>
<li>Next by Date:
<strong><a href="msg29367.html">Re: [PATCH v8 1/2] mm: security: introduce init_on_alloc=1 and init_on_free=1 boot options</a></strong>
</li>
<li>Previous by thread:
<strong><a href="msg29365.html">Re: [PATCH v8 1/2] mm: security: introduce init_on_alloc=1 and init_on_free=1 boot options</a></strong>
</li>
<li>Next by thread:
<strong><a href="msg29367.html">Re: [PATCH v8 1/2] mm: security: introduce init_on_alloc=1 and init_on_free=1 boot options</a></strong>
</li>
<li>Index(es):
<ul>
<li><a href="maillist.html#29366"><strong>Date</strong></a></li>
<li><a href="index.html#29366"><strong>Thread</strong></a></li>
</ul>
</li>
</ul>

<!--X-BotPNI-End-->
<!--X-User-Footer-->
<center>
<font size=-1>
<a href=/lists/>[Index&nbsp;of&nbsp;Archives]</a>
&nbsp;
&nbsp;
<a href=/linux/fedora/fedora-users/>[Fedora&nbsp;Users]</a>
&nbsp;
&nbsp;
<a href=/lists/fedora-desktop/>[Fedora&nbsp;Desktop]</a>
&nbsp;
&nbsp;
<a href=/lists/fedora-selinux/>[Fedora&nbsp;SELinux]</a>
&nbsp;
&nbsp;
<a href=https://yosemitenews.info>[Yosemite&nbsp;News]</a>
&nbsp;
&nbsp;
<a href=/lists/kde/>[KDE&nbsp;Users]</a>
</font>
</center>
<hr>
<p>
<div>
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<ins class="adsbygoogle"
     style="display:block"
     data-ad-format="autorelaxed"
     data-ad-client="ca-pub-3422782820843221"
     data-ad-slot="1424524564"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
</div>
<table width=100%>
<tr>
<td align=left>&nbsp;</td>
<td align=right><a href=/lists/><img src=/button_01.gif border=0 alt="Powered by Linux"></a></td>
</tr>
</table>
<!--X-User-Footer-End-->
<script type="text/javascript"> 
 function initAddThis() {
    addthis.init()
 }
initAddThis();
</script>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-760190-1', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
