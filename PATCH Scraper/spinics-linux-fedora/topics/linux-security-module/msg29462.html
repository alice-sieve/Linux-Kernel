<!-- MHonArc v2.6.19 -->
<!--X-Subject: Re: [PATCH V33 24/30] bpf: Restrict bpf when kernel lockdown is in confidentiality mode -->
<!--X-From-R13: Egrcura Eznyyrl &#60;fqfNglpub.afn.tbi> -->
<!--X-Date: Thu, 27 Jun 2019 07:36:03 &#45;0700 -->
<!--X-Message-Id: bce70c8b&#45;9efd&#45;6362&#45;d536&#45;cfbbcf70b0b7@tycho.nsa.gov -->
<!--X-Content-Type: text/plain -->
<!--X-Reference: 20190621011941.186255&#45;1&#45;matthewgarrett@google.com -->
<!--X-Reference: 20190621011941.186255&#45;25&#45;matthewgarrett@google.com -->
<!--X-Reference: CALCETrVUwQP7roLnW6kFG80Cc5U6X_T6AW+BTAftLccYGp8+Ow@mail.gmail.com -->
<!--X-Reference: alpine.LRH.2.21.1906270621080.28132@namei.org -->
<!--X-Reference: 6E53376F&#45;01BB&#45;4795&#45;BC02&#45;24F9CAE00001@amacapital.net -->
<!--X-Head-End-->
<!doctype html public "-//W3C//DTD HTML//EN">
<html>
<head>
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({
          google_ad_client: "ca-pub-3422782820843221",
          enable_page_level_ads: true
     });
</script>
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="description" content="Linux Security Module, Re: [PATCH V33 24/30] bpf: Restrict bpf when kernel lockdown is in confidentiality mode">
<style>
<!--
 pre {white-space: pre-wrap;}
-->
</style>
<title>Linux Security Module -- Re: [PATCH V33 24/30] bpf: Restrict bpf when kernel lockdown is in confidentiality mode</title>
<link rel="alternate" type="application/rss+xml" title="Linux Security Module" href="//feeds.feedburner.com/LinuxSecurityModule">
</head>
<body vlink=green>
<!--X-Body-Begin-->
<!--X-User-Header-->
<!--X-User-Header-End-->
<!--X-TopPNI-->
<form action="//www.google.com" id="cse-search-box" target="_blank">
  <div>
    <input type="hidden" name="cx" value="partner-pub-3422782820843221:9580497365" />
    <input type="hidden" name="ie" value="UTF-8" />
    <input type="text" name="q" size="25" />
    <input type="submit" name="sa" value="Search" />
  </div>
</form>
<script type="text/javascript" src="//www.google.com/coop/cse/brand?form=cse-search-box&amp;lang=en"></script>
<h1 itemprop="name">Re: [PATCH V33 24/30] bpf: Restrict bpf when kernel lockdown is in confidentiality mode</h1>
[<a href="msg29461.html">Date Prev</a>][<a href="msg29463.html">Date Next</a>][<a href="msg29433.html">Thread Prev</a>][<a href="msg29477.html">Thread Next</a>][<a href="maillist.html#29462">Date Index</a>][<a href="index.html#29462">Thread Index</a>]


<p>&nbsp;<br>
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- responsive test for archives -->
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-3422782820843221"
     data-ad-slot="6345952567"
     data-ad-format="auto"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>

<!--X-TopPNI-End-->
<!--X-MsgBody-->
<!--X-Subject-Header-Begin-->
<hr>
<!--X-Subject-Header-End-->
<!--X-Head-of-Message-->
<ul>
<li><em>Subject</em>: Re: [PATCH V33 24/30] bpf: Restrict bpf when kernel lockdown is in confidentiality mode</li>
<li><em>From</em>: Stephen Smalley &lt;sds@xxxxxxxxxxxxx&gt;</li>
<li><em>Date</em>: Thu, 27 Jun 2019 10:35:41 -0400</li>
<li><em>Cc</em>: Andy Lutomirski &lt;luto@xxxxxxxxxx&gt;,        Matthew Garrett &lt;matthewgarrett@xxxxxxxxxx&gt;,        linux-security@xxxxxxxxxxxxxxx, LKML &lt;linux-kernel@xxxxxxxxxxxxxxx&gt;,        Linux API &lt;linux-api@xxxxxxxxxxxxxxx&gt;,        David Howells &lt;dhowells@xxxxxxxxxx&gt;,        Alexei Starovoitov &lt;alexei.starovoitov@xxxxxxxxx&gt;,        Matthew Garrett &lt;mjg59@xxxxxxxxxx&gt;,        Network Development &lt;netdev@xxxxxxxxxxxxxxx&gt;,        Chun-Yi Lee &lt;jlee@xxxxxxxx&gt;, Daniel Borkmann &lt;daniel@xxxxxxxxxxxxx&gt;,        linux-security-module@xxxxxxxxxxxxxxx</li>
<li><em>In-reply-to</em>: &lt;<a href="msg29433.html">6E53376F-01BB-4795-BC02-24F9CAE00001@amacapital.net</a>&gt;</li>
<li><em>References</em>: &lt;20190621011941.186255-1-matthewgarrett@google.com&gt; &lt;20190621011941.186255-25-matthewgarrett@google.com&gt; &lt;CALCETrVUwQP7roLnW6kFG80Cc5U6X_T6AW+BTAftLccYGp8+Ow@mail.gmail.com&gt; &lt;<a href="msg29394.html">alpine.LRH.2.21.1906270621080.28132@namei.org</a>&gt; &lt;<a href="msg29433.html">6E53376F-01BB-4795-BC02-24F9CAE00001@amacapital.net</a>&gt;</li>
<li><em>User-agent</em>: Mozilla/5.0 (X11; Linux x86_64; rv:60.0) Gecko/20100101 Thunderbird/60.7.0</li>
</ul>
<!--X-Head-of-Message-End-->
<!--X-Head-Body-Sep-Begin-->
<!-- AddThis Button BEGIN -->
<div class="addthis_toolbox addthis_default_style ">
<a class="addthis_button_preferred_1"></a>
<a class="addthis_button_preferred_2"></a>
<a class="addthis_button_preferred_3"></a>
<a class="addthis_button_preferred_4"></a>
<a class="addthis_button_compact"></a>
<a class="addthis_counter addthis_bubble_style"></a>
</div>
<script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5196c2ae1be43d18&async=1&domready=1" async></script>
<!-- AddThis Button END -->
<hr>
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- responsive link 1 -->
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-3422782820843221"
     data-ad-slot="8681825769"
     data-ad-format="link"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
<p>
<div class="content" itemprop="articleBody">
<!--X-Head-Body-Sep-End-->
<!--X-Body-of-Message-->
<pre style="margin: 0em;">
On 6/26/19 8:57 PM, Andy Lutomirski wrote:
</pre><blockquote style="border-left: #5555EE solid 0.2em; margin: 0em; padding-left: 0.85em"><pre style="margin: 0em;">


</pre><blockquote style="border-left: #5555EE solid 0.2em; margin: 0em; padding-left: 0.85em"><pre style="margin: 0em;">
On Jun 26, 2019, at 1:22 PM, James Morris &lt;jmorris@xxxxxxxxx&gt; wrote:

[Adding the LSM mailing list: missed this patchset initially]

</pre><blockquote style="border-left: #5555EE solid 0.2em; margin: 0em; padding-left: 0.85em"><pre style="margin: 0em;">
On Thu, 20 Jun 2019, Andy Lutomirski wrote:

This patch exemplifies why I don't like this approach:

</pre><blockquote style="border-left: #5555EE solid 0.2em; margin: 0em; padding-left: 0.85em"><pre style="margin: 0em;">
@@ -97,6 +97,7 @@ enum lockdown_reason {
        LOCKDOWN_INTEGRITY_MAX,
        LOCKDOWN_KCORE,
        LOCKDOWN_KPROBES,
+       LOCKDOWN_BPF,
        LOCKDOWN_CONFIDENTIALITY_MAX,
</pre></blockquote><pre style="margin: 0em;">

</pre><blockquote style="border-left: #5555EE solid 0.2em; margin: 0em; padding-left: 0.85em"><pre style="margin: 0em;">
--- a/security/lockdown/lockdown.c
+++ b/security/lockdown/lockdown.c
@@ -33,6 +33,7 @@ static char *lockdown_reasons[LOCKDOWN_CONFIDENTIALITY_MAX+1] = {
        [LOCKDOWN_INTEGRITY_MAX] = &quot;integrity&quot;,
        [LOCKDOWN_KCORE] = &quot;/proc/kcore access&quot;,
        [LOCKDOWN_KPROBES] = &quot;use of kprobes&quot;,
+       [LOCKDOWN_BPF] = &quot;use of bpf&quot;,
        [LOCKDOWN_CONFIDENTIALITY_MAX] = &quot;confidentiality&quot;,
</pre></blockquote><pre style="margin: 0em;">

The text here says &quot;use of bpf&quot;, but what this patch is *really* doing
is locking down use of BPF to read kernel memory.  If the details
change, then every LSM needs to get updated, and we risk breaking user
policies that are based on LSMs that offer excessively fine
granularity.
</pre></blockquote><pre style="margin: 0em;">

Can you give an example of how the details might change?

</pre><blockquote style="border-left: #5555EE solid 0.2em; margin: 0em; padding-left: 0.85em"><pre style="margin: 0em;">
I'd be more comfortable if the LSM only got to see &quot;confidentiality&quot;
or &quot;integrity&quot;.
</pre></blockquote><pre style="margin: 0em;">

These are not sufficient for creating a useful policy for the SELinux
case.


</pre></blockquote><pre style="margin: 0em;">

I may have misunderstood, but I thought that SELinux mainly needed to allow certain privileged programs to bypass the policy.  Is there a real example of what SELinux wants to do that can&#x2019;t be done in the simplified model?

The think that specifically makes me uneasy about exposing all of these precise actions to LSMs is that they will get exposed to userspace in a way that forces us to treat them as stable ABIs.
</pre></blockquote><pre style="margin: 0em;">

There are two scenarios where finer-grained distinctions make sense:

</pre><tt>- Users may need to enable specific functionality that falls under the 
</tt><tt>umbrella of &quot;confidentiality&quot; or &quot;integrity&quot; lockdown.  Finer-grained 
</tt><tt>lockdown reasons free them from having to make an all-or-nothing choice 
</tt><tt>between lost functionality or no lockdown at all. This can be supported 
</tt><tt>directly by the lockdown module without any help from SELinux or other 
</tt><tt>security modules; we just need the ability to specify these 
</tt><tt>finer-grained lockdown levels via the boot parameters and securityfs nodes.
</tt><pre style="margin: 0em;">

</pre><tt>- Different processes/programs may need to use different sets of 
</tt><tt>functionality restricted via lockdown confidentiality or integrity 
</tt><tt>categories.  If we have to allow all-or-none for the set of 
</tt><tt>interfaces/functionality covered by the generic confidentiality or 
</tt><tt>integrity categories, then we'll end up having to choose between lost 
</tt><tt>functionality or overprivileged processes, neither of which is optimal.
</tt><pre style="margin: 0em;">

</pre><tt>Is it truly the case that everything under the &quot;confidentiality&quot; 
</tt><tt>category poses the same level of risk to kernel confidentiality, and 
</tt><tt>similarly for everything under the &quot;integrity&quot; category?  If not, then 
</tt><tt>being able to distinguish them definitely has benefit.
</tt><pre style="margin: 0em;">

</pre><tt>I'm still not clear though on how/if this will compose with or be 
</tt><tt>overridden by other security modules.  We would need some means for 
</tt><tt>another security module to take over lockdown decisions once it has 
</tt><tt>initialized (including policy load), and to be able to access state that 
</tt><tt>is currently private to the lockdown module, like the level.
</tt><pre style="margin: 0em;">


</pre>
<!--X-Body-of-Message-End-->
<!--X-MsgBody-End-->
<!--X-Follow-Ups-->
</div>
<hr>
<ul><li><strong>Follow-Ups</strong>:
<ul>
<li><strong><a name="29512" href="msg29512.html">Re: [PATCH V33 24/30] bpf: Restrict bpf when kernel lockdown is in confidentiality mode</a></strong>
<ul><li><em>From:</em> Andy Lutomirski</li></ul></li>
<li><strong><a name="29477" href="msg29477.html">Re: [PATCH V33 24/30] bpf: Restrict bpf when kernel lockdown is in confidentiality mode</a></strong>
<ul><li><em>From:</em> James Morris</li></ul></li>
</ul></li></ul>
<!--X-Follow-Ups-End-->
<!--X-References-->
<ul><li><strong>References</strong>:
<ul>
<li><strong><a name="29394" href="msg29394.html">Re: [PATCH V33 24/30] bpf: Restrict bpf when kernel lockdown is in confidentiality mode</a></strong>
<ul><li><em>From:</em> James Morris</li></ul></li>
<li><strong><a name="29433" href="msg29433.html">Re: [PATCH V33 24/30] bpf: Restrict bpf when kernel lockdown is in confidentiality mode</a></strong>
<ul><li><em>From:</em> Andy Lutomirski</li></ul></li>
</ul></li></ul>
<!--X-References-End-->
<!--X-BotPNI-->
<ul>
<li>Prev by Date:
<strong><a href="msg29461.html">Re: [PATCH v9 1/2] mm: security: introduce init_on_alloc=1 and init_on_free=1 boot options</a></strong>
</li>
<li>Next by Date:
<strong><a href="msg29463.html">Re: linux-next: Tree for Jun 26 (security/integrity/ima/)</a></strong>
</li>
<li>Previous by thread:
<strong><a href="msg29433.html">Re: [PATCH V33 24/30] bpf: Restrict bpf when kernel lockdown is in confidentiality mode</a></strong>
</li>
<li>Next by thread:
<strong><a href="msg29477.html">Re: [PATCH V33 24/30] bpf: Restrict bpf when kernel lockdown is in confidentiality mode</a></strong>
</li>
<li>Index(es):
<ul>
<li><a href="maillist.html#29462"><strong>Date</strong></a></li>
<li><a href="index.html#29462"><strong>Thread</strong></a></li>
</ul>
</li>
</ul>

<!--X-BotPNI-End-->
<!--X-User-Footer-->
<center>
<font size=-1>
<a href=/lists/>[Index&nbsp;of&nbsp;Archives]</a>
&nbsp;
&nbsp;
<a href=/linux/fedora/fedora-users/>[Fedora&nbsp;Users]</a>
&nbsp;
&nbsp;
<a href=/lists/fedora-desktop/>[Fedora&nbsp;Desktop]</a>
&nbsp;
&nbsp;
<a href=/lists/fedora-selinux/>[Fedora&nbsp;SELinux]</a>
&nbsp;
&nbsp;
<a href=https://yosemitenews.info>[Yosemite&nbsp;News]</a>
&nbsp;
&nbsp;
<a href=/lists/kde/>[KDE&nbsp;Users]</a>
</font>
</center>
<hr>
<p>
<div>
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<ins class="adsbygoogle"
     style="display:block"
     data-ad-format="autorelaxed"
     data-ad-client="ca-pub-3422782820843221"
     data-ad-slot="1424524564"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
</div>
<table width=100%>
<tr>
<td align=left>&nbsp;</td>
<td align=right><a href=/lists/><img src=/button_01.gif border=0 alt="Powered by Linux"></a></td>
</tr>
</table>
<!--X-User-Footer-End-->
<script type="text/javascript"> 
 function initAddThis() {
    addthis.init()
 }
initAddThis();
</script>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-760190-1', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
