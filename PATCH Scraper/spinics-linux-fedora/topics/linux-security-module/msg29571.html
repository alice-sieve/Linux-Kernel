<!-- MHonArc v2.6.19 -->
<!--X-Subject: Re: [PATCH v4 15/23] LSM: Specify which LSM to display -->
<!--X-From-R13: Xbua Xbunafra &#60;wbua.wbunafraNpnabavpny.pbz> -->
<!--X-Date: Fri, 28 Jun 2019 11:11:38 &#45;0700 -->
<!--X-Message-Id: 16102220&#45;d8bf&#45;fb15&#45;5298&#45;8ebaa98543e2@canonical.com -->
<!--X-Content-Type: text/plain -->
<!--X-Reference: 20190626192234.11725&#45;1&#45;casey@schaufler&#45;ca.com -->
<!--X-Reference: 20190626192234.11725&#45;16&#45;casey@schaufler&#45;ca.com -->
<!--X-Reference: 89561452&#45;86f9&#45;fd9a&#45;1390&#45;0cd4bde1fd62@tycho.nsa.gov -->
<!--X-Reference: 7944672e&#45;a590&#45;44a3&#45;743a&#45;48c1785a5464@schaufler&#45;ca.com -->
<!--X-Head-End-->
<!doctype html public "-//W3C//DTD HTML//EN">
<html>
<head>
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({
          google_ad_client: "ca-pub-3422782820843221",
          enable_page_level_ads: true
     });
</script>
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="description" content="Linux Security Module, Re: [PATCH v4 15/23] LSM: Specify which LSM to display">
<style>
<!--
 pre {white-space: pre-wrap;}
-->
</style>
<title>Linux Security Module -- Re: [PATCH v4 15/23] LSM: Specify which LSM to display</title>
<link rel="alternate" type="application/rss+xml" title="Linux Security Module" href="//feeds.feedburner.com/LinuxSecurityModule">
</head>
<body vlink=green>
<!--X-Body-Begin-->
<!--X-User-Header-->
<!--X-User-Header-End-->
<!--X-TopPNI-->
<form action="//www.google.com" id="cse-search-box" target="_blank">
  <div>
    <input type="hidden" name="cx" value="partner-pub-3422782820843221:9580497365" />
    <input type="hidden" name="ie" value="UTF-8" />
    <input type="text" name="q" size="25" />
    <input type="submit" name="sa" value="Search" />
  </div>
</form>
<script type="text/javascript" src="//www.google.com/coop/cse/brand?form=cse-search-box&amp;lang=en"></script>
<h1 itemprop="name">Re: [PATCH v4 15/23] LSM: Specify which LSM to display</h1>
[<a href="msg29570.html">Date Prev</a>][<a href="msg29572.html">Date Next</a>][<a href="msg29565.html">Thread Prev</a>][<a href="msg29579.html">Thread Next</a>][<a href="maillist.html#29571">Date Index</a>][<a href="index.html#29571">Thread Index</a>]


<p>&nbsp;<br>
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- responsive test for archives -->
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-3422782820843221"
     data-ad-slot="6345952567"
     data-ad-format="auto"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>

<!--X-TopPNI-End-->
<!--X-MsgBody-->
<!--X-Subject-Header-Begin-->
<hr>
<!--X-Subject-Header-End-->
<!--X-Head-of-Message-->
<ul>
<li><em>Subject</em>: Re: [PATCH v4 15/23] LSM: Specify which LSM to display</li>
<li><em>From</em>: John Johansen &lt;john.johansen@xxxxxxxxxxxxx&gt;</li>
<li><em>Date</em>: Fri, 28 Jun 2019 11:08:34 -0700</li>
<li><em>Cc</em>: keescook@xxxxxxxxxxxx, penguin-kernel@xxxxxxxxxxxxxxxxxxx,        paul@xxxxxxxxxxxxxx</li>
<li><em>In-reply-to</em>: &lt;<a href="msg29565.html">7944672e-a590-44a3-743a-48c1785a5464@schaufler-ca.com</a>&gt;</li>
<li><em>Openpgp</em>: preference=signencrypt</li>
<li><em>Organization</em>: Canonical</li>
<li><em>References</em>: &lt;<a href="msg29370.html">20190626192234.11725-1-casey@schaufler-ca.com</a>&gt; &lt;<a href="msg29385.html">20190626192234.11725-16-casey@schaufler-ca.com</a>&gt; &lt;<a href="msg29546.html">89561452-86f9-fd9a-1390-0cd4bde1fd62@tycho.nsa.gov</a>&gt; &lt;<a href="msg29565.html">7944672e-a590-44a3-743a-48c1785a5464@schaufler-ca.com</a>&gt;</li>
<li><em>User-agent</em>: Mozilla/5.0 (X11; Linux x86_64; rv:60.0) Gecko/20100101 Thunderbird/60.7.1</li>
</ul>
<!--X-Head-of-Message-End-->
<!--X-Head-Body-Sep-Begin-->
<!-- AddThis Button BEGIN -->
<div class="addthis_toolbox addthis_default_style ">
<a class="addthis_button_preferred_1"></a>
<a class="addthis_button_preferred_2"></a>
<a class="addthis_button_preferred_3"></a>
<a class="addthis_button_preferred_4"></a>
<a class="addthis_button_compact"></a>
<a class="addthis_counter addthis_bubble_style"></a>
</div>
<script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5196c2ae1be43d18&async=1&domready=1" async></script>
<!-- AddThis Button END -->
<hr>
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- responsive link 1 -->
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-3422782820843221"
     data-ad-slot="8681825769"
     data-ad-format="link"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
<p>
<div class="content" itemprop="articleBody">
<!--X-Head-Body-Sep-End-->
<!--X-Body-of-Message-->
<pre>On 6/28/19 9:15 AM, Casey Schaufler wrote:
&gt; On 6/28/2019 7:45 AM, Stephen Smalley wrote:
&gt;&gt; On 6/26/19 3:22 PM, Casey Schaufler wrote:
&gt;&gt;&gt; Create a new entry &quot;display&quot; in /proc/.../attr for controlling
&gt;&gt;&gt; which LSM security information is displayed for a process.
&gt;&gt;&gt; The name of an active LSM that supplies hooks for human readable
&gt;&gt;&gt; data may be written to &quot;display&quot; to set the value. The name of
&gt;&gt;&gt; the LSM currently in use can be read from &quot;display&quot;.
&gt;&gt;&gt; At this point there can only be one LSM capable of display
&gt;&gt;&gt; active.
&gt;&gt;
&gt;&gt; IIUC, presently, at the end of the entire series,
&gt;&gt;
&gt;&gt; 1) Any process can change its display attribute to any enabled security module, and no security module can veto that change.
&gt; 
&gt; That is correct. If a security module could hoard the display it
&gt; could prevent user space from functioning in a multiple module
&gt; environment.
&gt; 

It should be noted that this is also just for legacy, we agreed
last year that smack and apparmor would move to new none shared
interfaces by default, and ideally other LSMs would as well.
Smack has already added its process dir and apparmor has its
in apparmor-next

The display LSM allows for the current interfaces to be used
in a stacking situation for things like LSM in legacy container.

&gt;&gt; 2) The display attribute is inherited across fork and exec, even execs that change credentials, and again no security module has control over the inheritance of this attribute.
&gt; 
&gt; Also correct. Scripts don't work otherwise.
&gt; 
&gt;&gt;
&gt;&gt; 3) Setting the display attribute affects more than just the contexts read or written by the process itself:
&gt;&gt; - Contexts reported in audit logs,
&gt;&gt; - Contexts passed across binder (generated in sender context, delivered to receiver),
&gt;&gt; - Contexts passed to NFS servers for new files,
&gt;&gt; - Contexts returned by NFS servers for existing files,
&gt;&gt; - Netlink-related contexts (?possibly generated in sender context rather than receiver context?),
&gt;&gt; - This list may not be complete.
&gt; 
&gt; Any of which can be changed should a more rational behavior be proposed.
&gt; One possibility is to use lsm='value',lsm='value' encoding for internal
&gt; communications, but there's been considerable resistance to anything
&gt; like that.
&gt; 

This is the part of the patchset that I am least happy with but
it is a hard problem, and so far using display has been the only
option that has been even sort of agreed to.


&gt;&gt; 4) A security_secid_to_secctx() in one process' context (e.g. sender) or with one display value followed later by a security_secctx_to_secid() call in a different process' context (e.g. receiver) or with a different display value may ask a different security module to perform the reverse translation of the context than the forward translation.
&gt; 
&gt; Do you have an example of where this might happen?
&gt; Contexts are rarely used within the kernel. The usual
&gt; behavior is to generate them, send them out to user space,
&gt; and delete them. They get cached in some networking code,
&gt; but not in cases where more than one (existing) security
&gt; module will ever use them. Binder may be an exception, but
&gt; only SELinux (currently) supports binder.
&gt; 
&gt; 
&gt;&gt; Is that correct?&#xA0; If so, it seems problematic.
&gt; 
&gt; Balancing backward compatibility with new behavior is hard!
&gt; What would you suggest for audit logs? Should we put all LSM
&gt; data in every record?

If we could it would be better, but again how to do it. Every
option presented has been rejected.

&gt; Is NFS a concern for anyone not using
&gt; SELinux?
&gt; 
Yes. Just because it isn't currently used doesn't mean it isn't
a concern or desired. 

&gt; There is no user space that uses display, and it's going
&gt; to take some time to work out all the kinks before we even
&gt; think about teaching systemd about it.
&gt; 

I'm not even sure we want to teach systemd et al. about it,
it would be far better to teach them about
  /proc/*/attr/{smack,apparmor,...}/*


But yes its going to take time to get the userspace updated.


</pre>
<!--X-Body-of-Message-End-->
<!--X-MsgBody-End-->
<!--X-Follow-Ups-->
</div>
<hr>
<!--X-Follow-Ups-End-->
<!--X-References-->
<ul><li><strong>References</strong>:
<ul>
<li><strong><a name="29370" href="msg29370.html">[PATCH v4 00/23] LSM: Module stacking for AppArmor</a></strong>
<ul><li><em>From:</em> Casey Schaufler</li></ul></li>
<li><strong><a name="29385" href="msg29385.html">[PATCH v4 15/23] LSM: Specify which LSM to display</a></strong>
<ul><li><em>From:</em> Casey Schaufler</li></ul></li>
<li><strong><a name="29546" href="msg29546.html">Re: [PATCH v4 15/23] LSM: Specify which LSM to display</a></strong>
<ul><li><em>From:</em> Stephen Smalley</li></ul></li>
<li><strong><a name="29565" href="msg29565.html">Re: [PATCH v4 15/23] LSM: Specify which LSM to display</a></strong>
<ul><li><em>From:</em> Casey Schaufler</li></ul></li>
</ul></li></ul>
<!--X-References-End-->
<!--X-BotPNI-->
<ul>
<li>Prev by Date:
<strong><a href="msg29570.html">Re: [RFC PATCH v2 1/3] x86/sgx: Add SGX specific LSM hooks</a></strong>
</li>
<li>Next by Date:
<strong><a href="msg29572.html">Re: [PATCH V33 24/30] bpf: Restrict bpf when kernel lockdown is in confidentiality mode</a></strong>
</li>
<li>Previous by thread:
<strong><a href="msg29565.html">Re: [PATCH v4 15/23] LSM: Specify which LSM to display</a></strong>
</li>
<li>Next by thread:
<strong><a href="msg29579.html">Fwd: [PATCH v4 15/23] LSM: Specify which LSM to display</a></strong>
</li>
<li>Index(es):
<ul>
<li><a href="maillist.html#29571"><strong>Date</strong></a></li>
<li><a href="index.html#29571"><strong>Thread</strong></a></li>
</ul>
</li>
</ul>

<!--X-BotPNI-End-->
<!--X-User-Footer-->
<center>
<font size=-1>
<a href=/lists/>[Index&nbsp;of&nbsp;Archives]</a>
&nbsp;
&nbsp;
<a href=/linux/fedora/fedora-users/>[Fedora&nbsp;Users]</a>
&nbsp;
&nbsp;
<a href=/lists/fedora-desktop/>[Fedora&nbsp;Desktop]</a>
&nbsp;
&nbsp;
<a href=/lists/fedora-selinux/>[Fedora&nbsp;SELinux]</a>
&nbsp;
&nbsp;
<a href=https://yosemitenews.info>[Yosemite&nbsp;News]</a>
&nbsp;
&nbsp;
<a href=/lists/kde/>[KDE&nbsp;Users]</a>
</font>
</center>
<hr>
<p>
<div>
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<ins class="adsbygoogle"
     style="display:block"
     data-ad-format="autorelaxed"
     data-ad-client="ca-pub-3422782820843221"
     data-ad-slot="1424524564"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
</div>
<table width=100%>
<tr>
<td align=left>&nbsp;</td>
<td align=right><a href=/lists/><img src=/button_01.gif border=0 alt="Powered by Linux"></a></td>
</tr>
</table>
<!--X-User-Footer-End-->
<script type="text/javascript"> 
 function initAddThis() {
    addthis.init()
 }
initAddThis();
</script>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-760190-1', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
