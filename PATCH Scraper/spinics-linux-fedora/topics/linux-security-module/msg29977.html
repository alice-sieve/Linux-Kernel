<!-- MHonArc v2.6.19 -->
<!--X-Subject: Re: [PATCH V35 27/29] tracefs: Restrict tracefs when the kernel is locked down -->
<!--X-From-R13: Egrira Dbfgrqg &#60;ebfgrqgNtbbqzvf.bet> -->
<!--X-Date: Tue, 16 Jul 2019 16:14:43 &#45;0700 -->
<!--X-Message-Id: 20190716191439.59a1ac32@gandalf.local.home -->
<!--X-Content-Type: text/plain -->
<!--X-Reference: 20190715195946.223443&#45;1&#45;matthewgarrett@google.com -->
<!--X-Reference: 20190715195946.223443&#45;28&#45;matthewgarrett@google.com -->
<!--X-Head-End-->
<!doctype html public "-//W3C//DTD HTML//EN">
<html>
<head>
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({
          google_ad_client: "ca-pub-3422782820843221",
          enable_page_level_ads: true
     });
</script>
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="description" content="Linux Security Module, Re: [PATCH V35 27/29] tracefs: Restrict tracefs when the kernel is locked down">
<style>
<!--
 pre {white-space: pre-wrap;}
-->
</style>
<title>Linux Security Module -- Re: [PATCH V35 27/29] tracefs: Restrict tracefs when the kernel is locked down</title>
<link rel="alternate" type="application/rss+xml" title="Linux Security Module" href="//feeds.feedburner.com/LinuxSecurityModule">
</head>
<body vlink=green>
<!--X-Body-Begin-->
<!--X-User-Header-->
<!--X-User-Header-End-->
<!--X-TopPNI-->
<form action="//www.google.com" id="cse-search-box" target="_blank">
  <div>
    <input type="hidden" name="cx" value="partner-pub-3422782820843221:9580497365" />
    <input type="hidden" name="ie" value="UTF-8" />
    <input type="text" name="q" size="25" />
    <input type="submit" name="sa" value="Search" />
  </div>
</form>
<script type="text/javascript" src="//www.google.com/coop/cse/brand?form=cse-search-box&amp;lang=en"></script>
<h1 itemprop="name">Re: [PATCH V35 27/29] tracefs: Restrict tracefs when the kernel is locked down</h1>
[<a href="msg29976.html">Date Prev</a>][<a href="msg29978.html">Date Next</a>][<a href="msg29934.html">Thread Prev</a>][<a href="msg29978.html">Thread Next</a>][<a href="maillist.html#29977">Date Index</a>][<a href="index.html#29977">Thread Index</a>]


<p>&nbsp;<br>
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- responsive test for archives -->
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-3422782820843221"
     data-ad-slot="6345952567"
     data-ad-format="auto"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>

<!--X-TopPNI-End-->
<!--X-MsgBody-->
<!--X-Subject-Header-Begin-->
<hr>
<!--X-Subject-Header-End-->
<!--X-Head-of-Message-->
<ul>
<li><em>Subject</em>: Re: [PATCH V35 27/29] tracefs: Restrict tracefs when the kernel is locked down</li>
<li><em>From</em>: Steven Rostedt &lt;rostedt@xxxxxxxxxxx&gt;</li>
<li><em>Date</em>: Tue, 16 Jul 2019 19:14:39 -0400</li>
<li><em>Cc</em>: jmorris@xxxxxxxxx, linux-security-module@xxxxxxxxxxxxxxx,        linux-kernel@xxxxxxxxxxxxxxx, linux-api@xxxxxxxxxxxxxxx,        Matthew Garrett &lt;mjg59@xxxxxxxxxx&gt;</li>
<li><em>In-reply-to</em>: &lt;<a href="msg29934.html">20190715195946.223443-28-matthewgarrett@google.com</a>&gt;</li>
<li><em>References</em>: &lt;<a href="msg29916.html">20190715195946.223443-1-matthewgarrett@google.com</a>&gt;        &lt;<a href="msg29934.html">20190715195946.223443-28-matthewgarrett@google.com</a>&gt;</li>
</ul>
<!--X-Head-of-Message-End-->
<!--X-Head-Body-Sep-Begin-->
<!-- AddThis Button BEGIN -->
<div class="addthis_toolbox addthis_default_style ">
<a class="addthis_button_preferred_1"></a>
<a class="addthis_button_preferred_2"></a>
<a class="addthis_button_preferred_3"></a>
<a class="addthis_button_preferred_4"></a>
<a class="addthis_button_compact"></a>
<a class="addthis_counter addthis_bubble_style"></a>
</div>
<script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5196c2ae1be43d18&async=1&domready=1" async></script>
<!-- AddThis Button END -->
<hr>
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- responsive link 1 -->
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-3422782820843221"
     data-ad-slot="8681825769"
     data-ad-format="link"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
<p>
<div class="content" itemprop="articleBody">
<!--X-Head-Body-Sep-End-->
<!--X-Body-of-Message-->
<pre>On Mon, 15 Jul 2019 12:59:44 -0700
Matthew Garrett &lt;matthewgarrett@xxxxxxxxxx&gt; wrote:

&gt; Tracefs may release more information about the kernel than desirable, so
&gt; restrict it when the kernel is locked down in confidentiality mode by
&gt; preventing open().
&gt; 
&gt; Signed-off-by: Matthew Garrett &lt;mjg59@xxxxxxxxxx&gt;
&gt; Cc: Steven Rostedt &lt;rostedt@xxxxxxxxxxx&gt;
&gt; ---
&gt; 

&gt; @@ -389,6 +414,7 @@ struct dentry *tracefs_create_file(const char *name, umode_t mode,
&gt;  {
&gt;  	struct dentry *dentry;
&gt;  	struct inode *inode;
&gt; +	struct file_operations *proxy_fops;

Small nit, but please add this as the first declaration, to keep the
&quot;upside-down x-mas tree&quot; look. I know some of the other functions in
this file don't follow that (which should be cleaned up some day), but
I'd like to avoid adding more that breaks the aesthetic of the code.

&gt;  
&gt;  	if (!(mode &amp; S_IFMT))
&gt;  		mode |= S_IFREG;
&gt; @@ -402,8 +428,18 @@ struct dentry *tracefs_create_file(const char *name, umode_t mode,
&gt;  	if (unlikely(!inode))
&gt;  		return failed_creating(dentry);
&gt;  
&gt; +	proxy_fops = kzalloc(sizeof(struct file_operations), GFP_KERNEL);
&gt; +	if (!proxy_fops)
&gt; +		return failed_creating(dentry);
&gt; +
&gt; +	if (fops)

I think you meant &quot;if (!fops)&quot;.

-- Steve

&gt; +		fops = &amp;tracefs_file_operations;
&gt; +
&gt; +	dentry-&gt;d_fsdata = (void *)fops;
&gt; +	memcpy(proxy_fops, fops, sizeof(*proxy_fops));
&gt; +	proxy_fops-&gt;open = default_open_file;
&gt;  	inode-&gt;i_mode = mode;
&gt; -	inode-&gt;i_fop = fops ? fops : &amp;tracefs_file_operations;
&gt; +	inode-&gt;i_fop = proxy_fops;
&gt;  	inode-&gt;i_private = data;
&gt;  	d_instantiate(dentry, inode);
&gt;  	fsnotify_create(dentry-&gt;d_parent-&gt;d_inode, dentry);


</pre>
<!--X-Body-of-Message-End-->
<!--X-MsgBody-End-->
<!--X-Follow-Ups-->
</div>
<hr>
<ul><li><strong>Follow-Ups</strong>:
<ul>
<li><strong><a name="29978" href="msg29978.html">Re: [PATCH V35 27/29] tracefs: Restrict tracefs when the kernel is locked down</a></strong>
<ul><li><em>From:</em> Matthew Garrett</li></ul></li>
</ul></li></ul>
<!--X-Follow-Ups-End-->
<!--X-References-->
<ul><li><strong>References</strong>:
<ul>
<li><strong><a name="29916" href="msg29916.html">[PATCH V35 00/29] Kernel lockdown functionality</a></strong>
<ul><li><em>From:</em> Matthew Garrett</li></ul></li>
<li><strong><a name="29934" href="msg29934.html">[PATCH V35 27/29] tracefs: Restrict tracefs when the kernel is locked down</a></strong>
<ul><li><em>From:</em> Matthew Garrett</li></ul></li>
</ul></li></ul>
<!--X-References-End-->
<!--X-BotPNI-->
<ul>
<li>Prev by Date:
<strong><a href="msg29976.html">Re: Preferred subj= with multiple LSMs</a></strong>
</li>
<li>Next by Date:
<strong><a href="msg29978.html">Re: [PATCH V35 27/29] tracefs: Restrict tracefs when the kernel is locked down</a></strong>
</li>
<li>Previous by thread:
<strong><a href="msg29934.html">[PATCH V35 27/29] tracefs: Restrict tracefs when the kernel is locked down</a></strong>
</li>
<li>Next by thread:
<strong><a href="msg29978.html">Re: [PATCH V35 27/29] tracefs: Restrict tracefs when the kernel is locked down</a></strong>
</li>
<li>Index(es):
<ul>
<li><a href="maillist.html#29977"><strong>Date</strong></a></li>
<li><a href="index.html#29977"><strong>Thread</strong></a></li>
</ul>
</li>
</ul>

<!--X-BotPNI-End-->
<!--X-User-Footer-->
<center>
<font size=-1>
<a href=/lists/>[Index&nbsp;of&nbsp;Archives]</a>
&nbsp;
&nbsp;
<a href=/linux/fedora/fedora-users/>[Fedora&nbsp;Users]</a>
&nbsp;
&nbsp;
<a href=/lists/fedora-desktop/>[Fedora&nbsp;Desktop]</a>
&nbsp;
&nbsp;
<a href=/lists/fedora-selinux/>[Fedora&nbsp;SELinux]</a>
&nbsp;
&nbsp;
<a href=https://yosemitenews.info>[Yosemite&nbsp;News]</a>
&nbsp;
&nbsp;
<a href=/lists/kde/>[KDE&nbsp;Users]</a>
</font>
</center>
<hr>
<p>
<div>
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<ins class="adsbygoogle"
     style="display:block"
     data-ad-format="autorelaxed"
     data-ad-client="ca-pub-3422782820843221"
     data-ad-slot="1424524564"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
</div>
<table width=100%>
<tr>
<td align=left>&nbsp;</td>
<td align=right><a href=/lists/><img src=/button_01.gif border=0 alt="Powered by Linux"></a></td>
</tr>
</table>
<!--X-User-Footer-End-->
<script type="text/javascript"> 
 function initAddThis() {
    addthis.init()
 }
initAddThis();
</script>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-760190-1', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
