<!-- MHonArc v2.6.19 -->
<!--X-Subject: Re: [PATCH 6/6v3] Makefile: now support other common export	formats (v3) -->
<!--X-From-R13: Xna =?vfb&#45;8859&#45;1?C?Bbxbea=TR?= &#60;wcbxbealNerqung.pbz> -->
<!--X-Date: Mon, 5 Mar 2012 09:59:46 &#45;0800 -->
<!--X-Message-Id: 20120305175938.GA4395@redhat.com -->
<!--X-Content-Type: text/plain -->
<!--X-Reference: 7020fad5&#45;72e5&#45;48e2&#45;b38f&#45;42311fff97b4@zmail17.collab.prod.int.phx2.redhat.com -->
<!--X-Reference: d6c970db&#45;8575&#45;4f3c&#45;bc90&#45;8809fbd80c7f@zmail17.collab.prod.int.phx2.redhat.com -->
<!--X-Head-End-->
<!doctype html public "-//W3C//DTD HTML//EN">
<html>
<head>
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({
          google_ad_client: "ca-pub-3422782820843221",
          enable_page_level_ads: true
     });
</script>
<title>Fedora Fonts &mdash; Re: [PATCH 6/6v3] Makefile: now support other common export	formats (v3)</title>
<style>
<!--
 pre {white-space: pre-wrap;}
-->
</style>
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="description" content="Fedora Fonts, Re: [PATCH 6/6v3] Makefile: now support other common export	formats (v3)">
<link rel="alternate" type="application/rss+xml" title="Fedora Fonts" href="//feeds.feedburner.com/FedoraFonts">
</head>
<body itemscope itemtype="//schema.org/Article" vlink=green>
<!--X-Body-Begin-->
<!--X-User-Header-->
<!--X-User-Header-End-->
<!--X-TopPNI-->
<form action="//www.google.com" id="cse-search-box" target="_blank">
  <div>
    <input type="hidden" name="cx" value="partner-pub-3422782820843221:9580497365" />
    <input type="hidden" name="ie" value="UTF-8" />
    <input type="text" name="q" size="25" />
    <input type="submit" name="sa" value="Search" />
  </div>
</form>
<script type="text/javascript" src="//www.google.com/coop/cse/brand?form=cse-search-box&amp;lang=en"></script>
<h1>Re: [PATCH 6/6v3] Makefile: now support other common export	formats (v3)</h1>
[<a href="msg01406.html">Date Prev</a>][<a href="msg01408.html">Date Next</a>][<a href="msg01396.html">Thread Prev</a>][<a href="msg01397.html">Thread Next</a>][<a href="maillist.html#01407">Date Index</a>][<a href="index.html#01407">Thread Index</a>]


<p>&nbsp;<br>
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- responsive test for archives -->
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-3422782820843221"
     data-ad-slot="6345952567"
     data-ad-format="auto"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>

<!--X-TopPNI-End-->
<!--X-MsgBody-->
<!--X-Subject-Header-Begin-->
<hr>
<!--X-Subject-Header-End-->
<!--X-Head-of-Message-->
<ul>
<li><em>Subject</em>: Re: [PATCH 6/6v3] Makefile: now support other common export	formats (v3)</li>
<li><em>From</em>: Jan Pokorn&#xFD; &lt;<a href="mailto:jpokorny@DOMAIN.HIDDEN">jpokorny@xxxxxxxxxx</a>&gt;</li>
<li><em>Date</em>: Mon, 5 Mar 2012 18:59:39 +0100</li>
<li><em>Cc</em>: <a href="mailto:fonts@DOMAIN.HIDDEN">fonts@xxxxxxxxxxxxxxxxxxxxxxx</a></li>
<li><em>Delivered-to</em>: <a href="mailto:fonts@DOMAIN.HIDDEN">fonts@xxxxxxxxxxxxxxxxxxxxxxx</a></li>
<li><em>In-reply-to</em>: &lt;<a href="msg01391.html">d6c970db-8575-4f3c-bc90-8809fbd80c7f@zmail17.collab.prod.int.phx2.redhat.com</a>&gt;</li>
<li><em>References</em>: &lt;<a href="msg01385.html">7020fad5-72e5-48e2-b38f-42311fff97b4@zmail17.collab.prod.int.phx2.redhat.com</a>&gt;	&lt;<a href="msg01391.html">d6c970db-8575-4f3c-bc90-8809fbd80c7f@zmail17.collab.prod.int.phx2.redhat.com</a>&gt;</li>
</ul>
<!--X-Head-of-Message-End-->
<!--X-Head-Body-Sep-Begin-->
<!-- AddThis Button BEGIN -->
<div class="addthis_toolbox addthis_default_style ">
<a class="addthis_button_preferred_1"></a>
<a class="addthis_button_preferred_2"></a>
<a class="addthis_button_preferred_3"></a>
<a class="addthis_button_preferred_4"></a>
<a class="addthis_button_compact"></a>
<a class="addthis_counter addthis_bubble_style"></a>
</div>
<script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5196c2ae1be43d18&async=1&domready=1" async></script>
<!-- AddThis Button END -->
<hr>
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- responsive link 1 -->
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-3422782820843221"
     data-ad-slot="8681825769"
     data-ad-format="link"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
<p>
<div class="content" itemprop="articleBody">
<!--X-Head-Body-Sep-End-->
<!--X-Body-of-Message-->
<pre style="margin: 0em;">
Based on the previous patch, we create a generalization of how was
&quot;ttf&quot; target handled to support exporting also to other common
formats.  We add &quot;4web&quot; target covering common formats used on
the web (HTML/CSS:font-face): TTF, WOFF, SVG, EOT.
It is easy to add other formats if needed and provided that
such format is supported by FontForge.

Update v2
---------

EOT is not supported natively by FontForge, so in fact, another tool
is needed, either will serve the purpose:
    1. mkeot from eot-utils (<a  rel="nofollow" href="http://www.w3.org/Tools/eot-utils/">http://www.w3.org/Tools/eot-utils/</a>)
    2. ttf2eot (<a  rel="nofollow" href="http://code.google.com/p/ttf2eot/">http://code.google.com/p/ttf2eot/</a>)

Unfortunately, these are not commonly packaged so they have to be
compiled from source.  This is quite straightforward, only in case 2.,
extra header file has to be imported, see [1].

The Makefile supports both these convertors.  I made some comparison
of the two and the output is similar, although 2. seems to be doing font
subsetting and supports setting the URL prefixes where the font is
intended to be used -- this can be explictly requested using:

    make eot MKEOT_URLS=&quot;URL1 URL2 ...&quot;

Because 1. is also under the wings of authoritative organization (W3C),
I arranged it as prioritized choice with the fallback to 2. if mkeot
is not found on the PATH (if even this is missing, the eot target fails).

If official distribution of web fonts incl. EOT is ever to be made,
I think it is important to mark (in the form of a comment in Makefile)
the &quot;canonical&quot; converter.  I anticipated it is 1. as well, but it can be
changed anytime (preferrably also fallback order is changed then).

In scripts/fontexport.pe, printing newline is removed.

Update v3
---------

Use &quot;libre roots&quot; by default for EOT as it seems that 1+ root is needed
for MSIE 8+ and these are as neutral as possible (see also test page
[2]).

Also, make should be more parallel-run-friendly now regarding creation
of export dir.

[1] <a  rel="nofollow" href="http://code.google.com/p/ttf2eot/issues/attachmentText?id=22&amp;aid=220001000&amp;name=cstddef.patch">http://code.google.com/p/ttf2eot/issues/attachmentText?id=22&amp;aid=220001000&amp;name=cstddef.patch</a>
[2] <a  rel="nofollow" href="http://jpokorny.fedorapeople.org/font-test/liberation-sans-italic.html">http://jpokorny.fedorapeople.org/font-test/liberation-sans-italic.html</a>

Signed-off-by: Jan Pokorn&#xFD; &lt;jpokorny@xxxxxxxxxx&gt;
---
 source/Makefile              |   60 ++++++++++++++++++++++++++++++++++++-----
 source/scripts/fontexport.pe |    1 -
 2 files changed, 52 insertions(+), 9 deletions(-)

diff --git a/source/Makefile b/source/Makefile
index 995443b..520d892 100644
--- a/source/Makefile
+++ b/source/Makefile
@@ -1,7 +1,30 @@
+# common targets:
+# &lt;no target&gt;, build, ttf-dir: create dedicated dir with TTF files
+# ttf:                         create export dir with TTF files, track changes
+# 4web:                        dtto for TTF, WOFF, SVG, and EOT
+
 FONTFORGE    = fontforge
 FONTLINT     = fontlint
</pre><tt> 
</tt><tt>-SCRIPTS      = scripts/sfd2ttf.pe scripts/ttf2sfd.pe scripts/fontexport.pe
</tt><pre style="margin: 0em;">
+# TTF-&gt;EOT converters in fallback order
+# the first one is canonical choice used in the release process
+MKEOT        = mkeot
+# URLs to be used for root string within EOT file;
+# defaults to &quot;libre roots&quot; that allow usage on any common web page
+MKEOT_URLS   = http:// https:// file://
+TTF2EOT      = ttf2eot
+ifneq ($(strip $(shell which $(MKEOT) 2&gt;/dev/null)),)
+    make_eot = $(MKEOT) $(1) $(MKEOT_URLS) &gt; $(2)
+else
+    ifneq ($(strip $(shell which $(TTF2EOT) 2&gt;/dev/null)),)
+        make_eot = $(TTF2EOT) $(1) &gt; $(2)
+    else
+        make_eot = $(error No tool for TTF-&gt;EOT conversion: $(MKEOT), $(TTF2EOT))
+    endif
+endif
+
+EXPORTSCRIPT = scripts/fontexport.pe
+SCRIPTS      = $(EXPORTSCRIPT) scripts/sfd2ttf.pe scripts/ttf2sfd.pe
 MISCFILES    = AUTHORS ChangeLog COPYING License.txt README TODO
 SRCDIR       = src
 EXPORTDIR    = export
@@ -30,16 +53,37 @@ $(EXPORTDIR):
 # TrueType/OpenType Font, general usage
 # - ttf cares about source file changes, using shared EXPORTDIR
 # - ttf-dir should be a bit more efficient, creating dedicated dir for TTF
-ttf: $(EXPORTDIR) $(TTFFILES)
+FORMATS = ttf
 ttf-dir:: $(SFDFILES)
-	$(FONTFORGE) -script ./scripts/fontexport.pe -ttf $^
+	$(FONTFORGE) -script $(EXPORTSCRIPT) -ttf $^
 	mkdir -p $(DISTPREFIX_TTF)
 	mv $(addsuffix .ttf,$(basename $^)) $(DISTPREFIX_TTF)
</pre><tt> 
</tt><tt>-# single file export (primarily used by other targets)
</tt><pre style="margin: 0em;">
-$(EXPORTDIR)/%.ttf:: $(SRCDIR)/%.sfd
-	$(FONTFORGE) -script ./scripts/fontexport.pe -$(lastword $(subst ., ,$@)) $&lt;
-	mv $(SRCDIR)/$(notdir $@) $(EXPORTDIR)
+# web sites usage
+# Web Open Font Format (WOFF); for all modern browsers (W3C recommendation)
+FORMATS += woff
+# SVG Font; only for WebKit and Presto based browsers (Firefox &quot;avoids&quot; it)
+FORMATS += svg
+# Embedded OpenType (EOT); MSIE only [extra recipe, FontForge can't create EOT]
+FORMATS += eot
+eot:: $(addprefix $(EXPORTDIR)/$(NAME), $(VARIANTS:=.eot))
+	@echo
+$(EXPORTDIR)/%.eot: $(EXPORTDIR)/%.ttf | $(EXPORTDIR)
+	$(call make_eot,$&lt;,$@)
+4web: ttf woff svg eot
+
+# XXX: declare other formats here if needed (TeX, etc.)
+
+# default for formats without extra recipes defined above (e.g., not &quot;eot&quot;):
+# summary per-format target + single file export for these declared formats
+define FORMAT_template =
+$(1):: $$(addprefix $$(EXPORTDIR)/$$(NAME), $$(VARIANTS:=.$(1)))
+	@echo
+$$(EXPORTDIR)/%.$(1):: $$(SRCDIR)/%.sfd | $$(EXPORTDIR)
+	$$(FONTFORGE) -script $$(EXPORTSCRIPT) -$$(lastword $$(subst ., ,$$@)) $$&lt; 2&gt;/dev/null
+	mv $$(SRCDIR)/$$(notdir $$@) $$(EXPORTDIR)
+endef
+$(foreach format,$(FORMATS),$(eval $(call FORMAT_template,$(format))))
</pre><tt> 
</tt><tt> dist: clean-dist dist-sfd dist-ttf
</tt><pre style="margin: 0em;">
 dist-src: dist-sfd
@@ -74,4 +118,4 @@ clean: clean-dist
 clean-dist:
 	rm -f -- *.tar.gz *.zip
</pre><tt> 
</tt><tt>-.PHONY: all build ttf-dir ttf dist dist-src dist-sfd dist-ttf check clean clean-dist
</tt><pre style="margin: 0em;">
+.PHONY: all build ttf-dir ttf dist dist-src dist-sfd dist-ttf 4web $(FORMATS) check clean clean-dist
diff --git a/source/scripts/fontexport.pe b/source/scripts/fontexport.pe
index 031cf08..343f808 100644
--- a/source/scripts/fontexport.pe
+++ b/source/scripts/fontexport.pe
@@ -17,6 +17,5 @@ while ($argc &gt; 1)
     Open($1)
     Generate($1:r + &quot;.&quot; + format, &quot;&quot;, 0x800)
     Close()
-    Print(&quot;&quot;)
     shift
 endloop
--
1.7.3.4
_______________________________________________
fonts mailing list
fonts@xxxxxxxxxxxxxxxxxxxxxxx
<a  rel="nofollow" href="https://admin.fedoraproject.org/mailman/listinfo/fonts">https://admin.fedoraproject.org/mailman/listinfo/fonts</a>
<a  rel="nofollow" href="http://fonts.fedoraproject.org/">http://fonts.fedoraproject.org/</a>


</pre>
<!--X-Body-of-Message-End-->
<!--X-MsgBody-End-->
<!--X-Follow-Ups-->
</div>
<hr>
<!--X-Follow-Ups-End-->
<!--X-References-->
<!--X-References-End-->
<!--X-BotPNI-->
<ul>
<li>Prev by Date:
<strong><a href="msg01406.html">[Announce] Released 2.5.1 version of the Lohit fonts</a></strong>
</li>
<li>Next by Date:
<strong><a href="msg01408.html">default font list for f17</a></strong>
</li>
<li>Previous by thread:
<strong><a href="msg01396.html">Re: [PATCH 6v2/6] Makefile: now support other common export formats	(v2)</a></strong>
</li>
<li>Next by thread:
<strong><a href="msg01397.html">handling of fonts in the langpack plugin</a></strong>
</li>
<li>Index(es):
<ul>
<li><a href="maillist.html#01407"><strong>Date</strong></a></li>
<li><a href="index.html#01407"><strong>Thread</strong></a></li>
</ul>
</li>
</ul>

<!--X-BotPNI-End-->
<!--X-User-Footer-->
<center>
<font size=-1>
<a href=/lists/>[Index&nbsp;of&nbsp;Archives]</a>
&nbsp;
&nbsp;
<a href=/linux/fedora/fedora-users/>[Fedora&nbsp;Users]</a>
&nbsp;
&nbsp;
<a href=/lists/font-config/>[Font&nbsp;Configuration]</a>
&nbsp;
&nbsp;
<a href=/linux/fedora/fedora-maintainers/>[Fedora&nbsp;Maintainers]</a>
&nbsp;
&nbsp;
<a href=/lists/fedora-desktop/>[Fedora&nbsp;Desktop]</a>
&nbsp;
&nbsp;
<a href=/lists/fedora-selinux/>[Fedora&nbsp;SELinux]</a>
&nbsp;
&nbsp;
<a href=http://www.ske-art.com/z//biglist.php>[Big&nbsp;List&nbsp;of&nbsp;Linux&nbsp;Books]</a>
&nbsp;
&nbsp;
<a href=https://yosemitenews.info>[Yosemite&nbsp;Forum]</a>
&nbsp;
&nbsp;
<a href=/lists/kde/>[KDE&nbsp;Users]</a>
</font>
</center>
<hr>
<p>
<div>
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<ins class="adsbygoogle"
     style="display:block"
     data-ad-format="autorelaxed"
     data-ad-client="ca-pub-3422782820843221"
     data-ad-slot="1424524564"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
</div>
<table width=100%>
<tr>
<td align=left>&nbsp;</td>
<td align=right><a href=/lists/><img src=/button_01.gif border=0 alt="Powered by Linux"></a></td>
</tr>
</table>
<!--X-User-Footer-End-->
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-760190-1', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
