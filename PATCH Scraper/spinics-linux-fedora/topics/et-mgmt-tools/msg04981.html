<!-- MHonArc v2.6.19 -->
<!--X-Subject: Re:  [PATCH] virt&#45;manager: Make virt&#45;manager remember	last image directory -->
<!--X-From-R13: [vpuny @bibgal &#60;zvabibgaNerqung.pbz> -->
<!--X-Date: Thu, 18 Jun 2009 09:22:45 &#45;0700 -->
<!--X-Message-Id: 4A3A69C8.8020202@redhat.com -->
<!--X-Content-Type: multipart/mixed -->
<!--X-Reference: 4A37ABA0.4010903@redhat.com -->
<!--X-Reference: 4A39A423.3030707@redhat.com -->
<!--X-Reference: 4A3A05B4.9050107@redhat.com -->
<!--X-Reference: 4A3A49D7.2010406@redhat.com -->
<!--X-Head-End-->
<!doctype html public "-//W3C//DTD HTML//EN">
<html>
<head>
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({
          google_ad_client: "ca-pub-3422782820843221",
          enable_page_level_ads: true
     });
</script>
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="description" content="Fedora Management Tools, Re:  [PATCH] virt-manager: Make virt-manager remember	last image directory">
<style>
<!--
 pre {white-space: pre-wrap;}
-->
</style>
<link rel="alternate" type="application/rss+xml" title="Fedora Management Tools" href="//feedproxy.google.com/Fedora/linuxManagementTools">
<title>Fedora Management Tools -- Re:  [PATCH] virt-manager: Make virt-manager remember	last image directory</title>
</head>
<body vlink=green>
<!--X-Body-Begin-->
<!--X-User-Header-->
<!--X-User-Header-End-->
<!--X-TopPNI-->
<form action="//www.google.com" id="cse-search-box" target="_blank">
  <div>
    <input type="hidden" name="cx" value="partner-pub-3422782820843221:9580497365" />
    <input type="hidden" name="ie" value="UTF-8" />
    <input type="text" name="q" size="25" />
    <input type="submit" name="sa" value="Search" />
  </div>
</form>
<script type="text/javascript" src="//www.google.com/coop/cse/brand?form=cse-search-box&amp;lang=en"></script>
<h1 itemprop="name">Re:  [PATCH] virt-manager: Make virt-manager remember	last image directory</h1>
[<a href="msg04980.html">Date Prev</a>][<a href="msg04982.html">Date Next</a>][<a href="msg04980.html">Thread Prev</a>][<a href="msg04982.html">Thread Next</a>][<a href="maillist.html#04981">Date Index</a>][<a href="index.html#04981">Thread Index</a>]


<p>&nbsp;<br>
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- responsive test for archives -->
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-3422782820843221"
     data-ad-slot="6345952567"
     data-ad-format="auto"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>

<!--X-TopPNI-End-->
<!--X-MsgBody-->
<!--X-Subject-Header-Begin-->
<hr>
<!--X-Subject-Header-End-->
<!--X-Head-of-Message-->
<ul>
<li><em>Subject</em>: Re:  [PATCH] virt-manager: Make virt-manager remember	last image directory</li>
<li><em>From</em>: Michal Novotny &lt;<a href="mailto:minovotn@DOMAIN.HIDDEN">minovotn@xxxxxxxxxx</a>&gt;</li>
<li><em>Date</em>: Thu, 18 Jun 2009 18:22:32 +0200</li>
<li><em>In-reply-to</em>: &lt;<a href="mailto:4A3A49D7.2010406@DOMAIN.HIDDEN">4A3A49D7.2010406@xxxxxxxxxx</a>&gt;</li>
<li><em>References</em>: &lt;<a href="mailto:4A37ABA0.4010903@DOMAIN.HIDDEN">4A37ABA0.4010903@xxxxxxxxxx</a>&gt;	&lt;<a href="mailto:4A39A423.3030707@DOMAIN.HIDDEN">4A39A423.3030707@xxxxxxxxxx</a>&gt;	&lt;<a href="mailto:4A3A05B4.9050107@DOMAIN.HIDDEN">4A3A05B4.9050107@xxxxxxxxxx</a>&gt;	&lt;<a href="mailto:4A3A49D7.2010406@DOMAIN.HIDDEN">4A3A49D7.2010406@xxxxxxxxxx</a>&gt;</li>
<li><em>Reply-to</em>: Fedora/Linux Management Tools &lt;<a href="mailto:et-mgmt-tools@DOMAIN.HIDDEN">et-mgmt-tools@xxxxxxxxxx</a>&gt;</li>
<li><em>User-agent</em>: Mozilla/5.0 (X11; U; Linux x86_64; en-US;	rv:1.9.1b3pre) Gecko/20090513 Fedora/3.0-2.3.beta2.fc11	Thunderbird/3.0b2</li>
</ul>
<!--X-Head-of-Message-End-->
<!--X-Head-Body-Sep-Begin-->
<!-- AddThis Button BEGIN -->
<div class="addthis_toolbox addthis_default_style ">
<a class="addthis_button_preferred_1"></a>
<a class="addthis_button_preferred_2"></a>
<a class="addthis_button_preferred_3"></a>
<a class="addthis_button_preferred_4"></a>
<a class="addthis_button_compact"></a>
<a class="addthis_counter addthis_bubble_style"></a>
</div>
<script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5196c2ae1be43d18&async=1&domready=1" async></script>
<!-- AddThis Button END -->
<hr>
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- responsive link 1 -->
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-3422782820843221"
     data-ad-slot="8681825769"
     data-ad-format="link"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
<p>
<div class="content" itemprop="articleBody">
<!--X-Head-Body-Sep-End-->
<!--X-Body-of-Message-->
<table width="100%"><tr><td bgcolor="#ffffff" style="background-color: #ffffff; color: #000000; "><font color="#000000">



Ok, I had to rebase it to current codebase because there were some
changesets that were not applied to my hg repository.<br>
<br>
Here's the new version, checked using `make check-pylint`,<br>
Michal<br>
<br>
On 06/18/2009 04:06 PM, Michal Novotny wrote:
<blockquote cite="" type="cite">
  
Hi,<br>
this is new and updated version of my patch. It remembers 5 types of
last used paths now - for last image, media, save and restore and
screenshot files.<br>
  <br>
Schemas were also updated but it wasn't working right so there is a
still an exception try in get_default_directory() function in config.py.<br>
  <br>
Thanks,<br>
Michal<br>
  <br>
On 06/18/2009 11:15 AM, Michal Novotny wrote:
  <blockquote cite="" type="cite">
    
On 06/18/2009 04:19 AM, Cole Robinson wrote:
    <blockquote cite="" type="cite">
      <pre wrap="">On 06/16/2009 10:26 AM, Michal Novotny wrote:
  </pre>
      <blockquote type="cite">
        <pre wrap=""># HG changeset patch
# User Michal Novotny <a rel="nofollow" moz-do-not-send="true"
 class="moz-txt-link-rfc2396E" href="mailto:minovotn@xxxxxxxxxx">&lt;minovotn@xxxxxxxxxx&gt;</a>
# Date 1245162093 -7200
# Node ID 73427fcfc222006d7f74ce79277f8432d74d7c52
# Parent  74f1f8309b139af9d84edfb1f0186c2306c0f332
Make virt-manager remember last chosen image directory

Virt-manager never remembers last image directory after choosing file an image
file to be appended to any domain. Since I am having all the domain image files
in the same directory that is not default, this patch saves the last image path
to gconf configuration file and offers it as startfolder next time.

    </pre>
      </blockquote>
      <pre wrap=""><!---->
I like the idea in principle, but I think it needs to be a bit smarter.

I have a fix pending that will enable the storage browser for install media on
a local connection. We won't want the storage browser squashing the
default_image_path in that case, since there's a good chance that their media
directory and image directory are not the same.
  </pre>
    </blockquote>
Ok, basically I agree. Is there a way to get to know whether we're
choosing media or an image in StorageBrowser (SB, for short) class ?<br>
    <blockquote cite="" type="cite">
      <pre wrap="">We should have two gconf entries: /paths/last_image_path and
/paths/last_media_path, and give the storage_browser a flag or something to
allow the caller to opt in on which gconf entry we want to store. There's
probably a smarter way to do it but I can't think right now.
  </pre>
    </blockquote>
Yeah, that's exactly why I ask. So, if there is no flag, there is a
need to add some for SB. The SB itself stores the data in my code...
Anyway you said you have one patch pending, right? What exactly about?<br>
    <blockquote cite="" type="cite">
      <pre wrap="">A general comment: the gconf entries should change the virt-manager.schema.in.
You can probably just use a default value of "", that way gconf won't throw an
exception the first time you try to access the key.
  </pre>
    </blockquote>
Ok, I didn't know that. This needs further study but now I need to
solve things about Xen that I am primarily working on.<br>
    <blockquote cite="" type="cite">
      <pre wrap="">Some comments in line
  </pre>
    </blockquote>
Ok, I'll comment it too.<br>
    <blockquote cite="" type="cite">
      <blockquote type="cite">
        <pre wrap="">diff -r 74f1f8309b13 -r 73427fcfc222 src/virtManager/addhardware.py
--- a/src/virtManager/addhardware.py	Mon Jun 15 15:54:56 2009 +0200
+++ b/src/virtManager/addhardware.py	Tue Jun 16 16:21:33 2009 +0200
@@ -674,7 +674,7 @@
 
     def browse_storage_file_address(self, src, ignore=None):
         textent = self.window.get_widget("storage-file-address")
-        folder = self.config.get_default_image_dir(self.vm.get_connection())
+        folder = self.config.get_user_default_image_dir(self.vm.get_connection())
         filename = self._browse_file(_("Locate or Create New Storage File"),
                                      textent, folder=folder,
                                      confirm_overwrite=True)
diff -r 74f1f8309b13 -r 73427fcfc222 src/virtManager/config.py
--- a/src/virtManager/config.py	Mon Jun 15 15:54:56 2009 +0200
+++ b/src/virtManager/config.py	Tue Jun 16 16:21:33 2009 +0200
@@ -237,7 +237,15 @@
     def is_vmlist_network_traffic_visible(self):
         return self.conf.get_bool(self.conf_dir + "/vmlist-fields/network_traffic")
 
+    def get_user_default_image_dir(self, conn):
+        try:
+            return self.conf.get_value(self.conf_dir + "/paths/default_image_path")
+        except ValueError:
+            return self.get_default_image_dir(conn)
 
+    def set_user_default_image_dir(self, dir):
+        self.conf.set_value(self.conf_dir + "/paths/default_image_path", dir)
+        logging.debug("Setting path to %s", dir)
 
     def set_vmlist_domain_id_visible(self, state):
         self.conf.set_bool(self.conf_dir + "/vmlist-fields/domain_id", state)
@@ -556,6 +564,14 @@
 
 
     def get_default_image_dir(self, connection):
+        # Exception for case connection argument is str (happens when
+        # creating new domains because we don't have connection object)
+        if str(connection) == connection:
+            if connection == "Xen":
+                return DEFAULT_XEN_IMAGE_DIR
+            else:
+                return DEFAULT_VIRT_IMAGE_DIR
+
         if connection.get_type() == "Xen":
             return DEFAULT_XEN_IMAGE_DIR
 
    </pre>
      </blockquote>
      <pre wrap=""><!---->
The hack shouldn't be necessary (see below).
  </pre>
    </blockquote>
I see, so there's a valid connection object in self.conn that provides
"vmmConnection" (or some) object even when we are creating the domain
(ie. it doesn't exist yet) ?<br>
    <blockquote cite="" type="cite">
      <pre wrap="">  </pre>
      <blockquote type="cite">
        <pre wrap="">diff -r 74f1f8309b13 -r 73427fcfc222 src/virtManager/create.py
--- a/src/virtManager/create.py	Mon Jun 15 15:54:56 2009 +0200
+++ b/src/virtManager/create.py	Tue Jun 16 16:21:33 2009 +0200
@@ -1004,7 +1004,8 @@
         self.window.get_widget("config-storage-box").set_sensitive(src.get_active())
 
     def browse_storage(self, ignore1):
-        f = self._browse_file(_("Locate existing storage"))
+        folder = self.config.get_user_default_image_dir( self.capsdomain.hypervisor_type )
+        f = self._browse_file(_("Locate existing storage"), folder=folder)
         if f != None:
             self.window.get_widget("config-storage-entry").set_text(f)

    </pre>
      </blockquote>
      <pre wrap=""><!---->
'self.conn' contains the active connection, so you should use that rather than
self.capsdomain...

  </pre>
    </blockquote>
Ok, even in domain creation we have this object ?<br>
    <blockquote cite="" type="cite">
      <blockquote type="cite">
        <pre wrap="">@@ -1653,7 +1654,6 @@
             self.detectedDistro = (None, None)
 
     def _browse_file(self, dialog_name, folder=None, is_media=False):
-
         if self.conn.is_remote() or not is_media:
             if self.storage_browser == None:
                 self.storage_browser = vmmStorageBrowser(self.config,
diff -r 74f1f8309b13 -r 73427fcfc222 src/virtManager/storagebrowse.py
--- a/src/virtManager/storagebrowse.py	Mon Jun 15 15:54:56 2009 +0200
+++ b/src/virtManager/storagebrowse.py	Tue Jun 16 16:21:33 2009 +0200
@@ -20,6 +20,7 @@
 
 import gobject
 import gtk.glade
+import os.path
 
 import traceback
 import logging
@@ -242,6 +243,11 @@
     def _do_finish(self, path=None):
         if not path:
             path = self.current_vol().get_path()
+
+        # Save path to config if we use file as storage
+        if "/dev" not in path:
+            self.config.set_user_default_image_dir( os.path.dirname(path) )
+
    </pre>
      </blockquote>
      <pre wrap=""><!---->
A couple things here: This will match any path which contains "/dev", you
probably want path.startswith(). Also, this will store the directory of a
chosen storage volume, which isn't what we want. If you make this chunk the
first thing that happens in the function, it should be fine.

  </pre>
    </blockquote>
Oh, right. This is right. I didn't realized that function would be
better, thanks for your input. This isn't what we won't ? Why not? I
thought we want to strip eg. /disk2/vms/vm1/image.img to get
/disk2/vms/vm1/ and this is what we want, right ? Or could you give me
an example why not this approach?<br>
    <blockquote cite="" type="cite">
      <blockquote type="cite">
        <pre wrap="">         self.emit("storage-browse-finish", path)
         self.close()
    </pre>
      </blockquote>
      <pre wrap=""><!---->
Thanks,
Cole
  </pre>
    </blockquote>
Thanks,<br>
Michal<br>
    <pre wrap=""><hr size="4" width="90%">
_______________________________________________
et-mgmt-tools mailing list
<a rel="nofollow" moz-do-not-send="true" class="moz-txt-link-abbreviated"
 href="mailto:et-mgmt-tools@xxxxxxxxxx">et-mgmt-tools@xxxxxxxxxx</a>
<a rel="nofollow" moz-do-not-send="true" class="moz-txt-link-freetext"
 href="https://www.redhat.com/mailman/listinfo/et-mgmt-tools">https://www.redhat.com/mailman/listinfo/et-mgmt-tools</a></pre>
  </blockquote>
  <pre wrap="">
<hr size="4" width="90%">
_______________________________________________
et-mgmt-tools mailing list
<a rel="nofollow" class="moz-txt-link-abbreviated" href="mailto:et-mgmt-tools@xxxxxxxxxx">et-mgmt-tools@xxxxxxxxxx</a>
<a rel="nofollow" class="moz-txt-link-freetext" href="https://www.redhat.com/mailman/listinfo/et-mgmt-tools">https://www.redhat.com/mailman/listinfo/et-mgmt-tools</a></pre>
</blockquote>
<br>


</font></td></tr></table><pre># HG changeset patch
# User Michal Novotny &lt;minovotn@xxxxxxxxxx&gt;
# Date 1245341781 -7200
# Node ID b599a65ca0615704a47e38eabcd2ff0947bcbaec
# Parent  a996e00b3bb6a99fdf9505c053bc1f6bee532d3b
Make virt-manager remember last used paths

This patch makes virt-manager remember last used paths for disk images, saved
snapshots, restored snapshots, media paths and also screenshot paths not to
bother users with changing paths from the default location per HV technology.
Useful when installing multiple domains and having all the media/image files
in non-default locations.

diff -r a996e00b3bb6 -r b599a65ca061 src/virt-manager.schemas.in
--- a/src/virt-manager.schemas.in	Thu Jun 18 10:54:21 2009 -0400
+++ b/src/virt-manager.schemas.in	Thu Jun 18 18:16:21 2009 +0200
@@ -272,5 +272,70 @@
         &lt;long&gt;Whether to install a sound device for remote VMs or not&lt;/long&gt;
       &lt;/locale&gt;
     &lt;/schema&gt;
+
+    &lt;schema&gt;
+      &lt;key&gt;/schemas/apps/::PACKAGE::/paths/default-image-path&lt;/key&gt;
+      &lt;applyto&gt;/apps/::PACKAGE::/paths/default-image-path&lt;/applyto&gt;
+      &lt;owner&gt;::PACKAGE::&lt;/owner&gt;
+      &lt;type&gt;string&lt;/type&gt;
+      &lt;default&gt;&lt;/default&gt;
+
+      &lt;locale name=&quot;C&quot;&gt;
+        &lt;short&gt;Default image path&lt;/short&gt;
+        &lt;long&gt;Default path for choosing VM images&lt;/long&gt;
+      &lt;/locale&gt;
+    &lt;/schema&gt;
+
+    &lt;schema&gt;
+      &lt;key&gt;/schemas/apps/::PACKAGE::/paths/default-media-path&lt;/key&gt;
+      &lt;applyto&gt;/apps/::PACKAGE::/paths/default-media-path&lt;/applyto&gt;
+      &lt;owner&gt;::PACKAGE::&lt;/owner&gt;
+      &lt;type&gt;string&lt;/type&gt;
+      &lt;default&gt;&lt;/default&gt;
+
+      &lt;locale name=&quot;C&quot;&gt;
+        &lt;short&gt;Default media path&lt;/short&gt;
+        &lt;long&gt;Default path for choosing media&lt;/long&gt;
+      &lt;/locale&gt;
+    &lt;/schema&gt;
+
+    &lt;schema&gt;
+      &lt;key&gt;/schemas/apps/::PACKAGE::/paths/default-save-path&lt;/key&gt;
+      &lt;applyto&gt;/apps/::PACKAGE::/paths/default-save-path&lt;/applyto&gt;
+      &lt;owner&gt;::PACKAGE::&lt;/owner&gt;
+      &lt;type&gt;string&lt;/type&gt;
+      &lt;default&gt;&lt;/default&gt;
+
+      &lt;locale name=&quot;C&quot;&gt;
+        &lt;short&gt;Default save domain path&lt;/short&gt;
+        &lt;long&gt;Default path for saving VM snaphots&lt;/long&gt;
+      &lt;/locale&gt;
+    &lt;/schema&gt;
+
+    &lt;schema&gt;
+      &lt;key&gt;/schemas/apps/::PACKAGE::/paths/default-restore-path&lt;/key&gt;
+      &lt;applyto&gt;/apps/::PACKAGE::/paths/default-restore-path&lt;/applyto&gt;
+      &lt;owner&gt;::PACKAGE::&lt;/owner&gt;
+      &lt;type&gt;string&lt;/type&gt;
+      &lt;default&gt;&lt;/default&gt;
+
+      &lt;locale name=&quot;C&quot;&gt;
+        &lt;short&gt;Default restore path&lt;/short&gt;
+        &lt;long&gt;Default path for stored VM snapshots&lt;/long&gt;
+      &lt;/locale&gt;
+    &lt;/schema&gt;
+
+    &lt;schema&gt;
+      &lt;key&gt;/schemas/apps/::PACKAGE::/paths/default-screenshot-path&lt;/key&gt;
+      &lt;applyto&gt;/apps/::PACKAGE::/paths/default-screenshot-path&lt;/applyto&gt;
+      &lt;owner&gt;::PACKAGE::&lt;/owner&gt;
+      &lt;type&gt;string&lt;/type&gt;
+      &lt;default&gt;&lt;/default&gt;
+
+      &lt;locale name=&quot;C&quot;&gt;
+        &lt;short&gt;Default screenshot path&lt;/short&gt;
+        &lt;long&gt;Default path for saving screenshots from VMs&lt;/long&gt;
+      &lt;/locale&gt;
+    &lt;/schema&gt;
   &lt;/schemalist&gt;
 &lt;/gconfschemafile&gt;
diff -r a996e00b3bb6 -r b599a65ca061 src/virtManager/addhardware.py
--- a/src/virtManager/addhardware.py	Thu Jun 18 10:54:21 2009 -0400
+++ b/src/virtManager/addhardware.py	Thu Jun 18 18:16:21 2009 +0200
@@ -678,7 +678,7 @@
 
     def browse_storage_file_address(self, src, ignore=None):
         textent = self.window.get_widget(&quot;storage-file-address&quot;)
-        folder = self.config.get_default_image_dir(self.vm.get_connection())
+        folder = self.config.get_default_directory(self.vm.get_connection(), &quot;image&quot;)
         filename = self._browse_file(_(&quot;Locate or Create New Storage File&quot;),
                                      textent, folder=folder,
                                      confirm_overwrite=True)
diff -r a996e00b3bb6 -r b599a65ca061 src/virtManager/choosecd.py
--- a/src/virtManager/choosecd.py	Thu Jun 18 10:54:21 2009 -0400
+++ b/src/virtManager/choosecd.py	Thu Jun 18 18:16:21 2009 +0200
@@ -20,6 +20,7 @@
 import gtk.glade
 import gobject
 import logging
+import os.path
 
 import virtinst
 
@@ -133,7 +134,8 @@
         pass
 
     def browse_fv_iso_location(self, ignore1=None, ignore2=None):
-        self._browse_file(_(&quot;Locate ISO Image&quot;))
+        folder = self.config.get_default_directory( self.conn, &quot;media&quot; )
+        self._browse_file(_(&quot;Locate ISO Image&quot;), folder=folder)
 
     def populate_opt_media(self):
         try:
@@ -146,14 +148,16 @@
 
     def set_storage_path(self, src, path):
         self.window.get_widget(&quot;iso-path&quot;).set_text(path)
+        folder = os.path.dirname( path )
+        self.config.set_default_directory( folder, &quot;media&quot; )
 
-    def _browse_file(self, dialog_name):
+    def _browse_file(self, dialog_name, folder):
         if self.storage_browser == None:
             self.storage_browser = vmmStorageBrowser(self.config, self.conn)
                                                      #self.topwin)
             self.storage_browser.connect(&quot;storage-browse-finish&quot;,
                                          self.set_storage_path)
-        self.storage_browser.local_args = { &quot;dialog_name&quot;: dialog_name }
+        self.storage_browser.local_args = { &quot;dialog_name&quot;: dialog_name, &quot;start_folder&quot;: folder }
         self.storage_browser.show(self.conn)
         return None
 
diff -r a996e00b3bb6 -r b599a65ca061 src/virtManager/config.py
--- a/src/virtManager/config.py	Thu Jun 18 10:54:21 2009 -0400
+++ b/src/virtManager/config.py	Thu Jun 18 18:16:21 2009 +0200
@@ -261,6 +261,30 @@
         self.conf.set_bool(self.conf_dir + &quot;/vmlist-fields/network_traffic&quot;, state)
 
 
+    def get_default_directory(self, conn, _type):
+        if _type not in [&quot;image&quot;, &quot;media&quot;, &quot;save&quot;, &quot;restore&quot;, &quot;screenshot&quot;]:
+            logging.error(&quot;Unknown type for get_default_directory: %s&quot; % _type)
+            return
+
+        try:
+            path = self.conf.get_value( self.conf_dir + &quot;/paths/default-%s-path&quot; % _type )
+        except:
+            path = None
+
+        if not path or len(path) == 0:
+            if _type == &quot;image&quot; or _type == &quot;media&quot;:
+                path = self.get_default_image_dir(conn)
+            if _type == &quot;save&quot;:
+                path = self.get_default_save_dir(conn)
+
+        return path
+
+    def set_default_directory(self, folder, _type):
+        if _type not in [&quot;image&quot;, &quot;media&quot;, &quot;save&quot;, &quot;restore&quot;, &quot;screenshot&quot;]:
+            logging.error(&quot;Unknown type for set_default_directory: %s&quot; % _type)
+            return
+
+        self.conf.set_value( self.conf_dir + &quot;/paths/default-%s-path&quot; % _type, folder)
 
     def on_vmlist_domain_id_visible_changed(self, callback):
         self.conf.notify_add(self.conf_dir + &quot;/vmlist-fields/domain_id&quot;, callback)
diff -r a996e00b3bb6 -r b599a65ca061 src/virtManager/create.py
--- a/src/virtManager/create.py	Thu Jun 18 10:54:21 2009 -0400
+++ b/src/virtManager/create.py	Thu Jun 18 18:16:21 2009 +0200
@@ -995,16 +995,20 @@
             nodetect_label.show()
 
     def browse_iso(self, ignore1=None, ignore2=None):
+        folder = self.config.get_default_directory( self.conn, &quot;media&quot;)
         self._browse_file(_(&quot;Locate ISO Image&quot;),
-                          self.set_iso_storage_path)
+                          self.set_iso_storage_path,
+                          folder)
         self.window.get_widget(&quot;install-local-box&quot;).activate()
 
     def toggle_enable_storage(self, src):
         self.window.get_widget(&quot;config-storage-box&quot;).set_sensitive(src.get_active())
 
     def browse_storage(self, ignore1):
+        folder = self.config.get_default_directory( self.conn, &quot;image&quot;)
         self._browse_file(_(&quot;Locate existing storage&quot;),
-                          self.set_disk_storage_path)
+                          self.set_disk_storage_path,
+                          folder)
 
     def toggle_storage_select(self, src):
         act = src.get_active()
@@ -1014,9 +1018,13 @@
         self.window.get_widget(&quot;config-macaddr&quot;).set_sensitive(src.get_active())
 
     def set_iso_storage_path(self, ignore, path):
+        folder = os.path.dirname( path )
+        self.config.set_default_directory( folder, &quot;media&quot;)
         self.window.get_widget(&quot;install-local-box&quot;).child.set_text(path)
 
     def set_disk_storage_path(self, ignore, path):
+        folder = os.path.dirname( path )
+        self.config.set_default_directory( folder, &quot;image&quot;)
         self.window.get_widget(&quot;config-storage-entry&quot;).set_text(path)
 
     # Navigation methods
diff -r a996e00b3bb6 -r b599a65ca061 src/virtManager/details.py
--- a/src/virtManager/details.py	Thu Jun 18 10:54:21 2009 -0400
+++ b/src/virtManager/details.py	Thu Jun 18 18:16:21 2009 +0200
@@ -31,6 +31,7 @@
 import os
 import socket
 import cairo
+import os.path
 
 from virtManager.error import vmmErrorDialog
 from virtManager.addhardware import vmmAddHardware
@@ -1410,11 +1411,17 @@
         # user to choose what image format they'd like to save in....
         path = util.browse_local(self.window.get_widget(&quot;vmm-details&quot;),
                                  _(&quot;Save Virtual Machine Screenshot&quot;),
+                                 self.config.get_default_directory(self.vm.get_connection(),
+                                                                   &quot;screenshot&quot;),
                                  _type = (&quot;*.png&quot;, &quot;PNG files&quot;),
                                  dialog_type = gtk.FILE_CHOOSER_ACTION_SAVE)
         if not path:
             return
 
+        # Save default screenshot directory
+        folder = os.path.dirname( path )
+        self.config.set_default_directory( folder, &quot;screenshot&quot; )
+
         filename = path
         if not(filename.endswith(&quot;.png&quot;)):
             filename += &quot;.png&quot;
diff -r a996e00b3bb6 -r b599a65ca061 src/virtManager/engine.py
--- a/src/virtManager/engine.py	Thu Jun 18 10:54:21 2009 -0400
+++ b/src/virtManager/engine.py	Thu Jun 18 18:16:21 2009 +0200
@@ -24,6 +24,7 @@
 import logging
 import gnome
 import traceback
+import os.path
 
 from virtManager.about import vmmAbout
 from virtManager.connect import vmmConnect
@@ -406,12 +407,16 @@
 
         path = util.browse_local(src.window.get_widget(&quot;vmm-details&quot;),
                                  _(&quot;Save Virtual Machine&quot;),
-                                 self.config.get_default_save_dir(con),
+                                 self.config.get_default_directory(con, &quot;save&quot;),
                                  dialog_type=gtk.FILE_CHOOSER_ACTION_SAVE)
 
         if not path:
             return
 
+        # Save default directory for saving VMs
+        folder = os.path.dirname( path )
+        self.config.set_default_directory( folder, &quot;save&quot;)
+
         progWin = vmmAsyncJob(self.config, self._save_callback, [vm, path],
                               _(&quot;Saving Virtual Machine&quot;))
         progWin.run()
diff -r a996e00b3bb6 -r b599a65ca061 src/virtManager/manager.py
--- a/src/virtManager/manager.py	Thu Jun 18 10:54:21 2009 -0400
+++ b/src/virtManager/manager.py	Thu Jun 18 18:16:21 2009 +0200
@@ -23,6 +23,7 @@
 import gtk.glade
 import logging
 import traceback
+import os.path
 
 import sparkline
 import libvirt
@@ -397,11 +398,15 @@
 
         path = util.browse_local(self.window.get_widget(&quot;vmm-manager&quot;),
                                  _(&quot;Restore Virtual Machine&quot;),
-                                 self.config.get_default_save_dir(conn))
+                                 self.config.get_default_directory(conn, &quot;restore&quot;))
 
         if not path:
             return
 
+        # Save last restore path
+        folder = os.path.dirname( path )
+        self.config.set_default_directory( folder, &quot;restore&quot;)
+
         if not conn.is_valid_saved_image(path):
             self.err.val_err(_(&quot;The file '%s' does not appear to be a &quot;
                                &quot;valid saved machine image&quot;) % path)
</pre><pre>_______________________________________________
et-mgmt-tools mailing list
et-mgmt-tools@xxxxxxxxxx
<a  rel="nofollow" href="https://www.redhat.com/mailman/listinfo/et-mgmt-tools">https://www.redhat.com/mailman/listinfo/et-mgmt-tools</a></pre>
<!--X-Body-of-Message-End-->
<!--X-MsgBody-End-->
<!--X-Follow-Ups-->
</div>
<hr>
<ul><li><strong>Follow-Ups</strong>:
<ul>
<li><strong><a name="04982" href="msg04982.html">Re:  [PATCH] virt-manager: Make virt-manager remember	last image directory</a></strong>
<ul><li><em>From:</em> Cole Robinson</li></ul></li>
</ul></li></ul>
<!--X-Follow-Ups-End-->
<!--X-References-->
<ul><li><strong>References</strong>:
<ul>
<li><strong><a name="04964" href="msg04964.html">[PATCH] virt-manager: Make virt-manager remember	last image directory</a></strong>
<ul><li><em>From:</em> Michal Novotny</li></ul></li>
<li><strong><a name="04975" href="msg04975.html">Re:  [PATCH] virt-manager: Make virt-manager remember	last image directory</a></strong>
<ul><li><em>From:</em> Cole Robinson</li></ul></li>
<li><strong><a name="04976" href="msg04976.html">Re:  [PATCH] virt-manager: Make virt-manager remember	last image directory</a></strong>
<ul><li><em>From:</em> Michal Novotny</li></ul></li>
<li><strong><a name="04980" href="msg04980.html">Re:  [PATCH] virt-manager: Make virt-manager remember	last image directory</a></strong>
<ul><li><em>From:</em> Michal Novotny</li></ul></li>
</ul></li></ul>
<!--X-References-End-->
<!--X-BotPNI-->
<ul>
<li>Prev by Date:
<strong><a href="msg04980.html">Re:  [PATCH] virt-manager: Make virt-manager remember	last image directory</a></strong>
</li>
<li>Next by Date:
<strong><a href="msg04982.html">Re:  [PATCH] virt-manager: Make virt-manager remember	last image directory</a></strong>
</li>
<li>Previous by thread:
<strong><a href="msg04980.html">Re:  [PATCH] virt-manager: Make virt-manager remember	last image directory</a></strong>
</li>
<li>Next by thread:
<strong><a href="msg04982.html">Re:  [PATCH] virt-manager: Make virt-manager remember	last image directory</a></strong>
</li>
<li>Index(es):
<ul>
<li><a href="maillist.html#04981"><strong>Date</strong></a></li>
<li><a href="index.html#04981"><strong>Thread</strong></a></li>
</ul>
</li>
</ul>

<!--X-BotPNI-End-->
<!--X-User-Footer-->
<center>
<font size=-1>
<a href=/lists/>[Index&nbsp;of&nbsp;Archives]</a>
&nbsp;
&nbsp;
<a href=/linux/fedora/fedora-users/>[Fedora&nbsp;Users]</a>
&nbsp;
&nbsp;
<a href=/lists/fll/>[Fedora&nbsp;Legacy&nbsp;List]</a>
&nbsp;
&nbsp;
<a href=/linux/fedora/fedora-maintainers/>[Fedora&nbsp;Maintainers]</a>
&nbsp;
&nbsp;
<a href=/lists/fedora-desktop/>[Fedora&nbsp;Desktop]</a>
&nbsp;
&nbsp;
<a href=/lists/fedora-selinux/>[Fedora&nbsp;SELinux]</a>
&nbsp;
&nbsp;
<a href=http://www.ske-art.com/z/biglist.html>[Big&nbsp;List&nbsp;of&nbsp;Linux&nbsp;Books]</a>
&nbsp;
&nbsp;
<a href=https://yosemitenews.info>[Yosemite&nbsp;News]</a>
&nbsp;
&nbsp;
<a href=/lists/kde/>[KDE&nbsp;Users]</a>
&nbsp;
&nbsp;
<a href=/lists/fedora-tools/>[Fedora&nbsp;Tools]</a>
</font>
</center>
<hr>
<p>
<div>
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<ins class="adsbygoogle"
     style="display:block"
     data-ad-format="autorelaxed"
     data-ad-client="ca-pub-3422782820843221"
     data-ad-slot="1424524564"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
</div>
<table width=100%>
<tr>
<td align=left>&nbsp;</td>
<td align=right><a href=/lists/><img src=/button_01.gif border=0 alt="Powered by Linux"></a></td>
</tr>
</table>
<!--X-User-Footer-End-->
<script type="text/javascript"> 
 function initAddThis() {
    addthis.init()
 }
initAddThis();
</script>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-760190-1', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
