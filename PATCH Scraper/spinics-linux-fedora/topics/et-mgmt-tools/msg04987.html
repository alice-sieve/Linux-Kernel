<!-- MHonArc v2.6.19 -->
<!--X-Subject: Re:  [PATCH] virt&#45;manager: Make virt&#45;manager remember	last image directory -->
<!--X-From-R13: Qbyr Dbovafba &#60;pebovafbNerqung.pbz> -->
<!--X-Date: Mon, 22 Jun 2009 11:55:28 &#45;0700 -->
<!--X-Message-Id: 4A3FD39C.80501@redhat.com -->
<!--X-Content-Type: text/plain -->
<!--X-Reference: 4A37ABA0.4010903@redhat.com -->
<!--X-Reference: 4A39A423.3030707@redhat.com -->
<!--X-Reference: 4A3A05B4.9050107@redhat.com -->
<!--X-Reference: 4A3A49D7.2010406@redhat.com -->
<!--X-Reference: 4A3A69C8.8020202@redhat.com -->
<!--X-Reference: 4A3B94FB.5000007@redhat.com -->
<!--X-Reference: 4A3F3881.6040202@redhat.com -->
<!--X-Head-End-->
<!doctype html public "-//W3C//DTD HTML//EN">
<html>
<head>
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({
          google_ad_client: "ca-pub-3422782820843221",
          enable_page_level_ads: true
     });
</script>
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="description" content="Fedora Management Tools, Re:  [PATCH] virt-manager: Make virt-manager remember	last image directory">
<style>
<!--
 pre {white-space: pre-wrap;}
-->
</style>
<link rel="alternate" type="application/rss+xml" title="Fedora Management Tools" href="//feedproxy.google.com/Fedora/linuxManagementTools">
<title>Fedora Management Tools -- Re:  [PATCH] virt-manager: Make virt-manager remember	last image directory</title>
</head>
<body vlink=green>
<!--X-Body-Begin-->
<!--X-User-Header-->
<!--X-User-Header-End-->
<!--X-TopPNI-->
<form action="//www.google.com" id="cse-search-box" target="_blank">
  <div>
    <input type="hidden" name="cx" value="partner-pub-3422782820843221:9580497365" />
    <input type="hidden" name="ie" value="UTF-8" />
    <input type="text" name="q" size="25" />
    <input type="submit" name="sa" value="Search" />
  </div>
</form>
<script type="text/javascript" src="//www.google.com/coop/cse/brand?form=cse-search-box&amp;lang=en"></script>
<h1 itemprop="name">Re:  [PATCH] virt-manager: Make virt-manager remember	last image directory</h1>
[<a href="msg04986.html">Date Prev</a>][<a href="msg04988.html">Date Next</a>][<a href="msg04985.html">Thread Prev</a>][<a href="msg04986.html">Thread Next</a>][<a href="maillist.html#04987">Date Index</a>][<a href="index.html#04987">Thread Index</a>]


<p>&nbsp;<br>
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- responsive test for archives -->
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-3422782820843221"
     data-ad-slot="6345952567"
     data-ad-format="auto"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>

<!--X-TopPNI-End-->
<!--X-MsgBody-->
<!--X-Subject-Header-Begin-->
<hr>
<!--X-Subject-Header-End-->
<!--X-Head-of-Message-->
<ul>
<li><em>Subject</em>: Re:  [PATCH] virt-manager: Make virt-manager remember	last image directory</li>
<li><em>From</em>: Cole Robinson &lt;<a href="mailto:crobinso@DOMAIN.HIDDEN">crobinso@xxxxxxxxxx</a>&gt;</li>
<li><em>Date</em>: Mon, 22 Jun 2009 14:55:24 -0400</li>
<li><em>Cc</em>: Fedora/Linux Management Tools &lt;<a href="mailto:et-mgmt-tools@DOMAIN.HIDDEN">et-mgmt-tools@xxxxxxxxxx</a>&gt;</li>
<li><em>In-reply-to</em>: &lt;<a href="mailto:4A3F3881.6040202@DOMAIN.HIDDEN">4A3F3881.6040202@xxxxxxxxxx</a>&gt;</li>
<li><em>References</em>: &lt;<a href="mailto:4A37ABA0.4010903@DOMAIN.HIDDEN">4A37ABA0.4010903@xxxxxxxxxx</a>&gt;	&lt;<a href="mailto:4A39A423.3030707@DOMAIN.HIDDEN">4A39A423.3030707@xxxxxxxxxx</a>&gt;	&lt;<a href="mailto:4A3A05B4.9050107@DOMAIN.HIDDEN">4A3A05B4.9050107@xxxxxxxxxx</a>&gt;	&lt;<a href="mailto:4A3A49D7.2010406@DOMAIN.HIDDEN">4A3A49D7.2010406@xxxxxxxxxx</a>&gt;	&lt;<a href="mailto:4A3A69C8.8020202@DOMAIN.HIDDEN">4A3A69C8.8020202@xxxxxxxxxx</a>&gt; &lt;<a href="mailto:4A3B94FB.5000007@DOMAIN.HIDDEN">4A3B94FB.5000007@xxxxxxxxxx</a>&gt;	&lt;<a href="mailto:4A3F3881.6040202@DOMAIN.HIDDEN">4A3F3881.6040202@xxxxxxxxxx</a>&gt;</li>
<li><em>Reply-to</em>: Fedora/Linux Management Tools &lt;<a href="mailto:et-mgmt-tools@DOMAIN.HIDDEN">et-mgmt-tools@xxxxxxxxxx</a>&gt;</li>
<li><em>User-agent</em>: Thunderbird 2.0.0.19 (X11/20090105)</li>
</ul>
<!--X-Head-of-Message-End-->
<!--X-Head-Body-Sep-Begin-->
<!-- AddThis Button BEGIN -->
<div class="addthis_toolbox addthis_default_style ">
<a class="addthis_button_preferred_1"></a>
<a class="addthis_button_preferred_2"></a>
<a class="addthis_button_preferred_3"></a>
<a class="addthis_button_preferred_4"></a>
<a class="addthis_button_compact"></a>
<a class="addthis_counter addthis_bubble_style"></a>
</div>
<script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5196c2ae1be43d18&async=1&domready=1" async></script>
<!-- AddThis Button END -->
<hr>
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- responsive link 1 -->
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-3422782820843221"
     data-ad-slot="8681825769"
     data-ad-format="link"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
<p>
<div class="content" itemprop="articleBody">
<!--X-Head-Body-Sep-End-->
<!--X-Body-of-Message-->
<pre>Michal Novotny wrote:

&lt;snip&gt;

&gt;&gt;&gt;
&gt;&gt;&gt; diff -r a996e00b3bb6 -r b599a65ca061 src/virtManager/config.py
&gt;&gt;&gt; --- a/src/virtManager/config.py	Thu Jun 18 10:54:21 2009 -0400
&gt;&gt;&gt; +++ b/src/virtManager/config.py	Thu Jun 18 18:16:21 2009 +0200
&gt;&gt;&gt; @@ -261,6 +261,30 @@
&gt;&gt;&gt;           self.conf.set_bool(self.conf_dir + &quot;/vmlist-fields/network_traffic&quot;, state)
&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;&gt; +    def get_default_directory(self, conn, _type):
&gt;&gt;&gt; +        if _type not in [&quot;image&quot;, &quot;media&quot;, &quot;save&quot;, &quot;restore&quot;, &quot;screenshot&quot;]:
&gt;&gt;&gt; +            logging.error(&quot;Unknown type for get_default_directory: %s&quot; % _type)
&gt;&gt;&gt; +            return
&gt;&gt;&gt; +
&gt;&gt;&gt; +        try:
&gt;&gt;&gt; +            path = self.conf.get_value( self.conf_dir + &quot;/paths/default-%s-path&quot; % _type )
&gt;&gt;&gt; +        except:
&gt;&gt;&gt; +            path = None
&gt;&gt;&gt; +
&gt;&gt;&gt; +        if not path or len(path) == 0:
&gt;&gt;&gt; +            if _type == &quot;image&quot; or _type == &quot;media&quot;:
&gt;&gt;&gt; +                path = self.get_default_image_dir(conn)
&gt;&gt;&gt; +            if _type == &quot;save&quot;:
&gt;&gt;&gt; +                path = self.get_default_save_dir(conn)
&gt;&gt;&gt; +
&gt;&gt;&gt; +        return path
&gt;&gt;&gt; +
&gt;&gt;&gt; +    def set_default_directory(self, folder, _type):
&gt;&gt;&gt; +        if _type not in [&quot;image&quot;, &quot;media&quot;, &quot;save&quot;, &quot;restore&quot;, &quot;screenshot&quot;]:
&gt;&gt;&gt; +            logging.error(&quot;Unknown type for set_default_directory: %s&quot; % _type)
&gt;&gt;&gt; +            return
&gt;&gt;&gt; +
&gt;&gt;&gt; +        self.conf.set_value( self.conf_dir + &quot;/paths/default-%s-path&quot; % _type, folder)
&gt;&gt;&gt;
&gt;&gt;&gt;      
&gt;&gt; Rather than have the user pass a string in like &quot;image&quot;, &quot;media&quot;, ..., how
&gt;&gt; about defining some constants in the config class:
&gt;&gt;
&gt;&gt; CONFIG_DIR_IMAGE = 1
&gt;&gt; CONFIG_DIR_SAVE  = 2
&gt;&gt; ...
&gt;&gt;
&gt;&gt; (They can even be the string values you use above anyways). Then have a
&gt;&gt; separate function which converts that to the requested gconf path. This way
&gt;&gt; you don't have to duplicate the [&quot;image&quot;, &quot;media&quot;, ...] whitelist in two
&gt;&gt; places, and I think will make the calling code more readable.
&gt;&gt;
&gt;&gt;    
&gt; Well, the idea is good. I know what you mean and I'll use string values 
&gt; there to preserve most of those codes.
&gt;&gt; Also, to simplify a lot of the code, you could push down the gconf fetching/
&gt;&gt; storing into util.browse_local: add an argument which takes one of the above
&gt;&gt; CONFIG_DIR values, sets the start folder, and then records the directory that
&gt;&gt; the user chooses. That way, all callers would need to pass one value, and
&gt;&gt; wouldn't need to play with the result.
&gt;&gt;    
&gt; Well, I don't know what do you mean by that. Do you mean to import gconf 
&gt; directly into util.py and directly call gconf in browse_local? You wrote 
&gt; something about altering util.browse_local() ... could you provide me 
&gt; the prototype you mean?

Sure, here's an untested patch:

&gt; diff -r 2e0e047d21f0 src/virtManager/util.py
&gt; --- a/src/virtManager/util.py	Mon Jun 22 14:24:09 2009 -0400
&gt; +++ b/src/virtManager/util.py	Mon Jun 22 14:43:11 2009 -0400
&gt; @@ -90,25 +90,33 @@
&gt;      return ret
&gt;  
&gt;  
&gt; -def browse_local(parent, dialog_name, start_folder=None, _type=None,
&gt; -                 dialog_type=gtk.FILE_CHOOSER_ACTION_OPEN, confirm_func=None):
&gt; +def browse_local(parent, dialog_name, config, conn, start_folder=None,
&gt; +                 _type=None, dialog_type=gtk.FILE_CHOOSER_ACTION_OPEN,
&gt; +                 confirm_func=None, browse_reason=None):
&gt;      &quot;&quot;&quot;
&gt;      Helper function for launching a filechooser
&gt;  
&gt;      @param parent: Parent window for the filechooser
&gt; +    @param config: vmmConfig used by the calling class
&gt; +    @param conn: vmmConnection used by the calling class
&gt;      @param dialog_name: String to use in the title bar of the filechooser.
&gt;      @param start_folder: Folder the filechooser is viewing at startup
&gt;      @param _type: File extension to filter by (e.g. &quot;iso&quot;, &quot;png&quot;)
&gt;      @param dialog_type: Maps to FileChooserDialog 'action'
&gt;      @param confirm_func: Optional callback function if file is chosen.
&gt; +    @param browse_reason: The vmmConfig.CONFIG_DIR* reason we are browsing.
&gt; +        If set, this will override the 'folder' parameter with the gconf
&gt; +        value, and store the user chosen path.
&gt;      &quot;&quot;&quot;
&gt; -
&gt;      overwrite_confirm = False
&gt;      choose_button = gtk.STOCK_OPEN
&gt;      if dialog_type == gtk.FILE_CHOOSER_ACTION_SAVE:
&gt;          choose_button = gtk.STOCK_SAVE
&gt;          overwrite_confirm = True
&gt;  
&gt; +    if browse_reason:
&gt; +        start_folder = config.get_default_directory(conn, browse_reason)
&gt; +
&gt;      fcdialog = gtk.FileChooserDialog(dialog_name, parent,
&gt;                                       dialog_type,
&gt;                                       (gtk.STOCK_CANCEL, gtk.RESPONSE_CANCEL,
&gt; @@ -142,10 +150,15 @@
&gt;      if(response == gtk.RESPONSE_ACCEPT):
&gt;          filename = fcdialog.get_filename()
&gt;          fcdialog.destroy()
&gt; -        return filename
&gt; +        ret = filename
&gt;      else:
&gt;          fcdialog.destroy()
&gt; -        return None
&gt; +        ret = None
&gt; +
&gt; +    if ret and browse_reason:
&gt; +        config.set_default_directory(os.path.dirname(ret), browse_reason)
&gt; +
&gt; +    return ret
&gt;  
&gt;  def dup_conn(config, conn, libconn=None, return_conn_class=False):
&gt;  

This way, any caller of 'util.browse_local' doesn't need to store the
dirname in gconf: browse_local will do it for us. It sucks that we have
to pass conn and config to the helper, but that info is typically easy
to access from the callers, so shouldn't be a big change.

Thanks,
Cole

_______________________________________________
et-mgmt-tools mailing list
et-mgmt-tools@xxxxxxxxxx
<a  rel="nofollow" href="https://www.redhat.com/mailman/listinfo/et-mgmt-tools">https://www.redhat.com/mailman/listinfo/et-mgmt-tools</a>
</pre>
<!--X-Body-of-Message-End-->
<!--X-MsgBody-End-->
<!--X-Follow-Ups-->
</div>
<hr>
<!--X-Follow-Ups-End-->
<!--X-References-->
<ul><li><strong>References</strong>:
<ul>
<li><strong><a name="04964" href="msg04964.html">[PATCH] virt-manager: Make virt-manager remember	last image directory</a></strong>
<ul><li><em>From:</em> Michal Novotny</li></ul></li>
<li><strong><a name="04975" href="msg04975.html">Re:  [PATCH] virt-manager: Make virt-manager remember	last image directory</a></strong>
<ul><li><em>From:</em> Cole Robinson</li></ul></li>
<li><strong><a name="04976" href="msg04976.html">Re:  [PATCH] virt-manager: Make virt-manager remember	last image directory</a></strong>
<ul><li><em>From:</em> Michal Novotny</li></ul></li>
<li><strong><a name="04980" href="msg04980.html">Re:  [PATCH] virt-manager: Make virt-manager remember	last image directory</a></strong>
<ul><li><em>From:</em> Michal Novotny</li></ul></li>
<li><strong><a name="04981" href="msg04981.html">Re:  [PATCH] virt-manager: Make virt-manager remember	last image directory</a></strong>
<ul><li><em>From:</em> Michal Novotny</li></ul></li>
<li><strong><a name="04982" href="msg04982.html">Re:  [PATCH] virt-manager: Make virt-manager remember	last image directory</a></strong>
<ul><li><em>From:</em> Cole Robinson</li></ul></li>
<li><strong><a name="04985" href="msg04985.html">Re:  [PATCH] virt-manager: Make virt-manager remember	last image directory</a></strong>
<ul><li><em>From:</em> Michal Novotny</li></ul></li>
</ul></li></ul>
<!--X-References-End-->
<!--X-BotPNI-->
<ul>
<li>Prev by Date:
<strong><a href="msg04986.html">Re:  [PATCH] virt-manager: Make virt-manager remember	last image directory</a></strong>
</li>
<li>Next by Date:
<strong><a href="msg04988.html">Re:  [PATCH] virt-manager: Make virt-manager remember	last image directory</a></strong>
</li>
<li>Previous by thread:
<strong><a href="msg04985.html">Re:  [PATCH] virt-manager: Make virt-manager remember	last image directory</a></strong>
</li>
<li>Next by thread:
<strong><a href="msg04986.html">Re:  [PATCH] virt-manager: Make virt-manager remember	last image directory</a></strong>
</li>
<li>Index(es):
<ul>
<li><a href="maillist.html#04987"><strong>Date</strong></a></li>
<li><a href="index.html#04987"><strong>Thread</strong></a></li>
</ul>
</li>
</ul>

<!--X-BotPNI-End-->
<!--X-User-Footer-->
<center>
<font size=-1>
<a href=/lists/>[Index&nbsp;of&nbsp;Archives]</a>
&nbsp;
&nbsp;
<a href=/linux/fedora/fedora-users/>[Fedora&nbsp;Users]</a>
&nbsp;
&nbsp;
<a href=/lists/fll/>[Fedora&nbsp;Legacy&nbsp;List]</a>
&nbsp;
&nbsp;
<a href=/linux/fedora/fedora-maintainers/>[Fedora&nbsp;Maintainers]</a>
&nbsp;
&nbsp;
<a href=/lists/fedora-desktop/>[Fedora&nbsp;Desktop]</a>
&nbsp;
&nbsp;
<a href=/lists/fedora-selinux/>[Fedora&nbsp;SELinux]</a>
&nbsp;
&nbsp;
<a href=http://www.ske-art.com/z/biglist.html>[Big&nbsp;List&nbsp;of&nbsp;Linux&nbsp;Books]</a>
&nbsp;
&nbsp;
<a href=https://yosemitenews.info>[Yosemite&nbsp;News]</a>
&nbsp;
&nbsp;
<a href=/lists/kde/>[KDE&nbsp;Users]</a>
&nbsp;
&nbsp;
<a href=/lists/fedora-tools/>[Fedora&nbsp;Tools]</a>
</font>
</center>
<hr>
<p>
<div>
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<ins class="adsbygoogle"
     style="display:block"
     data-ad-format="autorelaxed"
     data-ad-client="ca-pub-3422782820843221"
     data-ad-slot="1424524564"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
</div>
<table width=100%>
<tr>
<td align=left>&nbsp;</td>
<td align=right><a href=/lists/><img src=/button_01.gif border=0 alt="Powered by Linux"></a></td>
</tr>
</table>
<!--X-User-Footer-End-->
<script type="text/javascript"> 
 function initAddThis() {
    addthis.init()
 }
initAddThis();
</script>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-760190-1', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
