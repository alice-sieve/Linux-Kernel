<!-- MHonArc v2.6.19 -->
<!--X-Subject: [PATCH]:virt&#45;viewer: Load "Send key" menu from XML file -->
<!--X-From-R13: Bng Qnzcoryy &#60;cypNabiryy.pbz> -->
<!--X-Date: Tue, 16 Dec 2008 12:52:27 &#45;0800 -->
<!--X-Message-Id: 4948148E.6090702@novell.com -->
<!--X-Content-Type: multipart/mixed -->
<!--X-Head-End-->
<!doctype html public "-//W3C//DTD HTML//EN">
<html>
<head>
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({
          google_ad_client: "ca-pub-3422782820843221",
          enable_page_level_ads: true
     });
</script>
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="description" content="Fedora Management Tools, [PATCH]:virt-viewer: Load &quot;Send key&quot; menu from XML file">
<style>
<!--
 pre {white-space: pre-wrap;}
-->
</style>
<link rel="alternate" type="application/rss+xml" title="Fedora Management Tools" href="//feedproxy.google.com/Fedora/linuxManagementTools">
<title>Fedora Management Tools -- [PATCH]:virt-viewer: Load &quot;Send key&quot; menu from XML file</title>
</head>
<body vlink=green>
<!--X-Body-Begin-->
<!--X-User-Header-->
<!--X-User-Header-End-->
<!--X-TopPNI-->
<form action="//www.google.com" id="cse-search-box" target="_blank">
  <div>
    <input type="hidden" name="cx" value="partner-pub-3422782820843221:9580497365" />
    <input type="hidden" name="ie" value="UTF-8" />
    <input type="text" name="q" size="25" />
    <input type="submit" name="sa" value="Search" />
  </div>
</form>
<script type="text/javascript" src="//www.google.com/coop/cse/brand?form=cse-search-box&amp;lang=en"></script>
<h1 itemprop="name">[PATCH]:virt-viewer: Load &quot;Send key&quot; menu from XML file</h1>
[<a href="msg04533.html">Date Prev</a>][<a href="msg04536.html">Date Next</a>][<a href="msg04530.html">Thread Prev</a>][<a href="msg04536.html">Thread Next</a>][<a href="maillist.html#04535">Date Index</a>][<a href="index.html#04535">Thread Index</a>]


<p>&nbsp;<br>
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- responsive test for archives -->
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-3422782820843221"
     data-ad-slot="6345952567"
     data-ad-format="auto"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>

<!--X-TopPNI-End-->
<!--X-MsgBody-->
<!--X-Subject-Header-Begin-->
<hr>
<!--X-Subject-Header-End-->
<!--X-Head-of-Message-->
<ul>
<li><em>Subject</em>: [PATCH]:virt-viewer: Load &quot;Send key&quot; menu from XML file</li>
<li><em>From</em>: Pat Campbell &lt;<a href="mailto:plc@DOMAIN.HIDDEN">plc@xxxxxxxxxx</a>&gt;</li>
<li><em>Date</em>: Tue, 16 Dec 2008 13:50:22 -0700</li>
<li><em>Cc</em>: </li>
<li><em>Reply-to</em>: Fedora/Linux Management Tools &lt;<a href="mailto:et-mgmt-tools@DOMAIN.HIDDEN">et-mgmt-tools@xxxxxxxxxx</a>&gt;</li>
<li><em>User-agent</em>: Thunderbird 2.0.0.6 (X11/20070801)</li>
</ul>
<!--X-Head-of-Message-End-->
<!--X-Head-Body-Sep-Begin-->
<!-- AddThis Button BEGIN -->
<div class="addthis_toolbox addthis_default_style ">
<a class="addthis_button_preferred_1"></a>
<a class="addthis_button_preferred_2"></a>
<a class="addthis_button_preferred_3"></a>
<a class="addthis_button_preferred_4"></a>
<a class="addthis_button_compact"></a>
<a class="addthis_counter addthis_bubble_style"></a>
</div>
<script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5196c2ae1be43d18&async=1&domready=1" async></script>
<!-- AddThis Button END -->
<hr>
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- responsive link 1 -->
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-3422782820843221"
     data-ad-slot="8681825769"
     data-ad-format="link"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
<p>
<div class="content" itemprop="articleBody">
<!--X-Head-Body-Sep-End-->
<!--X-Body-of-Message-->
<pre>
Attached patch modifies virt-viewer so that it acquires the &quot;Send key&quot;
menu contents from an xml file and allows user to load a browsed for
keymap def file while running.

Patch is based on hg tip, changeset: 44:92da1556bbf9

Signed-off-by: Pat Campbell &lt;plc@xxxxxxxxxx&gt;


</pre><pre>diff -r 92da1556bbf9 src/Makefile.am
--- a/src/Makefile.am	Fri Nov 28 07:24:56 2008 -0500
+++ b/src/Makefile.am	Tue Dec 16 13:34:01 2008 -0700
@@ -4,9 +4,12 @@
 gladedir = $(pkgdatadir)/ui
 glade_DATA = viewer.glade about.glade auth.glade
 
-EXTRA_DIST = $(glade_DATA)
+keymapdir = $(pkgdatadir)/keymaps
+keymap_DATA = default.xml 
 
-virt_viewer_SOURCES = main.c viewer.h
+EXTRA_DIST = $(glade_DATA) $(keymap_DATA)
+
+virt_viewer_SOURCES = main.c sendkey.c viewer.h
 virt_viewer_LDADD = \
 	@GTKVNC_LIBS@ \
 	@GTK2_LIBS@ \
@@ -23,4 +26,5 @@
 	@LIBVIRT_CFLAGS@ \
 	@LIBVIRT_GLIB_CFLAGS@ \
 	@WARN_CFLAGS@ \
-	-DGLADE_DIR=&quot;\&quot;$(gladedir)\&quot;&quot;
+	-DGLADE_DIR=&quot;\&quot;$(gladedir)\&quot;&quot; \
+	-DKEYMAPS_DIR=&quot;\&quot;$(keymapdir)\&quot;&quot;
diff -r 92da1556bbf9 src/default.xml
--- /dev/null	Thu Jan 01 00:00:00 1970 +0000
+++ b/src/default.xml	Tue Dec 16 13:34:01 2008 -0700
@@ -0,0 +1,135 @@
+&lt;?xml version=&quot;1.0&quot;?&gt;
+
+&lt;!DOCTYPE keymap [
+&lt;!ELEMENT keymap (item)*&gt;
+&lt;!ELEMENT item (label,keys)*&gt;
+&lt;!ELEMENT label (#PCDATA)&gt;
+&lt;!ELEMENT keys (key)+&gt;
+&lt;!ELEMENT key (#PCDATA)&gt;
+&lt;!ATTLIST keymap id CDATA #REQUIRED&gt;
+&lt;!ATTLIST item type (menu|separator) #REQUIRED&gt;
+]&gt;
+
+&lt;keymap id=&quot;virt-viewer, Send Key menu keymap&quot;&gt;
+    &lt;!-- See /usr/include/gtk2.0/gdk/gdkkeysyms.h for valid key names --&gt;
+	&lt;item type=&quot;menu&quot;&gt;
+		&lt;label&gt;Ctrl+Alt+_Del&lt;/label&gt;
+        &lt;keys&gt;
+            &lt;key&gt;Control_L&lt;/key&gt;
+            &lt;key&gt;Alt_L&lt;/key&gt;
+            &lt;key&gt;Delete&lt;/key&gt;
+        &lt;/keys&gt;
+    &lt;/item&gt;
+	&lt;item type=&quot;menu&quot;&gt;
+		&lt;label&gt;Ctrl+Alt+_BackSpace&lt;/label&gt;
+        &lt;keys&gt;
+            &lt;key&gt;Control_L&lt;/key&gt;
+            &lt;key&gt;Alt_L&lt;/key&gt;
+            &lt;key&gt;BackSpace&lt;/key&gt;
+        &lt;/keys&gt;
+    &lt;/item&gt;
+	&lt;item type=&quot;separator&quot;/&gt;
+	&lt;item type=&quot;menu&quot;&gt;
+		&lt;label&gt;Ctrl+Alt+F_1&lt;/label&gt;
+        &lt;keys&gt;
+            &lt;key&gt;Control_L&lt;/key&gt;
+            &lt;key&gt;Alt_L&lt;/key&gt;
+            &lt;key&gt;F1&lt;/key&gt;
+        &lt;/keys&gt;
+    &lt;/item&gt;
+	&lt;item type=&quot;menu&quot;&gt;
+		&lt;label&gt;Ctrl+Alt+F_2&lt;/label&gt;
+        &lt;keys&gt;
+            &lt;key&gt;Control_L&lt;/key&gt;
+            &lt;key&gt;Alt_L&lt;/key&gt;
+            &lt;key&gt;F2&lt;/key&gt;
+        &lt;/keys&gt;
+    &lt;/item&gt;
+    &lt;item type=&quot;menu&quot;&gt;
+		&lt;label&gt;Ctrl+Alt+F_3&lt;/label&gt;
+        &lt;keys&gt;
+            &lt;key&gt;Control_L&lt;/key&gt;
+            &lt;key&gt;Alt_L&lt;/key&gt;
+            &lt;key&gt;F3&lt;/key&gt;
+        &lt;/keys&gt;
+    &lt;/item&gt;
+    &lt;item type=&quot;menu&quot;&gt;
+		&lt;label&gt;Ctrl+Alt+F_4&lt;/label&gt;
+        &lt;keys&gt;
+            &lt;key&gt;Control_L&lt;/key&gt;
+            &lt;key&gt;Alt_L&lt;/key&gt;
+            &lt;key&gt;F4&lt;/key&gt;
+        &lt;/keys&gt;
+    &lt;/item&gt;
+    &lt;item type=&quot;menu&quot;&gt;
+		&lt;label&gt;Ctrl+Alt+F_5&lt;/label&gt;
+        &lt;keys&gt;
+            &lt;key&gt;Control_L&lt;/key&gt;
+            &lt;key&gt;Alt_L&lt;/key&gt;
+            &lt;key&gt;F5&lt;/key&gt;
+        &lt;/keys&gt;
+    &lt;/item&gt;
+    &lt;item type=&quot;menu&quot;&gt;
+		&lt;label&gt;Ctrl+Alt+F_6&lt;/label&gt;
+        &lt;keys&gt;
+            &lt;key&gt;Control_L&lt;/key&gt;
+            &lt;key&gt;Alt_L&lt;/key&gt;
+            &lt;key&gt;F6&lt;/key&gt;
+        &lt;/keys&gt;
+    &lt;/item&gt;
+    &lt;item type=&quot;menu&quot;&gt;
+		&lt;label&gt;Ctrl+Alt+F_7&lt;/label&gt;
+        &lt;keys&gt;
+            &lt;key&gt;Control_L&lt;/key&gt;
+            &lt;key&gt;Alt_L&lt;/key&gt;
+            &lt;key&gt;F7&lt;/key&gt;
+        &lt;/keys&gt;
+    &lt;/item&gt;
+    &lt;item type=&quot;menu&quot;&gt;
+		&lt;label&gt;Ctrl+Alt+F_8&lt;/label&gt;
+        &lt;keys&gt;
+            &lt;key&gt;Control_L&lt;/key&gt;
+            &lt;key&gt;Alt_L&lt;/key&gt;
+            &lt;key&gt;F8&lt;/key&gt;
+        &lt;/keys&gt;
+    &lt;/item&gt;
+    &lt;item type=&quot;menu&quot;&gt;
+		&lt;label&gt;Ctrl+Alt+F_9&lt;/label&gt;
+        &lt;keys&gt;
+            &lt;key&gt;Control_L&lt;/key&gt;
+            &lt;key&gt;Alt_L&lt;/key&gt;
+            &lt;key&gt;F9&lt;/key&gt;
+        &lt;/keys&gt;
+    &lt;/item&gt;
+    &lt;item type=&quot;menu&quot;&gt;
+		&lt;label&gt;Ctrl+Alt+F1_0&lt;/label&gt;
+        &lt;keys&gt;
+            &lt;key&gt;Control_L&lt;/key&gt;
+            &lt;key&gt;Alt_L&lt;/key&gt;
+            &lt;key&gt;F10&lt;/key&gt;
+        &lt;/keys&gt;
+    &lt;/item&gt;
+    &lt;item type=&quot;menu&quot;&gt;
+		&lt;label&gt;Ctrl+Alt+F11&lt;/label&gt;
+        &lt;keys&gt;
+            &lt;key&gt;Control_L&lt;/key&gt;
+            &lt;key&gt;Alt_L&lt;/key&gt;
+            &lt;key&gt;F11&lt;/key&gt;
+        &lt;/keys&gt;
+    &lt;/item&gt;
+    &lt;item type=&quot;menu&quot;&gt;
+		&lt;label&gt;Ctrl+Alt+F12&lt;/label&gt;
+        &lt;keys&gt;
+            &lt;key&gt;Control_L&lt;/key&gt;
+            &lt;key&gt;Alt_L&lt;/key&gt;
+            &lt;key&gt;F12&lt;/key&gt;
+        &lt;/keys&gt;
+    &lt;/item&gt;
+	&lt;item type=&quot;separator&quot;/&gt;
+	&lt;item type=&quot;menu&quot;&gt;
+		&lt;label&gt;_PrintScreen&lt;/label&gt;
+        &lt;keys&gt;
+            &lt;key&gt;Print&lt;/key&gt;
+        &lt;/keys&gt;
+    &lt;/item&gt;
+&lt;/keymap&gt;
diff -r 92da1556bbf9 src/main.c
--- a/src/main.c	Fri Nov 28 07:24:56 2008 -0500
+++ b/src/main.c	Tue Dec 16 13:34:01 2008 -0700
@@ -71,35 +71,6 @@
 };
 
 
-#define MAX_KEY_COMBO 3
-struct  keyComboDef {
-	guint keys[MAX_KEY_COMBO];
-	guint nkeys;
-	const char *label;
-};
-
-static const struct keyComboDef keyCombos[] = {
-        { { GDK_Control_L, GDK_Alt_L, GDK_Delete }, 3, &quot;Ctrl+Alt+_Del&quot;},
-        { { GDK_Control_L, GDK_Alt_L, GDK_BackSpace }, 3, &quot;Ctrl+Alt+_Backspace&quot;},
-        { {}, 0, &quot;&quot; },
-        { { GDK_Control_L, GDK_Alt_L, GDK_F1 }, 3, &quot;Ctrl+Alt+F_1&quot;},
-        { { GDK_Control_L, GDK_Alt_L, GDK_F2 }, 3, &quot;Ctrl+Alt+F_2&quot;},
-        { { GDK_Control_L, GDK_Alt_L, GDK_F3 }, 3, &quot;Ctrl+Alt+F_3&quot;},
-        { { GDK_Control_L, GDK_Alt_L, GDK_F4 }, 3, &quot;Ctrl+Alt+F_4&quot;},
-        { { GDK_Control_L, GDK_Alt_L, GDK_F5 }, 3, &quot;Ctrl+Alt+F_5&quot;},
-        { { GDK_Control_L, GDK_Alt_L, GDK_F6 }, 3, &quot;Ctrl+Alt+F_6&quot;},
-        { { GDK_Control_L, GDK_Alt_L, GDK_F7 }, 3, &quot;Ctrl+Alt+F_7&quot;},
-        { { GDK_Control_L, GDK_Alt_L, GDK_F8 }, 3, &quot;Ctrl+Alt+F_8&quot;},
-        { { GDK_Control_L, GDK_Alt_L, GDK_F5 }, 3, &quot;Ctrl+Alt+F_9&quot;},
-        { { GDK_Control_L, GDK_Alt_L, GDK_F6 }, 3, &quot;Ctrl+Alt+F1_0&quot;},
-        { { GDK_Control_L, GDK_Alt_L, GDK_F7 }, 3, &quot;Ctrl+Alt+F11&quot;},
-        { { GDK_Control_L, GDK_Alt_L, GDK_F8 }, 3, &quot;Ctrl+Alt+F12&quot;},
-        { {}, 0, &quot;&quot; },
-        { { GDK_Print }, 1, &quot;_PrintScreen&quot;},
-};
-
-
-
 typedef struct VirtViewer {
 	char *uri;
 	virConnectPtr conn;
@@ -109,6 +80,9 @@
 	GladeXML *glade;
 	GtkWidget *window;
 	GtkWidget *vnc;
+	GtkWidget *menubar;
+	GtkWidget *menu_send;
+	char *menu_send_text;
 	int active;
 
 	gboolean accelEnabled;
@@ -120,6 +94,8 @@
 	int reconnect;
 	int direct;
 	int verbose;
+
+	SendKeyItems sendKeyItems;
 } VirtViewer;
 
 typedef struct VirtViewerSize {
@@ -405,12 +381,13 @@
         GtkWidget *label = gtk_bin_get_child(GTK_BIN(menu));
         const char *text = gtk_label_get_label(GTK_LABEL(label));
 	DEBUG_LOG(&quot;Woo\n&quot;);
-        for (i = 0 ; i &lt; (sizeof(keyCombos)/sizeof(keyCombos[0])) ; i++) {
-                if (!strcmp(text, keyCombos[i].label)) {
+        for (i = 0 ; i &lt; viewer-&gt;sendKeyItems.cnt; i++) {
+                struct keyComboDef *kp = viewer-&gt;sendKeyItems.keyCombos[i];
+                if (!strcmp(text, kp-&gt;label)) {
                         DEBUG_LOG(&quot;Sending key combo %s\n&quot;, gtk_label_get_text(GTK_LABEL(label)));
                         vnc_display_send_keys(VNC_DISPLAY(viewer-&gt;vnc),
-                                              keyCombos[i].keys,
-                                              keyCombos[i].nkeys);
+                                              kp-&gt;keys,
+                                              kp-&gt;nkeys);
                         return;
                 }
         }
@@ -446,6 +423,83 @@
 
 		filename = gtk_file_chooser_get_filename (GTK_FILE_CHOOSER (dialog));
 		viewer_save_screenshot(viewer-&gt;vnc, filename);
+		g_free (filename);
+	}
+
+	gtk_widget_destroy (dialog);
+}
+
+static void viewer_menu_build_sendkey(VirtViewer *viewer, const char *filename)
+{
+	GtkWidget *sendkey;
+	GtkWidget *menu;
+	GtkWidget *label;
+	int i;
+
+	build_keyCombos(&amp;viewer-&gt;sendKeyItems, filename, viewer-&gt;verbose);
+	gtk_widget_destroy (viewer-&gt;menu_send);
+
+	sendkey = gtk_menu_item_new();
+	label = g_object_new(GTK_TYPE_ACCEL_LABEL, NULL);
+	gtk_label_set_text_with_mnemonic(GTK_LABEL(label), viewer-&gt;menu_send_text);
+	gtk_misc_set_alignment(GTK_MISC(label), 0.0, 0.5);
+
+	gtk_container_add(GTK_CONTAINER(sendkey), label);
+	gtk_accel_label_set_accel_widget(GTK_ACCEL_LABEL(label), sendkey);
+	gtk_widget_show(label);
+
+	menu = gtk_menu_new();
+	gtk_menu_item_set_submenu(GTK_MENU_ITEM(sendkey), menu);
+
+	for (i = 0; i &lt; viewer-&gt;sendKeyItems.cnt; i++) {
+		GtkWidget *key;
+		struct keyComboDef *kp = viewer-&gt;sendKeyItems.keyCombos[i];
+
+		if (kp-&gt;nkeys) {
+			key = gtk_menu_item_new_with_mnemonic(kp-&gt;label);
+			gtk_menu_append(GTK_MENU(menu), key);
+			g_signal_connect(key, &quot;activate&quot;, GTK_SIGNAL_FUNC(viewer_menu_send), viewer);
+		} else {
+			gtk_menu_append(GTK_MENU(menu), gtk_separator_menu_item_new());
+		}
+	}
+
+	viewer-&gt;menu_send = sendkey;
+	gtk_menu_bar_insert(GTK_MENU_BAR(viewer-&gt;menubar), viewer-&gt;menu_send, SEND_KEY_MENU);
+	gtk_widget_show_all(viewer-&gt;menu_send);
+}
+
+
+static void viewer_menu_file_sendkey(GtkWidget *menu G_GNUC_UNUSED, VirtViewer *viewer G_GNUC_UNUSED)
+{
+	GtkWidget *dialog;
+
+	dialog = gtk_file_chooser_dialog_new (&quot;Load SendKey&quot;,
+					      NULL,
+					      GTK_FILE_CHOOSER_ACTION_OPEN,
+					      GTK_STOCK_CANCEL, GTK_RESPONSE_CANCEL,
+					      GTK_STOCK_OPEN, GTK_RESPONSE_ACCEPT,
+					      NULL);
+again:
+	if (gtk_dialog_run (GTK_DIALOG (dialog)) == GTK_RESPONSE_ACCEPT) {
+		char *filename;
+
+		filename = gtk_file_chooser_get_filename (GTK_FILE_CHOOSER (dialog));
+		if (sendkey_xml_validate(filename) == -1) {
+			GtkWidget *msg_dialog = gtk_message_dialog_new (GTK_WINDOW(dialog),
+					GTK_DIALOG_DESTROY_WITH_PARENT,
+					GTK_MESSAGE_ERROR,
+					GTK_BUTTONS_CLOSE,
+					&quot;Invalid send key XML format: '%s'&quot;,
+					filename);
+			gtk_dialog_run (GTK_DIALOG (msg_dialog));
+			gtk_widget_destroy (msg_dialog);
+			g_free (filename);
+			goto again;
+		}
+		else {
+			viewer_menu_build_sendkey(viewer, filename);
+		}
 		g_free (filename);
 	}
 
@@ -979,12 +1033,14 @@
 	      gboolean waitvm,
 	      gboolean reconnect,
 	      gboolean verbose,
+	      const char *keymapfile,
 	      GtkWidget *container)
 {
 	VirtViewer *viewer;
 	GtkWidget *notebook;
 	GtkWidget *scroll;
 	GtkWidget *align;
+	GtkWidget *widget;
 
 	viewer = g_new0(VirtViewer, 1);
 
@@ -1015,6 +1071,8 @@
 				      G_CALLBACK(viewer_menu_file_quit), viewer);
 	glade_xml_signal_connect_data(viewer-&gt;glade, &quot;viewer_menu_file_screenshot&quot;,
 				      G_CALLBACK(viewer_menu_file_screenshot), viewer);
+	glade_xml_signal_connect_data(viewer-&gt;glade, &quot;viewer_menu_file_sendkey&quot;,
+				      G_CALLBACK(viewer_menu_file_sendkey), viewer);
 	glade_xml_signal_connect_data(viewer-&gt;glade, &quot;viewer_menu_view_fullscreen&quot;,
 				      G_CALLBACK(viewer_menu_view_fullscreen), viewer);
 	glade_xml_signal_connect_data(viewer-&gt;glade, &quot;viewer_menu_view_scale&quot;,
@@ -1030,6 +1088,12 @@
         vnc_display_set_pointer_grab(VNC_DISPLAY(viewer-&gt;vnc), TRUE);
 	vnc_display_set_force_size(VNC_DISPLAY(viewer-&gt;vnc), FALSE);
 	//vnc_display_set_scaling(VNC_DISPLAY(viewer-&gt;vnc), TRUE);
+
+	viewer-&gt;menubar = glade_xml_get_widget(viewer-&gt;glade,&quot;top-menu&quot;);
+	viewer-&gt;menu_send = glade_xml_get_widget(viewer-&gt;glade,&quot;menu-send&quot;);
+	widget = gtk_bin_get_child(GTK_BIN(viewer-&gt;menu_send));
+	viewer-&gt;menu_send_text = strdup(gtk_label_get_label(GTK_LABEL(widget)));
+	viewer_menu_build_sendkey(viewer, keymapfile);
 
         g_signal_connect(GTK_OBJECT(viewer-&gt;vnc), &quot;vnc-connected&quot;,
 			 GTK_SIGNAL_FUNC(viewer_connected), viewer);
@@ -1110,6 +1174,7 @@
 	GError *error = NULL;
 	int ret;
 	char *uri = NULL;
+	char *keymapfile = NULL;
 	gchar **args = NULL;
 	gboolean print_version = FALSE;
 	gboolean verbose = FALSE;
@@ -1132,6 +1197,8 @@
 		  &quot;reconnect to domain upon restart&quot;, NULL },
   	     	{ G_OPTION_REMAINING, '\0', 0, G_OPTION_ARG_STRING_ARRAY, &amp;args,
 		  NULL, &quot;DOMAIN-NAME|ID|UUID&quot; },
+		{ &quot;keymap&quot;, 'k', 0, G_OPTION_ARG_STRING, &amp;keymapfile,
+		  &quot;keymap descriptor file&quot;, &quot;filename&quot;},
   		{ NULL, 0, 0, G_OPTION_ARG_NONE, NULL, NULL, NULL }
 	};
 
@@ -1158,7 +1225,7 @@
 		return 1;
 	}
 
-	ret = viewer_start (uri, args[0], direct, waitvm, reconnect, verbose, NULL);
+	ret = viewer_start (uri, args[0], direct, waitvm, reconnect, verbose, keymapfile, NULL);
 	if (ret != 0)
 		return ret;
 
diff -r 92da1556bbf9 src/sendkey.c
--- /dev/null	Thu Jan 01 00:00:00 1970 +0000
+++ b/src/sendkey.c	Tue Dec 16 13:34:01 2008 -0700
@@ -0,0 +1,417 @@
+/*
+ * sendkey.c: Reads keymap XML definition file populating keyComboDef
+ *           structures for send key menu
+ *
+ * Copyright (C) 2008 Novell,
+ *
+ * This program is free software; you can redistribute it and/or modify
+ * it under the terms of the GNU General Public License as published by
+ * the Free Software Foundation; either version 2 of the License, or
+ * (at your option) any later version.
+ *
+ * This program is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU General Public License for more details.
+ *
+ * You should have received a copy of the GNU General Public License
+ * along with this program; if not, write to the Free Software
+ * Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
+ *
+ * Author: Pat Campbell &lt;plc@xxxxxxxxxx&gt;
+ */
+
+#include &lt;config.h&gt;
+
+#include &lt;gtk/gtk.h&gt;
+#include &lt;gdk/gdkkeysyms.h&gt;
+#include &lt;stdlib.h&gt;
+#include &lt;string.h&gt;
+#include &lt;sys/types.h&gt;
+#include &lt;sys/stat.h&gt;
+#include &lt;unistd.h&gt;
+#include &lt;libxml/xpath.h&gt;
+
+#include &quot;viewer.h&quot;
+
+#define ITEM_PATH &quot;//keymap/item&quot;
+#define ROOT   &quot;keymap&quot;
+#define ITEM   &quot;item&quot;
+#define TYPE   &quot;type&quot;
+#define MENU   &quot;menu&quot;
+#define SEP    &quot;separator&quot;
+#define LABEL  &quot;label&quot;
+#define KEYS   &quot;keys&quot;
+#define KEY    &quot;key&quot;
+
+static int verbose = 0;
+
+static int create_keyCombos(SendKeyItems * sendKeyItems, xmlXPathContextPtr ctxt)
+{
+	xmlXPathObjectPtr obj;
+	xmlNodePtr relnode;
+	SendKeyItems old_sendKeyItems;
+
+	if (ctxt == NULL) {
+		fprintf(stderr,&quot;Invalid parser context to %s&quot;, __func__);
+		goto error;
+	}
+	relnode = ctxt-&gt;node;
+
+	/*
+	 * Determine number of items
+	 */
+	obj = xmlXPathEval((xmlChar *)ITEM_PATH, ctxt);
+	if ((obj == NULL) || (obj-&gt;type != XPATH_NODESET)) {
+		xmlXPathFreeObject(obj);
+		fprintf(stderr, &quot;Error obj NULL or type not a NODESET&quot;);
+		goto error;
+	}
+	old_sendKeyItems.keyCombos = sendKeyItems-&gt;keyCombos;
+	old_sendKeyItems.cnt = sendKeyItems-&gt;cnt;
+
+	sendKeyItems-&gt;cnt = xmlXPathNodeSetGetLength(obj-&gt;nodesetval);
+	if (sendKeyItems-&gt;cnt) {
+		sendKeyItems-&gt;keyCombos = calloc(sendKeyItems-&gt;cnt, sizeof(struct keyComboDef *));
+		if (!sendKeyItems-&gt;keyCombos) {
+			sendKeyItems-&gt;keyCombos = old_sendKeyItems.keyCombos;
+			sendKeyItems-&gt;cnt = old_sendKeyItems.cnt;
+		}
+		else if (old_sendKeyItems.keyCombos) {
+			int i;
+			for (i = 0; i &lt; old_sendKeyItems.cnt; i++) {
+				free(old_sendKeyItems.keyCombos[i]-&gt;keys);
+				free(old_sendKeyItems.keyCombos[i]-&gt;label);
+			}
+			free(old_sendKeyItems.keyCombos);
+		}
+	}
+	ctxt-&gt;node = relnode;
+	xmlXPathFreeObject(obj);
+error:
+	return(sendKeyItems-&gt;cnt);
+}
+
+static void build_keyComboDef(SendKeyItems *sendKeyItems, guint *keys, int  cnt, const char * label)
+{
+	int i;
+	struct keyComboDef *kp;
+
+	kp = (struct keyComboDef*)calloc(sizeof(guint *) + sizeof(guint) + sizeof(char *), 1);
+	if (!kp)
+		return;
+
+	if (keys) {
+		kp-&gt;keys = (guint *)malloc((sizeof(guint) * cnt) );
+		if (!kp-&gt;keys) {
+			free(kp);
+			return;
+		}
+		for(i=0; i&lt;cnt; i++) {
+			kp-&gt;keys[i] = keys[i];
+		}
+	}
+	if (label) {
+		kp-&gt;label = strdup(label);
+	}
+	else {
+		kp-&gt;label = strdup(&quot;Unknown&quot;);
+	}
+	kp-&gt;nkeys = cnt;
+
+	for (i = 0; i &lt; sendKeyItems-&gt;cnt; i++) {
+		if ( sendKeyItems-&gt;keyCombos[i] == NULL) {
+			sendKeyItems-&gt;keyCombos[i] = kp;
+			break;
+		}
+	}
+}
+
+static char *trim(char *str)
+{
+	char * p = str;
+
+	p += strlen(str);
+
+	/* trim trailing */
+	while(p != str) {
+		if (*p == '\n' || *p == '\t' || *p == ' ' || *p == '\0') {
+			*p = '\0';
+			p--;
+			continue;
+		}
+		break;
+	}
+	/* trim leading */
+	p = str;
+	while(p != '\0') {
+		if (*p == '\n' || *p == '\t' || *p == ' ') {
+			p++;
+			continue;
+		}
+		break;
+	}
+	if (p != str) {
+		memcpy(str, p, strlen(p) + 1);
+	}
+	return(str);
+}
+
+static void process_keys(SendKeyItems *sendKeyItems, xmlDocPtr xml, xmlXPathContextPtr ctxt,
+		xmlNode * node, char *label)
+{
+	xmlNode *n;
+	int cnt = 0;
+	int i = 0;
+	guint * keys;
+	xmlXPathObjectPtr obj;
+	char *str;
+
+	if (!node || !node-&gt;children) return;
+
+	/*
+	 * get number of keys
+	 */
+	for(n=node-&gt;children; n; n=n-&gt;next) {
+		if (n-&gt;type != XML_ELEMENT_NODE) continue;
+		cnt++;
+	}
+
+	if (cnt) {
+		keys = malloc(sizeof(guint) * cnt);
+		if (keys) {
+			for(i = 0, n=node-&gt;children; n; n=n-&gt;next) {
+				if (n-&gt;type != XML_ELEMENT_NODE) continue;
+				obj = xmlXPathEval(xmlGetNodePath(n), ctxt);
+				str = (char *)xmlNodeListGetString(xml, obj-&gt;nodesetval-&gt;nodeTab[0]-&gt;xmlChildrenNode, 1);
+				trim(str);
+				keys[i] = gdk_keyval_from_name(str);
+				if (keys[i] == 0) {
+					if (verbose) {
+						fprintf(stderr, &quot;virt-viewer: Could not get keyval for %s:%s, ignoring\n&quot;,
+							str, label);
+					}
+					free(keys);
+					sendKeyItems-&gt;cnt--;
+					return;
+				}
+				i++;
+			}
+			build_keyComboDef(sendKeyItems, keys, cnt, label);
+		}
+	}
+}
+
+static void process_item(SendKeyItems * sendKeyItems, xmlDocPtr xml,
+		xmlXPathContextPtr ctxt, xmlNode * node)
+{
+	xmlNode *n;
+	xmlXPathObjectPtr obj;
+	xmlChar *type;
+	char *label = NULL;
+
+	if (!node) return;
+
+	type = xmlGetProp(node, (xmlChar*)&quot;type&quot;);
+	if (!type) return;
+
+	if (xmlStrncmp((const xmlChar*)MENU, type, strlen(MENU)) == 0) {
+		for(n=node-&gt;children; n; n=n-&gt;next) {
+			if (n-&gt;type != XML_ELEMENT_NODE) continue;
+			if (xmlStrncmp((const xmlChar*)LABEL, n-&gt;name, strlen(LABEL)) == 0) {
+				obj = xmlXPathEval(xmlGetNodePath(n), ctxt);
+				if (!obj) return;
+				label = (char *)xmlNodeListGetString(xml, obj-&gt;nodesetval-&gt;nodeTab[0]-&gt;xmlChildrenNode, 1);
+			}
+			else if (xmlStrncmp((const xmlChar*)KEYS, n-&gt;name, strlen(KEYS)) == 0) {
+				process_keys(sendKeyItems, xml, ctxt, n, label);
+			}
+		}
+	}
+	else if (xmlStrncmp((const xmlChar*)SEP, type, strlen(SEP)) == 0) {
+		build_keyComboDef(sendKeyItems, NULL, 0, &quot;&quot;);
+	}
+}
+
+/*
+ * Default keymap when xml definition file can't be found
+ */
+#define MAX_KEYS 3
+struct  defaultKeyComboDef {
+	guint keys[MAX_KEYS];
+	guint nkeys;
+	const char *label;
+};
+static const struct defaultKeyComboDef defaultKeyCombos[] = {
+	{ { GDK_Control_L, GDK_Alt_L, GDK_Delete }, 3, &quot;Ctrl+Alt+_Del&quot;},
+	{ { GDK_Control_L, GDK_Alt_L, GDK_BackSpace }, 3, &quot;Ctrl+Alt+_Backspace&quot;},
+	{ {}, 0, &quot;&quot; },
+	{ { GDK_Control_L, GDK_Alt_L, GDK_F1 }, 3, &quot;Ctrl+Alt+F_1&quot;},
+	{ { GDK_Control_L, GDK_Alt_L, GDK_F2 }, 3, &quot;Ctrl+Alt+F_2&quot;},
+	{ { GDK_Control_L, GDK_Alt_L, GDK_F3 }, 3, &quot;Ctrl+Alt+F_3&quot;},
+	{ { GDK_Control_L, GDK_Alt_L, GDK_F4 }, 3, &quot;Ctrl+Alt+F_4&quot;},
+	{ { GDK_Control_L, GDK_Alt_L, GDK_F5 }, 3, &quot;Ctrl+Alt+F_5&quot;},
+	{ { GDK_Control_L, GDK_Alt_L, GDK_F6 }, 3, &quot;Ctrl+Alt+F_6&quot;},
+	{ { GDK_Control_L, GDK_Alt_L, GDK_F7 }, 3, &quot;Ctrl+Alt+F_7&quot;},
+	{ { GDK_Control_L, GDK_Alt_L, GDK_F8 }, 3, &quot;Ctrl+Alt+F_8&quot;},
+	{ { GDK_Control_L, GDK_Alt_L, GDK_F9 }, 3, &quot;Ctrl+Alt+F_9&quot;},
+	{ { GDK_Control_L, GDK_Alt_L, GDK_F10 }, 3, &quot;Ctrl+Alt+F1_0&quot;},
+	{ { GDK_Control_L, GDK_Alt_L, GDK_F11 }, 3, &quot;Ctrl+Alt+F11&quot;},
+	{ { GDK_Control_L, GDK_Alt_L, GDK_F12 }, 3, &quot;Ctrl+Alt+F12&quot;},
+	{ {}, 0, &quot;&quot; },
+	{ { GDK_Print }, 1, &quot;_PrintScreen&quot;},
+};
+
+static void makeDefaultKeyCombos(SendKeyItems * sendKeyItems)
+{
+	int i;
+	guint *keys;
+
+	sendKeyItems-&gt;cnt = (sizeof(defaultKeyCombos)/sizeof(defaultKeyCombos[0]));
+	sendKeyItems-&gt;keyCombos = calloc(sendKeyItems-&gt;cnt, sizeof(struct keyComboDef *));
+	if (!sendKeyItems-&gt;keyCombos) {
+		sendKeyItems-&gt;cnt = 0;
+		return;
+	}
+
+	for (i = 0 ; i &lt; (sizeof(defaultKeyCombos)/sizeof(defaultKeyCombos[0])) ; i++) {
+		keys = (guint *)defaultKeyCombos[i].keys;
+		build_keyComboDef(sendKeyItems, keys, defaultKeyCombos[i].nkeys, defaultKeyCombos[i].label);
+	}
+}
+
+
+int build_keyCombos(SendKeyItems * sendKeyItems, const char *filename, int set_verbose)
+{
+	xmlDocPtr xml = NULL;
+	xmlParserCtxtPtr pctxt = NULL;
+	xmlXPathContextPtr ctxt = NULL;
+	xmlNode *root_element = NULL;
+	xmlNode *node;
+	struct stat sbuf;
+
+	verbose = set_verbose;
+	pctxt = xmlNewParserCtxt();
+	if (!pctxt || !pctxt-&gt;sax)
+		goto error;
+
+	if (filename == NULL)
+		filename = g_strdup_printf(&quot;%s/default.xml&quot;, KEYMAPS_DIR);
+
+	if(stat(filename, &amp;sbuf) != 0) {
+		if (verbose)
+			fprintf(stderr, &quot;%s(): could not stat file:%s \n&quot;, __FUNCTION__, filename);
+		goto error;
+	}
+
+	xml = xmlCtxtReadFile(pctxt, filename, NULL,
+			     XML_PARSE_NOENT | XML_PARSE_NONET |
+			     XML_PARSE_NOWARNING);
+	if (!xml) {
+		if (verbose)
+			fprintf(stderr, &quot;%s(): could not read file:%s \n&quot;, __FUNCTION__, filename);
+		goto error;
+	}
+
+	ctxt = xmlXPathNewContext(xml);
+	if (!ctxt)
+		goto error;
+
+	root_element = xmlDocGetRootElement(xml);
+	if (!root_element) {
+		if (verbose)
+			fprintf(stderr, &quot;%s(): could not locate root element\n&quot;, __FUNCTION__);
+		goto error;
+	}
+
+	if (!create_keyCombos(sendKeyItems, ctxt)) {
+		if (verbose)
+			fprintf(stderr, &quot;%s(): could not create XML based keyCombos structure \n&quot;, __FUNCTION__);
+		goto error;
+	}
+
+	for (node=root_element; node; node=node-&gt;next) {
+		if (node-&gt;type != XML_ELEMENT_NODE) continue;
+		if (node-&gt;children)
+		{
+			xmlNode *n;
+			for(n=node-&gt;children; n; n=n-&gt;next) {
+				if (n-&gt;type != XML_ELEMENT_NODE) continue;
+				if (xmlStrncmp((const xmlChar*)ITEM, n-&gt;name, strlen(ITEM)) == 0) {
+					process_item(sendKeyItems, xml, ctxt, n);
+				}
+			}
+		}
+	}
+
+ error:
+	if (ctxt)
+		xmlXPathFreeContext(ctxt);
+	if (xml)
+		xmlFreeDoc(xml);
+	if (pctxt)
+		xmlFreeParserCtxt(pctxt);
+	if (sendKeyItems-&gt;keyCombos == NULL)
+		makeDefaultKeyCombos(sendKeyItems);
+	return(sendKeyItems-&gt;cnt);
+}
+
+int sendkey_xml_validate(const char * filename)
+{
+	xmlDocPtr doc = NULL;
+	xmlParserCtxtPtr pctxt = NULL;
+	xmlXPathContextPtr ctxt = NULL;
+	xmlNode *root_element = NULL;
+	int ret = -1;
+
+	pctxt = xmlNewParserCtxt();
+	if (!pctxt || !pctxt-&gt;sax) {
+		if (verbose)
+			fprintf(stderr, &quot;%s(): failed to allocate parser context \n&quot;, __FUNCTION__);
+		goto error;
+	}
+
+	doc = xmlCtxtReadFile(pctxt, filename, NULL, XML_PARSE_DTDVALID);
+	if (!doc) {
+		if (verbose)
+			fprintf(stderr, &quot;%s(): could not read file:%s \n&quot;, __FUNCTION__, filename);
+		goto error;
+	}
+	if (pctxt-&gt;valid == 0) {
+		if (verbose)
+			fprintf(stderr, &quot;%s(): Failed to validate :%s \n&quot;, __FUNCTION__, filename);
+		goto error;
+	}
+
+	ctxt = xmlXPathNewContext(doc);
+	if (!ctxt) {
+		if (verbose)
+			fprintf(stderr, &quot;%s(): Failed to allocate path context\n&quot;, __FUNCTION__);
+		goto error;
+	}
+
+	root_element = xmlDocGetRootElement(doc);
+	if (!root_element) {
+		if (verbose)
+			fprintf(stderr, &quot;%s(): could not locate root element\n&quot;, __FUNCTION__);
+		goto error;
+	}
+
+	if (xmlStrncmp((const xmlChar*)ROOT, root_element-&gt;name, strlen(ROOT)) != 0) {
+		if (verbose)
+			fprintf(stderr, &quot;%s(): Incorrect root element name:%s\n&quot;, __FUNCTION__,
+					root_element-&gt;name);
+		goto error;
+	}
+	ret = 0;
+
+error:
+	if (ctxt)
+		xmlXPathFreeContext(ctxt);
+	if (doc)
+		xmlFreeDoc(doc);
+	if (pctxt)
+		xmlFreeParserCtxt(pctxt);
+	return(ret);
+
+}
diff -r 92da1556bbf9 src/viewer.glade
--- a/src/viewer.glade	Fri Nov 28 07:24:56 2008 -0500
+++ b/src/viewer.glade	Tue Dec 16 13:34:01 2008 -0700
@@ -25,6 +25,14 @@
                         &lt;property name=&quot;label&quot; translatable=&quot;yes&quot;&gt;Screenshot&lt;/property&gt;
                         &lt;property name=&quot;use_underline&quot;&gt;True&lt;/property&gt;
                         &lt;signal name=&quot;activate&quot; handler=&quot;viewer_menu_file_screenshot&quot;/&gt;
+                      &lt;/widget&gt;
+                    &lt;/child&gt;
+                    &lt;child&gt;
+                      &lt;widget class=&quot;GtkMenuItem&quot; id=&quot;menu-file-sendkey&quot;&gt;
+                        &lt;property name=&quot;visible&quot;&gt;True&lt;/property&gt;
+                        &lt;property name=&quot;label&quot; translatable=&quot;yes&quot;&gt;Send key&lt;/property&gt;
+                        &lt;property name=&quot;use_underline&quot;&gt;True&lt;/property&gt;
+                        &lt;signal name=&quot;activate&quot; handler=&quot;viewer_menu_file_sendkey&quot;/&gt;
                       &lt;/widget&gt;
                     &lt;/child&gt;
                     &lt;child&gt;
@@ -78,141 +86,6 @@
                 &lt;property name=&quot;visible&quot;&gt;True&lt;/property&gt;
                 &lt;property name=&quot;label&quot; translatable=&quot;yes&quot;&gt;_Send key&lt;/property&gt;
                 &lt;property name=&quot;use_underline&quot;&gt;True&lt;/property&gt;
-                &lt;child&gt;
-                  &lt;widget class=&quot;GtkMenu&quot; id=&quot;menu5&quot;&gt;
-                    &lt;property name=&quot;visible&quot;&gt;True&lt;/property&gt;
-                    &lt;child&gt;
-                      &lt;widget class=&quot;GtkMenuItem&quot; id=&quot;menu-send-cad&quot;&gt;
-                        &lt;property name=&quot;visible&quot;&gt;True&lt;/property&gt;
-                        &lt;property name=&quot;label&quot; translatable=&quot;yes&quot;&gt;Ctrl+Alt+_Del&lt;/property&gt;
-                        &lt;property name=&quot;use_underline&quot;&gt;True&lt;/property&gt;
-                        &lt;signal name=&quot;activate&quot; handler=&quot;viewer_menu_send&quot; object=&quot;cad&quot;/&gt;
-                      &lt;/widget&gt;
-                    &lt;/child&gt;
-                    &lt;child&gt;
-                      &lt;widget class=&quot;GtkMenuItem&quot; id=&quot;menu-send-cab&quot;&gt;
-                        &lt;property name=&quot;visible&quot;&gt;True&lt;/property&gt;
-                        &lt;property name=&quot;label&quot; translatable=&quot;yes&quot;&gt;Ctrl+Alt+_Backspace&lt;/property&gt;
-                        &lt;property name=&quot;use_underline&quot;&gt;True&lt;/property&gt;
-                        &lt;signal name=&quot;activate&quot; handler=&quot;viewer_menu_send&quot; object=&quot;cab&quot;/&gt;
-                      &lt;/widget&gt;
-                    &lt;/child&gt;
-                    &lt;child&gt;
-                      &lt;widget class=&quot;GtkSeparatorMenuItem&quot; id=&quot;separatormenuitem2&quot;&gt;
-                        &lt;property name=&quot;visible&quot;&gt;True&lt;/property&gt;
-                      &lt;/widget&gt;
-                    &lt;/child&gt;
-                    &lt;child&gt;
-                      &lt;widget class=&quot;GtkMenuItem&quot; id=&quot;menu-send-caf1&quot;&gt;
-                        &lt;property name=&quot;visible&quot;&gt;True&lt;/property&gt;
-                        &lt;property name=&quot;label&quot; translatable=&quot;yes&quot;&gt;Ctrl+Alt+F_1&lt;/property&gt;
-                        &lt;property name=&quot;use_underline&quot;&gt;True&lt;/property&gt;
-                        &lt;signal name=&quot;activate&quot; handler=&quot;viewer_menu_send&quot; object=&quot;caf1&quot;/&gt;
-                      &lt;/widget&gt;
-                    &lt;/child&gt;
-                    &lt;child&gt;
-                      &lt;widget class=&quot;GtkMenuItem&quot; id=&quot;menu-send-caf2&quot;&gt;
-                        &lt;property name=&quot;visible&quot;&gt;True&lt;/property&gt;
-                        &lt;property name=&quot;label&quot; translatable=&quot;yes&quot;&gt;Ctrl+Alt+F_2&lt;/property&gt;
-                        &lt;property name=&quot;use_underline&quot;&gt;True&lt;/property&gt;
-                        &lt;signal name=&quot;activate&quot; handler=&quot;viewer_menu_send&quot; object=&quot;caf2&quot;/&gt;
-                      &lt;/widget&gt;
-                    &lt;/child&gt;
-                    &lt;child&gt;
-                      &lt;widget class=&quot;GtkMenuItem&quot; id=&quot;menu-send-caf3&quot;&gt;
-                        &lt;property name=&quot;visible&quot;&gt;True&lt;/property&gt;
-                        &lt;property name=&quot;label&quot; translatable=&quot;yes&quot;&gt;Ctrl+Alt+F_3&lt;/property&gt;
-                        &lt;property name=&quot;use_underline&quot;&gt;True&lt;/property&gt;
-                        &lt;signal name=&quot;activate&quot; handler=&quot;viewer_menu_send&quot; object=&quot;caf3&quot;/&gt;
-                      &lt;/widget&gt;
-                    &lt;/child&gt;
-                    &lt;child&gt;
-                      &lt;widget class=&quot;GtkMenuItem&quot; id=&quot;menu-send-caf4&quot;&gt;
-                        &lt;property name=&quot;visible&quot;&gt;True&lt;/property&gt;
-                        &lt;property name=&quot;label&quot; translatable=&quot;yes&quot;&gt;Ctrl+Alt+F_4&lt;/property&gt;
-                        &lt;property name=&quot;use_underline&quot;&gt;True&lt;/property&gt;
-                        &lt;signal name=&quot;activate&quot; handler=&quot;viewer_menu_send&quot; object=&quot;caf4&quot;/&gt;
-                      &lt;/widget&gt;
-                    &lt;/child&gt;
-                    &lt;child&gt;
-                      &lt;widget class=&quot;GtkMenuItem&quot; id=&quot;menu-send-caf5&quot;&gt;
-                        &lt;property name=&quot;visible&quot;&gt;True&lt;/property&gt;
-                        &lt;property name=&quot;label&quot; translatable=&quot;yes&quot;&gt;Ctrl+Alt+F_5&lt;/property&gt;
-                        &lt;property name=&quot;use_underline&quot;&gt;True&lt;/property&gt;
-                        &lt;signal name=&quot;activate&quot; handler=&quot;viewer_menu_send&quot; object=&quot;caf5&quot;/&gt;
-                      &lt;/widget&gt;
-                    &lt;/child&gt;
-                    &lt;child&gt;
-                      &lt;widget class=&quot;GtkMenuItem&quot; id=&quot;menu-send-caf6&quot;&gt;
-                        &lt;property name=&quot;visible&quot;&gt;True&lt;/property&gt;
-                        &lt;property name=&quot;label&quot; translatable=&quot;yes&quot;&gt;Ctrl+Alt+F_6&lt;/property&gt;
-                        &lt;property name=&quot;use_underline&quot;&gt;True&lt;/property&gt;
-                        &lt;signal name=&quot;activate&quot; handler=&quot;viewer_menu_send&quot;/&gt;
-                      &lt;/widget&gt;
-                    &lt;/child&gt;
-                    &lt;child&gt;
-                      &lt;widget class=&quot;GtkMenuItem&quot; id=&quot;menu-send-caf7&quot;&gt;
-                        &lt;property name=&quot;visible&quot;&gt;True&lt;/property&gt;
-                        &lt;property name=&quot;label&quot; translatable=&quot;yes&quot;&gt;Ctrl+Alt+F_7&lt;/property&gt;
-                        &lt;property name=&quot;use_underline&quot;&gt;True&lt;/property&gt;
-                        &lt;signal name=&quot;activate&quot; handler=&quot;viewer_menu_send&quot; object=&quot;caf7&quot;/&gt;
-                      &lt;/widget&gt;
-                    &lt;/child&gt;
-                    &lt;child&gt;
-                      &lt;widget class=&quot;GtkMenuItem&quot; id=&quot;menu-send-caf8&quot;&gt;
-                        &lt;property name=&quot;visible&quot;&gt;True&lt;/property&gt;
-                        &lt;property name=&quot;label&quot; translatable=&quot;yes&quot;&gt;Ctrl+Alt+F_8&lt;/property&gt;
-                        &lt;property name=&quot;use_underline&quot;&gt;True&lt;/property&gt;
-                        &lt;signal name=&quot;activate&quot; handler=&quot;viewer_menu_send&quot; object=&quot;caf8&quot;/&gt;
-                      &lt;/widget&gt;
-                    &lt;/child&gt;
-                    &lt;child&gt;
-                      &lt;widget class=&quot;GtkMenuItem&quot; id=&quot;menu-send-caf9&quot;&gt;
-                        &lt;property name=&quot;visible&quot;&gt;True&lt;/property&gt;
-                        &lt;property name=&quot;label&quot; translatable=&quot;yes&quot;&gt;Ctrl+Alt+F_9&lt;/property&gt;
-                        &lt;property name=&quot;use_underline&quot;&gt;True&lt;/property&gt;
-                        &lt;signal name=&quot;activate&quot; handler=&quot;viewer_menu_send&quot; object=&quot;caf9&quot;/&gt;
-                      &lt;/widget&gt;
-                    &lt;/child&gt;
-                    &lt;child&gt;
-                      &lt;widget class=&quot;GtkMenuItem&quot; id=&quot;menu-send-caf10&quot;&gt;
-                        &lt;property name=&quot;visible&quot;&gt;True&lt;/property&gt;
-                        &lt;property name=&quot;label&quot; translatable=&quot;yes&quot;&gt;Ctrl+Alt+F1_0&lt;/property&gt;
-                        &lt;property name=&quot;use_underline&quot;&gt;True&lt;/property&gt;
-                        &lt;signal name=&quot;activate&quot; handler=&quot;viewer_menu_send&quot; object=&quot;caf10&quot;/&gt;
-                      &lt;/widget&gt;
-                    &lt;/child&gt;
-                    &lt;child&gt;
-                      &lt;widget class=&quot;GtkMenuItem&quot; id=&quot;menu-send-caf11&quot;&gt;
-                        &lt;property name=&quot;visible&quot;&gt;True&lt;/property&gt;
-                        &lt;property name=&quot;label&quot; translatable=&quot;yes&quot;&gt;Ctrl+Alt+F11&lt;/property&gt;
-                        &lt;property name=&quot;use_underline&quot;&gt;True&lt;/property&gt;
-                        &lt;signal name=&quot;activate&quot; handler=&quot;viewer_menu_send&quot; object=&quot;caf11&quot;/&gt;
-                      &lt;/widget&gt;
-                    &lt;/child&gt;
-                    &lt;child&gt;
-                      &lt;widget class=&quot;GtkMenuItem&quot; id=&quot;menu-send-caf12&quot;&gt;
-                        &lt;property name=&quot;visible&quot;&gt;True&lt;/property&gt;
-                        &lt;property name=&quot;label&quot; translatable=&quot;yes&quot;&gt;Ctrl+Alt+F12&lt;/property&gt;
-                        &lt;property name=&quot;use_underline&quot;&gt;True&lt;/property&gt;
-                        &lt;signal name=&quot;activate&quot; handler=&quot;viewer_menu_send&quot; object=&quot;caf12&quot;/&gt;
-                      &lt;/widget&gt;
-                    &lt;/child&gt;
-                    &lt;child&gt;
-                      &lt;widget class=&quot;GtkSeparatorMenuItem&quot; id=&quot;separatormenuitem3&quot;&gt;
-                        &lt;property name=&quot;visible&quot;&gt;True&lt;/property&gt;
-                      &lt;/widget&gt;
-                    &lt;/child&gt;
-                    &lt;child&gt;
-                      &lt;widget class=&quot;GtkMenuItem&quot; id=&quot;menu-send-print&quot;&gt;
-                        &lt;property name=&quot;visible&quot;&gt;True&lt;/property&gt;
-                        &lt;property name=&quot;label&quot; translatable=&quot;yes&quot;&gt;_PrintScreen&lt;/property&gt;
-                        &lt;property name=&quot;use_underline&quot;&gt;True&lt;/property&gt;
-                        &lt;signal name=&quot;activate&quot; handler=&quot;viewer_menu_send&quot; object=&quot;printscreen&quot;/&gt;
-                      &lt;/widget&gt;
-                    &lt;/child&gt;
-                  &lt;/widget&gt;
-                &lt;/child&gt;
               &lt;/widget&gt;
             &lt;/child&gt;
             &lt;child&gt;
diff -r 92da1556bbf9 src/viewer.h
--- a/src/viewer.h	Fri Nov 28 07:24:56 2008 -0500
+++ b/src/viewer.h	Tue Dec 16 13:34:01 2008 -0700
@@ -29,6 +29,21 @@
 			 gboolean waitvm,
 			 gboolean reconnect,
 			 gboolean verbose,
+			 const char *keymapfile,
 			 GtkWidget *container);
 
+typedef struct  keyComboDef {
+	guint *keys;
+	guint nkeys;
+	char *label;
+}KeyComboDef;
+
+typedef struct sendKeyItems {
+	int cnt;
+	struct keyComboDef **keyCombos;
+}SendKeyItems;
+
+int build_keyCombos(SendKeyItems *, const char *, int);
+int sendkey_xml_validate(const char * filename);
+
 #endif /* VIEWER_H */
diff -r 92da1556bbf9 virt-viewer.spec.in
--- a/virt-viewer.spec.in	Fri Nov 28 07:24:56 2008 -0500
+++ b/virt-viewer.spec.in	Tue Dec 16 13:34:01 2008 -0700
@@ -81,6 +81,7 @@
 %{_datadir}/%{name}/ui/auth.glade
 %{_datadir}/%{name}/ui/about.glade
 %{_datadir}/%{name}/ui/viewer.glade
+%{_datadir}/%{name}/keymaps/default.xml
 %{_mandir}/man1/%{name}*
 
 %if %{_with_plugin}
</pre><pre>_______________________________________________
et-mgmt-tools mailing list
et-mgmt-tools@xxxxxxxxxx
<a  rel="nofollow" href="https://www.redhat.com/mailman/listinfo/et-mgmt-tools">https://www.redhat.com/mailman/listinfo/et-mgmt-tools</a></pre>
<!--X-Body-of-Message-End-->
<!--X-MsgBody-End-->
<!--X-Follow-Ups-->
</div>
<hr>
<ul><li><strong>Follow-Ups</strong>:
<ul>
<li><strong><a name="04536" href="msg04536.html">Re: [PATCH]:virt-viewer: Load &quot;Send key&quot; menu from XML	file</a></strong>
<ul><li><em>From:</em> Daniel P. Berrange</li></ul></li>
</ul></li></ul>
<!--X-Follow-Ups-End-->
<!--X-References-->
<!--X-References-End-->
<!--X-BotPNI-->
<ul>
<li>Prev by Date:
<strong><a href="msg04533.html">Re:  virtual network devices</a></strong>
</li>
<li>Next by Date:
<strong><a href="msg04536.html">Re: [PATCH]:virt-viewer: Load &quot;Send key&quot; menu from XML	file</a></strong>
</li>
<li>Previous by thread:
<strong><a href="msg04530.html">virtual network devices</a></strong>
</li>
<li>Next by thread:
<strong><a href="msg04536.html">Re: [PATCH]:virt-viewer: Load &quot;Send key&quot; menu from XML	file</a></strong>
</li>
<li>Index(es):
<ul>
<li><a href="maillist.html#04535"><strong>Date</strong></a></li>
<li><a href="index.html#04535"><strong>Thread</strong></a></li>
</ul>
</li>
</ul>

<!--X-BotPNI-End-->
<!--X-User-Footer-->
<center>
<font size=-1>
<a href=/lists/>[Index&nbsp;of&nbsp;Archives]</a>
&nbsp;
&nbsp;
<a href=/linux/fedora/fedora-users/>[Fedora&nbsp;Users]</a>
&nbsp;
&nbsp;
<a href=/lists/fll/>[Fedora&nbsp;Legacy&nbsp;List]</a>
&nbsp;
&nbsp;
<a href=/linux/fedora/fedora-maintainers/>[Fedora&nbsp;Maintainers]</a>
&nbsp;
&nbsp;
<a href=/lists/fedora-desktop/>[Fedora&nbsp;Desktop]</a>
&nbsp;
&nbsp;
<a href=/lists/fedora-selinux/>[Fedora&nbsp;SELinux]</a>
&nbsp;
&nbsp;
<a href=http://www.ske-art.com/z/biglist.html>[Big&nbsp;List&nbsp;of&nbsp;Linux&nbsp;Books]</a>
&nbsp;
&nbsp;
<a href=https://yosemitenews.info>[Yosemite&nbsp;News]</a>
&nbsp;
&nbsp;
<a href=/lists/kde/>[KDE&nbsp;Users]</a>
&nbsp;
&nbsp;
<a href=/lists/fedora-tools/>[Fedora&nbsp;Tools]</a>
</font>
</center>
<hr>
<p>
<div>
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<ins class="adsbygoogle"
     style="display:block"
     data-ad-format="autorelaxed"
     data-ad-client="ca-pub-3422782820843221"
     data-ad-slot="1424524564"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
</div>
<table width=100%>
<tr>
<td align=left>&nbsp;</td>
<td align=right><a href=/lists/><img src=/button_01.gif border=0 alt="Powered by Linux"></a></td>
</tr>
</table>
<!--X-User-Footer-End-->
<script type="text/javascript"> 
 function initAddThis() {
    addthis.init()
 }
initAddThis();
</script>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-760190-1', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
