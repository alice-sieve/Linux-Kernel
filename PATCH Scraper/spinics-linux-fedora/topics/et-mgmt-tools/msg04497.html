<!-- MHonArc v2.6.19 -->
<!--X-Subject: Re:  [PATCH] Port utility functions to Solaris -->
<!--X-From-R13: Qbyr Dbovafba &#60;pebovafbNerqung.pbz> -->
<!--X-Date: Mon, 8 Dec 2008 18:21:58 &#45;0800 -->
<!--X-Message-Id: 493DD5E7.20207@redhat.com -->
<!--X-Content-Type: text/plain -->
<!--X-Reference: 271ceb01335da50c05fe.1228484289@xenbld.SFBay.Sun.COM -->
<!--X-Head-End-->
<!doctype html public "-//W3C//DTD HTML//EN">
<html>
<head>
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({
          google_ad_client: "ca-pub-3422782820843221",
          enable_page_level_ads: true
     });
</script>
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="description" content="Fedora Management Tools, Re:  [PATCH] Port utility functions to Solaris">
<style>
<!--
 pre {white-space: pre-wrap;}
-->
</style>
<link rel="alternate" type="application/rss+xml" title="Fedora Management Tools" href="//feedproxy.google.com/Fedora/linuxManagementTools">
<title>Fedora Management Tools -- Re:  [PATCH] Port utility functions to Solaris</title>
</head>
<body vlink=green>
<!--X-Body-Begin-->
<!--X-User-Header-->
<!--X-User-Header-End-->
<!--X-TopPNI-->
<form action="//www.google.com" id="cse-search-box" target="_blank">
  <div>
    <input type="hidden" name="cx" value="partner-pub-3422782820843221:9580497365" />
    <input type="hidden" name="ie" value="UTF-8" />
    <input type="text" name="q" size="25" />
    <input type="submit" name="sa" value="Search" />
  </div>
</form>
<script type="text/javascript" src="//www.google.com/coop/cse/brand?form=cse-search-box&amp;lang=en"></script>
<h1 itemprop="name">Re:  [PATCH] Port utility functions to Solaris</h1>
[<a href="msg04496.html">Date Prev</a>][<a href="msg04498.html">Date Next</a>][<a href="msg04480.html">Thread Prev</a>][<a href="msg04505.html">Thread Next</a>][<a href="maillist.html#04497">Date Index</a>][<a href="index.html#04497">Thread Index</a>]


<p>&nbsp;<br>
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- responsive test for archives -->
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-3422782820843221"
     data-ad-slot="6345952567"
     data-ad-format="auto"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>

<!--X-TopPNI-End-->
<!--X-MsgBody-->
<!--X-Subject-Header-Begin-->
<hr>
<!--X-Subject-Header-End-->
<!--X-Head-of-Message-->
<ul>
<li><em>Subject</em>: Re:  [PATCH] Port utility functions to Solaris</li>
<li><em>From</em>: Cole Robinson &lt;<a href="mailto:crobinso@DOMAIN.HIDDEN">crobinso@xxxxxxxxxx</a>&gt;</li>
<li><em>Date</em>: Mon, 08 Dec 2008 21:20:23 -0500</li>
<li><em>Cc</em>: <a href="mailto:john.levon@DOMAIN.HIDDEN">john.levon@xxxxxxx</a></li>
<li><em>In-reply-to</em>: &lt;<a href="mailto:271ceb01335da50c05fe.1228484289@DOMAIN.HIDDEN">271ceb01335da50c05fe.1228484289@xxxxxxxxxxxxxxxxxxxx</a>&gt;</li>
<li><em>References</em>: &lt;<a href="mailto:271ceb01335da50c05fe.1228484289@DOMAIN.HIDDEN">271ceb01335da50c05fe.1228484289@xxxxxxxxxxxxxxxxxxxx</a>&gt;</li>
<li><em>Reply-to</em>: Fedora/Linux Management Tools &lt;<a href="mailto:et-mgmt-tools@DOMAIN.HIDDEN">et-mgmt-tools@xxxxxxxxxx</a>&gt;</li>
<li><em>User-agent</em>: Thunderbird 2.0.0.18 (X11/20081119)</li>
</ul>
<!--X-Head-of-Message-End-->
<!--X-Head-Body-Sep-Begin-->
<!-- AddThis Button BEGIN -->
<div class="addthis_toolbox addthis_default_style ">
<a class="addthis_button_preferred_1"></a>
<a class="addthis_button_preferred_2"></a>
<a class="addthis_button_preferred_3"></a>
<a class="addthis_button_preferred_4"></a>
<a class="addthis_button_compact"></a>
<a class="addthis_counter addthis_bubble_style"></a>
</div>
<script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5196c2ae1be43d18&async=1&domready=1" async></script>
<!-- AddThis Button END -->
<hr>
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- responsive link 1 -->
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-3422782820843221"
     data-ad-slot="8681825769"
     data-ad-format="link"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
<p>
<div class="content" itemprop="articleBody">
<!--X-Head-Body-Sep-End-->
<!--X-Body-of-Message-->
<pre>john.levon@xxxxxxx wrote:
&gt; # HG changeset patch
&gt; # User john.levon@xxxxxxx
&gt; # Date 1228484283 28800
&gt; # Node ID 271ceb01335da50c05fe6c2f54f3eb1721f51bb4
&gt; # Parent  8ad095a908ad89a0c83c94bd486647b79817acbe
&gt; Port utility functions to Solaris
&gt;
&gt; Port various utils to Solaris, and remove some unused ones that don't
&gt; work.
&gt;
&gt; Signed-off-by: John Levon &lt;john.levon@xxxxxxx&gt;
&gt;
&gt;   

Unfortunately, 'util' is part of the public API, so removing dead
functions isn't a good idea. Granted, we probably have a grand total
of 3 API users (virt cli tools, virt-manager, koan), but I think it's
better to just play by the rules. I'm certainly not opposed to moving
those functions away from the still relevant code and clearly labeling
them as deprecated.

It might be a good idea to make an internal util file, so we have an
alternate place to dump utility methods without them automatically
entering the public API.

&gt; diff --git a/virtinst/FullVirtGuest.py b/virtinst/FullVirtGuest.py
&gt; --- a/virtinst/FullVirtGuest.py
&gt; +++ b/virtinst/FullVirtGuest.py
&gt; @@ -38,7 +38,8 @@ class FullVirtGuest(Guest):
&gt;              installer = DistroManager.DistroInstaller(type = type, os_type = &quot;hvm&quot;)
&gt;          Guest.__init__(self, type, connection, hypervisorURI, installer)
&gt;          self.disknode = &quot;hd&quot;
&gt; -        self.features = { &quot;acpi&quot;: None, &quot;pae&quot;: util.is_pae_capable(), &quot;apic&quot;: None }
&gt; +        self.features = { &quot;acpi&quot;: None, &quot;pae&quot;:
&gt; +            util.is_pae_capable(connection), &quot;apic&quot;: None }
&gt;          if arch is None:
&gt;              arch = platform.machine()
&gt;          self.arch = arch
&gt; diff --git a/virtinst/util.py b/virtinst/util.py
&gt; --- a/virtinst/util.py
&gt; +++ b/virtinst/util.py
&gt; @@ -25,6 +25,7 @@ import re
&gt;  import re
&gt;  import libxml2
&gt;  import logging
&gt; +import popen2
&gt;  from sys import stderr
&gt;  
&gt;  import libvirt
&gt; @@ -54,8 +55,29 @@ def default_route():
&gt;              continue
&gt;      return None
&gt;  
&gt; -# Legacy for compat only.
&gt; +def default_nic():
&gt; +    &quot;&quot;&quot;Return the default NIC to use, if one is specified.&quot;&quot;&quot;
&gt; +
&gt;   

Since this seems only be used for the public default_bridge
function, this is a candidate for an internal util file.

&gt; +    dev = ''
&gt; +
&gt; +    if platform.system() != 'SunOS':
&gt; +        return dev
&gt; +
&gt; +    # XXX: fails without PRIV_XVM_CONTROL
&gt; +    proc = popen2.Popen3([&quot;/usr/lib/xen/bin/xenstore-read&quot;,
&gt; +        &quot;device-misc/vif/default-nic&quot;], capturestderr=True)
&gt;   

The 'subprocess' module is intended to replace popen2. We aren't
really using it in the codebase yet, but it's worth mentioning.
Certainly not a deal breaker.

&gt; +    proc.tochild.close()
&gt; +    proc.wait()
&gt; +    out = proc.fromchild.readlines()
&gt; +    if len(out) &gt; 0:
&gt; +        dev = out[0].rstrip()
&gt; +
&gt; +    return dev
&gt; +
&gt;  def default_bridge():
&gt; +    if platform.system() == 'SunOS':
&gt; +        return default_nic()
&gt; +
&gt;      rt = default_route()
&gt;      if rt is None:
&gt;          defn = None
&gt; @@ -68,6 +90,9 @@ def default_bridge():
&gt;          return &quot;xenbr%d&quot;%(defn)
&gt;  
&gt;  def default_network(conn):
&gt; +    if platform.system() == 'SunOS':
&gt; +        return [&quot;bridge&quot;, default_nic()]
&gt; +
&gt;      dev = default_route()
&gt;  
&gt;      if dev is not None and not is_uri_remote(conn.getURI()):
&gt; @@ -98,6 +123,9 @@ def default_connection():
&gt;      return None
&gt;  
&gt;  def get_cpu_flags():
&gt; +    if platform.system() == 'SunOS':
&gt; +        raise OSError(&quot;CPU flags not available&quot;)
&gt; +
&gt;      f = open(&quot;/proc/cpuinfo&quot;)
&gt;      lines = f.readlines()
&gt;      f.close()
&gt; @@ -111,31 +139,16 @@ def get_cpu_flags():
&gt;          return flst
&gt;      return []
&gt;  
&gt; -def is_pae_capable():
&gt; +def is_pae_capable(conn):
&gt;   

If altering the command list here, please make conn optional
to maintain back compat.

&gt;      &quot;&quot;&quot;Determine if a machine is PAE capable or not.&quot;&quot;&quot;
&gt; -    flags = get_cpu_flags()
&gt; -    if &quot;pae&quot; in flags:
&gt; -        return True
&gt; -    return False
&gt; -
&gt; -def is_hvm_capable():
&gt; -    &quot;&quot;&quot;Determine if a machine is HVM capable or not.&quot;&quot;&quot;
&gt; -
&gt; -    caps = &quot;&quot;
&gt; -    if os.path.exists(&quot;/sys/hypervisor/properties/capabilities&quot;):
&gt; -        caps = open(&quot;/sys/hypervisor/properties/capabilities&quot;).read()
&gt; -    if caps.find(&quot;hvm&quot;) != -1:
&gt; -        return True
&gt; -    return False
&gt; -
&gt; -def is_kqemu_capable():
&gt; -    return os.path.exists(&quot;/dev/kqemu&quot;)
&gt; -
&gt; -def is_kvm_capable():
&gt; -    return os.path.exists(&quot;/dev/kvm&quot;)
&gt; +    if not conn:
&gt; +        conn = libvirt.open('')
&gt; +    return &quot;pae&quot; in conn.getCapabilities()
&gt;  
&gt;  def is_blktap_capable():
&gt; -    #return os.path.exists(&quot;/dev/xen/blktapctrl&quot;)
&gt; +    if platform.system() == 'SunOS':
&gt; +        return False
&gt; +
&gt;      f = open(&quot;/proc/modules&quot;)
&gt;      lines = f.readlines()
&gt;      f.close()
&gt;
&gt;   

Thanks,
Cole

_______________________________________________
et-mgmt-tools mailing list
et-mgmt-tools@xxxxxxxxxx
<a  rel="nofollow" href="https://www.redhat.com/mailman/listinfo/et-mgmt-tools">https://www.redhat.com/mailman/listinfo/et-mgmt-tools</a>
</pre>
<!--X-Body-of-Message-End-->
<!--X-MsgBody-End-->
<!--X-Follow-Ups-->
</div>
<hr>
<ul><li><strong>Follow-Ups</strong>:
<ul>
<li><strong><a name="04505" href="msg04505.html">Re:  [PATCH] Port utility functions to Solaris</a></strong>
<ul><li><em>From:</em> John Levon</li></ul></li>
</ul></li></ul>
<!--X-Follow-Ups-End-->
<!--X-References-->
<ul><li><strong>References</strong>:
<ul>
<li><strong><a name="04480" href="msg04480.html">[PATCH] Port utility functions to Solaris</a></strong>
<ul><li><em>From:</em> john . levon</li></ul></li>
</ul></li></ul>
<!--X-References-End-->
<!--X-BotPNI-->
<ul>
<li>Prev by Date:
<strong><a href="msg04496.html">Re:  [PATCH] Add --autocf</a></strong>
</li>
<li>Next by Date:
<strong><a href="msg04498.html">Re:  How send special keystrokes to guest (w2k8)	system?</a></strong>
</li>
<li>Previous by thread:
<strong><a href="msg04480.html">[PATCH] Port utility functions to Solaris</a></strong>
</li>
<li>Next by thread:
<strong><a href="msg04505.html">Re:  [PATCH] Port utility functions to Solaris</a></strong>
</li>
<li>Index(es):
<ul>
<li><a href="maillist.html#04497"><strong>Date</strong></a></li>
<li><a href="index.html#04497"><strong>Thread</strong></a></li>
</ul>
</li>
</ul>

<!--X-BotPNI-End-->
<!--X-User-Footer-->
<center>
<font size=-1>
<a href=/lists/>[Index&nbsp;of&nbsp;Archives]</a>
&nbsp;
&nbsp;
<a href=/linux/fedora/fedora-users/>[Fedora&nbsp;Users]</a>
&nbsp;
&nbsp;
<a href=/lists/fll/>[Fedora&nbsp;Legacy&nbsp;List]</a>
&nbsp;
&nbsp;
<a href=/linux/fedora/fedora-maintainers/>[Fedora&nbsp;Maintainers]</a>
&nbsp;
&nbsp;
<a href=/lists/fedora-desktop/>[Fedora&nbsp;Desktop]</a>
&nbsp;
&nbsp;
<a href=/lists/fedora-selinux/>[Fedora&nbsp;SELinux]</a>
&nbsp;
&nbsp;
<a href=http://www.ske-art.com/z/biglist.html>[Big&nbsp;List&nbsp;of&nbsp;Linux&nbsp;Books]</a>
&nbsp;
&nbsp;
<a href=https://yosemitenews.info>[Yosemite&nbsp;News]</a>
&nbsp;
&nbsp;
<a href=/lists/kde/>[KDE&nbsp;Users]</a>
&nbsp;
&nbsp;
<a href=/lists/fedora-tools/>[Fedora&nbsp;Tools]</a>
</font>
</center>
<hr>
<p>
<div>
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<ins class="adsbygoogle"
     style="display:block"
     data-ad-format="autorelaxed"
     data-ad-client="ca-pub-3422782820843221"
     data-ad-slot="1424524564"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
</div>
<table width=100%>
<tr>
<td align=left>&nbsp;</td>
<td align=right><a href=/lists/><img src=/button_01.gif border=0 alt="Powered by Linux"></a></td>
</tr>
</table>
<!--X-User-Footer-End-->
<script type="text/javascript"> 
 function initAddThis() {
    addthis.init()
 }
initAddThis();
</script>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-760190-1', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
