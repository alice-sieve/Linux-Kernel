<!-- MHonArc v2.6.19 -->
<!--X-Subject: Re:  [PATCH RFC 00/14] Minor code cleanups,	round zero -->
<!--X-From-R13: Rnir Oaqrefba &#60;naqrefbaNerqung.pbz> -->
<!--X-Date: Thu, 2 Nov 2017 07:34:14 &#45;0700 -->
<!--X-Message-Id: 479619235.24730762.1509633245338.JavaMail.zimbra@redhat.com -->
<!--X-Content-Type: text/plain -->
<!--X-Reference: 20171027082320.4079&#45;1&#45;oleksandr@redhat.com -->
<!--X-Reference: 20171027082320.4079&#45;4&#45;oleksandr@redhat.com -->
<!--X-Reference: 514573958.22978778.1509113743975.JavaMail.zimbra@redhat.com -->
<!--X-Reference: 33710E6CAA200E4583255F4FB666C4E21B119D94@G01JPEXMBYT03 -->
<!--X-Reference: CAHcwAbSRNroUsLhCWAOMhz=f2zmVjBKEx+Kf1EmEFpS+YoWD4A@mail.gmail.com -->
<!--X-Reference: 46628484.23718752.1509390608201.JavaMail.zimbra@redhat.com -->
<!--X-Reference: CAHcwAbTPm00or9u6AjuaveijHDiGQUFvPpMqSwX=xBWeA1VYPg@mail.gmail.com -->
<!--X-Head-End-->
<!doctype html public "-//W3C//DTD HTML//EN">
<html>
<head>
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({
          google_ad_client: "ca-pub-3422782820843221",
          enable_page_level_ads: true
     });
</script>
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="description" content="Re:  [PATCH RFC 00/14] Minor code cleanups,	round zero &mdash; Red Hat Crash Utility">
<style>
<!--
 pre {white-space: pre-wrap;}
-->
</style>
<title>Red Hat Crash Utility &mdash;  Re:  [PATCH RFC 00/14] Minor code cleanups,	round zero</title>
<link rel="alternate" type="application/rss+xml" title="Red Hat Crash Utility" href="//feeds.feedburner.com/RedHatCrashUtility">
</head>
<body itemscope itemtype="//schema.org/Article" vlink=green>
<!--X-Body-Begin-->
<!--X-User-Header-->
<!--X-User-Header-End-->
<!--X-TopPNI-->
<form action="//www.google.com" id="cse-search-box" target="_blank">
  <div>
    <input type="hidden" name="cx" value="partner-pub-3422782820843221:9580497365" />
    <input type="hidden" name="ie" value="UTF-8" />
    <input type="text" name="q" size="25" />
    <input type="submit" name="sa" value="Search" />
  </div>
</form>
<script type="text/javascript" src="//www.google.com/coop/cse/brand?form=cse-search-box&amp;lang=en"></script>
<h1 itemprop="name">Re:  [PATCH RFC 00/14] Minor code cleanups,	round zero</h1>
[<a href="msg07169.html">Date Prev</a>][<a href="msg07171.html">Date Next</a>][<a href="msg07168.html">Thread Prev</a>][<a href="msg07142.html">Thread Next</a>][<a href="maillist.html#07170">Date Index</a>][<a href="index.html#07170">Thread Index</a>]
<script src="https://apis.google.com/js/platform.js" async defer></script>
<g:plusone size="small"></g:plusone>
<p>&nbsp;<br>
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- responsive test for archives -->
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-3422782820843221"
     data-ad-slot="6345952567"
     data-ad-format="auto"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>

<!--X-TopPNI-End-->
<!--X-MsgBody-->
<!--X-Subject-Header-Begin-->
<hr>
<!--X-Subject-Header-End-->
<!--X-Head-of-Message-->
<ul>
<li><em>Subject</em>: Re:  [PATCH RFC 00/14] Minor code cleanups,	round zero</li>
<li><em>From</em>: Dave Anderson &lt;anderson@xxxxxxxxxx&gt;</li>
<li><em>Date</em>: Thu, 2 Nov 2017 10:34:05 -0400 (EDT)</li>
<li><em>Cc</em>: crash-utility@xxxxxxxxxx</li>
<li><em>In-reply-to</em>: &lt;CAHcwAbTPm00or9u6AjuaveijHDiGQUFvPpMqSwX=xBWeA1VYPg@mail.gmail.com&gt;</li>
<li><em>Reply-to</em>: &quot;Discussion list for crash utility usage,	maintenance and development&quot; &lt;crash-utility@xxxxxxxxxx&gt;</li>
</ul>
<!--X-Head-of-Message-End-->
<!--X-Head-Body-Sep-Begin-->
<!-- AddThis Button BEGIN -->
<div class="addthis_toolbox addthis_default_style ">
<a class="addthis_button_preferred_1"></a>
<a class="addthis_button_preferred_2"></a>
<a class="addthis_button_preferred_3"></a>
<a class="addthis_button_preferred_4"></a>
<a class="addthis_button_compact"></a>
<a class="addthis_counter addthis_bubble_style"></a>
</div>
<script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5196c2ae1be43d18&async=1&domready=1" defer async></script>
<!-- AddThis Button END -->
<hr>
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- responsive link 1 -->
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-3422782820843221"
     data-ad-slot="8681825769"
     data-ad-format="link"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
<p>
<div class="content" itemprop="articleBody">
<!--X-Head-Body-Sep-End-->
<!--X-Body-of-Message-->
<pre>
----- Original Message -----
&gt;<i> Hi, Dave.</i>
&gt;<i> </i>
&gt;<i> Thanks for your intensive review and accepting contribution.</i>
&gt;<i> </i>
&gt;<i> Nevertheless, I'd appreciate if you explicitly comment on the following</i>
&gt;<i> series:</i>
&gt;<i> </i>
&gt;<i> lkcd_v8: address of an array always evaluates to true</i>
&gt;<i> lkcd_v7: address of an array always evaluates to true</i>
&gt;<i> lkcd_v5: address of an array always evaluates to true</i>
&gt;<i> lkcd_v2_v3: address of an array always evaluates to true</i>
&gt;<i> lkcd_v1: address of an array always evaluates to true</i>
&gt;<i> </i>
&gt;<i> Let me explain why I think this should be fixed.</i>
&gt;<i> </i>
&gt;<i> dump_header_t is a struct that contains the following member:</i>
&gt;<i> </i>
&gt;<i> /* the panic string, if available */</i>
&gt;<i> char                 dh_panic_string[DUMP_PANIC_LEN];</i>
&gt;<i> </i>
&gt;<i> This struct is statically initialized with zeroes:</i>
&gt;<i> </i>
&gt;<i> static dump_header_t dump_header_v8 = { 0 };</i>
&gt;<i> </i>
&gt;<i> and assigned to dh via pointer. Thus, in the following expression:</i>
&gt;<i> </i>
&gt;<i> dh &amp;&amp; dh-&gt;dh_panic_string &amp;&amp; strstr(dh-&gt;dh_panic_string, &quot;\n&quot;) ? &quot;&quot; : &quot;\n&quot;</i>
&gt;<i> </i>
&gt;<i> once dh is non-NULL, dh-&gt;dh_panic_string also has some address within</i>
&gt;<i> a struct, but its value may be NULL. IIRC, passing NULL to strstr is</i>
&gt;<i> an undefined behaviour, so, looks like that this statement should be</i>
&gt;<i> rewritten to check whether dh_panic_string is NULL:</i>
&gt;<i> </i>
&gt;<i> dh &amp;&amp; *dh-&gt;dh_panic_string &amp;&amp; strstr(dh-&gt;dh_panic_string, &quot;\n&quot;) ? &quot;&quot; : &quot;\n&quot;</i>
&gt;<i> </i>
&gt;<i> or</i>
&gt;<i> </i>
&gt;<i> dh &amp;&amp; dh-&gt;dh_panic_string[0] &amp;&amp; strstr(dh-&gt;dh_panic_string, &quot;\n&quot;) ? &quot;&quot; : &quot;\n&quot;</i>
&gt;<i> </i>
&gt;<i> or even</i>
&gt;<i> </i>
&gt;<i> dh &amp;&amp; strlen(dh-&gt;dh_panic_string) &amp;&amp; strstr(dh-&gt;dh_panic_string, &quot;\n&quot;)</i>
&gt;<i> ? &quot;&quot; : &quot;\n&quot;</i>
&gt;<i> </i>
&gt;<i> to avoid any confusion for potential code reviewer.</i>
&gt;<i> </i>
&gt;<i> Am I correct?</i>

Yes you are correct that the dh-&gt;dh_panic_string test will always
return TRUE, but that it's harmless.  And it would never pass a NULL 
pointer to strstr(), but rather a pointer to a string of NULL characters, 
i.e., a legitimate string whose terminating NULL is the first character.
And FWIW, it's also meaningless to even make the &quot;dh&quot; check as well,
so the two-part &quot;dh &amp;&amp; dh-&gt;dh_panic_string&quot; validation could simply
be removed.

But practically speaking -- and I don't mean to be flippant -- when 
was the last time you worked with an LKCD dumpfile?  It's a dead dumpfile
format, that was abandoned in ~2006.  I think SUSE last used it in their 
2.6.5-based SLES9 kernels, but thankfully kdump was accepted in the kernel,
and LKCD (and Red Hat's netdump) were finally and thankfully laid to rest.

Again, what I'm interested in is just keeping crash working/in-sync 
with the constant onslaught of upstream kernel changes, fixing any existing
functional bugs, and adding new useful features.

Thanks,
  Dave

--
Crash-utility mailing list
Crash-utility@xxxxxxxxxx
<a  rel="nofollow" href="https://www.redhat.com/mailman/listinfo/crash-utility">https://www.redhat.com/mailman/listinfo/crash-utility</a>


</pre>
<!--X-Body-of-Message-End-->
<!--X-MsgBody-End-->
<!--X-Follow-Ups-->
</div>
<hr>
<!--X-Follow-Ups-End-->
<!--X-References-->
<ul><li><strong>References</strong>:
<ul>
<li><strong><a name="07141" href="msg07141.html">[PATCH RFC 00/14] Minor code cleanups, round zero</a></strong>
<ul><li><em>From:</em> Oleksandr Natalenko</li></ul></li>
<li><strong><a name="07140" href="msg07140.html">[PATCH RFC 03/14] memory: use &amp; for a bitwise	operation</a></strong>
<ul><li><em>From:</em> Oleksandr Natalenko</li></ul></li>
<li><strong><a name="07155" href="msg07155.html">Re:  [PATCH RFC 00/14] Minor code cleanups,	round zero</a></strong>
<ul><li><em>From:</em> Dave Anderson</li></ul></li>
<li><strong><a name="07159" href="msg07159.html">Re:  [PATCH RFC 00/14] Minor code cleanups,	round zero</a></strong>
<ul><li><em>From:</em> Hatayama, Daisuke</li></ul></li>
<li><strong><a name="07160" href="msg07160.html">Re:  [PATCH RFC 00/14] Minor code cleanups,	round zero</a></strong>
<ul><li><em>From:</em> Oleksandr Natalenko</li></ul></li>
<li><strong><a name="07166" href="msg07166.html">Re:  [PATCH RFC 00/14] Minor code cleanups,	round zero</a></strong>
<ul><li><em>From:</em> Dave Anderson</li></ul></li>
<li><strong><a name="07168" href="msg07168.html">Re:  [PATCH RFC 00/14] Minor code cleanups,	round zero</a></strong>
<ul><li><em>From:</em> Oleksandr Natalenko</li></ul></li>
</ul></li></ul>
<!--X-References-End-->
<!--X-BotPNI-->
<ul>
<li>Prev by Date:
<strong><a href="msg07169.html">[PATCH] fix vmstat handling</a></strong>
</li>
<li>Next by Date:
<strong><a href="msg07171.html">Re:  [PATCH] fix vmstat handling</a></strong>
</li>
<li>Previous by thread:
<strong><a href="msg07168.html">Re:  [PATCH RFC 00/14] Minor code cleanups,	round zero</a></strong>
</li>
<li>Next by thread:
<strong><a href="msg07142.html">[PATCH RFC 02/14] memory: do not compare unsigned	expression with negative value</a></strong>
</li>
<li>Index(es):
<ul>
<li><a href="maillist.html#07170"><strong>Date</strong></a></li>
<li><a href="index.html#07170"><strong>Thread</strong></a></li>
</ul>
</li>
</ul>

<!--X-BotPNI-End-->
<!--X-User-Footer-->
<center>
<font size=-1>
<a href=/lists/>[Index&nbsp;of&nbsp;Archives]</a>
&nbsp;
&nbsp;
<a href=/lists/fedora-devel/>[Fedora&nbsp;Development]</a>
&nbsp;
&nbsp;
<a href=/lists/fedora-desktop/>[Fedora&nbsp;Desktop]</a>
&nbsp;
&nbsp;
<a href=/lists/fedora-selinux/>[Fedora&nbsp;SELinux]</a>
&nbsp;
&nbsp;
<a href=https://yosemitenews.info>[Yosemite&nbsp;News]</a>
&nbsp;
&nbsp;
<a href=/lists/kde/>[KDE&nbsp;Users]</a>
&nbsp;
&nbsp;
<a href=/lists/fedora-tools/>[Fedora&nbsp;Tools]</a>
</font>
</center>
<hr>
<p>
<div>
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<ins class="adsbygoogle"
     style="display:block"
     data-ad-format="autorelaxed"
     data-ad-client="ca-pub-3422782820843221"
     data-ad-slot="1424524564"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
</div>
<table width="100%">
<tr>
<td align=left>&nbsp;</td>
<td valign=top align=right><H1><a href=/lists/><img src=/button_01.gif border=0 alt="Powered by Linux"></a></H1></td>
</tr></table>
<!--X-User-Footer-End-->
<script type="text/javascript"> 
 function initAddThis() {
    addthis.init()
 }
initAddThis();
</script>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-760190-1', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
