<!-- MHonArc v2.6.19 -->
<!--X-Subject: [osinfo&#45;db&#45;tools PATCH v2 06/16] maint.mk: Update to	the latest gnulib version -->
<!--X-From-R13: =?GFT&#45;8?d?Tnovnab=20Tvq=Q3=OOapvb?= &#60;svqrapvbNerqung.pbz> -->
<!--X-Date: Tue, 9 Jul 2019 03:48:15 &#45;0700 -->
<!--X-Message-Id: 20190709104744.16516&#45;7&#45;fidencio@redhat.com -->
<!--X-Content-Type: text/plain -->
<!--X-Reference: 20190709104744.16516&#45;1&#45;fidencio@redhat.com -->
<!--X-Head-End-->
<!doctype html public "-//W3C//DTD HTML//EN">
<html>
<head>
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({
          google_ad_client: "ca-pub-3422782820843221",
          enable_page_level_ads: true
     });
</script>
<title>[osinfo-db-tools PATCH v2 06/16] maint.mk: Update to	the latest gnulib version &mdash; libosinfo</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="description" content="libosinfo: [osinfo-db-tools PATCH v2 06/16] maint.mk: Update to	the latest gnulib version">
<style>
<!--
 pre {white-space: pre-wrap;}
-->
</style>
<link rel="alternate" type="application/rss+xml" title="libosinfo" href="//feeds.feedburner.com/libosinfo">
</head>
<body itemscope itemtype="//schema.org/Article" vlink=green>
<!--X-Body-Begin-->
<!--X-User-Header-->
<!--X-User-Header-End-->
<!--X-TopPNI-->
<form action="//www.google.com" id="cse-search-box" target="_blank">
  <div>
    <input type="hidden" name="cx" value="partner-pub-3422782820843221:9580497365" />
    <input type="hidden" name="ie" value="UTF-8" />
    <input type="text" name="q" size="25" />
    <input type="submit" name="sa" value="Search" />
  </div>
</form>
<script type="text/javascript" src="//www.google.com/coop/cse/brand?form=cse-search-box&amp;lang=en"></script>
<h1 itemprop="name">[osinfo-db-tools PATCH v2 06/16] maint.mk: Update to	the latest gnulib version</h1>
[<a href="msg05995.html">Date Prev</a>][<a href="msg05992.html">Date Next</a>][<a href="msg05995.html">Thread Prev</a>][<a href="msg05992.html">Thread Next</a>][<a href="maillist.html#05991">Date Index</a>][<a href="index.html#05991">Thread Index</a>]


<p>&nbsp;<br>
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- responsive test for archives -->
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-3422782820843221"
     data-ad-slot="6345952567"
     data-ad-format="auto"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>

<!--X-TopPNI-End-->
<!--X-MsgBody-->
<!--X-Subject-Header-Begin-->
<hr>
<!--X-Subject-Header-End-->
<!--X-Head-of-Message-->
<ul>
<li><em>Subject</em>: [osinfo-db-tools PATCH v2 06/16] maint.mk: Update to	the latest gnulib version</li>
<li><em>From</em>: Fabiano Fid&#xEA;ncio &lt;fidencio@xxxxxxxxxx&gt;</li>
<li><em>Date</em>: Tue,  9 Jul 2019 12:47:34 +0200</li>
<li><em>In-reply-to</em>: &lt;<a href="msg05980.html">20190709104744.16516-1-fidencio@redhat.com</a>&gt;</li>
<li><em>References</em>: &lt;<a href="msg05980.html">20190709104744.16516-1-fidencio@redhat.com</a>&gt;</li>
</ul>
<!--X-Head-of-Message-End-->
<!--X-Head-Body-Sep-Begin-->
<!-- AddThis Button BEGIN -->
<div class="addthis_toolbox addthis_default_style ">
<a class="addthis_button_preferred_1"></a>
<a class="addthis_button_preferred_2"></a>
<a class="addthis_button_preferred_3"></a>
<a class="addthis_button_preferred_4"></a>
<a class="addthis_button_compact"></a>
<a class="addthis_counter addthis_bubble_style"></a>
</div>
<script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5196c2ae1be43d18&async=1&domready=1" async></script>
<!-- AddThis Button END -->
<hr>
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- responsive link 1 -->
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-3422782820843221"
     data-ad-slot="8681825769"
     data-ad-format="link"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
<p>
<div class="content" itemprop="articleBody">
<!--X-Head-Body-Sep-End-->
<!--X-Body-of-Message-->
<pre>Signed-off-by: Fabiano Fid&#xEA;ncio &lt;fidencio@xxxxxxxxxx&gt;
---
 maint.mk | 407 ++++++++++++++++++++++++++++++++++---------------------
 1 file changed, 255 insertions(+), 152 deletions(-)

diff --git a/maint.mk b/maint.mk
index 04a839a..16e9360 100644
--- a/maint.mk
+++ b/maint.mk
@@ -2,7 +2,7 @@
 # This Makefile fragment tries to be general-purpose enough to be
 # used by many projects via the gnulib maintainer-makefile module.
 
-## Copyright (C) 2001-2014 Free Software Foundation, Inc.
+## Copyright (C) 2001-2019 Free Software Foundation, Inc.
 ##
 ## This program is free software: you can redistribute it and/or modify
 ## it under the terms of the GNU General Public License as published by
@@ -15,12 +15,19 @@
 ## GNU General Public License for more details.
 ##
 ## You should have received a copy of the GNU General Public License
-## along with this program.  If not, see &lt;<a  rel="nofollow" href="http://www.gnu.org/licenses/">http://www.gnu.org/licenses/</a>&gt;.
+## along with this program.  If not, see &lt;<a  rel="nofollow" href="https://www.gnu.org/licenses/">https://www.gnu.org/licenses/</a>&gt;.
 
 # This is reported not to work with make-3.79.1
 # ME := $(word $(words $(MAKEFILE_LIST)),$(MAKEFILE_LIST))
 ME := maint.mk
 
+# These variables ought to be defined through the configure.ac section
+# of the module description. But some packages import this file directly,
+# ignoring the module description.
+AWK ?= awk
+GREP ?= grep
+SED ?= sed
+
 # Helper variables.
 _empty =
 _sp = $(_empty) $(_empty)
@@ -46,7 +53,7 @@ member-check =								\
 # Do not save the original name or timestamp in the .tar.gz file.
 # Use --rsyncable if available.
 gzip_rsyncable := \
-  $(shell gzip --help 2&gt;/dev/null|grep rsyncable &gt;/dev/null \
+  $(shell gzip --help 2&gt;/dev/null|$(GREP) rsyncable &gt;/dev/null \
     &amp;&amp; printf %s --rsyncable)
 GZIP_ENV = '--no-name --best $(gzip_rsyncable)'
 
@@ -55,6 +62,10 @@ VC = $(GIT)
 
 VC_LIST = $(srcdir)/$(_build-aux)/vc-list-files -C $(srcdir)
 
+# You can override this variable in cfg.mk if your gnulib submodule lives
+# in a different location.
+gnulib_dir ?= $(srcdir)/gnulib
+
 # You can override this variable in cfg.mk to set your own regexp
 # matching files to ignore.
 VC_LIST_ALWAYS_EXCLUDE_REGEX ?= ^$$
@@ -79,9 +90,9 @@ _sc_excl = \
   $(or $(exclude_file_name_regexp--$@),^$$)
 VC_LIST_EXCEPT = \
   $(VC_LIST) | $(SED) 's|^$(_dot_escaped_srcdir)/||' \
-	| if test -f $(srcdir)/.x-$@; then grep -vEf $(srcdir)/.x-$@; \
-	  else grep -Ev -e &quot;$${VC_LIST_EXCEPT_DEFAULT-ChangeLog}&quot;; fi \
-	| grep -Ev -e '($(VC_LIST_ALWAYS_EXCLUDE_REGEX)|$(_sc_excl))' \
+	| if test -f $(srcdir)/.x-$@; then $(GREP) -vEf $(srcdir)/.x-$@; \
+	  else $(GREP) -Ev -e &quot;$${VC_LIST_EXCEPT_DEFAULT-ChangeLog}&quot;; fi \
+	| $(GREP) -Ev -e '($(VC_LIST_ALWAYS_EXCLUDE_REGEX)|$(_sc_excl))' \
 	$(_prepend_srcdir_prefix)
 
 ifeq ($(origin prev_version_file), undefined)
@@ -126,8 +137,8 @@ gnu_ftp_host-stable = ftp.gnu.org
 gnu_rel_host ?= $(gnu_ftp_host-$(release-type))
 
 url_dir_list ?= $(if $(call _equal,$(gnu_rel_host),ftp.gnu.org),	\
-                     <a  rel="nofollow" href="http://ftpmirror.gnu.org/$">http://ftpmirror.gnu.org/$</a>(PACKAGE),		\
-                     ftp://$(gnu_rel_host)/gnu/$(PACKAGE))
+                     <a  rel="nofollow" href="https://ftpmirror.gnu.org/$">https://ftpmirror.gnu.org/$</a>(PACKAGE),		\
+                     https://$(gnu_rel_host)/gnu/$(PACKAGE))
 
 # Override this in cfg.mk if you are using a different format in your
 # NEWS file.
@@ -148,6 +159,7 @@ export LC_ALL = C
 ## Sanity checks.  ##
 ## --------------- ##
 
+ifneq ($(_gl-Makefile),)
 _cfg_mk := $(wildcard $(srcdir)/cfg.mk)
 
 # Collect the names of rules starting with 'sc_'.
@@ -179,7 +191,7 @@ $(sc_z_rules_): %.z: %
 	@end=$$(date +%s.%N);						\
 	start=$$(cat .sc-start-$*);					\
 	rm -f .sc-start-$*;						\
-	awk -v s=$$start -v e=$$end					\
+	$(AWK) -v s=$$start -v e=$$end					\
 	  'END {printf &quot;%.2f $(patsubst sc_%,%,$*)\n&quot;, e - s}' &lt; /dev/null
 
 # The patsubst here is to replace each sc_% rule with its sc_%.z wrapper
@@ -189,6 +201,7 @@ local-check :=								\
     $(filter-out $(local-checks-to-skip), $(local-checks-available)))
 
 syntax-check: $(local-check)
+endif
 
 # _sc_search_regexp
 #
@@ -286,42 +299,56 @@ define _sc_search_regexp
 									\
    : Filter by file name;						\
    if test -n &quot;$$in_files&quot;; then					\
-     files=$$(find $(srcdir) | grep -E &quot;$$in_files&quot;			\
-              | grep -Ev '$(_sc_excl)');				\
+     files=$$(find $(srcdir) | $(GREP) -E &quot;$$in_files&quot;			\
+              | $(GREP) -Ev '$(_sc_excl)');				\
    else									\
      files=$$($(VC_LIST_EXCEPT));					\
      if test -n &quot;$$in_vc_files&quot;; then					\
-       files=$$(echo &quot;$$files&quot; | grep -E &quot;$$in_vc_files&quot;);		\
+       files=$$(echo &quot;$$files&quot; | $(GREP) -E &quot;$$in_vc_files&quot;);		\
      fi;								\
    fi;									\
 									\
    : Filter by content;							\
-   test -n &quot;$$files&quot; &amp;&amp; test -n &quot;$$containing&quot;				\
-     &amp;&amp; { files=$$(grep -l &quot;$$containing&quot; $$files); } || :;		\
-   test -n &quot;$$files&quot; &amp;&amp; test -n &quot;$$non_containing&quot;			\
-     &amp;&amp; { files=$$(grep -vl &quot;$$non_containing&quot; $$files); } || :;	\
+   test -n &quot;$$files&quot;							\
+     &amp;&amp; test -n &quot;$$containing&quot;						\
+     &amp;&amp; { files=$$(echo &quot;$$files&quot; | xargs $(GREP) -l &quot;$$containing&quot;); }	\
+     || :;								\
+   test -n &quot;$$files&quot;							\
+     &amp;&amp; test -n &quot;$$non_containing&quot;					\
+     &amp;&amp; { files=$$(echo &quot;$$files&quot; | xargs $(GREP) -vl &quot;$$non_containing&quot;); } \
+     || :;								\
 									\
    : Check for the construct;						\
    if test -n &quot;$$files&quot;; then						\
      if test -n &quot;$$prohibit&quot;; then					\
-       grep $$with_grep_options $(_ignore_case) -nE &quot;$$prohibit&quot; $$files \
-         | grep -vE &quot;$${exclude:-^$$}&quot;					\
-         &amp;&amp; { msg=&quot;$$halt&quot; $(_sc_say_and_exit) } || :;			\
+       echo &quot;$$files&quot;							\
+         | xargs $(GREP) $$with_grep_options $(_ignore_case) -nE	\
+		&quot;$$prohibit&quot; /dev/null					\
+         | $(GREP) -vE &quot;$${exclude:-^$$}&quot;				\
+         &amp;&amp; { msg=&quot;$$halt&quot; $(_sc_say_and_exit) }			\
+         || :;								\
      else								\
-       grep $$with_grep_options $(_ignore_case) -LE &quot;$$require&quot; $$files \
-           | grep .							\
-         &amp;&amp; { msg=&quot;$$halt&quot; $(_sc_say_and_exit) } || :;			\
+       echo &quot;$$files&quot;							\
+         | xargs							\
+             $(GREP) $$with_grep_options $(_ignore_case) -LE &quot;$$require&quot; \
+         | $(GREP) .							\
+         &amp;&amp; { msg=&quot;$$halt&quot; $(_sc_say_and_exit) }			\
+         || :;								\
      fi									\
    else :;								\
    fi || :;
 endef
 
 sc_avoid_if_before_free:
-	@$(srcdir)/$(_build-aux)/useless-if-before-free			\
-		$(useless_free_options)					\
-	    $$($(VC_LIST_EXCEPT) | grep -v useless-if-before-free) &amp;&amp;	\
-	  { echo '$(ME): found useless &quot;if&quot; before &quot;free&quot; above' 1&gt;&amp;2;	\
-	    exit 1; } || :
+	@$(VC_LIST_EXCEPT)						\
+	  | $(GREP) -v useless-if-before-free				\
+	  | xargs							\
+	      $(srcdir)/$(_build-aux)/useless-if-before-free		\
+	      $(useless_free_options)					\
+	  &amp;&amp; { printf '$(ME): found useless &quot;if&quot;'			\
+		      ' before &quot;free&quot; above\n' 1&gt;&amp;2;			\
+	       exit 1; }						\
+	  || :
 
 sc_cast_of_argument_to_free:
 	@prohibit='\&lt;free *\( *\(' halt=&quot;don't cast free argument&quot;	\
@@ -382,6 +409,43 @@ sc_prohibit_magic_number_exit:
 	halt='use EXIT_* values rather than magic number'		\
 	  $(_sc_search_regexp)
 
+# Check that we don't use $&lt; in non-implicit Makefile rules.
+#
+# To find the Makefiles, trace AC_CONFIG_FILES.  Using VC_LIST would
+# miss the Makefiles that are not under VC control (e.g., symlinks
+# installed for gettext).  &quot;Parsing&quot; (recursive) uses of SUBDIRS seems
+# too delicate.
+#
+# Use GNU Make's --print-data-base to normalize the rules into some
+# easy to parse format: they are separated by two \n.  Look for the
+# &quot;section&quot; about non-pattern rules (marked with &quot;# Files&quot;) inside
+# which there are still the POSIX Make like implicit rules (&quot;.c.o&quot;).
+sc_prohibit_gnu_make_extensions_awk_ =					\
+  BEGIN {								\
+      RS = &quot;\n\n&quot;;							\
+      in_rules = 0;							\
+  }									\
+  /^\# Files/ {								\
+      in_rules = 1;							\
+  }									\
+  /\$$&lt;/ &amp;&amp; in_rules &amp;&amp; $$0 !~ /^(.*\n)*\.\w+(\.\w+)?:/ {		\
+      print &quot;Error: &quot; file &quot;: $$&lt; in a non implicit rule\n&quot; $$0;	\
+      status = 1;							\
+  }									\
+  END {									\
+     exit status;							\
+  }
+sc_prohibit_gnu_make_extensions:
+	@if $(AWK) --version | grep GNU &gt;/dev/null 2&gt;&amp;1; then		\
+	  (cd $(srcdir) &amp;&amp; autoconf --trace AC_CONFIG_FILES:'$$1') |	\
+	    tr ' ' '\n' |						\
+	    $(SED) -ne '/Makefile/{s/\.in$$//;p;}' |			\
+	    while read m; do						\
+	      $(MAKE) -qp -f $$m .DUMMY-TARGET 2&gt;/dev/null |		\
+	        $(AWK) -v file=$$m -e '$($@_awk_)' || exit 1;		\
+	    done;							\
+	fi
+
 # Using EXIT_SUCCESS as the first argument to error is misleading,
 # since when that parameter is 0, error does not exit.  Use '0' instead.
 sc_error_exit_success:
@@ -393,28 +457,35 @@ sc_error_exit_success:
 # &quot;FATAL:&quot; should be fully upper-cased in error messages
 # &quot;WARNING:&quot; should be fully upper-cased, or fully lower-cased
 sc_error_message_warn_fatal:
-	@grep -nEA2 '[^rp]error *\(' $$($(VC_LIST_EXCEPT))		\
-	    | grep -E '&quot;Warning|&quot;Fatal|&quot;fatal' &amp;&amp;			\
-	  { echo '$(ME): use FATAL, WARNING or warning'	1&gt;&amp;2;		\
-	    exit 1; } || :
+	@$(VC_LIST_EXCEPT)						\
+	  | xargs $(GREP) -nEA2 '[^rp]error *\(' /dev/null		\
+	  | $(GREP) -E '&quot;Warning|&quot;Fatal|&quot;fatal'				\
+	  &amp;&amp; { echo '$(ME): use FATAL, WARNING or warning' 1&gt;&amp;2;	\
+	       exit 1; }						\
+	  || :
 
 # Error messages should not start with a capital letter
 sc_error_message_uppercase:
-	@grep -nEA2 '[^rp]error *\(' $$($(VC_LIST_EXCEPT))		\
-	    | grep -E '&quot;[A-Z]'						\
-	    | grep -vE '&quot;FATAL|&quot;WARNING|&quot;Java|&quot;C#|PRIuMAX' &amp;&amp;		\
-	  { echo '$(ME): found capitalized error message' 1&gt;&amp;2;		\
-	    exit 1; } || :
+	@$(VC_LIST_EXCEPT)						\
+	  | xargs $(GREP) -nEA2 '[^rp]error *\(' /dev/null		\
+	  | $(GREP) -E '&quot;[A-Z]'						\
+	  | $(GREP) -vE '&quot;FATAL|&quot;WARNING|&quot;Java|&quot;C#|PRIuMAX'		\
+	  &amp;&amp; { echo '$(ME): found capitalized error message' 1&gt;&amp;2;	\
+	       exit 1; }						\
+	  || :
 
 # Error messages should not end with a period
 sc_error_message_period:
-	@grep -nEA2 '[^rp]error *\(' $$($(VC_LIST_EXCEPT))		\
-	    | grep -E '[^.&quot;]\.&quot;' &amp;&amp;					\
-	  { echo '$(ME): found error message ending in period' 1&gt;&amp;2;	\
-	    exit 1; } || :
+	@$(VC_LIST_EXCEPT)						\
+	  | xargs $(GREP) -nEA2 '[^rp]error *\(' /dev/null		\
+	  | $(GREP) -E '[^.&quot;]\.&quot;'					\
+	  &amp;&amp; { echo '$(ME): found error message ending in period' 1&gt;&amp;2;	\
+	       exit 1; }						\
+	  || :
 
 sc_file_system:
 	@prohibit=file''system						\
+	exclude='/proc/filesystems'					\
 	ignore_case=1							\
 	halt='found use of &quot;file''system&quot;; spell it &quot;file system&quot;'	\
 	  $(_sc_search_regexp)
@@ -435,17 +506,26 @@ sc_require_config_h:
 	halt='the above files do not include &lt;config.h&gt;'		\
 	  $(_sc_search_regexp)
 
+# Print each file name for which the first #include does not match
+# $(config_h_header).  Like grep -m 1, this only looks at the first match.
+perl_config_h_first_ =							\
+  -e 'BEGIN {$$ret = 0}'						\
+  -e 'if (/^\# *include\b/) {'						\
+  -e '  if (not m{^\# *include $(config_h_header)}) {'			\
+  -e '    print &quot;$$ARGV\n&quot;;'						\
+  -e '    $$ret = 1;'							\
+  -e '  }'								\
+  -e '  \# Move on to next file after first include'			\
+  -e '  close ARGV;'							\
+  -e '}'								\
+  -e 'END {exit $$ret}'
+
 # You must include &lt;config.h&gt; before including any other header file.
 # This can possibly be via a package-specific header, if given by cfg.mk.
 sc_require_config_h_first:
-	@if $(VC_LIST_EXCEPT) | grep '\.c$$' &gt; /dev/null; then		\
-	  fail=0;							\
-	  for i in $$($(VC_LIST_EXCEPT) | grep '\.c$$'); do		\
-	    grep '^# *include\&gt;' $$i | $(SED) 1q			\
-		| grep -E '^# *include $(config_h_header)' &gt; /dev/null	\
-	      || { echo $$i; fail=1; };					\
-	  done;								\
-	  test $$fail = 1 &amp;&amp;						\
+	@if $(VC_LIST_EXCEPT) | $(GREP) '\.c$$' &gt; /dev/null; then	\
+	  files=$$($(VC_LIST_EXCEPT) | $(GREP) '\.c$$') &amp;&amp;		\
+	  perl -n $(perl_config_h_first_) $$files ||			\
 	    { echo '$(ME): the above files include some other header'	\
 		'before &lt;config.h&gt;' 1&gt;&amp;2; exit 1; } || :;		\
 	else :;								\
@@ -462,10 +542,10 @@ sc_prohibit_HAVE_MBRTOWC:
 define _sc_header_without_use
   dummy=; : so we do not need a semicolon before each use;		\
   h_esc=`echo '[&lt;&quot;]'&quot;$$h&quot;'[&quot;&gt;]'|$(SED) 's/\./\\\\./g'`;			\
-  if $(VC_LIST_EXCEPT) | grep '\.c$$' &gt; /dev/null; then			\
-    files=$$(grep -l '^# *include '&quot;$$h_esc&quot;				\
-	     $$($(VC_LIST_EXCEPT) | grep '\.c$$')) &amp;&amp;			\
-    grep -LE &quot;$$re&quot; $$files | grep . &amp;&amp;					\
+  if $(VC_LIST_EXCEPT) | $(GREP) '\.c$$' &gt; /dev/null; then		\
+    files=$$($(GREP) -l '^# *include '&quot;$$h_esc&quot;				\
+	     $$($(VC_LIST_EXCEPT) | $(GREP) '\.c$$')) &amp;&amp;		\
+    $(GREP) -LE &quot;$$re&quot; $$files | $(GREP) . &amp;&amp;				\
       { echo &quot;$(ME): the above files include $$h but don't use it&quot;	\
 	1&gt;&amp;2; exit 1; } || :;						\
   else :;								\
@@ -495,7 +575,7 @@ sc_prohibit_quote_without_use:
 
 # Don't include this header unless you use one of its functions.
 sc_prohibit_long_options_without_use:
-	@h='long-options.h' re='\&lt;parse_long_options *\(' \
+	@h='long-options.h' re='\&lt;parse_(long_options|gnu_standard_options_only) *\(' \
 	  $(_sc_header_without_use)
 
 # Don't include this header unless you use one of its functions.
@@ -556,7 +636,7 @@ sc_prohibit_posixver_without_use:
 	@h='posixver.h' re='\&lt;posix2_version *\(' $(_sc_header_without_use)
 
 sc_prohibit_same_without_use:
-	@h='same.h' re='\&lt;same_name *\(' $(_sc_header_without_use)
+	@h='same.h' re='\&lt;same_name(at)? *\(' $(_sc_header_without_use)
 
 sc_prohibit_hash_pjw_without_use:
 	@h='hash-pjw.h' \
@@ -646,18 +726,14 @@ sc_prohibit_strings_without_use:
 	re='\&lt;(strn?casecmp|ffs(ll)?)\&gt;'				\
 	  $(_sc_header_without_use)
 
-# Get the list of symbol names with this:
-# perl -lne '/^# *define ([A-Z]\w+)\(/ and print $1' lib/intprops.h|fmt
-_intprops_names =							\
-  TYPE_IS_INTEGER TYPE_TWOS_COMPLEMENT TYPE_ONES_COMPLEMENT		\
-  TYPE_SIGNED_MAGNITUDE TYPE_SIGNED TYPE_MINIMUM TYPE_MAXIMUM		\
-  INT_BITS_STRLEN_BOUND INT_STRLEN_BOUND INT_BUFSIZE_BOUND		\
-  INT_ADD_RANGE_OVERFLOW INT_SUBTRACT_RANGE_OVERFLOW			\
-  INT_NEGATE_RANGE_OVERFLOW INT_MULTIPLY_RANGE_OVERFLOW			\
-  INT_DIVIDE_RANGE_OVERFLOW INT_REMAINDER_RANGE_OVERFLOW		\
-  INT_LEFT_SHIFT_RANGE_OVERFLOW INT_ADD_OVERFLOW INT_SUBTRACT_OVERFLOW	\
-  INT_NEGATE_OVERFLOW INT_MULTIPLY_OVERFLOW INT_DIVIDE_OVERFLOW		\
-  INT_REMAINDER_OVERFLOW INT_LEFT_SHIFT_OVERFLOW
+# Extract the raw list of symbol names with this:
+gl_extract_define_simple = \
+  /^\# *define ([A-Z]\w+)\(/ and print $$1
+# Filter out duplicates and convert to a space-separated list:
+_intprops_names = \
+  $(shell f=$(gnulib_dir)/lib/intprops.h;				\
+    perl -lne '$(gl_extract_define_simple)' $$f | sort -u | tr '\n' ' ')
+# Remove trailing space and convert to a regular expression:
 _intprops_syms_re = $(subst $(_sp),|,$(strip $(_intprops_names)))
 # Prohibit the inclusion of intprops.h without an actual use.
 sc_prohibit_intprops_without_use:
@@ -685,7 +761,7 @@ sc_prohibit_dirent_without_use:
 # Prohibit the inclusion of verify.h without an actual use.
 sc_prohibit_verify_without_use:
 	@h='verify.h'							\
-	re='\&lt;(verify(true|expr)?|static_assert) *\('			\
+	re='\&lt;(verify(true|expr)?|assume|static_assert) *\('		\
 	  $(_sc_header_without_use)
 
 # Don't include xfreopen.h unless you use one of its functions.
@@ -706,15 +782,6 @@ sc_changelog:
 	halt='found unexpected prefix in a ChangeLog'			\
 	  $(_sc_search_regexp)
 
-# Ensure that each .c file containing a &quot;main&quot; function also
-# calls set_program_name.
-sc_program_name:
-	@require='set_program_name *\(.*\);'				\
-	in_vc_files='\.c$$'						\
-	containing='\&lt;main *('						\
-	halt='the above files do not call set_program_name'		\
-	  $(_sc_search_regexp)
-
 # Ensure that each .c file containing a &quot;main&quot; function also
 # calls bindtextdomain.
 sc_bindtextdomain:
@@ -732,9 +799,9 @@ Exit_base := $(notdir $(Exit_witness_file))
 sc_require_test_exit_idiom:
 	@if test -f $(srcdir)/$(Exit_witness_file); then		\
 	  die=0;							\
-	  for i in $$(grep -l -F 'srcdir/$(Exit_base)'			\
+	  for i in $$($(GREP) -l -F 'srcdir/$(Exit_base)'		\
 		$$($(VC_LIST) tests)); do				\
-	    tail -n1 $$i | grep '^Exit .' &gt; /dev/null			\
+	    tail -n1 $$i | $(GREP) '^Exit .' &gt; /dev/null		\
 	      &amp;&amp; : || { die=1; echo $$i; }				\
 	  done;								\
 	  test $$die = 1 &amp;&amp;						\
@@ -839,18 +906,23 @@ endef
 # Don't define macros that we already get from gnulib header files.
 sc_prohibit_always-defined_macros:
 	@if test -d $(gnulib_dir); then					\
-	  case $$(echo all: | grep -l -f - Makefile) in Makefile);; *)	\
+	  case $$(echo all: | $(GREP) -l -f - Makefile) in Makefile);; *) \
 	    echo '$(ME): skipping $@: you lack GNU grep' 1&gt;&amp;2; exit 0;;	\
 	  esac;								\
-	  $(def_sym_regex) | grep -E -f - $$($(VC_LIST_EXCEPT))		\
-	    &amp;&amp; { echo '$(ME): define the above via some gnulib .h file'	\
-		  1&gt;&amp;2;  exit 1; } || :;				\
+	  regex=$$($(def_sym_regex)); export regex;			\
+	  $(VC_LIST_EXCEPT)						\
+	    | xargs sh -c 'echo $$regex | $(GREP) -E -f - &quot;$$@&quot;'	\
+		dummy /dev/null						\
+	    &amp;&amp; { printf '$(ME): define the above'			\
+			' via some gnulib .h file\n' 1&gt;&amp;2;		\
+	         exit 1; }						\
+	    || :;							\
 	fi
 # ==================================================================
 
 # Prohibit checked in backup files.
 sc_prohibit_backup_files:
-	@$(VC_LIST) | grep '~$$' &amp;&amp;				\
+	@$(VC_LIST) | $(GREP) '~$$' &amp;&amp;					\
 	  { echo '$(ME): found version controlled backup file' 1&gt;&amp;2;	\
 	    exit 1; } || :
 
@@ -869,7 +941,7 @@ sc_GFDL_version:
 	  $(_sc_search_regexp)
 
 # Don't use Texinfo's @acronym{}.
-# <a  rel="nofollow" href="http://lists.gnu.org/archive/html/bug-gnulib/2010-03/msg00321.html">http://lists.gnu.org/archive/html/bug-gnulib/2010-03/msg00321.html</a>
+# <a  rel="nofollow" href="https://lists.gnu.org/r/bug-gnulib/2010-03/msg00321.html">https://lists.gnu.org/r/bug-gnulib/2010-03/msg00321.html</a>
 texinfo_suffix_re_ ?= \.(txi|texi(nfo)?)$$
 sc_texinfo_acronym:
 	@prohibit='@acronym\{'						\
@@ -924,9 +996,11 @@ require_exactly_one_NL_at_EOF_ =					\
     }									\
   END { exit defined $$fail }
 sc_prohibit_empty_lines_at_EOF:
-	@perl -le '$(require_exactly_one_NL_at_EOF_)' $$($(VC_LIST_EXCEPT)) \
-	  || { echo '$(ME): empty line(s) or no newline at EOF'		\
-		1&gt;&amp;2; exit 1; } || :
+	@$(VC_LIST_EXCEPT)						\
+	  | xargs perl -le '$(require_exactly_one_NL_at_EOF_)'		\
+	  || { echo '$(ME): empty line(s) or no newline at EOF' 1&gt;&amp;2;	\
+	       exit 1; }						\
+	  || :
 
 # Make sure we don't use st_blocks.  Use ST_NBLOCKS instead.
 # This is a bit of a kludge, since it prevents use of the string
@@ -952,8 +1026,13 @@ perl_filename_lineno_text_ =						\
     -e '    print &quot;$$ARGV:$$n:$$v\n&quot;;'					\
     -e '  }'
 
+prohibit_doubled_words_ = \
+    the then in an on if is it but for or at and do to
+# expand the regex before running the check to avoid using expensive captures
+prohibit_doubled_word_expanded_ = \
+    $(join $(prohibit_doubled_words_),$(addprefix \s+,$(prohibit_doubled_words_)))
 prohibit_doubled_word_RE_ ?= \
-  /\b(then?|[iao]n|i[fst]|but|f?or|at|and|[dt]o)\s+\1\b/gims
+    /\b(?:$(subst $(_sp),|,$(prohibit_doubled_word_expanded_)))\b/gims
 prohibit_doubled_word_ =						\
     -e 'while ($(prohibit_doubled_word_RE_))'				\
     $(perl_filename_lineno_text_)
@@ -964,9 +1043,12 @@ prohibit_doubled_word_ =						\
 ignore_doubled_word_match_RE_ ?= ^$$
 
 sc_prohibit_doubled_word:
-	@perl -n -0777 $(prohibit_doubled_word_) $$($(VC_LIST_EXCEPT))	\
-	  | grep -vE '$(ignore_doubled_word_match_RE_)'			\
-	  | grep . &amp;&amp; { echo '$(ME): doubled words' 1&gt;&amp;2; exit 1; } || :
+	@$(VC_LIST_EXCEPT)						\
+	  | xargs perl -n -0777 $(prohibit_doubled_word_)		\
+	  | $(GREP) -vE '$(ignore_doubled_word_match_RE_)'		\
+	  | $(GREP) .							\
+	  &amp;&amp; { echo '$(ME): doubled words' 1&gt;&amp;2; exit 1; }		\
+	  || :
 
 # A regular expression matching undesirable combinations of words like
 # &quot;can not&quot;; this matches them even when the two words appear on different
@@ -976,10 +1058,11 @@ sc_prohibit_doubled_word:
 # Also prohibit a prefix matching &quot;\w+ +&quot;.
 # @pxref gets the same see/also treatment and should be parenthesized;
 # presume it must *not* start a sentence.
+# POSIX spells it &quot;timestamp&quot; rather than &quot;time\s+stamp&quot;, so we do, too.
 bad_xref_re_ ?= (?:[\w,:;] +|(?:see|also)\s+)\@xref\{
 bad_pxref_re_ ?= (?:[.!?]|(?:see|also))\s+\@pxref\{
 prohibit_undesirable_word_seq_RE_ ?=					\
-  /(?:\bcan\s+not\b|$(bad_xref_re_)|$(bad_pxref_re_))/gims
+  /(?:\bcan\s+not\b|\btime\s+stamps?\b|$(bad_xref_re_)|$(bad_pxref_re_))/gims
 prohibit_undesirable_word_seq_ =					\
     -e 'while ($(prohibit_undesirable_word_seq_RE_))'			\
     $(perl_filename_lineno_text_)
@@ -989,10 +1072,20 @@ prohibit_undesirable_word_seq_ =					\
 ignore_undesirable_word_sequence_RE_ ?= ^$$
 
 sc_prohibit_undesirable_word_seq:
-	@perl -n -0777 $(prohibit_undesirable_word_seq_)		\
-	     $$($(VC_LIST_EXCEPT))					\
-	  | grep -vE '$(ignore_undesirable_word_sequence_RE_)' | grep .	\
-	  &amp;&amp; { echo '$(ME): undesirable word sequence' &gt;&amp;2; exit 1; } || :
+	@$(VC_LIST_EXCEPT)						\
+	  | xargs perl -n -0777 $(prohibit_undesirable_word_seq_)	\
+	  | $(GREP) -vE '$(ignore_undesirable_word_sequence_RE_)'	\
+	  | $(GREP) .							\
+	  &amp;&amp; { echo '$(ME): undesirable word sequence' &gt;&amp;2; exit 1; }   \
+	  || :
+
+# Except for shell files and for loops, double semicolon is probably a mistake
+sc_prohibit_double_semicolon:
+	@prohibit='; *;[	{} \]*(/[/*]|$$)'			\
+	in_vc_files='\.[chly]$$'					\
+	exclude='\bfor *\(.*\)'						\
+	halt=&quot;Double semicolon detected&quot;				\
+	  $(_sc_search_regexp)
 
 _ptm1 = use &quot;test C1 &amp;&amp; test C2&quot;, not &quot;test C1 -''a C2&quot;
 _ptm2 = use &quot;test C1 || test C2&quot;, not &quot;test C1 -''o C2&quot;
@@ -1016,7 +1109,8 @@ sc_prohibit_test_double_equal:
 # definition of LDADD from the appropriate Makefile.am and exits 0
 # when it contains &quot;ICONV&quot;.
 sc_proper_name_utf8_requires_ICONV:
-	@progs=$$(grep -l 'proper_name_utf8 ''(&quot;' $$($(VC_LIST_EXCEPT)));\
+	@progs=$$($(VC_LIST_EXCEPT)					\
+		    | xargs $(GREP) -l 'proper_name_utf8 ''(&quot;');	\
 	if test &quot;x$$progs&quot; != x; then					\
 	  fail=0;							\
 	  for p in $$progs; do						\
@@ -1025,7 +1119,7 @@ sc_proper_name_utf8_requires_ICONV:
 	      -ne 'exit !(/^LDADD =(.+?[^\\]\n)/ms &amp;&amp; $$1 =~ /ICONV/)'	\
 	      $$dir/Makefile.am &amp;&amp; continue;				\
 	    base=$$(basename &quot;$$p&quot; .c);					\
-	    grep &quot;$${base}_LDADD.*ICONV)&quot; $$dir/Makefile.am &gt; /dev/null	\
+	    $(GREP) &quot;$${base}_LDADD.*ICONV)&quot; $$dir/Makefile.am &gt; /dev/null	\
 	      || { fail=1; echo 1&gt;&amp;2 &quot;$(ME): $$p uses proper_name_utf8&quot;; }; \
 	  done;								\
 	  test $$fail = 1 &amp;&amp;						\
@@ -1086,12 +1180,12 @@ sc_makefile_at_at_check:
           -e ' &amp;&amp; !/(\w+)\s+=.*\@\1\@$$/'				\
           -e ''$(_makefile_at_at_check_exceptions)			\
 	  -e 'and (print &quot;$$ARGV:$$.: $$_&quot;), $$m=1; END {exit !$$m}'	\
-	    $$($(VC_LIST_EXCEPT) | grep -E '(^|/)(Makefile\.am|[^/]+\.mk)$$') \
+	    $$($(VC_LIST_EXCEPT) | $(GREP) -E '(^|/)(Makefile\.am|[^/]+\.mk)$$') \
 	  &amp;&amp; { echo '$(ME): use $$(...), not @...@' 1&gt;&amp;2; exit 1; } || :
 
 news-check: NEWS
 	$(AM_V_GEN)if $(SED) -n $(news-check-lines-spec)p $&lt;		\
-	    | grep -E $(news-check-regexp) &gt;/dev/null; then		\
+	    | $(GREP) -E $(news-check-regexp) &gt;/dev/null; then		\
 	  :;								\
 	else								\
 	  echo 'NEWS: $$(news-check-regexp) failed to match' 1&gt;&amp;2;	\
@@ -1114,6 +1208,21 @@ fix_po_file_diag = \
 'you have changed the set of files with translatable diagnostics;\n\
 apply the above patch\n'
 
+# Generate a list of files in which to search for translatable strings.
+perl_translatable_files_list_ =						\
+  -e 'foreach $$file (@ARGV) {'						\
+  -e '	\# Consider only file extensions with one or two letters'	\
+  -e '	$$file =~ /\...?$$/ or next;'					\
+  -e '	\# Ignore m4 and mk files'					\
+  -e '	$$file =~ /\.m[4k]$$/ and next;'				\
+  -e '	\# Ignore a .c or .h file with a corresponding .l or .y file'	\
+  -e '	$$file =~ /(.+)\.[ch]$$/ &amp;&amp; (-e &quot;$${1}.l&quot; || -e &quot;$${1}.y&quot;)'	\
+  -e '	  and next;'							\
+  -e '	\# Skip unreadable files'					\
+  -e '	-r $$file or next;'						\
+  -e '	print &quot;$$file &quot;;'						\
+  -e '}'
+
 # Verify that all source files using _() (more specifically, files that
 # match $(_gl_translatable_string_re)) are listed in po/POTFILES.in.
 po_file ?= $(srcdir)/po/POTFILES.in
@@ -1121,25 +1230,13 @@ generated_files ?= $(srcdir)/lib/*.[ch]
 _gl_translatable_string_re ?= \b(N?_|gettext *)\([^)&quot;]*(&quot;|$$)
 sc_po_check:
 	@if test -f $(po_file); then					\
-	  grep -E -v '^(#|$$)' $(po_file)				\
-	    | grep -v '^src/false\.c$$' | sort &gt; $@-1;			\
-	  files=;							\
-	  for file in $$($(VC_LIST_EXCEPT)) $(generated_files); do	\
-	    test -r $$file || continue;					\
-	    case $$file in						\
-	      *.m4|*.mk) continue ;;					\
-	      *.?|*.??) ;;						\
-	      *) continue;;						\
-	    esac;							\
-	    case $$file in						\
-	    *.[ch])							\
-	      base=`expr &quot; $$file&quot; : ' \(.*\)\..'`;			\
-	      { test -f $$base.l || test -f $$base.y; } &amp;&amp; continue;;	\
-	    esac;							\
-	    files=&quot;$$files $$file&quot;;					\
-	  done;								\
-	  grep -E -l '$(_gl_translatable_string_re)' $$files		\
-	    | $(SED) 's|^$(_dot_escaped_srcdir)/||' | sort -u &gt; $@-2;	\
+	  $(GREP) -E -v '^(#|$$)' $(po_file)				\
+	    | $(GREP) -v '^src/false\.c$$' | sort &gt; $@-1;		\
+	  { $(VC_LIST_EXCEPT); echo $(generated_files); }		\
+	    | xargs perl $(perl_translatable_files_list_)		\
+	    | xargs $(GREP) -E -l '$(_gl_translatable_string_re)'	\
+	    | $(SED) 's|^$(_dot_escaped_srcdir)/||'			\
+	    | sort -u &gt; $@-2;						\
 	  diff -u -L $(po_file) -L $(po_file) $@-1 $@-2			\
 	    || { printf '$(ME): '$(fix_po_file_diag) 1&gt;&amp;2; exit 1; };	\
 	  rm -f $@-1 $@-2;						\
@@ -1203,18 +1300,21 @@ _hv_regex_weak ?= ^ *\. .*/init\.sh&quot;
 _hv_regex_strong ?= ^ *\. &quot;\$${srcdir=\.}/init\.sh&quot;
 sc_cross_check_PATH_usage_in_tests:
 	@if test -f $(_hv_file); then					\
-	  grep -l 'VERSION mismatch' $(_hv_file) &gt;/dev/null		\
+	  $(GREP) -l 'VERSION mismatch' $(_hv_file) &gt;/dev/null		\
 	    || { echo &quot;$@: skipped: no such file: $(_hv_file)&quot; 1&gt;&amp;2;	\
 		 exit 0; };						\
-	  grep -lE '$(_hv_regex_strong)' $(_hv_file) &gt;/dev/null		\
+	  $(GREP) -lE '$(_hv_regex_strong)' $(_hv_file) &gt;/dev/null	\
 	    || { echo &quot;$@: $(_hv_file) lacks conforming use of init.sh&quot; 1&gt;&amp;2; \
 		 exit 1; };						\
-	  good=$$(grep -E '$(_hv_regex_strong)' $(_hv_file));		\
-	  grep -LFx &quot;$$good&quot;						\
-		$$(grep -lE '$(_hv_regex_weak)' $$($(VC_LIST_EXCEPT)))	\
-	      | grep . &amp;&amp;						\
-	    { echo &quot;$(ME): the above files use path_prepend_ inconsistently&quot; \
-		1&gt;&amp;2; exit 1; } || :;					\
+	  good=$$($(GREP) -E '$(_hv_regex_strong)' $(_hv_file));	\
+	  $(VC_LIST_EXCEPT)						\
+	    | xargs $(GREP) -lE '$(_hv_regex_weak)'			\
+	    | xargs $(GREP) -LFx &quot;$$good&quot;				\
+	    | $(GREP) .							\
+	    &amp;&amp; { printf &quot;$(ME): the above files use&quot;			\
+			&quot; path_prepend_ inconsistently\n&quot; 1&gt;&amp;2;		\
+		 exit 1; }						\
+	    || :;							\
 	fi
 
 # BRE regex of file contents to identify a test script.
@@ -1251,7 +1351,7 @@ sc_vulnerable_makefile_CVE-2009-4029:
 	halt=$$(printf '%s\n'						\
 	  'the above files are vulnerable; beware of running'		\
 	  '  &quot;make dist*&quot; rules, and upgrade to fixed automake'		\
-	  '  see <a  rel="nofollow" href="http://bugzilla.redhat.com/542609">http://bugzilla.redhat.com/542609</a> for details')	\
+	  '  see <a  rel="nofollow" href="https://bugzilla.redhat.com/show_bug.cgi?id=542609">https://bugzilla.redhat.com/show_bug.cgi?id=542609</a> for details') \
 	  $(_sc_search_regexp)
 
 sc_vulnerable_makefile_CVE-2012-3386:
@@ -1260,7 +1360,7 @@ sc_vulnerable_makefile_CVE-2012-3386:
 	halt=$$(printf '%s\n'						\
 	  'the above files are vulnerable; beware of running'		\
 	  '  &quot;make distcheck&quot;, and upgrade to fixed automake'		\
-	  '  see <a  rel="nofollow" href="http://bugzilla.redhat.com/CVE-2012-3386">http://bugzilla.redhat.com/CVE-2012-3386</a> for details')	\
+	  '  see <a  rel="nofollow" href="https://bugzilla.redhat.com/show_bug.cgi?id=CVE-2012-3386">https://bugzilla.redhat.com/show_bug.cgi?id=CVE-2012-3386</a> for details') \
 	  $(_sc_search_regexp)
 
 vc-diff-check:
@@ -1275,7 +1375,6 @@ vc-diff-check:
 
 rel-files = $(DIST_ARCHIVES)
 
-gnulib_dir ?= $(srcdir)/gnulib
 gnulib-version = $$(cd $(gnulib_dir)				\
                     &amp;&amp; { git describe || git rev-parse --short=10 HEAD; } )
 bootstrap-tools ?= autoconf,automake,gnulib
@@ -1287,7 +1386,7 @@ gpg_key_ID ?=								\
   $$(cd $(srcdir)							\
      &amp;&amp; git cat-file tag v$(VERSION)					\
         | $(gpgv) --status-fd 1 --keyring /dev/null - - 2&gt;/dev/null	\
-        | awk '/^\[GNUPG:\] ERRSIG / {print $$3; exit}')
+        | $(AWK) '/^\[GNUPG:\] ERRSIG / {print $$3; exit}')
 
 translation_project_ ?= coordinator@xxxxxxxxxxxxxxxxxxxxxx
 
@@ -1336,8 +1435,8 @@ release-commit:
 ## Updating files.  ##
 ## ---------------- ##
 
-ftp-gnu = <a  rel="nofollow" href="ftp://ftp.gnu.org/gnu">ftp://ftp.gnu.org/gnu</a>
-www-gnu = <a  rel="nofollow" href="http://www.gnu.org">http://www.gnu.org</a>
+ftp-gnu = <a  rel="nofollow" href="https://ftp.gnu.org/gnu">https://ftp.gnu.org/gnu</a>
+www-gnu = <a  rel="nofollow" href="https://www.gnu.org">https://www.gnu.org</a>
 
 upload_dest_dir_ ?= $(PACKAGE)
 upload_command =						\
@@ -1408,7 +1507,7 @@ check: $(gl_public_submodule_commit)
 ALL_RECURSIVE_TARGETS += alpha beta stable
 alpha beta stable: $(local-check) writable-files $(submodule-checks)
 	$(AM_V_GEN)test $@ = stable					\
-	  &amp;&amp; { echo $(VERSION) | grep -E '^[0-9]+(\.[0-9]+)+$$'		\
+	  &amp;&amp; { echo $(VERSION) | $(GREP) -E '^[0-9]+(\.[0-9]+)+$$'	\
 	       || { echo &quot;invalid version string: $(VERSION)&quot; 1&gt;&amp;2; exit 1;};}\
 	  || :
 	$(AM_V_at)$(MAKE) vc-diff-check
@@ -1485,7 +1584,10 @@ gen-coverage:
 		--highlight --frames --legend \
 		--title &quot;$(PACKAGE_NAME)&quot;
 
-coverage: init-coverage build-coverage gen-coverage
+coverage:
+	$(MAKE) init-coverage
+	$(MAKE) build-coverage
+	$(MAKE) gen-coverage
 
 # Some projects carry local adjustments for gnulib modules via patches in
 # a gnulib patch directory whose default name is gl/ (defined in bootstrap
@@ -1503,7 +1605,7 @@ refresh-gnulib-patches:
 	       -e 'END{defined $$d and print $$d}' bootstrap.conf);	\
 	  test -n &quot;$$t&quot; &amp;&amp; gl=$$t;					\
 	fi;								\
-	for diff in $$(cd $$gl; git ls-files | grep '\.diff$$'); do	\
+	for diff in $$(cd $$gl; git ls-files | $(GREP) '\.diff$$'); do	\
 	  b=$$(printf %s &quot;$$diff&quot;|$(SED) 's/\.diff$$//');		\
 	  VERSION_CONTROL=none						\
 	    patch &quot;$(gnulib_dir)/$$b&quot; &quot;$$gl/$$diff&quot; || exit 1;		\
@@ -1515,7 +1617,7 @@ refresh-gnulib-patches:
 # Update gettext files.
 PACKAGE ?= $(shell basename $(PWD))
 PO_DOMAIN ?= $(PACKAGE)
-POURL = <a  rel="nofollow" href="http://translationproject.org/latest/$">http://translationproject.org/latest/$</a>(PO_DOMAIN)/
+POURL = <a  rel="nofollow" href="https://translationproject.org/latest/$">https://translationproject.org/latest/$</a>(PO_DOMAIN)/
 PODIR ?= po
 refresh-po:
 	rm -f $(PODIR)/*.po &amp;&amp; \
@@ -1546,7 +1648,7 @@ update-copyright-env ?=
 # in the file .x-update-copyright.
 .PHONY: update-copyright
 update-copyright:
-	$(AM_V_GEN)grep -l -w Copyright                                  \
+	$(AM_V_GEN)$(GREP) -l -w Copyright                               \
 	  $$(export VC_LIST_EXCEPT_DEFAULT=COPYING &amp;&amp; $(VC_LIST_EXCEPT)) \
 	  | $(update-copyright-env) xargs $(srcdir)/$(_build-aux)/$@
 
@@ -1560,9 +1662,9 @@ _gl_TS_dir ?= src
 ALL_RECURSIVE_TARGETS += sc_tight_scope
 sc_tight_scope: tight-scope.mk
 	@fail=0;							\
-	if ! grep '^ *export _gl_TS_headers *=' $(srcdir)/cfg.mk	\
+	if ! $(GREP) '^ *export _gl_TS_headers *=' $(srcdir)/cfg.mk	\
 		&gt; /dev/null						\
-	   &amp;&amp; ! grep -w noinst_HEADERS $(srcdir)/$(_gl_TS_dir)/Makefile.am \
+	   &amp;&amp; ! $(GREP) -w noinst_HEADERS $(srcdir)/$(_gl_TS_dir)/Makefile.am \
 		&gt; /dev/null 2&gt;&amp;1; then					\
 	    echo '$(ME): skipping $@';					\
 	else								\
@@ -1590,7 +1692,7 @@ ifeq (a,b)
 # do not need to be marked.  Symbols matching '__.*' are
 # reserved by the compiler, so are automatically excluded below.
 _gl_TS_unmarked_extern_functions ?= main usage
-_gl_TS_function_match ?= /^(?:$(_gl_TS_extern)) +.*?(\S+) *\(/
+_gl_TS_function_match ?= /^(?:$(_gl_TS_extern)) +.*?(\w+) *\(/
 
 # If your project uses a macro like &quot;XTERN&quot;, then put
 # the following in cfg.mk to override this default:
@@ -1623,6 +1725,7 @@ _gl_TS_other_headers ?= *.h
 
 .PHONY: _gl_tight_scope
 _gl_tight_scope: $(bin_PROGRAMS)
+	sed_wrap='s/^/^_?/;s/$$/$$/';					\
 	t=exceptions-$$$$;						\
 	trap 's=$$?; rm -f $$t; exit $$s' 0;				\
 	for sig in 1 2 3 13 15; do					\
@@ -1632,21 +1735,21 @@ _gl_tight_scope: $(bin_PROGRAMS)
 	       test -f $$f &amp;&amp; d= || d=$(srcdir)/; echo $$d$$f; done`;	\
 	hdr=`for f in $(_gl_TS_headers); do				\
 	       test -f $$f &amp;&amp; d= || d=$(srcdir)/; echo $$d$$f; done`;	\
-	( printf '^%s$$\n' '__.*' $(_gl_TS_unmarked_extern_functions);	\
-	  grep -h -A1 '^extern .*[^;]$$' $$src				\
-	    | grep -vE '^(extern |--)' | $(SED) 's/ .*//';		\
+	( printf '%s\n' '__.*' $(_gl_TS_unmarked_extern_functions);	\
+	  $(GREP) -h -A1 '^extern .*[^;]$$' $$src			\
+	    | $(GREP) -vE '^(extern |--|#)' | $(SED) 's/ .*//; /^$$/d';	\
 	  perl -lne							\
-	     '$(_gl_TS_function_match) and print &quot;^$$1\$$&quot;' $$hdr;	\
-	) | sort -u &gt; $$t;						\
-	nm -e $(_gl_TS_obj_files)|$(SED) -n 's/.* T //p'|grep -Ev -f $$t \
+	     '$(_gl_TS_function_match) and print $$1' $$hdr;		\
+	) | sort -u | $(SED) &quot;$$sed_wrap&quot; &gt; $$t;			\
+	nm -g $(_gl_TS_obj_files)|$(SED) -n 's/.* T //p'|$(GREP) -Ev -f $$t \
 	  &amp;&amp; { echo the above functions should have static scope &gt;&amp;2;	\
 	       exit 1; } || : ;						\
-	( printf '^%s$$\n' '__.*' $(_gl_TS_unmarked_extern_vars);	\
-	  perl -lne '$(_gl_TS_var_match) and print &quot;^$$1\$$&quot;'		\
+	( printf '%s\n' '__.*' main $(_gl_TS_unmarked_extern_vars);	\
+	  perl -lne '$(_gl_TS_var_match) and print $$1'			\
 		$$hdr $(_gl_TS_other_headers)				\
-	) | sort -u &gt; $$t;						\
-	nm -e $(_gl_TS_obj_files) | $(SED) -n 's/.* [BCDGRS] //p'	\
-            | sort -u | grep -Ev -f $$t					\
+	) | sort -u | $(SED) &quot;$$sed_wrap&quot; &gt; $$t;			\
+	nm -g $(_gl_TS_obj_files) | $(SED) -n 's/.* [BCDGRS] //p'	\
+            | sort -u | $(GREP) -Ev -f $$t				\
 	  &amp;&amp; { echo the above variables should have static scope &gt;&amp;2;	\
 	       exit 1; } || :
 # TS-end
-- 
2.21.0

_______________________________________________
Libosinfo mailing list
Libosinfo@xxxxxxxxxx
<a  rel="nofollow" href="https://www.redhat.com/mailman/listinfo/libosinfo">https://www.redhat.com/mailman/listinfo/libosinfo</a>



</pre>
<!--X-Body-of-Message-End-->
<!--X-MsgBody-End-->
<!--X-Follow-Ups-->
</div>
<hr>
<!--X-Follow-Ups-End-->
<!--X-References-->
<!--X-References-End-->
<!--X-BotPNI-->
<ul>
<li>Prev by Date:
<strong><a href="msg05995.html">[osinfo-db-tools PATCH v2 09/16] spec: Adapt to use	meson</a></strong>
</li>
<li>Next by Date:
<strong><a href="msg05992.html">[osinfo-db-tools PATCH v2 11/16] prepare-release: Adapt	to use meson</a></strong>
</li>
<li>Previous by thread:
<strong><a href="msg05995.html">[osinfo-db-tools PATCH v2 09/16] spec: Adapt to use	meson</a></strong>
</li>
<li>Next by thread:
<strong><a href="msg05992.html">[osinfo-db-tools PATCH v2 11/16] prepare-release: Adapt	to use meson</a></strong>
</li>
<li>Index(es):
<ul>
<li><a href="maillist.html#05991"><strong>Date</strong></a></li>
<li><a href="index.html#05991"><strong>Thread</strong></a></li>
</ul>
</li>
</ul>

<!--X-BotPNI-End-->
<!--X-User-Footer-->
<center>
<font size=-1>
<a href=/lists/>[Index&nbsp;of&nbsp;Archives]</a>
&nbsp;
&nbsp;
<a href=/lists/virt-tools/>[Virt&nbsp;Tools]</a>
&nbsp;
&nbsp;
<a href=/linux/fedora/libvirt-users/>[Libvirt&nbsp;Users]</a>
&nbsp;
&nbsp;
<a href=/linux/fedora/fedora-users/>[Fedora&nbsp;Users]</a>
&nbsp;
&nbsp;
<a href=/linux/fedora/fedora-maintainers/>[Fedora&nbsp;Maintainers]</a>
&nbsp;
&nbsp;
<a href=/lists/fedora-desktop/>[Fedora&nbsp;Desktop]</a>
&nbsp;
&nbsp;
<a href=/lists/fedora-selinux/>[Fedora&nbsp;SELinux]</a>
&nbsp;
&nbsp;
<a href=http://www.ske-art.com/z/biglist.html>[Big&nbsp;List&nbsp;of&nbsp;Linux&nbsp;Books]</a>
&nbsp;
&nbsp;
<a href=https://yosemitenews.info>[Yosemite&nbsp;News]</a>
&nbsp;
&nbsp;
<a href=/lists/kde/>[KDE&nbsp;Users]</a>
</font>
</center>
<p>
<div>
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<ins class="adsbygoogle"
     style="display:block"
     data-ad-format="autorelaxed"
     data-ad-client="ca-pub-3422782820843221"
     data-ad-slot="1424524564"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
</div>
<table width=100%>
<tr>
<td align=left>&nbsp;</td>
<td align=right><a href=/lists/><img src=/button_01.gif border=0 alt="Powered by Linux"></a></td>
</tr>
</table>
<!--X-User-Footer-End-->
<script type="text/javascript"> 
 function initAddThis() {
    addthis.init()
 }
initAddThis();
</script>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-760190-1', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
