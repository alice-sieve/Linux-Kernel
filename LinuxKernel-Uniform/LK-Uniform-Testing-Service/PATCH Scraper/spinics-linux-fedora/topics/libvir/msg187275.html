<!-- MHonArc v2.6.19 -->
<!--X-Subject: Re:  [PATCH v4 04/23] conf: Extend TPM XML parser with encryption support -->
<!--X-From-R13: Rnavry =?hgs&#45;8?P?GQ4tCzHlpzThL8Ac?= &#60;oreenatrNerqung.pbz> -->
<!--X-Date: Fri, 12 Jul 2019 02:30:23 &#45;0700 -->
<!--X-Message-Id: 20190712093002.GH5068@redhat.com -->
<!--X-Content-Type: text/plain -->
<!--X-Reference: 20190711194151.3728114&#45;1&#45;stefanb@linux.vnet.ibm.com -->
<!--X-Reference: 20190711194151.3728114&#45;5&#45;stefanb@linux.vnet.ibm.com -->
<!--X-Head-End-->
<!doctype html public "-//W3C//DTD HTML//EN">
<html>
<head>
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({
          google_ad_client: "ca-pub-3422782820843221",
          enable_page_level_ads: true
     });
</script>
<style>
<!--
 pre {white-space: pre-wrap;}
-->
</style>
<title>libvirt &mdash; Re:  [PATCH v4 04/23] conf: Extend TPM XML parser with encryption support</title>
<meta name="description" content="libvirt: Re:  [PATCH v4 04/23] conf: Extend TPM XML parser with encryption support">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="alternate" type="application/rss+xml" title="Libvirt Development" href="//feeds.feedburner.com/Libvir">
</head>
<body itemscope itemtype="//schema.org/Article" vlink=green>
<!--X-Body-Begin-->
<!--X-User-Header-->
<!--X-User-Header-End-->
<!--X-TopPNI-->
<form action="//www.google.com" id="cse-search-box" target="_blank">
  <div>
    <input type="hidden" name="cx" value="partner-pub-3422782820843221:8422278960" />
    <input type="hidden" name="ie" value="UTF-8" />
    <input type="text" name="q" size="55" />
    <input type="submit" name="sa" value="Search" />
  </div>
</form>
<script type="text/javascript" src="//www.google.com/coop/cse/brand?form=cse-search-box&amp;lang=en"></script>
<h1>Re:  [PATCH v4 04/23] conf: Extend TPM XML parser with encryption support</h1>
[<a href="msg187274.html">Date Prev</a>][<a href="msg187276.html">Date Next</a>][<a href="msg187241.html">Thread Prev</a>][<a href="msg187242.html">Thread Next</a>][<a href="maillist.html#187275">Date Index</a>][<a href="index.html#187275">Thread Index</a>] 


<p>&nbsp;<br>
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- responsive test for archives -->
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-3422782820843221"
     data-ad-slot="6345952567"
     data-ad-format="auto"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>

<!--X-TopPNI-End-->
<!--X-MsgBody-->
<!--X-Subject-Header-Begin-->
<hr>
<!--X-Subject-Header-End-->
<!--X-Head-of-Message-->
<ul>
<li><em>Subject</em>: Re:  [PATCH v4 04/23] conf: Extend TPM XML parser with encryption support</li>
<li><em>From</em>: Daniel P. Berrang&#xE9; &lt;berrange@xxxxxxxxxx&gt;</li>
<li><em>Date</em>: Fri, 12 Jul 2019 10:30:02 +0100</li>
<li><em>Cc</em>: libvir-list@xxxxxxxxxx, marcandre.lureau@xxxxxxxxxx,        Stefan Berger &lt;stefanb@xxxxxxxxxxxxx&gt;</li>
<li><em>In-reply-to</em>: &lt;<a href="msg187241.html">20190711194151.3728114-5-stefanb@linux.vnet.ibm.com</a>&gt;</li>
<li><em>References</em>: &lt;<a href="msg187236.html">20190711194151.3728114-1-stefanb@linux.vnet.ibm.com</a>&gt;	&lt;<a href="msg187241.html">20190711194151.3728114-5-stefanb@linux.vnet.ibm.com</a>&gt;</li>
<li><em>Reply-to</em>: Daniel P. Berrang&#xE9; &lt;berrange@xxxxxxxxxx&gt;</li>
<li><em>User-agent</em>: Mutt/1.12.0 (2019-05-25)</li>
</ul>
<!--X-Head-of-Message-End-->
<!--X-Head-Body-Sep-Begin-->
<!-- AddThis Button BEGIN -->
<div class="addthis_toolbox addthis_default_style ">
<a class="addthis_button_preferred_1"></a>
<a class="addthis_button_preferred_2"></a>
<a class="addthis_button_preferred_3"></a>
<a class="addthis_button_preferred_4"></a>
<a class="addthis_button_compact"></a>
<a class="addthis_counter addthis_bubble_style"></a>
</div>
<script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5196c2ae1be43d18&async=1&domready=1" async></script>
<!-- AddThis Button END -->
<hr>
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- responsive link 1 -->
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-3422782820843221"
     data-ad-slot="8681825769"
     data-ad-format="link"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
<p>
<div class="content" itemprop="articleBody">
<!--X-Head-Body-Sep-End-->
<!--X-Body-of-Message-->
<pre>On Thu, Jul 11, 2019 at 03:41:32PM -0400, Stefan Berger wrote:
&gt; Extend the TPM device XML parser and XML generator with emulator
&gt; state encryption support.
&gt; 
&gt; Signed-off-by: Stefan Berger &lt;stefanb@xxxxxxxxxxxxx&gt;
&gt; Reviewed-by: Marc-Andr&#xE9; Lureau &lt;marcandre.lureau@xxxxxxxxxx&gt;
&gt; ---
&gt;  src/conf/domain_conf.c | 40 +++++++++++++++++++++++++++++++++++++++-
&gt;  src/conf/domain_conf.h |  1 +
&gt;  2 files changed, 40 insertions(+), 1 deletion(-)
&gt; 
&gt; diff --git a/src/conf/domain_conf.c b/src/conf/domain_conf.c
&gt; index 3323c9a5b1..df6238c299 100644
&gt; --- a/src/conf/domain_conf.c
&gt; +++ b/src/conf/domain_conf.c
&gt; @@ -2950,6 +2950,7 @@ void virDomainTPMDefFree(virDomainTPMDefPtr def)
&gt;          virDomainChrSourceDefClear(&amp;def-&gt;data.emulator.source);
&gt;          VIR_FREE(def-&gt;data.emulator.storagepath);
&gt;          VIR_FREE(def-&gt;data.emulator.logfile);
&gt; +        virStorageEncryptionFree(def-&gt;data.emulator.encryption);
&gt;          break;
&gt;      case VIR_DOMAIN_TPM_TYPE_LAST:
&gt;          break;
&gt; @@ -13048,6 +13049,16 @@ virDomainSmartcardDefParseXML(virDomainXMLOptionPtr xmlopt,
&gt;   * &lt;tpm model='tpm-tis'&gt;
&gt;   *   &lt;backend type='emulator' version='2'/&gt;
&gt;   * &lt;/tpm&gt;
&gt; + *
&gt; + * Emulator state encryption is supported with the following:
&gt; + *
&gt; + * &lt;tpm model='tpm-tis'&gt;
&gt; + *   &lt;backend type='emulator' version='2'&gt;
&gt; + *     &lt;encryption format='vtpm'&gt;
&gt; + *        &lt;secret type='passphrase' uuid='32ee7e76-2178-47a1-ab7b-269e6e348015'/&gt;
&gt; + *     &lt;/encryption&gt;
&gt; + *   &lt;/backend&gt;
&gt; + * &lt;/tpm&gt;

Again this feels rather odd to me - we're just providing a password to
the swtpm process. We don't need to have a choice of encyption formats
in the XML - the way this is implemented allows you to specify lusk or
qcow2 for encryption which is rather meaningless here, and likewise
allows vtpm for disk encryption.

We should just be referencing the secret without this extra level of
XML nesting eg

   &lt;encrypt secret=&quot;.....uuid...&quot;/&gt;

and avoid use of virStorageEncryption entirely.

Regards,
Daniel
-- 
|: <a  rel="nofollow" href="https://berrange.com">https://berrange.com</a>      -o-    <a  rel="nofollow" href="https://www.flickr.com/photos/dberrange">https://www.flickr.com/photos/dberrange</a> :|
|: <a  rel="nofollow" href="https://libvirt.org">https://libvirt.org</a>         -o-            <a  rel="nofollow" href="https://fstop138.berrange.com">https://fstop138.berrange.com</a> :|
|: <a  rel="nofollow" href="https://entangle-photo.org">https://entangle-photo.org</a>    -o-    <a  rel="nofollow" href="https://www.instagram.com/dberrange">https://www.instagram.com/dberrange</a> :|

--
libvir-list mailing list
libvir-list@xxxxxxxxxx
<a  rel="nofollow" href="https://www.redhat.com/mailman/listinfo/libvir-list">https://www.redhat.com/mailman/listinfo/libvir-list</a>



</pre>
<!--X-Body-of-Message-End-->
<!--X-MsgBody-End-->
<!--X-Follow-Ups-->
</div>
<hr>
<!--X-Follow-Ups-End-->
<!--X-References-->
<!--X-References-End-->
<!--X-BotPNI-->
<ul>
<li>Prev by Date:
<strong><a href="msg187274.html">Re:  [PATCH v4 03/23] util: Add VIR_STORAGE_ENCRYPTION_FORMAT_VTPM</a></strong>
</li>
<li>Next by Date:
<strong><a href="msg187276.html">Re:  [PATCH v4 08/23] tpm: Move virtpm.c from utils dir to own tpm dir</a></strong>
</li>
<li>Previous by thread:
<strong><a href="msg187241.html">[PATCH v4 04/23] conf: Extend TPM XML parser with	encryption support</a></strong>
</li>
<li>Next by thread:
<strong><a href="msg187242.html">[PATCH v4 03/23] util: Add	VIR_STORAGE_ENCRYPTION_FORMAT_VTPM</a></strong>
</li>
<li>Index(es):
<ul>
<li><a href="maillist.html#187275"><strong>Date</strong></a></li>
<li><a href="index.html#187275"><strong>Thread</strong></a></li>
</ul>
</li>
</ul>

<!--X-BotPNI-End-->
<!--X-User-Footer-->
<center>
<font size=-1>
<a href=/lists/>[Index&nbsp;of&nbsp;Archives]</a>
&nbsp;
&nbsp;
<a href=/lists/virt-tools/>[Virt&nbsp;Tools]</a>
&nbsp;
&nbsp;
<a href=/linux/fedora/libvirt-users/>[Libvirt&nbsp;Users]</a>
&nbsp;
&nbsp;
<a href=/linux/fedora/libosinfo/>[Lib&nbsp;OS&nbsp;Info]</a>
&nbsp;
&nbsp;
<a href=/linux/fedora/fedora-users/>[Fedora&nbsp;Users]</a>
&nbsp;
&nbsp;
<a href=/lists/fedora-desktop/>[Fedora&nbsp;Desktop]</a>
&nbsp;
&nbsp;
<a href=/lists/fedora-selinux/>[Fedora&nbsp;SELinux]</a>
&nbsp;
&nbsp;
<a href=http://www.ske-art.com/z/biglist.php>[Big&nbsp;List&nbsp;of&nbsp;Linux&nbsp;Books]</a>
&nbsp;
&nbsp;
<a href=https://yosemitenews.info>[Yosemite&nbsp;News]</a>
&nbsp;
&nbsp;
<a href=/lists/kde/>[KDE&nbsp;Users]</a>
&nbsp;
&nbsp;
<a href=/lists/fedora-tools/>[Fedora&nbsp;Tools]</a>
</font>
</center>
<hr>
<p>
<div>
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<ins class="adsbygoogle"
     style="display:block"
     data-ad-format="autorelaxed"
     data-ad-client="ca-pub-3422782820843221"
     data-ad-slot="1424524564"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
</div>
<table width=100%>
<tr>
<td align=left>&nbsp;</td>
<td align=right><a href=/lists/><img src=/button_01.gif border=0 alt="Powered by Linux"></a></td>
</tr>
</table>
<!--X-User-Footer-End-->
<script type="text/javascript"> 
 function initAddThis() {
    addthis.init()
 }
initAddThis();
</script>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-760190-1', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
