<!-- MHonArc v2.6.19 -->
<!--X-Subject: [PATCH 08/29] remote: conditionalize IP socket config in	libvirtd.conf -->
<!--X-From-R13: =?GFT&#45;8?d?Rnavry=20B=2S=20Preenat=Q3=O9?= &#60;oreenatrNerqung.pbz> -->
<!--X-Date: Thu, 11 Jul 2019 09:05:47 &#45;0700 -->
<!--X-Message-Id: 20190711160516.2130&#45;9&#45;berrange@redhat.com -->
<!--X-Content-Type: text/plain -->
<!--X-Reference: 20190711160516.2130&#45;1&#45;berrange@redhat.com -->
<!--X-Head-End-->
<!doctype html public "-//W3C//DTD HTML//EN">
<html>
<head>
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({
          google_ad_client: "ca-pub-3422782820843221",
          enable_page_level_ads: true
     });
</script>
<style>
<!--
 pre {white-space: pre-wrap;}
-->
</style>
<title>libvirt &mdash; [PATCH 08/29] remote: conditionalize IP socket config in	libvirtd.conf</title>
<meta name="description" content="libvirt: [PATCH 08/29] remote: conditionalize IP socket config in	libvirtd.conf">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="alternate" type="application/rss+xml" title="Libvirt Development" href="//feeds.feedburner.com/Libvir">
</head>
<body itemscope itemtype="//schema.org/Article" vlink=green>
<!--X-Body-Begin-->
<!--X-User-Header-->
<!--X-User-Header-End-->
<!--X-TopPNI-->
<form action="//www.google.com" id="cse-search-box" target="_blank">
  <div>
    <input type="hidden" name="cx" value="partner-pub-3422782820843221:8422278960" />
    <input type="hidden" name="ie" value="UTF-8" />
    <input type="text" name="q" size="55" />
    <input type="submit" name="sa" value="Search" />
  </div>
</form>
<script type="text/javascript" src="//www.google.com/coop/cse/brand?form=cse-search-box&amp;lang=en"></script>
<h1>[PATCH 08/29] remote: conditionalize IP socket config in	libvirtd.conf</h1>
[<a href="msg187212.html">Date Prev</a>][<a href="msg187214.html">Date Next</a>][<a href="msg187212.html">Thread Prev</a>][<a href="msg187214.html">Thread Next</a>][<a href="maillist.html#187213">Date Index</a>][<a href="index.html#187213">Thread Index</a>] 


<p>&nbsp;<br>
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- responsive test for archives -->
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-3422782820843221"
     data-ad-slot="6345952567"
     data-ad-format="auto"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>

<!--X-TopPNI-End-->
<!--X-MsgBody-->
<!--X-Subject-Header-Begin-->
<hr>
<!--X-Subject-Header-End-->
<!--X-Head-of-Message-->
<ul>
<li><em>Subject</em>: [PATCH 08/29] remote: conditionalize IP socket config in	libvirtd.conf</li>
<li><em>From</em>: Daniel P. Berrang&#xE9; &lt;berrange@xxxxxxxxxx&gt;</li>
<li><em>Date</em>: Thu, 11 Jul 2019 17:04:55 +0100</li>
<li><em>In-reply-to</em>: &lt;<a href="msg187198.html">20190711160516.2130-1-berrange@redhat.com</a>&gt;</li>
<li><em>References</em>: &lt;<a href="msg187198.html">20190711160516.2130-1-berrange@redhat.com</a>&gt;</li>
</ul>
<!--X-Head-of-Message-End-->
<!--X-Head-Body-Sep-Begin-->
<!-- AddThis Button BEGIN -->
<div class="addthis_toolbox addthis_default_style ">
<a class="addthis_button_preferred_1"></a>
<a class="addthis_button_preferred_2"></a>
<a class="addthis_button_preferred_3"></a>
<a class="addthis_button_preferred_4"></a>
<a class="addthis_button_compact"></a>
<a class="addthis_counter addthis_bubble_style"></a>
</div>
<script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5196c2ae1be43d18&async=1&domready=1" async></script>
<!-- AddThis Button END -->
<hr>
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- responsive link 1 -->
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-3422782820843221"
     data-ad-slot="8681825769"
     data-ad-format="link"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
<p>
<div class="content" itemprop="articleBody">
<!--X-Head-Body-Sep-End-->
<!--X-Body-of-Message-->
<pre>Prepare for reusing libvirtd config to create other daemons by making
the config parameters for IP sockets conditionally defined by the make
rules.

The main libvirtd daemon will retain IP listen ability, but all the
driver specific daemons will be local UNIX sockets only. Apps needing
IP connectivity will connect via the libvirtd daemon which will proxy
to the driver specfic daemon.

Signed-off-by: Daniel P. Berrang&#xE9; &lt;berrange@xxxxxxxxxx&gt;
---
 src/remote/Makefile.inc.am                    | 12 +++++-
 .../{libvirtd.conf =&gt; libvirtd.conf.in}       | 42 +++++++++++--------
 src/remote/test_libvirtd.aug.in               |  2 +-
 3 files changed, 37 insertions(+), 19 deletions(-)
 rename src/remote/{libvirtd.conf =&gt; libvirtd.conf.in} (95%)

diff --git a/src/remote/Makefile.inc.am b/src/remote/Makefile.inc.am
index 25921437e2..4bc71346f2 100644
--- a/src/remote/Makefile.inc.am
+++ b/src/remote/Makefile.inc.am
@@ -71,7 +71,7 @@ EXTRA_DIST += \
 	$(LIBVIRTD_SOURCES) \
 	remote/test_libvirtd.aug.in \
 	remote/libvirtd.aug \
-	remote/libvirtd.conf \
+	remote/libvirtd.conf.in \
 	remote/libvirtd.policy \
 	remote/libvirtd.rules \
 	remote/libvirtd.sasl \
@@ -88,6 +88,9 @@ MAINTAINERCLEANFILES += \
 	$(REMOTE_DRIVER_GENERATED) \
 	$(LIBVIRTD_GENERATED) \
 	$(NULL)
+CLEANFILES += \
+	remote/libvirtd.conf \
+	$(NULL)
 
 if WITH_REMOTE
 noinst_LTLIBRARIES += libvirt_driver_remote.la
@@ -178,6 +181,13 @@ libvirtd_LDADD += \
 	$(LIBSOCKET) \
 	$(NULL)
 
+remote/libvirtd.conf: remote/libvirtd.conf.in
+	$(AM_V_GEN)sed \
+		-e '/:: CUT ENABLE_IP ::/d' \
+		-e '/:: END ::/d' \
+		-e 's/:: DAEMON_NAME ::/libvirtd/' \
+		&lt; $^ &gt; $@
+
 INSTALL_DATA_DIRS += remote
 
 install-data-remote:
diff --git a/src/remote/libvirtd.conf b/src/remote/libvirtd.conf.in
similarity index 95%
rename from src/remote/libvirtd.conf
rename to src/remote/libvirtd.conf.in
index bbeb053495..39da576e68 100644
--- a/src/remote/libvirtd.conf
+++ b/src/remote/libvirtd.conf.in
@@ -1,13 +1,14 @@
 # Master libvirt daemon configuration file
 #
 
+:: CUT ENABLE_IP ::
 #################################################################
 #
 # Network connectivity controls
 #
 
 # Flag listening for secure TLS connections on the public TCP/IP port.
-# NB, must pass the --listen flag to the libvirtd process for this to
+# NB, must pass the --listen flag to the :: DAEMON_NAME :: process for this to
 # have any effect.
 #
 # It is necessary to setup a CA and issue server certificates before
@@ -17,7 +18,7 @@
 #listen_tls = 0
 
 # Listen for unencrypted TCP connections on the public TCP/IP port.
-# NB, must pass the --listen flag to the libvirtd process for this to
+# NB, must pass the --listen flag to the :: DAEMON_NAME :: process for this to
 # have any effect.
 #
 # Using the TCP socket requires SASL authentication by default. Only
@@ -43,13 +44,14 @@
 # Override the default configuration which binds to all network
 # interfaces. This can be a numeric IPv4/6 address, or hostname
 #
-# If the libvirtd service is started in parallel with network
+# If the :: DAEMON_NAME :: service is started in parallel with network
 # startup (e.g. with systemd), binding to addresses other than
 # the wildcards (0.0.0.0/::) might not be available yet.
 #
 #listen_addr = &quot;192.168.0.1&quot;
 
 
+:: END ::
 #################################################################
 #
 # UNIX socket access controls
@@ -126,6 +128,7 @@
 # If the unix_sock_rw_perms are changed you may wish to enable
 # an authentication mechanism here
 #auth_unix_rw = &quot;none&quot;
+:: CUT ENABLE_IP ::
 
 # Change the authentication scheme for TCP sockets.
 #
@@ -143,6 +146,7 @@
 # It is possible to make use of any SASL authentication
 # mechanism as well, by using 'sasl' for this option
 #auth_tls = &quot;none&quot;
+:: END ::
 
 
 # Change the API access control scheme
@@ -151,10 +155,11 @@
 # to all APIs. Access drivers can place restrictions
 # on this. By default the 'nop' driver is enabled,
 # meaning no access control checks are done once a
-# client has authenticated with libvirtd
+# client has authenticated with :: DAEMON_NAME ::
 #
 #access_drivers = [ &quot;polkit&quot; ]
 
+:: CUT ENABLE_IP ::
 #################################################################
 #
 # TLS x509 certificate configuration
@@ -194,15 +199,17 @@
 
 
 
+:: END ::
 #################################################################
 #
 # Authorization controls
 #
 
 
+:: CUT ENABLE_IP ::
 # Flag to disable verification of our own server certificates
 #
-# When libvirtd starts it performs some sanity checks against
+# When :: DAEMON_NAME :: starts it performs some sanity checks against
 # its own certificates.
 #
 # Default is to always run sanity checks. Uncommenting this
@@ -234,6 +241,15 @@
 #tls_allowed_dn_list = [&quot;DN1&quot;, &quot;DN2&quot;]
 
 
+# Override the compile time default TLS priority string. The
+# default is usually &quot;NORMAL&quot; unless overridden at build time.
+# Only set this is it is desired for libvirt to deviate from
+# the global default settings.
+#
+#tls_priority=&quot;NORMAL&quot;
+
+
+:: END ::
 # A whitelist of allowed SASL usernames. The format for username
 # depends on the SASL authentication mechanism. Kerberos usernames
 # look like username@REALM
@@ -251,14 +267,6 @@
 #sasl_allowed_username_list = [&quot;joe@xxxxxxxxxxx&quot;, &quot;fred@xxxxxxxxxxx&quot; ]
 
 
-# Override the compile time default TLS priority string. The
-# default is usually &quot;NORMAL&quot; unless overridden at build time.
-# Only set this is it is desired for libvirt to deviate from
-# the global default settings.
-#
-#tls_priority=&quot;NORMAL&quot;
-
-
 #################################################################
 #
 # Processing controls
@@ -386,8 +394,8 @@
 #    4: ERROR
 #
 # Multiple outputs can be defined, they just need to be separated by spaces.
-# e.g. to log all warnings and errors to syslog under the libvirtd ident:
-#log_outputs=&quot;3:syslog:libvirtd&quot;
+# e.g. to log all warnings and errors to syslog under the :: DAEMON_NAME :: ident:
+#log_outputs=&quot;3:syslog::: DAEMON_NAME ::&quot;
 
 
 ##################################################################
@@ -430,7 +438,7 @@
 
 ###################################################################
 # Keepalive protocol:
-# This allows libvirtd to detect broken client connections or even
+# This allows :: DAEMON_NAME :: to detect broken client connections or even
 # dead clients.  A keepalive message is sent to a client after
 # keepalive_interval seconds of inactivity to check if the client is
 # still responding; keepalive_count is a maximum number of keepalive
@@ -439,7 +447,7 @@
 # words, the connection is automatically closed approximately after
 # keepalive_interval * (keepalive_count + 1) seconds since the last
 # message received from the client.  If keepalive_interval is set to
-# -1, libvirtd will never send keepalive requests; however clients
+# -1, :: DAEMON_NAME :: will never send keepalive requests; however clients
 # can still send them and the daemon will send responses.  When
 # keepalive_count is set to 0, connections will be automatically
 # closed after keepalive_interval seconds of inactivity without
diff --git a/src/remote/test_libvirtd.aug.in b/src/remote/test_libvirtd.aug.in
index ad6450a569..a4c7b4afe8 100644
--- a/src/remote/test_libvirtd.aug.in
+++ b/src/remote/test_libvirtd.aug.in
@@ -29,11 +29,11 @@ module Test_libvirtd =
              { &quot;1&quot; = &quot;DN1&quot;}
              { &quot;2&quot; = &quot;DN2&quot;}
         }
+        { &quot;tls_priority&quot; = &quot;NORMAL&quot; }
         { &quot;sasl_allowed_username_list&quot;
              { &quot;1&quot; = &quot;joe@xxxxxxxxxxx&quot; }
              { &quot;2&quot; = &quot;fred@xxxxxxxxxxx&quot; }
         }
-        { &quot;tls_priority&quot; = &quot;NORMAL&quot; }
         { &quot;max_clients&quot; = &quot;5000&quot; }
         { &quot;max_queued_clients&quot; = &quot;1000&quot; }
         { &quot;max_anonymous_clients&quot; = &quot;20&quot; }
-- 
2.21.0

--
libvir-list mailing list
libvir-list@xxxxxxxxxx
<a  rel="nofollow" href="https://www.redhat.com/mailman/listinfo/libvir-list">https://www.redhat.com/mailman/listinfo/libvir-list</a>



</pre>
<!--X-Body-of-Message-End-->
<!--X-MsgBody-End-->
<!--X-Follow-Ups-->
</div>
<hr>
<!--X-Follow-Ups-End-->
<!--X-References-->
<!--X-References-End-->
<!--X-BotPNI-->
<ul>
<li>Prev by Date:
<strong><a href="msg187212.html">[PATCH 21/29] bhyve: introduce virtbhyved daemon</a></strong>
</li>
<li>Next by Date:
<strong><a href="msg187214.html">[PATCH 18/29] qemu: introduce virtqemud daemon</a></strong>
</li>
<li>Previous by thread:
<strong><a href="msg187212.html">[PATCH 21/29] bhyve: introduce virtbhyved daemon</a></strong>
</li>
<li>Next by thread:
<strong><a href="msg187214.html">[PATCH 18/29] qemu: introduce virtqemud daemon</a></strong>
</li>
<li>Index(es):
<ul>
<li><a href="maillist.html#187213"><strong>Date</strong></a></li>
<li><a href="index.html#187213"><strong>Thread</strong></a></li>
</ul>
</li>
</ul>

<!--X-BotPNI-End-->
<!--X-User-Footer-->
<center>
<font size=-1>
<a href=/lists/>[Index&nbsp;of&nbsp;Archives]</a>
&nbsp;
&nbsp;
<a href=/lists/virt-tools/>[Virt&nbsp;Tools]</a>
&nbsp;
&nbsp;
<a href=/linux/fedora/libvirt-users/>[Libvirt&nbsp;Users]</a>
&nbsp;
&nbsp;
<a href=/linux/fedora/libosinfo/>[Lib&nbsp;OS&nbsp;Info]</a>
&nbsp;
&nbsp;
<a href=/linux/fedora/fedora-users/>[Fedora&nbsp;Users]</a>
&nbsp;
&nbsp;
<a href=/lists/fedora-desktop/>[Fedora&nbsp;Desktop]</a>
&nbsp;
&nbsp;
<a href=/lists/fedora-selinux/>[Fedora&nbsp;SELinux]</a>
&nbsp;
&nbsp;
<a href=http://www.ske-art.com/z/biglist.php>[Big&nbsp;List&nbsp;of&nbsp;Linux&nbsp;Books]</a>
&nbsp;
&nbsp;
<a href=https://yosemitenews.info>[Yosemite&nbsp;News]</a>
&nbsp;
&nbsp;
<a href=/lists/kde/>[KDE&nbsp;Users]</a>
&nbsp;
&nbsp;
<a href=/lists/fedora-tools/>[Fedora&nbsp;Tools]</a>
</font>
</center>
<hr>
<p>
<div>
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<ins class="adsbygoogle"
     style="display:block"
     data-ad-format="autorelaxed"
     data-ad-client="ca-pub-3422782820843221"
     data-ad-slot="1424524564"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
</div>
<table width=100%>
<tr>
<td align=left>&nbsp;</td>
<td align=right><a href=/lists/><img src=/button_01.gif border=0 alt="Powered by Linux"></a></td>
</tr>
</table>
<!--X-User-Footer-End-->
<script type="text/javascript"> 
 function initAddThis() {
    addthis.init()
 }
initAddThis();
</script>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-760190-1', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
