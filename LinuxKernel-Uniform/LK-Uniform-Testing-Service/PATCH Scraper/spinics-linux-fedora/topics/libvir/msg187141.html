<!-- MHonArc v2.6.19 -->
<!--X-Subject: [PATCH v2 13/19] remote: update config files to note	usage wrt systemd socket activation -->
<!--X-From-R13: =?GFT&#45;8?d?Rnavry=20B=2S=20Preenat=Q3=O9?= &#60;oreenatrNerqung.pbz> -->
<!--X-Date: Thu, 11 Jul 2019 07:08:03 &#45;0700 -->
<!--X-Message-Id: 20190711140742.31029&#45;14&#45;berrange@redhat.com -->
<!--X-Content-Type: text/plain -->
<!--X-Reference: 20190711140742.31029&#45;1&#45;berrange@redhat.com -->
<!--X-Head-End-->
<!doctype html public "-//W3C//DTD HTML//EN">
<html>
<head>
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({
          google_ad_client: "ca-pub-3422782820843221",
          enable_page_level_ads: true
     });
</script>
<style>
<!--
 pre {white-space: pre-wrap;}
-->
</style>
<title>libvirt &mdash; [PATCH v2 13/19] remote: update config files to note	usage wrt systemd socket activation</title>
<meta name="description" content="libvirt: [PATCH v2 13/19] remote: update config files to note	usage wrt systemd socket activation">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="alternate" type="application/rss+xml" title="Libvirt Development" href="//feeds.feedburner.com/Libvir">
</head>
<body itemscope itemtype="//schema.org/Article" vlink=green>
<!--X-Body-Begin-->
<!--X-User-Header-->
<!--X-User-Header-End-->
<!--X-TopPNI-->
<form action="//www.google.com" id="cse-search-box" target="_blank">
  <div>
    <input type="hidden" name="cx" value="partner-pub-3422782820843221:8422278960" />
    <input type="hidden" name="ie" value="UTF-8" />
    <input type="text" name="q" size="55" />
    <input type="submit" name="sa" value="Search" />
  </div>
</form>
<script type="text/javascript" src="//www.google.com/coop/cse/brand?form=cse-search-box&amp;lang=en"></script>
<h1>[PATCH v2 13/19] remote: update config files to note	usage wrt systemd socket activation</h1>
[<a href="msg187140.html">Date Prev</a>][<a href="msg187143.html">Date Next</a>][<a href="msg187140.html">Thread Prev</a>][<a href="msg187143.html">Thread Next</a>][<a href="maillist.html#187141">Date Index</a>][<a href="index.html#187141">Thread Index</a>] 


<p>&nbsp;<br>
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- responsive test for archives -->
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-3422782820843221"
     data-ad-slot="6345952567"
     data-ad-format="auto"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>

<!--X-TopPNI-End-->
<!--X-MsgBody-->
<!--X-Subject-Header-Begin-->
<hr>
<!--X-Subject-Header-End-->
<!--X-Head-of-Message-->
<ul>
<li><em>Subject</em>: [PATCH v2 13/19] remote: update config files to note	usage wrt systemd socket activation</li>
<li><em>From</em>: Daniel P. Berrang&#xE9; &lt;berrange@xxxxxxxxxx&gt;</li>
<li><em>Date</em>: Thu, 11 Jul 2019 15:07:36 +0100</li>
<li><em>In-reply-to</em>: &lt;<a href="msg187133.html">20190711140742.31029-1-berrange@redhat.com</a>&gt;</li>
<li><em>References</em>: &lt;<a href="msg187133.html">20190711140742.31029-1-berrange@redhat.com</a>&gt;</li>
</ul>
<!--X-Head-of-Message-End-->
<!--X-Head-Body-Sep-Begin-->
<!-- AddThis Button BEGIN -->
<div class="addthis_toolbox addthis_default_style ">
<a class="addthis_button_preferred_1"></a>
<a class="addthis_button_preferred_2"></a>
<a class="addthis_button_preferred_3"></a>
<a class="addthis_button_preferred_4"></a>
<a class="addthis_button_compact"></a>
<a class="addthis_counter addthis_bubble_style"></a>
</div>
<script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5196c2ae1be43d18&async=1&domready=1" async></script>
<!-- AddThis Button END -->
<hr>
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- responsive link 1 -->
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-3422782820843221"
     data-ad-slot="8681825769"
     data-ad-format="link"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
<p>
<div class="content" itemprop="articleBody">
<!--X-Head-Body-Sep-End-->
<!--X-Body-of-Message-->
<pre>Certain libvirtd.conf settings are not honoured when using systemd
socket activation.

Certain systemd unit file settings must match those defined in
libvirtd.conf for systemd socket activation to work with systemd
version &lt; 227, otherwise libvirtd cannot determine which inherited
FD to use for which service.

Signed-off-by: Daniel P. Berrang&#xE9; &lt;berrange@xxxxxxxxxx&gt;
---
 src/remote/libvirtd-admin.socket.in |  2 ++
 src/remote/libvirtd-ro.socket.in    |  2 ++
 src/remote/libvirtd-tcp.socket.in   |  2 ++
 src/remote/libvirtd-tls.socket.in   |  2 ++
 src/remote/libvirtd.conf            | 31 +++++++++++++++++++++++++++++
 src/remote/libvirtd.socket.in       |  2 ++
 src/remote/libvirtd.sysconf         |  3 ++-
 7 files changed, 43 insertions(+), 1 deletion(-)

diff --git a/src/remote/libvirtd-admin.socket.in b/src/remote/libvirtd-admin.socket.in
index b791a2eb1b..307c9ba24b 100644
--- a/src/remote/libvirtd-admin.socket.in
+++ b/src/remote/libvirtd-admin.socket.in
@@ -5,6 +5,8 @@ BindsTo=libvirtd.socket
 After=libvirtd.socket
 
 [Socket]
+# The directory must match the /etc/libvirt/libvirtd.conf unix_sock_dir setting
+# when using systemd version &lt; 227
 ListenStream=@localstatedir@/run/libvirt/libvirt-admin-sock
 Service=libvirtd.service
 SocketMode=0600
diff --git a/src/remote/libvirtd-ro.socket.in b/src/remote/libvirtd-ro.socket.in
index 55c44944b4..876daf0c9c 100644
--- a/src/remote/libvirtd-ro.socket.in
+++ b/src/remote/libvirtd-ro.socket.in
@@ -5,6 +5,8 @@ BindsTo=libvirtd.socket
 After=libvirtd.socket
 
 [Socket]
+# The directory must match the /etc/libvirt/libvirtd.conf unix_sock_dir setting
+# when using systemd version &lt; 227
 ListenStream=@localstatedir@/run/libvirt/libvirt-sock-ro
 Service=libvirtd.service
 SocketMode=0666
diff --git a/src/remote/libvirtd-tcp.socket.in b/src/remote/libvirtd-tcp.socket.in
index 09d5d3d67a..16a4764283 100644
--- a/src/remote/libvirtd-tcp.socket.in
+++ b/src/remote/libvirtd-tcp.socket.in
@@ -5,6 +5,8 @@ BindsTo=libvirtd.socket
 After=libvirtd.socket
 
 [Socket]
+# This must match the /etc/libvirt/libvirtd.conf tcp_port setting
+# when using systemd version &lt; 227
 ListenStream=16509
 Service=libvirtd.service
 
diff --git a/src/remote/libvirtd-tls.socket.in b/src/remote/libvirtd-tls.socket.in
index c60f0c9c77..e904583cf9 100644
--- a/src/remote/libvirtd-tls.socket.in
+++ b/src/remote/libvirtd-tls.socket.in
@@ -5,6 +5,8 @@ BindsTo=libvirtd.socket
 After=libvirtd.socket
 
 [Socket]
+# This must match the /etc/libvirt/libvirtd.conf tls_port setting
+# when using systemd version &lt; 227
 ListenStream=16514
 Service=libvirtd.service
 
diff --git a/src/remote/libvirtd.conf b/src/remote/libvirtd.conf
index bbeb053495..b63b8d61b7 100644
--- a/src/remote/libvirtd.conf
+++ b/src/remote/libvirtd.conf
@@ -10,6 +10,9 @@
 # NB, must pass the --listen flag to the libvirtd process for this to
 # have any effect.
 #
+# This setting is not required or honoured if using systemd socket
+# activation.
+#
 # It is necessary to setup a CA and issue server certificates before
 # using this capability.
 #
@@ -20,6 +23,9 @@
 # NB, must pass the --listen flag to the libvirtd process for this to
 # have any effect.
 #
+# This setting is not required or honoured if using systemd socket
+# activation.
+#
 # Using the TCP socket requires SASL authentication by default. Only
 # SASL mechanisms which support data encryption are allowed. This is
 # DIGEST_MD5 and GSSAPI (Kerberos5)
@@ -32,17 +38,26 @@
 # Override the port for accepting secure TLS connections
 # This can be a port number, or service name
 #
+# This setting is not required or honoured if using systemd socket
+# activation with systemd version &gt;= 227
+#
 #tls_port = &quot;16514&quot;
 
 # Override the port for accepting insecure TCP connections
 # This can be a port number, or service name
 #
+# This setting is not required or honoured if using systemd socket
+# activation with systemd version &gt;= 227
+#
 #tcp_port = &quot;16509&quot;
 
 
 # Override the default configuration which binds to all network
 # interfaces. This can be a numeric IPv4/6 address, or hostname
 #
+# This setting is not required or honoured if using systemd socket
+# activation.
+#
 # If the libvirtd service is started in parallel with network
 # startup (e.g. with systemd), binding to addresses other than
 # the wildcards (0.0.0.0/::) might not be available yet.
@@ -59,12 +74,18 @@
 # allow a 'trusted' set of users access to management capabilities
 # without becoming root.
 #
+# This setting is not required or honoured if using systemd socket
+# activation.
+#
 # This is restricted to 'root' by default.
 #unix_sock_group = &quot;libvirt&quot;
 
 # Set the UNIX socket permissions for the R/O socket. This is used
 # for monitoring VM status only
 #
+# This setting is not required or honoured if using systemd socket
+# activation.
+#
 # Default allows any user. If setting group ownership, you may want to
 # restrict this too.
 #unix_sock_ro_perms = &quot;0777&quot;
@@ -72,6 +93,9 @@
 # Set the UNIX socket permissions for the R/W socket. This is used
 # for full management of VMs
 #
+# This setting is not required or honoured if using systemd socket
+# activation.
+#
 # Default allows only root. If PolicyKit is enabled on the socket,
 # the default will change to allow everyone (eg, 0777)
 #
@@ -81,11 +105,18 @@
 
 # Set the UNIX socket permissions for the admin interface socket.
 #
+# This setting is not required or honoured if using systemd socket
+# activation.
+#
 # Default allows only owner (root), do not change it unless you are
 # sure to whom you are exposing the access to.
 #unix_sock_admin_perms = &quot;0700&quot;
 
 # Set the name of the directory in which sockets will be found/created.
+#
+# This setting is not required or honoured if using systemd socket
+# activation with systemd version &gt;= 227
+#
 #unix_sock_dir = &quot;/var/run/libvirt&quot;
 
 
diff --git a/src/remote/libvirtd.socket.in b/src/remote/libvirtd.socket.in
index e194c6e76e..2ee4d7d7a2 100644
--- a/src/remote/libvirtd.socket.in
+++ b/src/remote/libvirtd.socket.in
@@ -3,6 +3,8 @@ Description=Libvirt local socket
 Before=libvirtd.service
 
 [Socket]
+# The directory must match the /etc/libvirt/libvirtd.conf unix_sock_dir setting
+# when using systemd version &lt; 227
 ListenStream=@localstatedir@/run/libvirt/libvirt-sock
 Service=libvirtd.service
 SocketMode=0666
diff --git a/src/remote/libvirtd.sysconf b/src/remote/libvirtd.sysconf
index 60a47c252f..5969518bf2 100644
--- a/src/remote/libvirtd.sysconf
+++ b/src/remote/libvirtd.sysconf
@@ -1,6 +1,7 @@
 # Customizations for the libvirtd.service systemd unit
 
-# Listen for TCP/IP connections
+# Listen for TCP/IP connections. This is not required if using systemd
+# socket activation.
 # NB. must setup TLS/SSL keys prior to using this
 #LIBVIRTD_ARGS=&quot;--listen&quot;
 
-- 
2.21.0

--
libvir-list mailing list
libvir-list@xxxxxxxxxx
<a  rel="nofollow" href="https://www.redhat.com/mailman/listinfo/libvir-list">https://www.redhat.com/mailman/listinfo/libvir-list</a>



</pre>
<!--X-Body-of-Message-End-->
<!--X-MsgBody-End-->
<!--X-Follow-Ups-->
</div>
<hr>
<!--X-Follow-Ups-End-->
<!--X-References-->
<!--X-References-End-->
<!--X-BotPNI-->
<ul>
<li>Prev by Date:
<strong><a href="msg187140.html">[PATCH v2 06/19] rpc: add helper APIs for adding services	with systemd activation</a></strong>
</li>
<li>Next by Date:
<strong><a href="msg187143.html">[PATCH v2 09/19] remote: fix handling of systemd	activation wrt socket ordering</a></strong>
</li>
<li>Previous by thread:
<strong><a href="msg187140.html">[PATCH v2 06/19] rpc: add helper APIs for adding services	with systemd activation</a></strong>
</li>
<li>Next by thread:
<strong><a href="msg187143.html">[PATCH v2 09/19] remote: fix handling of systemd	activation wrt socket ordering</a></strong>
</li>
<li>Index(es):
<ul>
<li><a href="maillist.html#187141"><strong>Date</strong></a></li>
<li><a href="index.html#187141"><strong>Thread</strong></a></li>
</ul>
</li>
</ul>

<!--X-BotPNI-End-->
<!--X-User-Footer-->
<center>
<font size=-1>
<a href=/lists/>[Index&nbsp;of&nbsp;Archives]</a>
&nbsp;
&nbsp;
<a href=/lists/virt-tools/>[Virt&nbsp;Tools]</a>
&nbsp;
&nbsp;
<a href=/linux/fedora/libvirt-users/>[Libvirt&nbsp;Users]</a>
&nbsp;
&nbsp;
<a href=/linux/fedora/libosinfo/>[Lib&nbsp;OS&nbsp;Info]</a>
&nbsp;
&nbsp;
<a href=/linux/fedora/fedora-users/>[Fedora&nbsp;Users]</a>
&nbsp;
&nbsp;
<a href=/lists/fedora-desktop/>[Fedora&nbsp;Desktop]</a>
&nbsp;
&nbsp;
<a href=/lists/fedora-selinux/>[Fedora&nbsp;SELinux]</a>
&nbsp;
&nbsp;
<a href=http://www.ske-art.com/z/biglist.php>[Big&nbsp;List&nbsp;of&nbsp;Linux&nbsp;Books]</a>
&nbsp;
&nbsp;
<a href=https://yosemitenews.info>[Yosemite&nbsp;News]</a>
&nbsp;
&nbsp;
<a href=/lists/kde/>[KDE&nbsp;Users]</a>
&nbsp;
&nbsp;
<a href=/lists/fedora-tools/>[Fedora&nbsp;Tools]</a>
</font>
</center>
<hr>
<p>
<div>
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<ins class="adsbygoogle"
     style="display:block"
     data-ad-format="autorelaxed"
     data-ad-client="ca-pub-3422782820843221"
     data-ad-slot="1424524564"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
</div>
<table width=100%>
<tr>
<td align=left>&nbsp;</td>
<td align=right><a href=/lists/><img src=/button_01.gif border=0 alt="Powered by Linux"></a></td>
</tr>
</table>
<!--X-User-Footer-End-->
<script type="text/javascript"> 
 function initAddThis() {
    addthis.init()
 }
initAddThis();
</script>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-760190-1', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
