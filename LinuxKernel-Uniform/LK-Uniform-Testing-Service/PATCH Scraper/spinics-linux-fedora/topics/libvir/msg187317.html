<!-- MHonArc v2.6.19 -->
<!--X-Subject: [PATCH 00/25] qemu: Properly track blockjobs	(blockdev&#45;add saga) -->
<!--X-From-R13: Brgre Yerzcn &#60;cxerzcnNerqung.pbz> -->
<!--X-Date: Fri, 12 Jul 2019 09:06:17 &#45;0700 -->
<!--X-Message-Id: cover.1562947283.git.pkrempa@redhat.com -->
<!--X-Content-Type: text/plain -->
<!--X-Head-End-->
<!doctype html public "-//W3C//DTD HTML//EN">
<html>
<head>
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({
          google_ad_client: "ca-pub-3422782820843221",
          enable_page_level_ads: true
     });
</script>
<style>
<!--
 pre {white-space: pre-wrap;}
-->
</style>
<title>libvirt &mdash; [PATCH 00/25] qemu: Properly track blockjobs	(blockdev-add saga)</title>
<meta name="description" content="libvirt: [PATCH 00/25] qemu: Properly track blockjobs	(blockdev-add saga)">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="alternate" type="application/rss+xml" title="Libvirt Development" href="//feeds.feedburner.com/Libvir">
</head>
<body itemscope itemtype="//schema.org/Article" vlink=green>
<!--X-Body-Begin-->
<!--X-User-Header-->
<!--X-User-Header-End-->
<!--X-TopPNI-->
<form action="//www.google.com" id="cse-search-box" target="_blank">
  <div>
    <input type="hidden" name="cx" value="partner-pub-3422782820843221:8422278960" />
    <input type="hidden" name="ie" value="UTF-8" />
    <input type="text" name="q" size="55" />
    <input type="submit" name="sa" value="Search" />
  </div>
</form>
<script type="text/javascript" src="//www.google.com/coop/cse/brand?form=cse-search-box&amp;lang=en"></script>
<h1>[PATCH 00/25] qemu: Properly track blockjobs	(blockdev-add saga)</h1>
[<a href="msg187314.html">Date Prev</a>][<a href="msg187315.html">Date Next</a>][<a href="msg187313.html">Thread Prev</a>][<a href="msg187314.html">Thread Next</a>][<a href="maillist.html#187317">Date Index</a>][<a href="index.html#187317">Thread Index</a>] 


<p>&nbsp;<br>
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- responsive test for archives -->
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-3422782820843221"
     data-ad-slot="6345952567"
     data-ad-format="auto"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>

<!--X-TopPNI-End-->
<!--X-MsgBody-->
<!--X-Subject-Header-Begin-->
<hr>
<!--X-Subject-Header-End-->
<!--X-Head-of-Message-->
<ul>
<li><em>Subject</em>: [PATCH 00/25] qemu: Properly track blockjobs	(blockdev-add saga)</li>
<li><em>From</em>: Peter Krempa &lt;pkrempa@xxxxxxxxxx&gt;</li>
<li><em>Date</em>: Fri, 12 Jul 2019 18:05:41 +0200</li>
<li><em>Cc</em>: Peter Krempa &lt;pkrempa@xxxxxxxxxx&gt;</li>
</ul>
<!--X-Head-of-Message-End-->
<!--X-Head-Body-Sep-Begin-->
<!-- AddThis Button BEGIN -->
<div class="addthis_toolbox addthis_default_style ">
<a class="addthis_button_preferred_1"></a>
<a class="addthis_button_preferred_2"></a>
<a class="addthis_button_preferred_3"></a>
<a class="addthis_button_preferred_4"></a>
<a class="addthis_button_compact"></a>
<a class="addthis_counter addthis_bubble_style"></a>
</div>
<script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5196c2ae1be43d18&async=1&domready=1" async></script>
<!-- AddThis Button END -->
<hr>
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- responsive link 1 -->
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-3422782820843221"
     data-ad-slot="8681825769"
     data-ad-format="link"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
<p>
<div class="content" itemprop="articleBody">
<!--X-Head-Body-Sep-End-->
<!--X-Body-of-Message-->
<pre>This series requires few patches I've posted, namely:
<a  rel="nofollow" href="https://www.redhat.com/archives/libvir-list/2019-July/msg00669.html">https://www.redhat.com/archives/libvir-list/2019-July/msg00669.html</a>
<a  rel="nofollow" href="https://www.redhat.com/archives/libvir-list/2019-June/msg01133.html">https://www.redhat.com/archives/libvir-list/2019-June/msg01133.html</a>

which were not yet pushed upstream.

For convenience you can fetch the patches including deps by:

git fetch <a  rel="nofollow" href="https://github.com/pipo/libvirt.git">https://github.com/pipo/libvirt.git</a> job-tracking-send

Further patches will build on top of this to add metadata for individual
jobs for supporting blockdev and will be posted later as they require
some cleanups.

Peter Krempa (25):
  qemu: domain: Repurpose and export helper for saving domain status XML
  qemu: domain: Add helper for saving config XML
  qemu: blockjob: Use VIR_AUTOUNREF in qemuBlockJobDataNew
  qemu: blockjob: Separate and unify block job (un)registration
  qemu: domain: Add global table of blockjobs
  qemu: blockjob: Register new and running blockjobs in the global table
  qemu: blockjob: Add string convertors for blockjob type and state
    enums
  qemu: blockjob: Export functions for allocating and registering job
    data
  qemu: blockjob: Add flag for invalid block job data
  qemu: domain: Store blockjob data in the status XML
  qemu: blockjob: Save status XML when modifying job state
  qemu: driver: Remove unnecessary saving of status XML
  tests: qemustatusxml2xml: Add test case for block job tracking
  qemu: blockjob: Add 'concluded' state for a block job
  qemu: process: Don't trigger BLOCK_JOB* events with -blockdev
  qemu: blockjob: Add helper to convert monitor job status to internal
    state
  qemu: Add handler for job state change event
  qemu: blockjob: Add modern block job event handler
  qemu: process: Refresh -blockdev based blockjobs on reconnect to qemu
  conf: export virDomainDiskBackingStoreParse
  conf: export virDomainDiskBackingStoreFormat
  qemu: blockjob: Track orphaned backing chains in blockjob status XML
  qemu: Detect managed persistent reservations in block job orphan
    chains
  qemu: blockjob: Unplug inherited storage chains when concluding
    blockjob
  qemu: hotplug: Transfer ownership of backing chain to block job on
    disk unplug

 src/conf/domain_conf.c                        |   4 +-
 src/conf/domain_conf.h                        |  13 +
 src/libvirt_private.syms                      |   2 +
 src/qemu/qemu_blockjob.c                      | 465 ++++++++++++++++--
 src/qemu/qemu_blockjob.h                      |  40 +-
 src/qemu/qemu_domain.c                        | 327 +++++++++++-
 src/qemu/qemu_domain.h                        |   9 +
 src/qemu/qemu_driver.c                        |  64 +--
 src/qemu/qemu_hotplug.c                       |  19 +-
 src/qemu/qemu_migration.c                     |   6 +-
 src/qemu/qemu_process.c                       |  89 +++-
 .../blockjob-blockdev-in.xml                  | 403 +++++++++++++++
 .../blockjob-blockdev-out.xml                 |   1 +
 tests/qemuxml2xmltest.c                       |   2 +
 14 files changed, 1349 insertions(+), 95 deletions(-)
 create mode 100644 tests/qemustatusxml2xmldata/blockjob-blockdev-in.xml
 create mode 120000 tests/qemustatusxml2xmldata/blockjob-blockdev-out.xml

-- 
2.21.0

--
libvir-list mailing list
libvir-list@xxxxxxxxxx
<a  rel="nofollow" href="https://www.redhat.com/mailman/listinfo/libvir-list">https://www.redhat.com/mailman/listinfo/libvir-list</a>


</pre>
<!--X-Body-of-Message-End-->
<!--X-MsgBody-End-->
<!--X-Follow-Ups-->
</div>
<hr>
<!--X-Follow-Ups-End-->
<!--X-References-->
<!--X-References-End-->
<!--X-BotPNI-->
<ul>
<li>Prev by Date:
<strong><a href="msg187314.html">[PATCH 02/25] qemu: domain: Add helper for saving config	XML</a></strong>
</li>
<li>Next by Date:
<strong><a href="msg187315.html">[PATCH 04/25] qemu: blockjob: Separate and unify block	job (un)registration</a></strong>
</li>
<li>Previous by thread:
<strong><a href="msg187313.html">[PATCH] storage: rbd: do not attempt to dereference a	non-pointer</a></strong>
</li>
<li>Next by thread:
<strong><a href="msg187314.html">[PATCH 02/25] qemu: domain: Add helper for saving config	XML</a></strong>
</li>
<li>Index(es):
<ul>
<li><a href="maillist.html#187317"><strong>Date</strong></a></li>
<li><a href="index.html#187317"><strong>Thread</strong></a></li>
</ul>
</li>
</ul>

<!--X-BotPNI-End-->
<!--X-User-Footer-->
<center>
<font size=-1>
<a href=/lists/>[Index&nbsp;of&nbsp;Archives]</a>
&nbsp;
&nbsp;
<a href=/lists/virt-tools/>[Virt&nbsp;Tools]</a>
&nbsp;
&nbsp;
<a href=/linux/fedora/libvirt-users/>[Libvirt&nbsp;Users]</a>
&nbsp;
&nbsp;
<a href=/linux/fedora/libosinfo/>[Lib&nbsp;OS&nbsp;Info]</a>
&nbsp;
&nbsp;
<a href=/linux/fedora/fedora-users/>[Fedora&nbsp;Users]</a>
&nbsp;
&nbsp;
<a href=/lists/fedora-desktop/>[Fedora&nbsp;Desktop]</a>
&nbsp;
&nbsp;
<a href=/lists/fedora-selinux/>[Fedora&nbsp;SELinux]</a>
&nbsp;
&nbsp;
<a href=http://www.ske-art.com/z/biglist.php>[Big&nbsp;List&nbsp;of&nbsp;Linux&nbsp;Books]</a>
&nbsp;
&nbsp;
<a href=https://yosemitenews.info>[Yosemite&nbsp;News]</a>
&nbsp;
&nbsp;
<a href=/lists/kde/>[KDE&nbsp;Users]</a>
&nbsp;
&nbsp;
<a href=/lists/fedora-tools/>[Fedora&nbsp;Tools]</a>
</font>
</center>
<hr>
<p>
<div>
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<ins class="adsbygoogle"
     style="display:block"
     data-ad-format="autorelaxed"
     data-ad-client="ca-pub-3422782820843221"
     data-ad-slot="1424524564"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
</div>
<table width=100%>
<tr>
<td align=left>&nbsp;</td>
<td align=right><a href=/lists/><img src=/button_01.gif border=0 alt="Powered by Linux"></a></td>
</tr>
</table>
<!--X-User-Footer-End-->
<script type="text/javascript"> 
 function initAddThis() {
    addthis.init()
 }
initAddThis();
</script>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-760190-1', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
