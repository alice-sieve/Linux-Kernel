<!-- MHonArc v2.6.19 -->
<!--X-Subject: [jenkins&#45;ci PATCH v2 07/20] quayadmin: Implement debug	mode -->
<!--X-From-R13: Oaqern Pbybtanav &#60;nobybtanNerqung.pbz> -->
<!--X-Date: Wed, 17 Jul 2019 06:49:50 &#45;0700 -->
<!--X-Message-Id: 20190717134929.10540&#45;8&#45;abologna@redhat.com -->
<!--X-Content-Type: text/plain -->
<!--X-Reference: 20190717134929.10540&#45;1&#45;abologna@redhat.com -->
<!--X-Head-End-->
<!doctype html public "-//W3C//DTD HTML//EN">
<html>
<head>
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({
          google_ad_client: "ca-pub-3422782820843221",
          enable_page_level_ads: true
     });
</script>
<style>
<!--
 pre {white-space: pre-wrap;}
-->
</style>
<title>libvirt &mdash; [jenkins-ci PATCH v2 07/20] quayadmin: Implement debug	mode</title>
<meta name="description" content="libvirt: [jenkins-ci PATCH v2 07/20] quayadmin: Implement debug	mode">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="alternate" type="application/rss+xml" title="Libvirt Development" href="//feeds.feedburner.com/Libvir">
</head>
<body itemscope itemtype="//schema.org/Article" vlink=green>
<!--X-Body-Begin-->
<!--X-User-Header-->
<!--X-User-Header-End-->
<!--X-TopPNI-->
<form action="//www.google.com" id="cse-search-box" target="_blank">
  <div>
    <input type="hidden" name="cx" value="partner-pub-3422782820843221:8422278960" />
    <input type="hidden" name="ie" value="UTF-8" />
    <input type="text" name="q" size="55" />
    <input type="submit" name="sa" value="Search" />
  </div>
</form>
<script type="text/javascript" src="//www.google.com/coop/cse/brand?form=cse-search-box&amp;lang=en"></script>
<h1>[jenkins-ci PATCH v2 07/20] quayadmin: Implement debug	mode</h1>
[<a href="msg187550.html">Date Prev</a>][<a href="msg187555.html">Date Next</a>][<a href="msg187600.html">Thread Prev</a>][<a href="msg187602.html">Thread Next</a>][<a href="maillist.html#187551">Date Index</a>][<a href="index.html#187551">Thread Index</a>] 


<p>&nbsp;<br>
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- responsive test for archives -->
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-3422782820843221"
     data-ad-slot="6345952567"
     data-ad-format="auto"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>

<!--X-TopPNI-End-->
<!--X-MsgBody-->
<!--X-Subject-Header-Begin-->
<hr>
<!--X-Subject-Header-End-->
<!--X-Head-of-Message-->
<ul>
<li><em>Subject</em>: [jenkins-ci PATCH v2 07/20] quayadmin: Implement debug	mode</li>
<li><em>From</em>: Andrea Bolognani &lt;abologna@xxxxxxxxxx&gt;</li>
<li><em>Date</em>: Wed, 17 Jul 2019 15:49:16 +0200</li>
<li><em>In-reply-to</em>: &lt;<a href="msg187545.html">20190717134929.10540-1-abologna@redhat.com</a>&gt;</li>
<li><em>References</em>: &lt;<a href="msg187545.html">20190717134929.10540-1-abologna@redhat.com</a>&gt;</li>
</ul>
<!--X-Head-of-Message-End-->
<!--X-Head-Body-Sep-Begin-->
<!-- AddThis Button BEGIN -->
<div class="addthis_toolbox addthis_default_style ">
<a class="addthis_button_preferred_1"></a>
<a class="addthis_button_preferred_2"></a>
<a class="addthis_button_preferred_3"></a>
<a class="addthis_button_preferred_4"></a>
<a class="addthis_button_compact"></a>
<a class="addthis_counter addthis_bubble_style"></a>
</div>
<script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5196c2ae1be43d18&async=1&domready=1" async></script>
<!-- AddThis Button END -->
<hr>
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- responsive link 1 -->
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-3422782820843221"
     data-ad-slot="8681825769"
     data-ad-format="link"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
<p>
<div class="content" itemprop="articleBody">
<!--X-Head-Body-Sep-End-->
<!--X-Body-of-Message-->
<pre>While a command line parameter for enabling debug mode has
been defined, it's not currently used in any form or shape.

Make it so enabling debug mode actually does something
useful, that is, prints the most important parts of the
conversation happening between the client and the server.

Signed-off-by: Andrea Bolognani &lt;abologna@xxxxxxxxxx&gt;
---
 guests/quayadmin | 41 +++++++++++++++++++++++++++++------------
 1 file changed, 29 insertions(+), 12 deletions(-)

diff --git a/guests/quayadmin b/guests/quayadmin
index 7ddf7a4..04a8b66 100755
--- a/guests/quayadmin
+++ b/guests/quayadmin
@@ -19,6 +19,7 @@
 # with this program. If not, see &lt;<a  rel="nofollow" href="https://www.gnu.org/licenses/">https://www.gnu.org/licenses/</a>&gt;.
 
 import argparse
+import pprint
 import requests
 import sys
 
@@ -28,26 +29,42 @@ clientsecret = &quot;xxx&quot;
 token= &quot;xxx&quot;
 
 
-def request(endpoint, method, payload=None, params=None):
+def request(endpoint, method, payload=None, params=None, debug=False):
     url = baseurl + endpoint
 
     headers = {
         &quot;Authorization&quot;: &quot;Bearer {}&quot;.format(token)
     }
 
-    return method(url, headers=headers, json=payload, params=params)
+    if debug:
+        print(&quot;=&gt; {&quot;)
+        print(&quot;  url={}&quot;.format(url))
+        print(&quot;  params={}&quot;.format(pprint.pformat(params)))
+        print(&quot;  payload={}&quot;.format(pprint.pformat(payload)))
+        print(&quot;}&quot;)
 
+    res = method(url, headers=headers, json=payload, params=params)
 
-def get(endpoint, params=None):
-    return request(endpoint, method=requests.get, params=params)
+    if debug:
+        print(&quot;&lt;= {&quot;)
+        print(&quot;  status_code={}&quot;.format(res.status_code))
+        if res.text is not None and len(res.text) &gt; 0:
+            print(&quot;  json={}&quot;.format(pprint.pformat(res.json())))
+        print(&quot;}&quot;)
 
+    return res
 
-def delete(endpoint, payload=None):
-    return request(endpoint, method=requests.delete, payload=payload)
 
+def get(endpoint, params=None, debug=False):
+    return request(endpoint, method=requests.get, params=params, debug=debug)
 
-def post(endpoint, payload=None):
-    return request(endpoint, method=requests.post, payload=payload)
+
+def delete(endpoint, payload=None, debug=False):
+    return request(endpoint, method=requests.delete, payload=payload, debug=debug)
+
+
+def post(endpoint, payload=None, debug=False):
+    return request(endpoint, method=requests.post, payload=payload, debug=debug)
 
 
 def has_error(quiet, res, expected, message):
@@ -71,7 +88,7 @@ def run_list_repos(args):
         &quot;namespace&quot;: args.namespace,
     }
 
-    res = get(endpoint, params=params)
+    res = get(endpoint, params=params, debug=args.debug)
 
     if has_error(args.quiet, res, 200, &quot;Cannot list repositories&quot;):
         return 1
@@ -85,7 +102,7 @@ def run_list_repos(args):
 def run_show_repo(args):
     endpoint = &quot;/repository/{}/{}&quot;.format(args.namespace, args.repo)
 
-    res = get(endpoint)
+    res = get(endpoint, debug=args.debug)
 
     if has_error(args.quiet, res, 200, &quot;Cannot query repository {}/{}&quot;
                  .format(args.namespace, args.repo)):
@@ -112,7 +129,7 @@ def run_create_repo(args):
         &quot;description&quot;: args.desc,
     }
 
-    res = post(endpoint, payload=payload)
+    res = post(endpoint, payload=payload, debug=args.debug)
 
     if has_error(args.quiet, res, 201, &quot;Cannot create repository {}/{}&quot;
                  .format(args.namespace, args.repo)):
@@ -127,7 +144,7 @@ def run_create_repo(args):
 def run_delete_repo(args):
     endpoint = &quot;/repository/{}/{}&quot;.format(args.namespace, args.repo)
 
-    res = delete(endpoint)
+    res = delete(endpoint, debug=args.debug)
 
     if has_error(args.quiet, res, 204, &quot;Cannot delete repository {}/{}&quot;
                  .format(args.namespace, args.repo)):
-- 
2.21.0

--
libvir-list mailing list
libvir-list@xxxxxxxxxx
<a  rel="nofollow" href="https://www.redhat.com/mailman/listinfo/libvir-list">https://www.redhat.com/mailman/listinfo/libvir-list</a>


</pre>
<!--X-Body-of-Message-End-->
<!--X-MsgBody-End-->
<!--X-Follow-Ups-->
</div>
<hr>
<!--X-Follow-Ups-End-->
<!--X-References-->
<!--X-References-End-->
<!--X-BotPNI-->
<ul>
<li>Prev by Date:
<strong><a href="msg187550.html">[jenkins-ci PATCH v2 05/20] quayadmin: Tweak list-repos	output format</a></strong>
</li>
<li>Next by Date:
<strong><a href="msg187555.html">[jenkins-ci PATCH v2 04/20] quayadmin: Tweak show-repo	output format</a></strong>
</li>
<li>Previous by thread:
<strong><a href="msg187600.html">Re:  [jenkins-ci PATCH v2 05/20] quayadmin: Tweak list-repos output format</a></strong>
</li>
<li>Next by thread:
<strong><a href="msg187602.html">Re:  [jenkins-ci PATCH v2 07/20] quayadmin: Implement debug mode</a></strong>
</li>
<li>Index(es):
<ul>
<li><a href="maillist.html#187551"><strong>Date</strong></a></li>
<li><a href="index.html#187551"><strong>Thread</strong></a></li>
</ul>
</li>
</ul>

<!--X-BotPNI-End-->
<!--X-User-Footer-->
<center>
<font size=-1>
<a href=/lists/>[Index&nbsp;of&nbsp;Archives]</a>
&nbsp;
&nbsp;
<a href=/lists/virt-tools/>[Virt&nbsp;Tools]</a>
&nbsp;
&nbsp;
<a href=/linux/fedora/libvirt-users/>[Libvirt&nbsp;Users]</a>
&nbsp;
&nbsp;
<a href=/linux/fedora/libosinfo/>[Lib&nbsp;OS&nbsp;Info]</a>
&nbsp;
&nbsp;
<a href=/linux/fedora/fedora-users/>[Fedora&nbsp;Users]</a>
&nbsp;
&nbsp;
<a href=/lists/fedora-desktop/>[Fedora&nbsp;Desktop]</a>
&nbsp;
&nbsp;
<a href=/lists/fedora-selinux/>[Fedora&nbsp;SELinux]</a>
&nbsp;
&nbsp;
<a href=http://www.ske-art.com/z/biglist.php>[Big&nbsp;List&nbsp;of&nbsp;Linux&nbsp;Books]</a>
&nbsp;
&nbsp;
<a href=https://yosemitenews.info>[Yosemite&nbsp;News]</a>
&nbsp;
&nbsp;
<a href=/lists/kde/>[KDE&nbsp;Users]</a>
&nbsp;
&nbsp;
<a href=/lists/fedora-tools/>[Fedora&nbsp;Tools]</a>
</font>
</center>
<hr>
<p>
<div>
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<ins class="adsbygoogle"
     style="display:block"
     data-ad-format="autorelaxed"
     data-ad-client="ca-pub-3422782820843221"
     data-ad-slot="1424524564"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
</div>
<table width=100%>
<tr>
<td align=left>&nbsp;</td>
<td align=right><a href=/lists/><img src=/button_01.gif border=0 alt="Powered by Linux"></a></td>
</tr>
</table>
<!--X-User-Footer-End-->
<script type="text/javascript"> 
 function initAddThis() {
    addthis.init()
 }
initAddThis();
</script>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-760190-1', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
