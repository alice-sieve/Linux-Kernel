<!-- MHonArc v2.6.19 -->
<!--X-Subject: Re:  [PATCH 0/1] Add &#45;&#45;kaslr support for s390x -->
<!--X-From-R13: Rnir Oaqrefba &#60;naqrefbaNerqung.pbz> -->
<!--X-Date: Wed, 22 May 2019 12:42:21 &#45;0700 -->
<!--X-Message-Id: 1202780469.24476984.1558553935526.JavaMail.zimbra@redhat.com -->
<!--X-Content-Type: text/plain -->
<!--X-Reference: 176707502.24419935.1558541585993.JavaMail.zimbra@redhat.com -->
<!--X-Head-End-->
<!doctype html public "-//W3C//DTD HTML//EN">
<html>
<head>
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({
          google_ad_client: "ca-pub-3422782820843221",
          enable_page_level_ads: true
     });
</script>
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="description" content="Re:  [PATCH 0/1] Add --kaslr support for s390x &mdash; Red Hat Crash Utility">
<style>
<!--
 pre {white-space: pre-wrap;}
-->
</style>
<title>Red Hat Crash Utility &mdash;  Re:  [PATCH 0/1] Add --kaslr support for s390x</title>
<link rel="alternate" type="application/rss+xml" title="Red Hat Crash Utility" href="//feeds.feedburner.com/RedHatCrashUtility">
</head>
<body itemscope itemtype="//schema.org/Article" vlink=green>
<!--X-Body-Begin-->
<!--X-User-Header-->
<!--X-User-Header-End-->
<!--X-TopPNI-->
<form action="//www.google.com" id="cse-search-box" target="_blank">
  <div>
    <input type="hidden" name="cx" value="partner-pub-3422782820843221:9580497365" />
    <input type="hidden" name="ie" value="UTF-8" />
    <input type="text" name="q" size="25" />
    <input type="submit" name="sa" value="Search" />
  </div>
</form>
<script type="text/javascript" src="//www.google.com/coop/cse/brand?form=cse-search-box&amp;lang=en"></script>
<h1 itemprop="name">Re:  [PATCH 0/1] Add --kaslr support for s390x</h1>
[<a href="msg07761.html">Date Prev</a>][<a href="msg07763.html">Date Next</a>][<a href="msg07761.html">Thread Prev</a>][<a href="msg07766.html">Thread Next</a>][<a href="maillist.html#07762">Date Index</a>][<a href="index.html#07762">Thread Index</a>]


<p>&nbsp;<br>
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- responsive test for archives -->
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-3422782820843221"
     data-ad-slot="6345952567"
     data-ad-format="auto"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>

<!--X-TopPNI-End-->
<!--X-MsgBody-->
<!--X-Subject-Header-Begin-->
<hr>
<!--X-Subject-Header-End-->
<!--X-Head-of-Message-->
<ul>
<li><em>Subject</em>: Re:  [PATCH 0/1] Add --kaslr support for s390x</li>
<li><em>From</em>: Dave Anderson &lt;anderson@xxxxxxxxxx&gt;</li>
<li><em>Date</em>: Wed, 22 May 2019 15:38:55 -0400 (EDT)</li>
<li><em>Cc</em>: gerald schaefer &lt;gerald.schaefer@xxxxxxxxxx&gt;,        &quot;Discussion list for crash utility usage,	maintenance and development&quot; &lt;crash-utility@xxxxxxxxxx&gt;</li>
<li><em>In-reply-to</em>: &lt;<a href="msg07761.html">176707502.24419935.1558541585993.JavaMail.zimbra@redhat.com</a>&gt;</li>
<li><em>Reply-to</em>: &quot;Discussion list for crash utility usage,	maintenance and development&quot; &lt;crash-utility@xxxxxxxxxx&gt;</li>
</ul>
<!--X-Head-of-Message-End-->
<!--X-Head-Body-Sep-Begin-->
<!-- AddThis Button BEGIN -->
<div class="addthis_toolbox addthis_default_style ">
<a class="addthis_button_preferred_1"></a>
<a class="addthis_button_preferred_2"></a>
<a class="addthis_button_preferred_3"></a>
<a class="addthis_button_preferred_4"></a>
<a class="addthis_button_compact"></a>
<a class="addthis_counter addthis_bubble_style"></a>
</div>
<script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5196c2ae1be43d18&async=1&domready=1" defer async></script>
<!-- AddThis Button END -->
<hr>
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- responsive link 1 -->
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-3422782820843221"
     data-ad-slot="8681825769"
     data-ad-format="link"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
<p>
<div class="content" itemprop="articleBody">
<!--X-Head-Body-Sep-End-->
<!--X-Body-of-Message-->
<pre>

----- Original Message -----
&gt;<i> </i>
&gt;<i> Hello Mikhail, Philipp and Gerald,</i>
&gt;<i> </i>
&gt;<i> For the first time today I'm testing a 5.2.0-0.rc1 kernel that has</i>
&gt;<i> been configured with CONFIG_RANDOMIZE_BASE=y, and I have verified</i>
&gt;<i> that it runs live using the KERNELOFFSET value from the /proc/kcore</i>
&gt;<i> VMCOREINFO as the --kalsr argument.</i>
&gt;<i> </i>
&gt;<i> For live system analysis, it seems that the existing kaslr</i>
&gt;<i> code in symbols.c should be able to calculate the offset</i>
&gt;<i> by comparing the _stext values from /proc/kallsyms and the</i>
&gt;<i> the vmlinux file.  But obviously it doesn't, although I</i>
&gt;<i> haven't investigate why not.</i>
&gt;<i> </i>
&gt;<i> Also, I can't create a kdump dumpfile, so I can't test that,</i>
&gt;<i> so it's not clear whether the initial patchset also requires</i>
&gt;<i> the -kaslr argument for vmcores?</i>
&gt;<i> </i>
&gt;<i> Anyway, are you guys planning to post a follow-on patch to make</i>
&gt;<i> things work automagically both live and with kdumps?</i>
&gt;<i> </i>
&gt;<i> Thanks,</i>
&gt;<i>   Dave</i>

Just to follow-up...

The current KASLR-checking code in kaslr_init() looks for an x86-only variable,
so for s390x, this simple patch makes live system work without --kalsr:
 
  --- a/symbols.c
  +++ b/symbols.c
  @@ -609,6 +609,12 @@ kaslr_init(void)
                  st-&gt;_stext_vmlinux = UNINITIALIZED;
          }
   
  +       if (machine_type(&quot;S390X&quot;) &amp;&amp;  /* Linux 5.2 */
  +           (symbol_value_from_proc_kallsyms(&quot;__kaslr_offset&quot;) != BADVAL)) {
  +               kt-&gt;flags2 |= (RELOC_AUTO|KASLR);
  +               st-&gt;_stext_vmlinux = UNINITIALIZED;
  +       }
  +
          if (QEMU_MEM_DUMP_NO_VMCOREINFO()) {
                  if (KDUMP_DUMPFILE() &amp;&amp; kdump_kaslr_check()) {
                          kt-&gt;flags2 |= KASLR_CHECK;
  
Proof of the pudding:
  
  # ./crash
  
  crash 7.2.6++
  Copyright (C) 2002-2019  Red Hat, Inc.
  Copyright (C) 2004, 2005, 2006, 2010  IBM Corporation
  Copyright (C) 1999-2006  Hewlett-Packard Co
  Copyright (C) 2005, 2006, 2011, 2012  Fujitsu Limited
  Copyright (C) 2006, 2007  VA Linux Systems Japan K.K.
  Copyright (C) 2005, 2011  NEC Corporation
  Copyright (C) 1999, 2002, 2007  Silicon Graphics, Inc.
  Copyright (C) 1999, 2000, 2001, 2002  Mission Critical Linux, Inc.
  This program is free software, covered by the GNU General Public License,
  and you are welcome to change it and/or distribute copies of it under
  certain conditions.  Enter &quot;help copying&quot; to see the conditions.
  This program has absolutely no warranty.  Enter &quot;help warranty&quot; for details.
   
  GNU gdb (GDB) 7.6
  Copyright (C) 2013 Free Software Foundation, Inc.
  License GPLv3+: GNU GPL version 3 or later &lt;<a  rel="nofollow" href="http://gnu.org/licenses/gpl.html">http://gnu.org/licenses/gpl.html</a>&gt;
  This is free software: you are free to change and redistribute it.
  There is NO WARRANTY, to the extent permitted by law.  Type &quot;show copying&quot;
  and &quot;show warranty&quot; for details.
  This GDB was configured as &quot;s390x-ibm-linux-gnu&quot;...
  
  WARNING: kernel relocated [1239MB]: patching 65462 gdb minimal_symbol values
  
        KERNEL: /usr/lib/debug/lib/modules/5.2.0-0.rc1.1.elrdy.s390x/vmlinux
      DUMPFILE: /proc/kcore
          CPUS: 2
          DATE: Wed May 22 15:29:37 2019
        UPTIME: 04:04:45
  LOAD AVERAGE: 0.22, 0.10, 0.08
         TASKS: 138
      NODENAME: ibm-z-113.rhts.eng.bos.redhat.com
       RELEASE: 5.2.0-0.rc1.1.elrdy.s390x
       VERSION: #1 SMP Mon May 20 22:23:41 EDT 2019
       MACHINE: s390x  (unknown Mhz)
        MEMORY: 2 GB
           PID: 8322
       COMMAND: &quot;crash&quot;
          TASK: 69739000  [THREAD_INFO: 69739000]
           CPU: 1
         STATE: TASK_RUNNING (ACTIVE)
  
  crash&gt; 
  
And it appears that kdump vmcores with KERNELOFFSET should just work, no?

Dave




















--
Crash-utility mailing list
Crash-utility@xxxxxxxxxx
<a  rel="nofollow" href="https://www.redhat.com/mailman/listinfo/crash-utility">https://www.redhat.com/mailman/listinfo/crash-utility</a>


</pre>
<!--X-Body-of-Message-End-->
<!--X-MsgBody-End-->
<!--X-Follow-Ups-->
</div>
<hr>
<ul><li><strong>Follow-Ups</strong>:
<ul>
<li><strong><a name="07766" href="msg07766.html">Re:  [PATCH 0/1] Add --kaslr support for s390x</a></strong>
<ul><li><em>From:</em> Philipp Rudo</li></ul></li>
</ul></li></ul>
<!--X-Follow-Ups-End-->
<!--X-References-->
<ul><li><strong>References</strong>:
<ul>
<li><strong><a name="07761" href="msg07761.html">Re:  [PATCH 0/1] Add --kaslr support for s390x</a></strong>
<ul><li><em>From:</em> Dave Anderson</li></ul></li>
</ul></li></ul>
<!--X-References-End-->
<!--X-BotPNI-->
<ul>
<li>Prev by Date:
<strong><a href="msg07761.html">Re:  [PATCH 0/1] Add --kaslr support for s390x</a></strong>
</li>
<li>Next by Date:
<strong><a href="msg07763.html">Re:  [RFC] cacheutils crash extension module</a></strong>
</li>
<li>Previous by thread:
<strong><a href="msg07761.html">Re:  [PATCH 0/1] Add --kaslr support for s390x</a></strong>
</li>
<li>Next by thread:
<strong><a href="msg07766.html">Re:  [PATCH 0/1] Add --kaslr support for s390x</a></strong>
</li>
<li>Index(es):
<ul>
<li><a href="maillist.html#07762"><strong>Date</strong></a></li>
<li><a href="index.html#07762"><strong>Thread</strong></a></li>
</ul>
</li>
</ul>

<!--X-BotPNI-End-->
<!--X-User-Footer-->
<center>
<font size=-1>
<a href=/lists/>[Index&nbsp;of&nbsp;Archives]</a>
&nbsp;
&nbsp;
<a href=/lists/fedora-devel/>[Fedora&nbsp;Development]</a>
&nbsp;
&nbsp;
<a href=/lists/fedora-desktop/>[Fedora&nbsp;Desktop]</a>
&nbsp;
&nbsp;
<a href=/lists/fedora-selinux/>[Fedora&nbsp;SELinux]</a>
&nbsp;
&nbsp;
<a href=https://yosemitenews.info>[Yosemite&nbsp;News]</a>
&nbsp;
&nbsp;
<a href=/lists/kde/>[KDE&nbsp;Users]</a>
&nbsp;
&nbsp;
<a href=/lists/fedora-tools/>[Fedora&nbsp;Tools]</a>
</font>
</center>
<hr>
<p>
<div>
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<ins class="adsbygoogle"
     style="display:block"
     data-ad-format="autorelaxed"
     data-ad-client="ca-pub-3422782820843221"
     data-ad-slot="1424524564"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
</div>
<table width="100%">
<tr>
<td align=left>&nbsp;</td>
<td valign=top align=right><H1><a href=/lists/><img src=/button_01.gif border=0 alt="Powered by Linux"></a></H1></td>
</tr></table>
<!--X-User-Footer-End-->
<script type="text/javascript"> 
 function initAddThis() {
    addthis.init()
 }
initAddThis();
</script>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-760190-1', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
