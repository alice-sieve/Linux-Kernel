<!-- MHonArc v2.6.19 -->
<!--X-Subject: Re:  [PATCH RFCv1] Crash: Extensions: Coresight panic dump -->
<!--X-From-R13: Zrb Kna &#60;yrb.lnaNyvaneb.bet> -->
<!--X-Date: Tue, 21 Nov 2017 19:00:55 &#45;0800 -->
<!--X-Message-Id: 20171122030033.GB15632@leoy&#45;ThinkPad&#45;T440 -->
<!--X-Content-Type: text/plain -->
<!--X-Reference: 1511236501&#45;16815&#45;1&#45;git&#45;send&#45;email&#45;leo.yan@linaro.org -->
<!--X-Reference: 1066647179.4741256.1511274732087.JavaMail.zimbra@redhat.com -->
<!--X-Reference: 311534455.4759549.1511276562982.JavaMail.zimbra@redhat.com -->
<!--X-Head-End-->
<!doctype html public "-//W3C//DTD HTML//EN">
<html>
<head>
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({
          google_ad_client: "ca-pub-3422782820843221",
          enable_page_level_ads: true
     });
</script>
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="description" content="Re:  [PATCH RFCv1] Crash: Extensions: Coresight panic dump &mdash; Red Hat Crash Utility">
<style>
<!--
 pre {white-space: pre-wrap;}
-->
</style>
<title>Red Hat Crash Utility &mdash;  Re:  [PATCH RFCv1] Crash: Extensions: Coresight panic dump</title>
<link rel="alternate" type="application/rss+xml" title="Red Hat Crash Utility" href="//feeds.feedburner.com/RedHatCrashUtility">
</head>
<body itemscope itemtype="//schema.org/Article" vlink=green>
<!--X-Body-Begin-->
<!--X-User-Header-->
<!--X-User-Header-End-->
<!--X-TopPNI-->
<form action="//www.google.com" id="cse-search-box" target="_blank">
  <div>
    <input type="hidden" name="cx" value="partner-pub-3422782820843221:9580497365" />
    <input type="hidden" name="ie" value="UTF-8" />
    <input type="text" name="q" size="25" />
    <input type="submit" name="sa" value="Search" />
  </div>
</form>
<script type="text/javascript" src="//www.google.com/coop/cse/brand?form=cse-search-box&amp;lang=en"></script>
<h1 itemprop="name">Re:  [PATCH RFCv1] Crash: Extensions: Coresight panic dump</h1>
[<a href="msg07203.html">Date Prev</a>][<a href="msg07205.html">Date Next</a>][<a href="msg07205.html">Thread Prev</a>][<a href="msg07202.html">Thread Next</a>][<a href="maillist.html#07204">Date Index</a>][<a href="index.html#07204">Thread Index</a>]
<script src="https://apis.google.com/js/platform.js" async defer></script>
<g:plusone size="small"></g:plusone>
<p>&nbsp;<br>
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- responsive test for archives -->
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-3422782820843221"
     data-ad-slot="6345952567"
     data-ad-format="auto"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>

<!--X-TopPNI-End-->
<!--X-MsgBody-->
<!--X-Subject-Header-Begin-->
<hr>
<!--X-Subject-Header-End-->
<!--X-Head-of-Message-->
<ul>
<li><em>Subject</em>: Re:  [PATCH RFCv1] Crash: Extensions: Coresight panic dump</li>
<li><em>From</em>: Leo Yan &lt;leo.yan@xxxxxxxxxx&gt;</li>
<li><em>Date</em>: Wed, 22 Nov 2017 11:00:33 +0800</li>
<li><em>Cc</em>: CoreSight@xxxxxxxxxxxxxxxx, Mathieu Poirier &lt;mathieu.poirier@xxxxxxxxxx&gt;,        &quot;Discussion list for crash utility usage,	maintenance and development&quot; &lt;crash-utility@xxxxxxxxxx&gt;</li>
<li><em>In-reply-to</em>: &lt;<a href="msg07200.html">311534455.4759549.1511276562982.JavaMail.zimbra@redhat.com</a>&gt;</li>
<li><em>Reply-to</em>: &quot;Discussion list for crash utility usage,	maintenance and development&quot; &lt;crash-utility@xxxxxxxxxx&gt;</li>
<li><em>User-agent</em>: Mutt/1.5.21 (2010-09-15)</li>
</ul>
<!--X-Head-of-Message-End-->
<!--X-Head-Body-Sep-Begin-->
<!-- AddThis Button BEGIN -->
<div class="addthis_toolbox addthis_default_style ">
<a class="addthis_button_preferred_1"></a>
<a class="addthis_button_preferred_2"></a>
<a class="addthis_button_preferred_3"></a>
<a class="addthis_button_preferred_4"></a>
<a class="addthis_button_compact"></a>
<a class="addthis_counter addthis_bubble_style"></a>
</div>
<script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5196c2ae1be43d18&async=1&domready=1" defer async></script>
<!-- AddThis Button END -->
<hr>
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- responsive link 1 -->
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-3422782820843221"
     data-ad-slot="8681825769"
     data-ad-format="link"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
<p>
<div class="content" itemprop="articleBody">
<!--X-Head-Body-Sep-End-->
<!--X-Body-of-Message-->
<pre>Hi Dave,

On Tue, Nov 21, 2017 at 10:02:42AM -0500, Dave Anderson wrote:

[...]

&gt;<i> &gt; Hello Leo,</i>
&gt;<i> &gt; </i>
&gt;<i> &gt; Everything looks fine on paper, except that long ago I stopped accepting</i>
&gt;<i> &gt; and adding extension modules as part of the base crash package:</i>

Thanks a lot for reviewing.

&gt;<i> &gt; &gt; ---</i>
&gt;<i> &gt; &gt;  extensions/csdump.c | 547</i>
&gt;<i> &gt; &gt;  ++++++++++++++++++++++++++++++++++++++++++++++++++++</i>
&gt;<i> &gt; &gt;  1 file changed, 547 insertions(+)</i>
&gt;<i> &gt; &gt;  create mode 100644 extensions/csdump.c</i>
&gt;<i> &gt; </i>
&gt;<i> &gt; Can you please create a simple standalone package that can be added to</i>
&gt;<i> &gt; the extensions page here:</i>
&gt;<i> &gt; </i>
&gt;<i> &gt;   <a  rel="nofollow" href="http://people.redhat.com/anderson/extensions.html">http://people.redhat.com/anderson/extensions.html</a></i>
&gt;<i> &gt; </i>
&gt;<i> &gt; When your standalone pacakge is ready, I will add it to that page.  And</i>
&gt;<i> &gt; any future updates to the package can be posted there as a new revision</i>
&gt;<i> &gt; whenever you like.</i>
&gt;<i> </i>
&gt;<i> BTW, by &quot;standalone package&quot;, in your case, it can simply be a copy of csdump.c,</i>
&gt;<i> since it builds automatically when placed in the extensions subdirectory.  </i>
&gt;<i> </i>
&gt;<i> Note that several of the packages on the extensions page simply consist of a</i>
&gt;<i> single file.  However, you may want to add a version number, a link to a github</i>
&gt;<i> repo, restrict it to ARM64 only, have its own makefile, or whatever you want</i>
&gt;<i> to add.  That's all up to you -- just let me know.</i>

Understand. When I started to write this code, I read the extensions
page and referred intel-pt extension which listed on the page.

This code is still in early phase and need mature it after I get
feedback and suggestions from mailing list.

When related kernel patches have been merged into mainline kernel [1],
then this will be milestone for me and let you help to add it on the
extension page.

[1] <a  rel="nofollow" href="https://lists.linaro.org/pipermail/coresight/2017-November/000964.html">https://lists.linaro.org/pipermail/coresight/2017-November/000964.html</a>

Thanks,
Leo Yan

&gt;<i> &gt; &gt; diff --git a/extensions/csdump.c b/extensions/csdump.c</i>
&gt;<i> &gt; &gt; new file mode 100644</i>
&gt;<i> &gt; &gt; index 0000000..c657378</i>
&gt;<i> &gt; &gt; --- /dev/null</i>
&gt;<i> &gt; &gt; +++ b/extensions/csdump.c</i>
&gt;<i> &gt; &gt; @@ -0,0 +1,547 @@</i>
&gt;<i> &gt; &gt; +/*</i>
&gt;<i> &gt; &gt; + * Extension module to dump log buffer of ARM Coresight Trace</i>
&gt;<i> &gt; &gt; + *</i>
&gt;<i> &gt; &gt; + * Copyright (C) 2017 Linaro Ltd.</i>
&gt;<i> &gt; &gt; + *</i>
&gt;<i> &gt; &gt; + * This program is free software; you can redistribute it and/or modify</i>
&gt;<i> &gt; &gt; + * it under the terms of the GNU General Public License as published by</i>
&gt;<i> &gt; &gt; + * the Free Software Foundation; either version 2 of the License, or</i>
&gt;<i> &gt; &gt; + * (at your option) any later version.</i>
&gt;<i> &gt; &gt; + *</i>
&gt;<i> &gt; &gt; + * This program is distributed in the hope that it will be useful,</i>
&gt;<i> &gt; &gt; + * but WITHOUT ANY WARRANTY; without even the implied warranty of</i>
&gt;<i> &gt; &gt; + * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</i>
&gt;<i> &gt; &gt; + * GNU General Public License for more details.</i>
&gt;<i> &gt; &gt; + */</i>
&gt;<i> &gt; &gt; +</i>
&gt;<i> &gt; &gt; +#define _GNU_SOURCE</i>
&gt;<i> &gt; &gt; +#include &lt;sys/file.h&gt;</i>
&gt;<i> &gt; &gt; +</i>
&gt;<i> &gt; &gt; +#include &quot;defs.h&quot;</i>
&gt;<i> &gt; &gt; +</i>
&gt;<i> &gt; &gt; +static unsigned int perf_header[] = {</i>
&gt;<i> &gt; &gt; +	0x46524550, 0x32454c49,  /* Magic: PERFILE2 */</i>
&gt;<i> &gt; &gt; +	0x00000068, 0x00000000,  /* header size */</i>
&gt;<i> &gt; &gt; +	0x00000080, 0x00000000,  /* attr size */</i>
&gt;<i> &gt; &gt; +	0x00000078, 0x00000000,  /* attrs offset */</i>
&gt;<i> &gt; &gt; +	0x00000100, 0x00000000,  /* attrs size */</i>
&gt;<i> &gt; &gt; +	0x00000178, 0x00000000,  /* data offset */</i>
&gt;<i> &gt; &gt; +	0x00002568, 0x00000000,  /* data size */</i>
&gt;<i> &gt; &gt; +	0x00000000, 0x00000000,  /* event offset */</i>
&gt;<i> &gt; &gt; +	0x00000000, 0x00000000,  /* event size */</i>
&gt;<i> &gt; &gt; +	0x00040004, 0x00000000,  /* feature bitmap */</i>
&gt;<i> &gt; &gt; +	0x00000000, 0x00000000,</i>
&gt;<i> &gt; &gt; +	0x00000000, 0x00000000,</i>
&gt;<i> &gt; &gt; +	0x00000000, 0x00000000</i>
&gt;<i> &gt; &gt; +};</i>
&gt;<i> &gt; &gt; +</i>
&gt;<i> &gt; &gt; +static unsigned int perf_event_id[] = {</i>
&gt;<i> &gt; &gt; +        0x00000015, 0x00000000,</i>
&gt;<i> &gt; &gt; +	0x00000016, 0x00000000,</i>
&gt;<i> &gt; &gt; +};</i>
&gt;<i> &gt; &gt; +</i>
&gt;<i> &gt; &gt; +static unsigned int perf_event_cs_etm[] = {</i>
&gt;<i> &gt; &gt; +	0x00000006, 0x00000070,	 /* event type: 6, size: 0x70 */</i>
&gt;<i> &gt; &gt; +	0x00000000, 0x00000000,  /* config: 0 */</i>
&gt;<i> &gt; &gt; +	0x00000001, 0x00000000,  /* sample_period: 1 */</i>
&gt;<i> &gt; &gt; +	0x00010003, 0x00000000,  /* sample_type: PERF_SAMPLE_IP | PERF_SAMPLE_TID</i>
&gt;<i> &gt; &gt; |</i>
&gt;<i> &gt; &gt; +						 PERF_SAMPLE_PERIOD */</i>
&gt;<i> &gt; &gt; +	0x00000004, 0x00000000,  /* read_format: PERF_FORMAT_ID */</i>
&gt;<i> &gt; &gt; +	0x00141001, 0x00000000,  /* disabled: 1, enable_on_exec: 1,</i>
&gt;<i> &gt; &gt; +                                    sample_id_all: 1, exclude_guest: 1 */</i>
&gt;<i> &gt; &gt; +	0x00000000, 0x00000000,  /* wakeup_events: 0, bp_type: 0 */</i>
&gt;<i> &gt; &gt; +	0x00000000, 0x00000000,  /* config1 : 0 */</i>
&gt;<i> &gt; &gt; +	0x00000000, 0x00000000,  /* config1 : 0 */</i>
&gt;<i> &gt; &gt; +	0x00000000, 0x00000000,  /* branch_sample_type: 0 */</i>
&gt;<i> &gt; &gt; +	0x00000000, 0x00000000,  /* sample_regs_user: 0 */</i>
&gt;<i> &gt; &gt; +	0x00000000, 0x00000000,  /* sample_stack_user: 0, clockid: 0 */</i>
&gt;<i> &gt; &gt; +	0x00000000, 0x00000000,  /* sample_regs_intr: 0 */</i>
&gt;<i> &gt; &gt; +	0x00000000, 0x00000000,  /* aux_watermark: 0, sample_max_stack: 0 */</i>
&gt;<i> &gt; &gt; +	0x00000068, 0x00000000,  /* ids.offset: 0x68 */</i>
&gt;<i> &gt; &gt; +	0x00000008, 0x00000000,  /* ids.size: 0x8 */</i>
&gt;<i> &gt; &gt; +};</i>
&gt;<i> &gt; &gt; +</i>
&gt;<i> &gt; &gt; +static unsigned int perf_event_dummy[] = {</i>
&gt;<i> &gt; &gt; +	0x00000001, 0x00000070,	 /* event type: 1, size: 0x70 */</i>
&gt;<i> &gt; &gt; +	0x00000009, 0x00000000,  /* config: 9 */</i>
&gt;<i> &gt; &gt; +	0x00000001, 0x00000000,  /* sample_period: 1 */</i>
&gt;<i> &gt; &gt; +	0x00010003, 0x00000000,  /* sample_type: PERF_SAMPLE_IP | PERF_SAMPLE_TID</i>
&gt;<i> &gt; &gt; |</i>
&gt;<i> &gt; &gt; +						 PERF_SAMPLE_PERIOD */</i>
&gt;<i> &gt; &gt; +	0x00000004, 0x00000000,  /* read_format: PERF_FORMAT_ID */</i>
&gt;<i> &gt; &gt; +	0x01843361, 0x00000000,  /* disabled: 1, exclude_kernel: 1</i>
&gt;<i> &gt; &gt; +				    exclude_hv: 1, mmap: 1,</i>
&gt;<i> &gt; &gt; +				    comm: 1, enable_on_exec: 1,</i>
&gt;<i> &gt; &gt; +				    task: 1, sample_id_all: 1,</i>
&gt;<i> &gt; &gt; +				    mmap2: 1, comm_exec: 1 */</i>
&gt;<i> &gt; &gt; +	0x00000000, 0x00000000,  /* wakeup_events: 0, bp_type: 0 */</i>
&gt;<i> &gt; &gt; +	0x00000000, 0x00000000,  /* config1 : 0 */</i>
&gt;<i> &gt; &gt; +	0x00000000, 0x00000000,  /* config1 : 0 */</i>
&gt;<i> &gt; &gt; +	0x00000000, 0x00000000,  /* branch_sample_type: 0 */</i>
&gt;<i> &gt; &gt; +	0x00000000, 0x00000000,  /* sample_regs_user: 0 */</i>
&gt;<i> &gt; &gt; +	0x00000000, 0x00000000,  /* sample_stack_user: 0, clockid: 0 */</i>
&gt;<i> &gt; &gt; +	0x00000000, 0x00000000,  /* sample_regs_intr: 0 */</i>
&gt;<i> &gt; &gt; +	0x00000000, 0x00000000,  /* aux_watermark: 0, sample_max_stack: 0 */</i>
&gt;<i> &gt; &gt; +	0x00000070, 0x00000000,  /* ids.offset: 0x70 */</i>
&gt;<i> &gt; &gt; +	0x00000008, 0x00000000,  /* ids.size: 0x8 */</i>
&gt;<i> &gt; &gt; +};</i>
&gt;<i> &gt; &gt; +</i>
&gt;<i> &gt; &gt; +static unsigned int perf_auxtrace_info[] = {</i>
&gt;<i> &gt; &gt; +	0x00000046, 0x02680000,  /* type: PERF_RECORD_AUXTRACE_INFO, size: 0x268</i>
&gt;<i> &gt; &gt; */</i>
&gt;<i> &gt; &gt; +	0x00000003, 0x00000000,  /* info-&gt;type: PERF_AUXTRACE_CS_ETM */</i>
&gt;<i> &gt; &gt; +	0x00000000, 0x00000000,  /* version: 0 */</i>
&gt;<i> &gt; &gt; +	0x00000008, 0x00000006,  /* cpus: 8, type: 6 */</i>
&gt;<i> &gt; &gt; +	0x00000000, 0x00000000   /* snapshot_mode: 0 */</i>
&gt;<i> &gt; &gt; +};</i>
&gt;<i> &gt; &gt; +</i>
&gt;<i> &gt; &gt; +static unsigned int perf_kernel_mmap[] = {</i>
&gt;<i> &gt; &gt; +	0x00000001, 0x00500001,  /* type: PERF_RECORD_MMAP, size: 0x50,</i>
&gt;<i> &gt; &gt; +				    misc: PERF_RECORD_MISC_KERNEL */</i>
&gt;<i> &gt; &gt; +	0xffffffff, 0x00000000,  /* pid: 0xffffffff, tid: 0x0 */</i>
&gt;<i> &gt; &gt; +	0x08080000, 0xffff0000,  /* start: 0xffff000008080000 */</i>
&gt;<i> &gt; &gt; +	0xf7f7ffff, 0x0000ffff,  /* len:   0x0000fffff7f7ffff */</i>
&gt;<i> &gt; &gt; +	0x08080000, 0xffff0000,  /* pgoff: 0xffff000008080000 */</i>
&gt;<i> &gt; &gt; +	0x72656b5b, 0x2e6c656e,  /* filename: [kernel.kallsyms]_text */</i>
&gt;<i> &gt; &gt; +	0x6c6c616b, 0x736d7973,</i>
&gt;<i> &gt; &gt; +	0x65745f5d, 0x00007478,</i>
&gt;<i> &gt; &gt; +	0x00000000, 0x00000000,</i>
&gt;<i> &gt; &gt; +	0x00000000, 0x00000000,</i>
&gt;<i> &gt; &gt; +};</i>
&gt;<i> &gt; &gt; +</i>
&gt;<i> &gt; &gt; +static unsigned int perf_threads[] = {</i>
&gt;<i> &gt; &gt; +	0x00000003, 0x00280000,  /* type: PERF_RECORD_COMM, size: 0x28 */</i>
&gt;<i> &gt; &gt; +	0x0000090c, 0x0000090c,  /* pid: 0x90c, tid: 0x90c */</i>
&gt;<i> &gt; &gt; +	0x66726570, 0x00000000,  /* comm: perf */</i>
&gt;<i> &gt; &gt; +	0x00000000, 0x00000000,</i>
&gt;<i> &gt; &gt; +	0x00000000, 0x00000000,</i>
&gt;<i> &gt; &gt; +</i>
&gt;<i> &gt; &gt; +        0x00000003, 0x00282000,  /* type: PERF_RECORD_COMM, size: 0x28 */</i>
&gt;<i> &gt; &gt; +	0x0000090c, 0x0000090c,  /* pid: 0x90c, tid: 0x90c */</i>
&gt;<i> &gt; &gt; +	0x696e6170, 0x00000063,  /* comm: panic */</i>
&gt;<i> &gt; &gt; +	0x0000090c, 0x0000090c,</i>
&gt;<i> &gt; &gt; +        0x00000016, 0x00000000,</i>
&gt;<i> &gt; &gt; +</i>
&gt;<i> &gt; &gt; +	0x0000000a, 0x00680002,  /* type: PERF_RECORD_MMAP2, size: 0x68 */</i>
&gt;<i> &gt; &gt; +	0x0000090c, 0x0000090c,  /* pid: 0x90c, tid: 0x90c */</i>
&gt;<i> &gt; &gt; +	0x00400000, 0x00000000,  /* addr: 0x00400000 */</i>
&gt;<i> &gt; &gt; +	0x00006000, 0x00000000,  /* len: 0x00006000 */</i>
&gt;<i> &gt; &gt; +	0x00000000, 0x00000000,  /* pgoff: 0x0 */</i>
&gt;<i> &gt; &gt; +	0x000000b3, 0x00000009,  /* maj: 0xb3, min: 0x9 */</i>
&gt;<i> &gt; &gt; +	0x00000085, 0x00000000,  /* ino: 0x85 */</i>
&gt;<i> &gt; &gt; +	0x00000000, 0x00000000,  /* ino_generation: 0x0 */</i>
&gt;<i> &gt; &gt; +	0x00000005, 0x00001802,  /* prot: PROT_READ | PROT_EXEC, flag: 0x1802 */</i>
&gt;<i> &gt; &gt; +	0x6e69622f, 0x616e752f,  /* comm: /bin/uname */</i>
&gt;<i> &gt; &gt; +	0x0000656d, 0x00000000,</i>
&gt;<i> &gt; &gt; +	0x0000090c, 0x0000090c,</i>
&gt;<i> &gt; &gt; +	0x00000016, 0x00000000,</i>
&gt;<i> &gt; &gt; +</i>
&gt;<i> &gt; &gt; +        0x0000000a, 0x00800002,</i>
&gt;<i> &gt; &gt; +	0x0000090c, 0x0000090c,</i>
&gt;<i> &gt; &gt; +	0xb77c2000, 0x0000ffff,</i>
&gt;<i> &gt; &gt; +	0x0002e000, 0x00000000,</i>
&gt;<i> &gt; &gt; +	0x00000000, 0x00000000,</i>
&gt;<i> &gt; &gt; +	0x000000b3, 0x00000009,</i>
&gt;<i> &gt; &gt; +	0x00000752, 0x00000000,</i>
&gt;<i> &gt; &gt; +	0x00000000, 0x00000000,</i>
&gt;<i> &gt; &gt; +	0x00000005, 0x00001802,</i>
&gt;<i> &gt; &gt; +	0x62696c2f, 0x7261612f,  /* ld-2.19.so */</i>
&gt;<i> &gt; &gt; +	0x34366863, 0x6e696c2d,</i>
&gt;<i> &gt; &gt; +	0x672d7875, 0x6c2f756e,</i>
&gt;<i> &gt; &gt; +	0x2e322d64, 0x732e3931,</i>
&gt;<i> &gt; &gt; +	0x0000006f, 0x00000000,</i>
&gt;<i> &gt; &gt; +	0x0000090c, 0x0000090c,</i>
&gt;<i> &gt; &gt; +	0x00000016, 0x00000000,</i>
&gt;<i> &gt; &gt; +</i>
&gt;<i> &gt; &gt; +	0x0000000a, 0x00600002,</i>
&gt;<i> &gt; &gt; +	0x0000090c, 0x0000090c,</i>
&gt;<i> &gt; &gt; +	0xb77ec000, 0x0000ffff,</i>
&gt;<i> &gt; &gt; +	0x00001000, 0x00000000,</i>
&gt;<i> &gt; &gt; +	0x00000000, 0x00000000,</i>
&gt;<i> &gt; &gt; +	0x00000000, 0x00000000,</i>
&gt;<i> &gt; &gt; +	0x00000000, 0x00000000,</i>
&gt;<i> &gt; &gt; +	0x00000000, 0x00000000,</i>
&gt;<i> &gt; &gt; +	0x00000005, 0x00001002,</i>
&gt;<i> &gt; &gt; +	0x7364765b, 0x00005d6f,  /* [vdso] */</i>
&gt;<i> &gt; &gt; +	0x0000090c, 0x0000090c,</i>
&gt;<i> &gt; &gt; +	0x00000016, 0x00000000,</i>
&gt;<i> &gt; &gt; +</i>
&gt;<i> &gt; &gt; +	0x0000000a, 0x00800002,</i>
&gt;<i> &gt; &gt; +	0x0000090c, 0x0000090c,</i>
&gt;<i> &gt; &gt; +	0xb7675000, 0x0000ffff,</i>
&gt;<i> &gt; &gt; +	0x0014d000, 0x00000000,</i>
&gt;<i> &gt; &gt; +	0x00000000, 0x00000000,</i>
&gt;<i> &gt; &gt; +	0x000000b3, 0x00000009,</i>
&gt;<i> &gt; &gt; +	0x0000076a, 0x00000000,</i>
&gt;<i> &gt; &gt; +	0x00000000, 0x00000000,</i>
&gt;<i> &gt; &gt; +	0x00000005, 0x00001002,</i>
&gt;<i> &gt; &gt; +	0x62696c2f, 0x7261612f,  /* /lib/aarch64-linux-gnu/libc-2.19.so */</i>
&gt;<i> &gt; &gt; +	0x34366863, 0x6e696c2d,</i>
&gt;<i> &gt; &gt; +	0x672d7875, 0x6c2f756e,</i>
&gt;<i> &gt; &gt; +	0x2d636269, 0x39312e32,</i>
&gt;<i> &gt; &gt; +	0x006f732e, 0x00000000,</i>
&gt;<i> &gt; &gt; +	0x0000090c, 0x0000090c,</i>
&gt;<i> &gt; &gt; +	0x00000016, 0x00000000,</i>
&gt;<i> &gt; &gt; +</i>
&gt;<i> &gt; &gt; +	0x0000000b, 0x00300000,  /* type: PERF_RECORD_AUX, size: 0x30 */</i>
&gt;<i> &gt; &gt; +	0x00000000, 0x00000000,  /* aux_offset: 0x0 */</i>
&gt;<i> &gt; &gt; +	0x00002000, 0x00000000,  /* aux_size: 0x2000 */</i>
&gt;<i> &gt; &gt; +	0x00000001, 0x00000000,  /* flag: 0x1 */</i>
&gt;<i> &gt; &gt; +	0x0000090c, 0x0000090c,</i>
&gt;<i> &gt; &gt; +	0x00000015, 0x00000000,</i>
&gt;<i> &gt; &gt; +</i>
&gt;<i> &gt; &gt; +        0x00000004, 0x00300000,  /* type: PERF_RECORD_EXIT, size: 0x30 */</i>
&gt;<i> &gt; &gt; +	0x0000090c, 0x0000090c,  /* pid, ppid: 0x90c */</i>
&gt;<i> &gt; &gt; +	0x0000090c, 0x0000090c,  /* tid, ptid: 0x90c */</i>
&gt;<i> &gt; &gt; +	0xf89cbddc, 0x00000571,</i>
&gt;<i> &gt; &gt; +	0x0000090c, 0x0000090c,</i>
&gt;<i> &gt; &gt; +	0x00000016, 0x00000000,</i>
&gt;<i> &gt; &gt; +};</i>
&gt;<i> &gt; &gt; +</i>
&gt;<i> &gt; &gt; +static unsigned int perf_auxtrace_snapshot[] = {</i>
&gt;<i> &gt; &gt; +	0x00000047, 0x00300000,  /* type: PERF_RECORD_AUXTRACE, size: 0x30 */</i>
&gt;<i> &gt; &gt; +	0x00002000, 0x00000000,  /* auxsize: 0x2000 */</i>
&gt;<i> &gt; &gt; +	0x00000000, 0x00000000,  /* auxoffset: 0x0 */</i>
&gt;<i> &gt; &gt; +	0x74bc6ab4, 0x5a1c47b3,  /* reference: rand() */</i>
&gt;<i> &gt; &gt; +	0x00000000, 0x0000090c,  /* idx: 0x0, pid: 0x90c */</i>
&gt;<i> &gt; &gt; +	0xffffffff, 0x00000000,  /* cpu: -1 */</i>
&gt;<i> &gt; &gt; +};</i>
&gt;<i> &gt; &gt; +</i>
&gt;<i> &gt; &gt; +static unsigned int perf_record_finish[] = {</i>
&gt;<i> &gt; &gt; +        0x00000044, 0x00080000,</i>
&gt;<i> &gt; &gt; +};</i>
&gt;<i> &gt; &gt; +</i>
&gt;<i> &gt; &gt; +static unsigned int perf_sections[] = {</i>
&gt;<i> &gt; &gt; +	0x00002760, 0x00000000,  /* buildid section: start addr */</i>
&gt;<i> &gt; &gt; +	0x00000064, 0x00000000,  /* buildid section: len */</i>
&gt;<i> &gt; &gt; +	0x000027c4, 0x00000000,  /* auxtrace section: start addr */</i>
&gt;<i> &gt; &gt; +	0x00000018, 0x00000000,  /* auxtrace section: len */</i>
&gt;<i> &gt; &gt; +	0x000027dc, 0x00000000,</i>
&gt;<i> &gt; &gt; +	0x00000000, 0x00000000,</i>
&gt;<i> &gt; &gt; +	0x00000000, 0x00000000,</i>
&gt;<i> &gt; &gt; +	0x00000000, 0x00000000,</i>
&gt;<i> &gt; &gt; +};</i>
&gt;<i> &gt; &gt; +</i>
&gt;<i> &gt; &gt; +static unsigned int perf_sections_feat[] = {</i>
&gt;<i> &gt; &gt; +	0x00000000, 0x00640001,</i>
&gt;<i> &gt; &gt; +	0xffffffff, 0xc9b5ee32,</i>
&gt;<i> &gt; &gt; +	0xa6009dc9, 0xcb21093d,</i>
&gt;<i> &gt; &gt; +	0x23c315d8, 0x1067c385,</i>
&gt;<i> &gt; &gt; +	0x00000000, 0x72656b5b,</i>
&gt;<i> &gt; &gt; +	0x2e6c656e, 0x6c6c616b,</i>
&gt;<i> &gt; &gt; +	0x736d7973, 0x0000005d,</i>
&gt;<i> &gt; &gt; +	0x00000000, 0x00000000,</i>
&gt;<i> &gt; &gt; +	0x00000000, 0x00000000,</i>
&gt;<i> &gt; &gt; +	0x00000000, 0x00000000,</i>
&gt;<i> &gt; &gt; +	0x00000000, 0x00000000,</i>
&gt;<i> &gt; &gt; +	0x00000000, 0x00000000,</i>
&gt;<i> &gt; &gt; +	0x00000000,</i>
&gt;<i> &gt; &gt; +</i>
&gt;<i> &gt; &gt; +	0x00000001, 0x00000000,</i>
&gt;<i> &gt; &gt; +	0x000006a8, 0x00000000,</i>
&gt;<i> &gt; &gt; +	0x00000030, 0x00000000,</i>
&gt;<i> &gt; &gt; +};</i>
&gt;<i> &gt; &gt; +</i>
&gt;<i> &gt; &gt; +#define koffset(struct, member) struct##_##member##_offset</i>
&gt;<i> &gt; &gt; +</i>
&gt;<i> &gt; &gt; +/* at = ((struct *)ptr)-&gt;member */</i>
&gt;<i> &gt; &gt; +#define read_value(at, ptr, struct, member)				\</i>
&gt;<i> &gt; &gt; +	do {								\</i>
&gt;<i> &gt; &gt; +		readmem(ptr + koffset(struct, member), KVADDR,		\</i>
&gt;<i> &gt; &gt; +				&amp;at, sizeof(at), #struct &quot;'s &quot; #member,	\</i>
&gt;<i> &gt; &gt; +				RETURN_ON_ERROR);			\</i>
&gt;<i> &gt; &gt; +	} while (0)</i>
&gt;<i> &gt; &gt; +</i>
&gt;<i> &gt; &gt; +</i>
&gt;<i> &gt; &gt; +#define init_offset(struct, member) do {				\</i>
&gt;<i> &gt; &gt; +		koffset(struct, member) = MEMBER_OFFSET(#struct, #member);\</i>
&gt;<i> &gt; &gt; +		if (koffset(struct, member) &lt; 0) {			\</i>
&gt;<i> &gt; &gt; +			fprintf(fp, &quot;failed to init the offset, struct:&quot;\</i>
&gt;<i> &gt; &gt; +				#struct &quot;, member:&quot; #member);		\</i>
&gt;<i> &gt; &gt; +			fprintf(fp, &quot;\n&quot;);				\</i>
&gt;<i> &gt; &gt; +			return -1;					\</i>
&gt;<i> &gt; &gt; +		}							\</i>
&gt;<i> &gt; &gt; +	} while (0)</i>
&gt;<i> &gt; &gt; +</i>
&gt;<i> &gt; &gt; +static int koffset(coresight_dump_node, cpu);</i>
&gt;<i> &gt; &gt; +static int koffset(coresight_dump_node, list);</i>
&gt;<i> &gt; &gt; +static int koffset(coresight_dump_node, buf);</i>
&gt;<i> &gt; &gt; +static int koffset(coresight_dump_node, buf_size);</i>
&gt;<i> &gt; &gt; +static int koffset(coresight_dump_node, name);</i>
&gt;<i> &gt; &gt; +static int koffset(coresight_dump_node, csdev);</i>
&gt;<i> &gt; &gt; +</i>
&gt;<i> &gt; &gt; +static int koffset(coresight_device, dev);</i>
&gt;<i> &gt; &gt; +static int koffset(device, kobj);</i>
&gt;<i> &gt; &gt; +static int koffset(kobject, name);</i>
&gt;<i> &gt; &gt; +</i>
&gt;<i> &gt; &gt; +static struct list_data list_data;</i>
&gt;<i> &gt; &gt; +static int instance_count;</i>
&gt;<i> &gt; &gt; +static int csdump_metadata_len = 0;</i>
&gt;<i> &gt; &gt; +</i>
&gt;<i> &gt; &gt; +static int csdump_write_buf(FILE *out_fp, char *component, int cpu_idx)</i>
&gt;<i> &gt; &gt; +{</i>
&gt;<i> &gt; &gt; +	ulong instance_ptr;</i>
&gt;<i> &gt; &gt; +	ulong field;</i>
&gt;<i> &gt; &gt; +	ulong buf_addr;</i>
&gt;<i> &gt; &gt; +	ulong csdev_addr;</i>
&gt;<i> &gt; &gt; +	ulong dev_addr;</i>
&gt;<i> &gt; &gt; +	ulong kobj_addr;</i>
&gt;<i> &gt; &gt; +	ulong name_addr;</i>
&gt;<i> &gt; &gt; +	int cpu, buf_sz, i, ret;</i>
&gt;<i> &gt; &gt; +	char name[64];</i>
&gt;<i> &gt; &gt; +	char *buf;</i>
&gt;<i> &gt; &gt; +</i>
&gt;<i> &gt; &gt; +	/* We start i at 1 to skip over the list_head and continue to the last</i>
&gt;<i> &gt; &gt; +	 * instance, which lies at index instance_count */</i>
&gt;<i> &gt; &gt; +	for (i = 1; i &lt;= instance_count; i++) {</i>
&gt;<i> &gt; &gt; +		instance_ptr = list_data.list_ptr[i];</i>
&gt;<i> &gt; &gt; +</i>
&gt;<i> &gt; &gt; +		field = instance_ptr - koffset(coresight_dump_node, list);</i>
&gt;<i> &gt; &gt; +</i>
&gt;<i> &gt; &gt; +		read_value(cpu, field, coresight_dump_node, cpu);</i>
&gt;<i> &gt; &gt; +		read_value(buf_addr, field, coresight_dump_node, buf);</i>
&gt;<i> &gt; &gt; +		read_value(buf_sz, field, coresight_dump_node, buf_size);</i>
&gt;<i> &gt; &gt; +</i>
&gt;<i> &gt; &gt; +		read_value(csdev_addr, field, coresight_dump_node, csdev);</i>
&gt;<i> &gt; &gt; +		dev_addr = csdev_addr + koffset(coresight_device, dev);</i>
&gt;<i> &gt; &gt; +		kobj_addr = dev_addr + koffset(device, kobj);</i>
&gt;<i> &gt; &gt; +</i>
&gt;<i> &gt; &gt; +		read_value(name_addr, kobj_addr, kobject, name);</i>
&gt;<i> &gt; &gt; +		read_string(name_addr, name, 64);</i>
&gt;<i> &gt; &gt; +</i>
&gt;<i> &gt; &gt; +		if (!buf_sz)</i>
&gt;<i> &gt; &gt; +			continue;</i>
&gt;<i> &gt; &gt; +</i>
&gt;<i> &gt; &gt; +		if (strstr(name, component) &amp;&amp; (cpu == cpu_idx))</i>
&gt;<i> &gt; &gt; +			break;</i>
&gt;<i> &gt; &gt; +	}</i>
&gt;<i> &gt; &gt; +</i>
&gt;<i> &gt; &gt; +	if (i &gt; instance_count)</i>
&gt;<i> &gt; &gt; +		return -1;</i>
&gt;<i> &gt; &gt; +</i>
&gt;<i> &gt; &gt; +	buf = malloc(buf_sz);</i>
&gt;<i> &gt; &gt; +	readmem(buf_addr, KVADDR, buf, buf_sz, &quot;read dump log buf&quot;,</i>
&gt;<i> &gt; &gt; +		FAULT_ON_ERROR);</i>
&gt;<i> &gt; &gt; +</i>
&gt;<i> &gt; &gt; +	ret = fwrite(buf, buf_sz, 1, out_fp);</i>
&gt;<i> &gt; &gt; +	if (!ret) {</i>
&gt;<i> &gt; &gt; +		fprintf(fp, &quot;[%d] Cannot write file\n&quot;, cpu);</i>
&gt;<i> &gt; &gt; +		free(buf);</i>
&gt;<i> &gt; &gt; +		return -1;</i>
&gt;<i> &gt; &gt; +	}</i>
&gt;<i> &gt; &gt; +</i>
&gt;<i> &gt; &gt; +	free(buf);</i>
&gt;<i> &gt; &gt; +</i>
&gt;<i> &gt; &gt; +	return buf_sz;</i>
&gt;<i> &gt; &gt; +}</i>
&gt;<i> &gt; &gt; +</i>
&gt;<i> &gt; &gt; +static int csdump_metadata(void)</i>
&gt;<i> &gt; &gt; +{</i>
&gt;<i> &gt; &gt; +	FILE *out_fp;</i>
&gt;<i> &gt; &gt; +	int online_cpus, i;</i>
&gt;<i> &gt; &gt; +</i>
&gt;<i> &gt; &gt; +	if ((out_fp = fopen(&quot;./metadata.bin&quot;, &quot;w&quot;)) == NULL) {</i>
&gt;<i> &gt; &gt; +		fprintf(fp, &quot;Cannot open file\n&quot;);</i>
&gt;<i> &gt; &gt; +		return -1;</i>
&gt;<i> &gt; &gt; +	}</i>
&gt;<i> &gt; &gt; +</i>
&gt;<i> &gt; &gt; +	online_cpus = get_cpus_online();</i>
&gt;<i> &gt; &gt; +	for (i = 0; i &lt; online_cpus; i++) {</i>
&gt;<i> &gt; &gt; +		fprintf(fp, &quot;cpu = %d\n&quot;, i);</i>
&gt;<i> &gt; &gt; +		csdump_metadata_len += csdump_write_buf(out_fp, &quot;etm&quot;, i);</i>
&gt;<i> &gt; &gt; +	}</i>
&gt;<i> &gt; &gt; +</i>
&gt;<i> &gt; &gt; +	fclose(out_fp);</i>
&gt;<i> &gt; &gt; +</i>
&gt;<i> &gt; &gt; +	return 0;</i>
&gt;<i> &gt; &gt; +}</i>
&gt;<i> &gt; &gt; +</i>
&gt;<i> &gt; &gt; +static int csdump_tracedata(void)</i>
&gt;<i> &gt; &gt; +{</i>
&gt;<i> &gt; &gt; +	FILE *out_fp;</i>
&gt;<i> &gt; &gt; +</i>
&gt;<i> &gt; &gt; +	if ((out_fp = fopen(&quot;./cstrace.bin&quot;, &quot;w&quot;)) == NULL) {</i>
&gt;<i> &gt; &gt; +		fprintf(fp, &quot;Cannot open file\n&quot;);</i>
&gt;<i> &gt; &gt; +		return -1;</i>
&gt;<i> &gt; &gt; +	}</i>
&gt;<i> &gt; &gt; +</i>
&gt;<i> &gt; &gt; +	csdump_write_buf(out_fp, &quot;etf&quot;, 0);</i>
&gt;<i> &gt; &gt; +</i>
&gt;<i> &gt; &gt; +	fclose(out_fp);</i>
&gt;<i> &gt; &gt; +</i>
&gt;<i> &gt; &gt; +	return 0;</i>
&gt;<i> &gt; &gt; +}</i>
&gt;<i> &gt; &gt; +</i>
&gt;<i> &gt; &gt; +static int csdump_perfdata(void)</i>
&gt;<i> &gt; &gt; +{</i>
&gt;<i> &gt; &gt; +	FILE *out_fp;</i>
&gt;<i> &gt; &gt; +	int online_cpus, i;</i>
&gt;<i> &gt; &gt; +	int trace_len = 0;</i>
&gt;<i> &gt; &gt; +	int pos, diff;</i>
&gt;<i> &gt; &gt; +</i>
&gt;<i> &gt; &gt; +	if ((out_fp = fopen(&quot;./perf.data&quot;, &quot;w&quot;)) == NULL) {</i>
&gt;<i> &gt; &gt; +		fprintf(fp, &quot;Cannot open file\n&quot;);</i>
&gt;<i> &gt; &gt; +		return -1;</i>
&gt;<i> &gt; &gt; +	}</i>
&gt;<i> &gt; &gt; +</i>
&gt;<i> &gt; &gt; +	fwrite(perf_header, sizeof(perf_header), 1, out_fp);</i>
&gt;<i> &gt; &gt; +	fwrite(perf_event_id, sizeof(perf_event_id), 1, out_fp);</i>
&gt;<i> &gt; &gt; +	fwrite(perf_event_cs_etm, sizeof(perf_event_cs_etm), 1, out_fp);</i>
&gt;<i> &gt; &gt; +	fwrite(perf_event_dummy, sizeof(perf_event_dummy), 1, out_fp);</i>
&gt;<i> &gt; &gt; +</i>
&gt;<i> &gt; &gt; +	online_cpus = get_cpus_online();</i>
&gt;<i> &gt; &gt; +</i>
&gt;<i> &gt; &gt; +	/* Adjust auxtrace_info size */</i>
&gt;<i> &gt; &gt; +	perf_auxtrace_info[1] = (perf_auxtrace_info[1] &amp; 0xffff) |</i>
&gt;<i> &gt; &gt; +		((sizeof(perf_auxtrace_info) + csdump_metadata_len) &lt;&lt; 16);</i>
&gt;<i> &gt; &gt; +	/* Adjust CPU num */</i>
&gt;<i> &gt; &gt; +	perf_auxtrace_info[6] = online_cpus;</i>
&gt;<i> &gt; &gt; +</i>
&gt;<i> &gt; &gt; +	fwrite(perf_auxtrace_info, sizeof(perf_auxtrace_info), 1, out_fp);</i>
&gt;<i> &gt; &gt; +	trace_len += sizeof(perf_auxtrace_info);</i>
&gt;<i> &gt; &gt; +</i>
&gt;<i> &gt; &gt; +	for (i = 0; i &lt; online_cpus; i++) {</i>
&gt;<i> &gt; &gt; +		fprintf(fp, &quot;cpu = %d\n&quot;, i);</i>
&gt;<i> &gt; &gt; +		trace_len += csdump_write_buf(out_fp, &quot;etm&quot;, i);</i>
&gt;<i> &gt; &gt; +	}</i>
&gt;<i> &gt; &gt; +</i>
&gt;<i> &gt; &gt; +	fwrite(perf_kernel_mmap, sizeof(perf_kernel_mmap), 1, out_fp);</i>
&gt;<i> &gt; &gt; +	trace_len += sizeof(perf_kernel_mmap);</i>
&gt;<i> &gt; &gt; +</i>
&gt;<i> &gt; &gt; +	fwrite(perf_threads, sizeof(perf_threads), 1, out_fp);</i>
&gt;<i> &gt; &gt; +	trace_len += sizeof(perf_threads);</i>
&gt;<i> &gt; &gt; +</i>
&gt;<i> &gt; &gt; +	fwrite(perf_auxtrace_snapshot, sizeof(perf_auxtrace_snapshot), 1,</i>
&gt;<i> &gt; &gt; out_fp);</i>
&gt;<i> &gt; &gt; +	trace_len += sizeof(perf_auxtrace_snapshot);</i>
&gt;<i> &gt; &gt; +</i>
&gt;<i> &gt; &gt; +	trace_len += csdump_write_buf(out_fp, &quot;etf&quot;, 0);</i>
&gt;<i> &gt; &gt; +</i>
&gt;<i> &gt; &gt; +	fwrite(perf_record_finish, sizeof(perf_record_finish), 1, out_fp);</i>
&gt;<i> &gt; &gt; +	trace_len += sizeof(perf_record_finish);</i>
&gt;<i> &gt; &gt; +</i>
&gt;<i> &gt; &gt; +	pos = ftell(out_fp);</i>
&gt;<i> &gt; &gt; +	pos += sizeof(perf_sections);</i>
&gt;<i> &gt; &gt; +</i>
&gt;<i> &gt; &gt; +	diff = perf_sections[0] - pos;</i>
&gt;<i> &gt; &gt; +</i>
&gt;<i> &gt; &gt; +	for (i = 0; i &lt; sizeof(perf_sections) / 4; i += 4) {</i>
&gt;<i> &gt; &gt; +		if (!perf_sections[i])</i>
&gt;<i> &gt; &gt; +			continue;</i>
&gt;<i> &gt; &gt; +</i>
&gt;<i> &gt; &gt; +		perf_sections[i] = perf_sections[i] - diff;</i>
&gt;<i> &gt; &gt; +	}</i>
&gt;<i> &gt; &gt; +</i>
&gt;<i> &gt; &gt; +	fwrite(perf_sections, sizeof(perf_sections), 1, out_fp);</i>
&gt;<i> &gt; &gt; +	fwrite(perf_sections_feat, sizeof(perf_sections_feat), 1, out_fp);</i>
&gt;<i> &gt; &gt; +</i>
&gt;<i> &gt; &gt; +	fseek(out_fp, 48L, SEEK_SET);</i>
&gt;<i> &gt; &gt; +	fwrite(&amp;trace_len, sizeof(trace_len), 1, out_fp);</i>
&gt;<i> &gt; &gt; +</i>
&gt;<i> &gt; &gt; +	fclose(out_fp);</i>
&gt;<i> &gt; &gt; +</i>
&gt;<i> &gt; &gt; +	return 0;</i>
&gt;<i> &gt; &gt; +}</i>
&gt;<i> &gt; &gt; +</i>
&gt;<i> &gt; &gt; +static int csdump_prepare(void)</i>
&gt;<i> &gt; &gt; +{</i>
&gt;<i> &gt; &gt; +	struct syment *sym_dump_list;</i>
&gt;<i> &gt; &gt; +	struct kernel_list_head *cs_dump_list_head;</i>
&gt;<i> &gt; &gt; +</i>
&gt;<i> &gt; &gt; +	init_offset(coresight_dump_node, cpu);</i>
&gt;<i> &gt; &gt; +	init_offset(coresight_dump_node, list);</i>
&gt;<i> &gt; &gt; +	init_offset(coresight_dump_node, buf);</i>
&gt;<i> &gt; &gt; +	init_offset(coresight_dump_node, buf_size);</i>
&gt;<i> &gt; &gt; +	init_offset(coresight_dump_node, name);</i>
&gt;<i> &gt; &gt; +	init_offset(coresight_dump_node, csdev);</i>
&gt;<i> &gt; &gt; +</i>
&gt;<i> &gt; &gt; +	init_offset(coresight_device, dev);</i>
&gt;<i> &gt; &gt; +	init_offset(device, kobj);</i>
&gt;<i> &gt; &gt; +	init_offset(kobject, name);</i>
&gt;<i> &gt; &gt; +</i>
&gt;<i> &gt; &gt; +	/* Get pointer to dump list */</i>
&gt;<i> &gt; &gt; +	sym_dump_list = symbol_search(&quot;coresight_dump_list&quot;);</i>
&gt;<i> &gt; &gt; +	if (!sym_dump_list) {</i>
&gt;<i> &gt; &gt; +		fprintf(fp, &quot;symbol coresight_dump_list is not found\n&quot;);</i>
&gt;<i> &gt; &gt; +		return -1;</i>
&gt;<i> &gt; &gt; +	}</i>
&gt;<i> &gt; &gt; +</i>
&gt;<i> &gt; &gt; +	cs_dump_list_head = (void *)sym_dump_list-&gt;value;</i>
&gt;<i> &gt; &gt; +	fprintf(fp, &quot;cs_dump_list_head = 0x%p\n&quot;, cs_dump_list_head);</i>
&gt;<i> &gt; &gt; +</i>
&gt;<i> &gt; &gt; +	BZERO(&amp;list_data, sizeof(struct list_data));</i>
&gt;<i> &gt; &gt; +	list_data.start = (ulong)cs_dump_list_head;</i>
&gt;<i> &gt; &gt; +	list_data.end = (ulong)cs_dump_list_head;</i>
&gt;<i> &gt; &gt; +	list_data.flags = LIST_ALLOCATE;</i>
&gt;<i> &gt; &gt; +	instance_count = do_list(&amp;list_data);</i>
&gt;<i> &gt; &gt; +</i>
&gt;<i> &gt; &gt; +	/*</i>
&gt;<i> &gt; &gt; +	 * The do_list count includes the list_head, which is not</i>
&gt;<i> &gt; &gt; +	 * a proper instance so minus 1.</i>
&gt;<i> &gt; &gt; +	 */</i>
&gt;<i> &gt; &gt; +	instance_count--;</i>
&gt;<i> &gt; &gt; +	if (instance_count &lt;= 0)</i>
&gt;<i> &gt; &gt; +		return -1;</i>
&gt;<i> &gt; &gt; +</i>
&gt;<i> &gt; &gt; +	return 0;</i>
&gt;<i> &gt; &gt; +}</i>
&gt;<i> &gt; &gt; +</i>
&gt;<i> &gt; &gt; +static void csdump_unprepare(void)</i>
&gt;<i> &gt; &gt; +{</i>
&gt;<i> &gt; &gt; +	FREEBUF(list_data.list_ptr);</i>
&gt;<i> &gt; &gt; +}</i>
&gt;<i> &gt; &gt; +</i>
&gt;<i> &gt; &gt; +void cmd_csdump(void)</i>
&gt;<i> &gt; &gt; +{</i>
&gt;<i> &gt; &gt; +	char* outdir;</i>
&gt;<i> &gt; &gt; +	mode_t mode = S_IRUSR | S_IWUSR | S_IXUSR |</i>
&gt;<i> &gt; &gt; +		      S_IRGRP | S_IXGRP |</i>
&gt;<i> &gt; &gt; +		      S_IROTH | S_IXOTH; /* 0755 */</i>
&gt;<i> &gt; &gt; +	int ret;</i>
&gt;<i> &gt; &gt; +</i>
&gt;<i> &gt; &gt; +	if (argcnt != 2)</i>
&gt;<i> &gt; &gt; +		cmd_usage(pc-&gt;curcmd, SYNOPSIS);</i>
&gt;<i> &gt; &gt; +</i>
&gt;<i> &gt; &gt; +	outdir = args[1];</i>
&gt;<i> &gt; &gt; +	if ((ret = mkdir(outdir, mode))) {</i>
&gt;<i> &gt; &gt; +		fprintf(fp, &quot;Cannot create directory %s: %d\n&quot;, outdir, ret);</i>
&gt;<i> &gt; &gt; +		return;</i>
&gt;<i> &gt; &gt; +	}</i>
&gt;<i> &gt; &gt; +</i>
&gt;<i> &gt; &gt; +	if ((ret = chdir(outdir))) {</i>
&gt;<i> &gt; &gt; +		fprintf(fp, &quot;Cannot chdir %s: %d\n&quot;, outdir, ret);</i>
&gt;<i> &gt; &gt; +		return;</i>
&gt;<i> &gt; &gt; +	}</i>
&gt;<i> &gt; &gt; +</i>
&gt;<i> &gt; &gt; +	if (csdump_prepare())</i>
&gt;<i> &gt; &gt; +		goto out;</i>
&gt;<i> &gt; &gt; +</i>
&gt;<i> &gt; &gt; +	csdump_metadata();</i>
&gt;<i> &gt; &gt; +	csdump_tracedata();</i>
&gt;<i> &gt; &gt; +	csdump_perfdata();</i>
&gt;<i> &gt; &gt; +</i>
&gt;<i> &gt; &gt; +out:</i>
&gt;<i> &gt; &gt; +	csdump_unprepare();</i>
&gt;<i> &gt; &gt; +	chdir(&quot;..&quot;);</i>
&gt;<i> &gt; &gt; +	return;</i>
&gt;<i> &gt; &gt; +}</i>
&gt;<i> &gt; &gt; +</i>
&gt;<i> &gt; &gt; +char *help_csdump[] = {</i>
&gt;<i> &gt; &gt; +	&quot;csdump&quot;,</i>
&gt;<i> &gt; &gt; +	&quot;Dump log buffer of Coresight Trace&quot;,</i>
&gt;<i> &gt; &gt; +	&quot;&lt;output-dir&gt;&quot;,</i>
&gt;<i> &gt; &gt; +	&quot;This command extracts coresight log buffer to the directory&quot;,</i>
&gt;<i> &gt; &gt; +	&quot;specified by &lt;output-dir&gt;&quot;,</i>
&gt;<i> &gt; &gt; +	NULL</i>
&gt;<i> &gt; &gt; +};</i>
&gt;<i> &gt; &gt; +</i>
&gt;<i> &gt; &gt; +static struct command_table_entry command_table[] = {</i>
&gt;<i> &gt; &gt; +	{ &quot;csdump&quot;, cmd_csdump, help_csdump, 0},</i>
&gt;<i> &gt; &gt; +	{ NULL },</i>
&gt;<i> &gt; &gt; +};</i>
&gt;<i> &gt; &gt; +</i>
&gt;<i> &gt; &gt; +void __attribute__((constructor))</i>
&gt;<i> &gt; &gt; +csdump_init(void)</i>
&gt;<i> &gt; &gt; +{</i>
&gt;<i> &gt; &gt; +	register_extension(command_table);</i>
&gt;<i> &gt; &gt; +}</i>
&gt;<i> &gt; &gt; +</i>
&gt;<i> &gt; &gt; +void __attribute__((destructor))</i>
&gt;<i> &gt; &gt; +csdump_fini(void) { }</i>
&gt;<i> &gt; &gt; --</i>
&gt;<i> &gt; &gt; 2.7.4</i>
&gt;<i> &gt; &gt; </i>
&gt;<i> &gt; &gt; --</i>
&gt;<i> &gt; &gt; Crash-utility mailing list</i>
&gt;<i> &gt; &gt; Crash-utility@xxxxxxxxxx</i>
&gt;<i> &gt; &gt; <a  rel="nofollow" href="https://www.redhat.com/mailman/listinfo/crash-utility">https://www.redhat.com/mailman/listinfo/crash-utility</a></i>
&gt;<i> &gt; &gt; </i>
&gt;<i> &gt; </i>
&gt;<i> &gt; --</i>
&gt;<i> &gt; Crash-utility mailing list</i>
&gt;<i> &gt; Crash-utility@xxxxxxxxxx</i>
&gt;<i> &gt; <a  rel="nofollow" href="https://www.redhat.com/mailman/listinfo/crash-utility">https://www.redhat.com/mailman/listinfo/crash-utility</a></i>
&gt;<i> &gt; </i>

--
Crash-utility mailing list
Crash-utility@xxxxxxxxxx
<a  rel="nofollow" href="https://www.redhat.com/mailman/listinfo/crash-utility">https://www.redhat.com/mailman/listinfo/crash-utility</a>


</pre>
<!--X-Body-of-Message-End-->
<!--X-MsgBody-End-->
<!--X-Follow-Ups-->
</div>
<hr>
<!--X-Follow-Ups-End-->
<!--X-References-->
<ul><li><strong>References</strong>:
<ul>
<li><strong><a name="07198" href="msg07198.html">[PATCH RFCv1] Crash: Extensions: Coresight panic	dump</a></strong>
<ul><li><em>From:</em> Leo Yan</li></ul></li>
<li><strong><a name="07199" href="msg07199.html">Re:  [PATCH RFCv1] Crash: Extensions: Coresight panic dump</a></strong>
<ul><li><em>From:</em> Dave Anderson</li></ul></li>
<li><strong><a name="07200" href="msg07200.html">Re:  [PATCH RFCv1] Crash: Extensions: Coresight panic dump</a></strong>
<ul><li><em>From:</em> Dave Anderson</li></ul></li>
</ul></li></ul>
<!--X-References-End-->
<!--X-BotPNI-->
<ul>
<li>Prev by Date:
<strong><a href="msg07203.html">Re:  [PATCH RFCv1] Crash: Extensions: Coresight panic dump</a></strong>
</li>
<li>Next by Date:
<strong><a href="msg07205.html">Re:  [PATCH RFCv1] Crash: Extensions: Coresight	panic dump</a></strong>
</li>
<li>Previous by thread:
<strong><a href="msg07205.html">Re:  [PATCH RFCv1] Crash: Extensions: Coresight	panic dump</a></strong>
</li>
<li>Next by thread:
<strong><a href="msg07202.html">HEADS UP: upstream kernel pidhash removal</a></strong>
</li>
<li>Index(es):
<ul>
<li><a href="maillist.html#07204"><strong>Date</strong></a></li>
<li><a href="index.html#07204"><strong>Thread</strong></a></li>
</ul>
</li>
</ul>

<!--X-BotPNI-End-->
<!--X-User-Footer-->
<center>
<font size=-1>
<a href=/lists/>[Index&nbsp;of&nbsp;Archives]</a>
&nbsp;
&nbsp;
<a href=/lists/fedora-devel/>[Fedora&nbsp;Development]</a>
&nbsp;
&nbsp;
<a href=/lists/fedora-desktop/>[Fedora&nbsp;Desktop]</a>
&nbsp;
&nbsp;
<a href=/lists/fedora-selinux/>[Fedora&nbsp;SELinux]</a>
&nbsp;
&nbsp;
<a href=https://yosemitenews.info>[Yosemite&nbsp;News]</a>
&nbsp;
&nbsp;
<a href=/lists/kde/>[KDE&nbsp;Users]</a>
&nbsp;
&nbsp;
<a href=/lists/fedora-tools/>[Fedora&nbsp;Tools]</a>
</font>
</center>
<hr>
<p>
<div>
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<ins class="adsbygoogle"
     style="display:block"
     data-ad-format="autorelaxed"
     data-ad-client="ca-pub-3422782820843221"
     data-ad-slot="1424524564"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
</div>
<table width="100%">
<tr>
<td align=left>&nbsp;</td>
<td valign=top align=right><H1><a href=/lists/><img src=/button_01.gif border=0 alt="Powered by Linux"></a></H1></td>
</tr></table>
<!--X-User-Footer-End-->
<script type="text/javascript"> 
 function initAddThis() {
    addthis.init()
 }
initAddThis();
</script>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-760190-1', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
