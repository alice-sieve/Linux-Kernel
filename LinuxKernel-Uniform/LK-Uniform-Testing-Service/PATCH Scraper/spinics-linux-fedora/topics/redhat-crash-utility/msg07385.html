<!-- MHonArc v2.6.19 -->
<!--X-Subject: [PATCH v3 0/4] Generalize KASLR calculation and use	it for KDUMPs -->
<!--X-From-R13: Eretvb Zbcrm &#60;fycNerqung.pbz> -->
<!--X-Date: Tue, 20 Mar 2018 05:49:12 &#45;0700 -->
<!--X-Message-Id: 20180320124852.1763&#45;1&#45;slp@redhat.com -->
<!--X-Content-Type: text/plain -->
<!--X-Head-End-->
<!doctype html public "-//W3C//DTD HTML//EN">
<html>
<head>
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({
          google_ad_client: "ca-pub-3422782820843221",
          enable_page_level_ads: true
     });
</script>
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="description" content="[PATCH v3 0/4] Generalize KASLR calculation and use	it for KDUMPs &mdash; Red Hat Crash Utility">
<style>
<!--
 pre {white-space: pre-wrap;}
-->
</style>
<title>Red Hat Crash Utility &mdash;  [PATCH v3 0/4] Generalize KASLR calculation and use	it for KDUMPs</title>
<link rel="alternate" type="application/rss+xml" title="Red Hat Crash Utility" href="//feeds.feedburner.com/RedHatCrashUtility">
</head>
<body itemscope itemtype="//schema.org/Article" vlink=green>
<!--X-Body-Begin-->
<!--X-User-Header-->
<!--X-User-Header-End-->
<!--X-TopPNI-->
<form action="//www.google.com" id="cse-search-box" target="_blank">
  <div>
    <input type="hidden" name="cx" value="partner-pub-3422782820843221:9580497365" />
    <input type="hidden" name="ie" value="UTF-8" />
    <input type="text" name="q" size="25" />
    <input type="submit" name="sa" value="Search" />
  </div>
</form>
<script type="text/javascript" src="//www.google.com/coop/cse/brand?form=cse-search-box&amp;lang=en"></script>
<h1 itemprop="name">[PATCH v3 0/4] Generalize KASLR calculation and use	it for KDUMPs</h1>
[<a href="msg07384.html">Date Prev</a>][<a href="msg07386.html">Date Next</a>][<a href="msg07374.html">Thread Prev</a>][<a href="msg07386.html">Thread Next</a>][<a href="maillist.html#07385">Date Index</a>][<a href="index.html#07385">Thread Index</a>]
<script src="https://apis.google.com/js/platform.js" async defer></script>
<g:plusone size="small"></g:plusone>
<p>&nbsp;<br>
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- responsive test for archives -->
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-3422782820843221"
     data-ad-slot="6345952567"
     data-ad-format="auto"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>

<!--X-TopPNI-End-->
<!--X-MsgBody-->
<!--X-Subject-Header-Begin-->
<hr>
<!--X-Subject-Header-End-->
<!--X-Head-of-Message-->
<ul>
<li><em>Subject</em>: [PATCH v3 0/4] Generalize KASLR calculation and use	it for KDUMPs</li>
<li><em>From</em>: Sergio Lopez &lt;slp@xxxxxxxxxx&gt;</li>
<li><em>Date</em>: Tue, 20 Mar 2018 13:48:48 +0100</li>
<li><em>Reply-to</em>: &quot;Discussion list for crash utility usage,	maintenance and development&quot; &lt;crash-utility@xxxxxxxxxx&gt;</li>
</ul>
<!--X-Head-of-Message-End-->
<!--X-Head-Body-Sep-Begin-->
<!-- AddThis Button BEGIN -->
<div class="addthis_toolbox addthis_default_style ">
<a class="addthis_button_preferred_1"></a>
<a class="addthis_button_preferred_2"></a>
<a class="addthis_button_preferred_3"></a>
<a class="addthis_button_preferred_4"></a>
<a class="addthis_button_compact"></a>
<a class="addthis_counter addthis_bubble_style"></a>
</div>
<script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5196c2ae1be43d18&async=1&domready=1" defer async></script>
<!-- AddThis Button END -->
<hr>
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- responsive link 1 -->
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-3422782820843221"
     data-ad-slot="8681825769"
     data-ad-format="link"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
<p>
<div class="content" itemprop="articleBody">
<!--X-Head-Body-Sep-End-->
<!--X-Body-of-Message-->
<pre>Commit 45b74b89530d611b3fa95a1041e158fbb865fa84 added support for
calculating phys_base and kernel offset for KASLR-enabled kernels on
SADUMPs by using a technique developed by Takao Indoh. Originally, the
patchset included support for KDUMPs, but this was dropped in v2, as it
was deemed unnecessary due to the implementation of the vmcoreinfo
device in QEMU.

Sadly, there are many reasons for which the vmcoreinfo device may not be
present in the moment of taking the memory dump from a VM, ranging from
a Host running older QEMU/libvirt versions, to misconfigured VMs or
environments running Hypervisors that doesn't support this device.

This patchset generalizes the kaslr related functions from sadump.c
moving them to kaslr_helper.c, and makes KDUMP analysis fallback to
KASLR offset calculation if vmcoreinfo data is missing.

These changes have been successfully tested with a 3.10.0-830.el7.x86_64
under the following conditions:

 - kdump with KASLR and vmcoreinfo

 - kdump with KASLR but no vmcoreinfo

 - kdump without KASLR (&quot;nokaslr&quot; kernel command line option)

It was also tested that a &quot;crash&quot; patched with these changes still
builds and runs (live and kdump debugging) on an aarch64 machine.

changelog:

v3:
 - Merge *get_cr3 and *get_idtr functions and move them to
   kaslr_helper.c
 - diskdump: drop kaslr_phys_base addition and use
   sub_header_kdump-&gt;phys_base instead.
 - Unconditionally call x86_64_virt_phys_base after grabbing phys_base

v2:
 - Limit application to QEMU ELF and QEMU COMPRESSED dumps (thanks Dave)
 - Add support for QEMU COMPRESSED dumps (diskdump)

Sergio Lopez (4):
  Move kaslr related functions from sadump.c to kaslr_helper.c
  Move QEMUCPU* structs from netdump.h to defs.h
  netdump: infer kaslr offset for QEMU ELF dumps without vmcoreinfo
  diskdump: infer kaslr offset for QEMU COMPRESSED dumps without
    vmcoreinfo

 Makefile       |   7 +-
 defs.h         |  39 +++++
 diskdump.c     |  61 ++++++++
 kaslr_helper.c | 488 +++++++++++++++++++++++++++++++++++++++++++++++++++++++++
 netdump.c      |  54 +++++++
 netdump.h      |  24 +--
 sadump.c       | 486 ++++----------------------------------------------------
 symbols.c      |  26 ++-
 x86_64.c       |  18 ++-
 9 files changed, 719 insertions(+), 484 deletions(-)
 create mode 100644 kaslr_helper.c

-- 
2.14.3

--
Crash-utility mailing list
Crash-utility@xxxxxxxxxx
<a  rel="nofollow" href="https://www.redhat.com/mailman/listinfo/crash-utility">https://www.redhat.com/mailman/listinfo/crash-utility</a>


</pre>
<!--X-Body-of-Message-End-->
<!--X-MsgBody-End-->
<!--X-Follow-Ups-->
</div>
<hr>
<ul><li><strong>Follow-Ups</strong>:
<ul>
<li><strong><a name="07390" href="msg07390.html">Re:  [PATCH v3 0/4] Generalize KASLR calculation and use it for KDUMPs</a></strong>
<ul><li><em>From:</em> Dave Anderson</li></ul></li>
<li><strong><a name="07389" href="msg07389.html">[PATCH v3 4/4] diskdump: infer kaslr offset for	QEMU COMPRESSED dumps without vmcoreinfo</a></strong>
<ul><li><em>From:</em> Sergio Lopez</li></ul></li>
<li><strong><a name="07388" href="msg07388.html">[PATCH v3 2/4] Move QEMUCPU* structs from netdump.h	to defs.h</a></strong>
<ul><li><em>From:</em> Sergio Lopez</li></ul></li>
<li><strong><a name="07387" href="msg07387.html">[PATCH v3 3/4] netdump: infer kaslr offset for QEMU	ELF dumps without vmcoreinfo</a></strong>
<ul><li><em>From:</em> Sergio Lopez</li></ul></li>
<li><strong><a name="07386" href="msg07386.html">[PATCH v3 1/4] Move kaslr related functions from	sadump.c to kaslr_helper.c</a></strong>
<ul><li><em>From:</em> Sergio Lopez</li></ul></li>
</ul></li></ul>
<!--X-Follow-Ups-End-->
<!--X-References-->
<!--X-References-End-->
<!--X-BotPNI-->
<ul>
<li>Prev by Date:
<strong><a href="msg07384.html">Re:  [PATCH v2 0/4] Generalize KASLR calculation and use it for KDUMPs</a></strong>
</li>
<li>Next by Date:
<strong><a href="msg07386.html">[PATCH v3 1/4] Move kaslr related functions from	sadump.c to kaslr_helper.c</a></strong>
</li>
<li>Previous by thread:
<strong><a href="msg07374.html">[PATCH v2 0/4] Generalize KASLR calculation and use	it for KDUMPs</a></strong>
</li>
<li>Next by thread:
<strong><a href="msg07386.html">[PATCH v3 1/4] Move kaslr related functions from	sadump.c to kaslr_helper.c</a></strong>
</li>
<li>Index(es):
<ul>
<li><a href="maillist.html#07385"><strong>Date</strong></a></li>
<li><a href="index.html#07385"><strong>Thread</strong></a></li>
</ul>
</li>
</ul>

<!--X-BotPNI-End-->
<!--X-User-Footer-->
<center>
<font size=-1>
<a href=/lists/>[Index&nbsp;of&nbsp;Archives]</a>
&nbsp;
&nbsp;
<a href=/lists/fedora-devel/>[Fedora&nbsp;Development]</a>
&nbsp;
&nbsp;
<a href=/lists/fedora-desktop/>[Fedora&nbsp;Desktop]</a>
&nbsp;
&nbsp;
<a href=/lists/fedora-selinux/>[Fedora&nbsp;SELinux]</a>
&nbsp;
&nbsp;
<a href=https://yosemitenews.info>[Yosemite&nbsp;News]</a>
&nbsp;
&nbsp;
<a href=/lists/kde/>[KDE&nbsp;Users]</a>
&nbsp;
&nbsp;
<a href=/lists/fedora-tools/>[Fedora&nbsp;Tools]</a>
</font>
</center>
<hr>
<p>
<div>
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<ins class="adsbygoogle"
     style="display:block"
     data-ad-format="autorelaxed"
     data-ad-client="ca-pub-3422782820843221"
     data-ad-slot="1424524564"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
</div>
<table width="100%">
<tr>
<td align=left>&nbsp;</td>
<td valign=top align=right><H1><a href=/lists/><img src=/button_01.gif border=0 alt="Powered by Linux"></a></H1></td>
</tr></table>
<!--X-User-Footer-End-->
<script type="text/javascript"> 
 function initAddThis() {
    addthis.init()
 }
initAddThis();
</script>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-760190-1', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
