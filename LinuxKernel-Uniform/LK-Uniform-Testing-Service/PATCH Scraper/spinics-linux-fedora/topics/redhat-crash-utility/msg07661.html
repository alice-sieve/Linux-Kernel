<!-- MHonArc v2.6.19 -->
<!--X-Subject: Re:  [PATCH] crash: Use '?' for kernel module symbols	type -->
<!--X-From-R13: Rnir Oaqrefba &#60;naqrefbaNerqung.pbz> -->
<!--X-Date: Thu, 7 Mar 2019 07:07:58 &#45;0800 -->
<!--X-Message-Id: 33125000.6402605.1551971271135.JavaMail.zimbra@redhat.com -->
<!--X-Content-Type: text/plain -->
<!--X-Reference: 20190307042341.18594&#45;1&#45;ravi.bangoria@linux.ibm.com -->
<!--X-Head-End-->
<!doctype html public "-//W3C//DTD HTML//EN">
<html>
<head>
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({
          google_ad_client: "ca-pub-3422782820843221",
          enable_page_level_ads: true
     });
</script>
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="description" content="Re:  [PATCH] crash: Use '?' for kernel module symbols	type &mdash; Red Hat Crash Utility">
<style>
<!--
 pre {white-space: pre-wrap;}
-->
</style>
<title>Red Hat Crash Utility &mdash;  Re:  [PATCH] crash: Use '?' for kernel module symbols	type</title>
<link rel="alternate" type="application/rss+xml" title="Red Hat Crash Utility" href="//feeds.feedburner.com/RedHatCrashUtility">
</head>
<body itemscope itemtype="//schema.org/Article" vlink=green>
<!--X-Body-Begin-->
<!--X-User-Header-->
<!--X-User-Header-End-->
<!--X-TopPNI-->
<form action="//www.google.com" id="cse-search-box" target="_blank">
  <div>
    <input type="hidden" name="cx" value="partner-pub-3422782820843221:9580497365" />
    <input type="hidden" name="ie" value="UTF-8" />
    <input type="text" name="q" size="25" />
    <input type="submit" name="sa" value="Search" />
  </div>
</form>
<script type="text/javascript" src="//www.google.com/coop/cse/brand?form=cse-search-box&amp;lang=en"></script>
<h1 itemprop="name">Re:  [PATCH] crash: Use '?' for kernel module symbols	type</h1>
[<a href="msg07660.html">Date Prev</a>][<a href="msg07662.html">Date Next</a>][<a href="msg07660.html">Thread Prev</a>][<a href="msg07662.html">Thread Next</a>][<a href="maillist.html#07661">Date Index</a>][<a href="index.html#07661">Thread Index</a>]


<p>&nbsp;<br>
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- responsive test for archives -->
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-3422782820843221"
     data-ad-slot="6345952567"
     data-ad-format="auto"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>

<!--X-TopPNI-End-->
<!--X-MsgBody-->
<!--X-Subject-Header-Begin-->
<hr>
<!--X-Subject-Header-End-->
<!--X-Head-of-Message-->
<ul>
<li><em>Subject</em>: Re:  [PATCH] crash: Use '?' for kernel module symbols	type</li>
<li><em>From</em>: Dave Anderson &lt;anderson@xxxxxxxxxx&gt;</li>
<li><em>Date</em>: Thu, 7 Mar 2019 10:07:51 -0500 (EST)</li>
<li><em>Cc</em>: Ravi Bangoria &lt;ravi.bangoria@xxxxxxxxxxxxx&gt;, laijs@xxxxxxxxxxxxxx</li>
<li><em>In-reply-to</em>: &lt;<a href="msg07660.html">20190307042341.18594-1-ravi.bangoria@linux.ibm.com</a>&gt;</li>
<li><em>Reply-to</em>: &quot;Discussion list for crash utility usage,	maintenance and development&quot; &lt;crash-utility@xxxxxxxxxx&gt;</li>
</ul>
<!--X-Head-of-Message-End-->
<!--X-Head-Body-Sep-Begin-->
<!-- AddThis Button BEGIN -->
<div class="addthis_toolbox addthis_default_style ">
<a class="addthis_button_preferred_1"></a>
<a class="addthis_button_preferred_2"></a>
<a class="addthis_button_preferred_3"></a>
<a class="addthis_button_preferred_4"></a>
<a class="addthis_button_compact"></a>
<a class="addthis_counter addthis_bubble_style"></a>
</div>
<script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5196c2ae1be43d18&async=1&domready=1" defer async></script>
<!-- AddThis Button END -->
<hr>
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- responsive link 1 -->
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-3422782820843221"
     data-ad-slot="8681825769"
     data-ad-format="link"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
<p>
<div class="content" itemprop="articleBody">
<!--X-Head-Body-Sep-End-->
<!--X-Body-of-Message-->
<pre>

----- Original Message -----
&gt;<i> We are using ELFXX_sym-&gt;st_info directly as the 'type' of symbol,</i>
&gt;<i> which is wrong, because st_info contains numeric value which needs</i>
&gt;<i> to be mapped to appropriate type character. </i>

I'm confused here.  If I dump each module symbol's st_info fields as they are
being read/initialized, they always contain the unsigned char ASCII value for
either 't', 'r', 'd', 'b' or 'w'.  What do you mean that it needs to be mapped
to the appropriate type character?

Dave


&gt;<i> Sections headers are</i>
&gt;<i> also required to correctly map st_info to symbol type which are</i>
&gt;<i> missing here (lm-&gt;mod_section_data is NULL). Use '?' for now. This</i>
&gt;<i> fixes 'trace' extension which segfaults internally while parsing</i>
&gt;<i> module kallsyms:</i>
&gt;<i>  </i>
&gt;<i> Before patch:</i>
&gt;<i>   crash&gt; trace show</i>
&gt;<i>   crash&gt;</i>
&gt;<i> </i>
&gt;<i> After patch:</i>
&gt;<i>   crash&gt; trace show</i>
&gt;<i>   cpus=4</i>
&gt;<i>     &lt;idle&gt;-0  [002]  4350.912553: function: __hrtimer_get_next_event &lt;--</i>
&gt;<i>     hrtime</i>
&gt;<i>     &lt;idle&gt;-0  [002]  4350.912553: function: __hrtimer_next_event_base &lt;--</i>
&gt;<i>     __hrt</i>
&gt;<i> </i>
&gt;<i> Signed-off-by: Ravi Bangoria &lt;ravi.bangoria@xxxxxxxxxxxxx&gt;</i>
&gt;<i> ---</i>
&gt;<i>  symbols.c | 14 ++++++++++++--</i>
&gt;<i>  1 file changed, 12 insertions(+), 2 deletions(-)</i>
&gt;<i> </i>
&gt;<i> diff --git a/symbols.c b/symbols.c</i>
&gt;<i> index e73e735..4456cd3 100644</i>
&gt;<i> --- a/symbols.c</i>
&gt;<i> +++ b/symbols.c</i>
&gt;<i> @@ -2188,7 +2188,12 @@ Elf32_Sym_to_common(Elf32_Sym *e32, struct elf_common</i>
&gt;<i> *ec)</i>
&gt;<i>  	ec-&gt;st_name = (ulong)e32-&gt;st_name;</i>
&gt;<i>  	ec-&gt;st_value = (ulong)e32-&gt;st_value;</i>
&gt;<i>  	ec-&gt;st_shndx = (ulong)e32-&gt;st_shndx;</i>
&gt;<i> -	ec-&gt;st_info = e32-&gt;st_info;</i>
&gt;<i> +	/*</i>
&gt;<i> +	 * Section headers are required to correctly map st_info</i>
&gt;<i> +	 * to symbol type, which are missing here. Let's use '?'</i>
&gt;<i> +	 * for all kernel module symbols type.</i>
&gt;<i> +	 */</i>
&gt;<i> +	ec-&gt;st_info = '?';</i>
&gt;<i>  	ec-&gt;st_size = (ulong)e32-&gt;st_size;</i>
&gt;<i>  }</i>
&gt;<i>  </i>
&gt;<i> @@ -2198,7 +2203,12 @@ Elf64_Sym_to_common(Elf64_Sym *e64, struct elf_common</i>
&gt;<i> *ec)</i>
&gt;<i>  	ec-&gt;st_name = (ulong)e64-&gt;st_name;</i>
&gt;<i>  	ec-&gt;st_value = (ulong)e64-&gt;st_value;</i>
&gt;<i>  	ec-&gt;st_shndx = (ulong)e64-&gt;st_shndx;</i>
&gt;<i> -	ec-&gt;st_info = e64-&gt;st_info;</i>
&gt;<i> +	/*</i>
&gt;<i> +	 * Section headers are required to correctly map st_info</i>
&gt;<i> +	 * to symbol type, which are missing here. Let's use '?'</i>
&gt;<i> +	 * for all kernel module symbols type.</i>
&gt;<i> +	 */</i>
&gt;<i> +	ec-&gt;st_info = '?';</i>
&gt;<i>  	ec-&gt;st_size = (ulong)e64-&gt;st_size;</i>
&gt;<i>  }</i>
&gt;<i>  </i>
&gt;<i> --</i>
&gt;<i> 1.8.3.1</i>
&gt;<i> </i>
&gt;<i> --</i>
&gt;<i> Crash-utility mailing list</i>
&gt;<i> Crash-utility@xxxxxxxxxx</i>
&gt;<i> <a  rel="nofollow" href="https://www.redhat.com/mailman/listinfo/crash-utility">https://www.redhat.com/mailman/listinfo/crash-utility</a></i>
&gt;<i> </i>

--
Crash-utility mailing list
Crash-utility@xxxxxxxxxx
<a  rel="nofollow" href="https://www.redhat.com/mailman/listinfo/crash-utility">https://www.redhat.com/mailman/listinfo/crash-utility</a>


</pre>
<!--X-Body-of-Message-End-->
<!--X-MsgBody-End-->
<!--X-Follow-Ups-->
</div>
<hr>
<ul><li><strong>Follow-Ups</strong>:
<ul>
<li><strong><a name="07662" href="msg07662.html">Re:  [PATCH] crash: Use '?' for kernel module symbols	type</a></strong>
<ul><li><em>From:</em> Dave Anderson</li></ul></li>
</ul></li></ul>
<!--X-Follow-Ups-End-->
<!--X-References-->
<ul><li><strong>References</strong>:
<ul>
<li><strong><a name="07660" href="msg07660.html">[PATCH] crash: Use '?' for kernel module symbols	type</a></strong>
<ul><li><em>From:</em> Ravi Bangoria</li></ul></li>
</ul></li></ul>
<!--X-References-End-->
<!--X-BotPNI-->
<ul>
<li>Prev by Date:
<strong><a href="msg07660.html">[PATCH] crash: Use '?' for kernel module symbols	type</a></strong>
</li>
<li>Next by Date:
<strong><a href="msg07662.html">Re:  [PATCH] crash: Use '?' for kernel module symbols	type</a></strong>
</li>
<li>Previous by thread:
<strong><a href="msg07660.html">[PATCH] crash: Use '?' for kernel module symbols	type</a></strong>
</li>
<li>Next by thread:
<strong><a href="msg07662.html">Re:  [PATCH] crash: Use '?' for kernel module symbols	type</a></strong>
</li>
<li>Index(es):
<ul>
<li><a href="maillist.html#07661"><strong>Date</strong></a></li>
<li><a href="index.html#07661"><strong>Thread</strong></a></li>
</ul>
</li>
</ul>

<!--X-BotPNI-End-->
<!--X-User-Footer-->
<center>
<font size=-1>
<a href=/lists/>[Index&nbsp;of&nbsp;Archives]</a>
&nbsp;
&nbsp;
<a href=/lists/fedora-devel/>[Fedora&nbsp;Development]</a>
&nbsp;
&nbsp;
<a href=/lists/fedora-desktop/>[Fedora&nbsp;Desktop]</a>
&nbsp;
&nbsp;
<a href=/lists/fedora-selinux/>[Fedora&nbsp;SELinux]</a>
&nbsp;
&nbsp;
<a href=https://yosemitenews.info>[Yosemite&nbsp;News]</a>
&nbsp;
&nbsp;
<a href=/lists/kde/>[KDE&nbsp;Users]</a>
&nbsp;
&nbsp;
<a href=/lists/fedora-tools/>[Fedora&nbsp;Tools]</a>
</font>
</center>
<hr>
<p>
<div>
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<ins class="adsbygoogle"
     style="display:block"
     data-ad-format="autorelaxed"
     data-ad-client="ca-pub-3422782820843221"
     data-ad-slot="1424524564"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
</div>
<table width="100%">
<tr>
<td align=left>&nbsp;</td>
<td valign=top align=right><H1><a href=/lists/><img src=/button_01.gif border=0 alt="Powered by Linux"></a></H1></td>
</tr></table>
<!--X-User-Footer-End-->
<script type="text/javascript"> 
 function initAddThis() {
    addthis.init()
 }
initAddThis();
</script>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-760190-1', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
