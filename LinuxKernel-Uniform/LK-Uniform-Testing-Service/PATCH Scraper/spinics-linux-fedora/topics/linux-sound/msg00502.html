<!-- MHonArc v2.6.19 -->
<!--X-Subject: Re: [PATCH v6] ASoC: tas2552: Support TI TAS2552 Amplifier -->
<!--X-From-R13: [nex Pebja &#60;oebbavrNxreary.bet> -->
<!--X-Date: Mon, 14 Jul 2014 11:43:40 &#45;0700 -->
<!--X-Message-Id: 20140714184321.GW6800@sirena.org.uk -->
<!--X-Content-Type: multipart/signed -->
<!--X-Reference: 1405093489&#45;11897&#45;1&#45;git&#45;send&#45;email&#45;dmurphy@ti.com -->
<!--X-Derived: pgpkPd7Gaz3In.pgp -->
<!--X-Head-End-->
<!doctype html public "-//W3C//DTD HTML//EN">
<html>
<head>
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({
          google_ad_client: "ca-pub-3422782820843221",
          enable_page_level_ads: true
     });
</script>
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="description" content="Linux Sound: Re: [PATCH v6] ASoC: tas2552: Support TI TAS2552 Amplifier">
<style>
<!--
 pre {white-space: pre-wrap;}
-->
</style>
<title>Linux Sound &mdash; Re: [PATCH v6] ASoC: tas2552: Support TI TAS2552 Amplifier</title>
<link rel="alternate" type="application/rss+xml" title="Linux Sound" href="//feeds.feedburner.com/LinuxSound">
</head>
<body vlink=green>
<!--X-Body-Begin-->
<!--X-User-Header-->
<!--X-User-Header-End-->
<!--X-TopPNI-->
<form action="//www.google.com" id="cse-search-box" target="_blank">
  <div>
    <input type="hidden" name="cx" value="partner-pub-3422782820843221:6612422167" />
    <input type="hidden" name="ie" value="UTF-8" />
    <input type="text" name="q" size="55" />
    <input type="submit" name="sa" value="Search" />
  </div>
</form>
<script type="text/javascript" src="//www.google.com/coop/cse/brand?form=cse-search-box&amp;lang=en"></script>
<h1 itemprop="name">Re: [PATCH v6] ASoC: tas2552: Support TI TAS2552 Amplifier</h1>
[<a href="msg00501.html">Date Prev</a>][<a href="msg00503.html">Date Next</a>][<a href="msg00500.html">Thread Prev</a>][<a href="msg00503.html">Thread Next</a>][<a href="maillist.html#00502">Date Index</a>][<a href="index.html#00502">Thread Index</a>]
<script src="https://apis.google.com/js/platform.js" async defer></script>
<g:plusone size="small"></g:plusone>
<p>
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- responsive test for archives -->
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-3422782820843221"
     data-ad-slot="6345952567"
     data-ad-format="auto"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
</div>

<!--X-TopPNI-End-->
<!--X-MsgBody-->
<!--X-Subject-Header-Begin-->
<hr>
<!--X-Subject-Header-End-->
<!--X-Head-of-Message-->
<ul>
<li><em>Subject</em>: Re: [PATCH v6] ASoC: tas2552: Support TI TAS2552 Amplifier</li>
<li><em>From</em>: Mark Brown &lt;<a href="mailto:broonie@DOMAIN.HIDDEN">broonie@xxxxxxxxxx</a>&gt;</li>
<li><em>Date</em>: Mon, 14 Jul 2014 19:43:21 +0100</li>
<li><em>Cc</em>: <a href="mailto:linux-sound@DOMAIN.HIDDEN">linux-sound@xxxxxxxxxxxxxxx</a>, <a href="mailto:linux-kernel@DOMAIN.HIDDEN">linux-kernel@xxxxxxxxxxxxxxx</a>,        <a href="mailto:alsa-devel@DOMAIN.HIDDEN">alsa-devel@xxxxxxxxxxxxxxxx</a>, <a href="mailto:devicetree@DOMAIN.HIDDEN">devicetree@xxxxxxxxxxxxxxx</a></li>
<li><em>In-reply-to</em>: &lt;<a href="msg00500.html">1405093489-11897-1-git-send-email-dmurphy@ti.com</a>&gt;</li>
<li><em>User-agent</em>: Mutt/1.5.23 (2014-03-12)</li>
</ul>
<!--X-Head-of-Message-End-->
<!--X-Head-Body-Sep-Begin-->
<!-- AddThis Button BEGIN -->
<div class="addthis_toolbox addthis_default_style ">
<a class="addthis_button_preferred_1"></a>
<a class="addthis_button_preferred_2"></a>
<a class="addthis_button_preferred_3"></a>
<a class="addthis_button_preferred_4"></a>
<a class="addthis_button_compact"></a>
<a class="addthis_counter addthis_bubble_style"></a>
</div>
<script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5196c2ae1be43d18&async=1&domready=1" async></script>
<!-- AddThis Button END -->
<hr>
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- responsive link 1 -->
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-3422782820843221"
     data-ad-slot="8681825769"
     data-ad-format="link"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
<p>
<div class="content" itemprop="articleBody">
<!--X-Head-Body-Sep-End-->
<!--X-Body-of-Message-->
<pre>On Fri, Jul 11, 2014 at 10:44:49AM -0500, Dan Murphy wrote:

&gt; @@ -754,4 +755,8 @@ config SND_SOC_TPA6130A2
&gt;  	tristate &quot;Texas Instruments TPA6130A2 headphone amplifier&quot;
&gt;  	depends on I2C
&gt;  
&gt; +config SND_SOC_TAS2552
&gt; +	tristate &quot;Texas Instruments TAS2552 Mono Audio amplifier&quot;
&gt; +	depends on I2C
&gt; +
&gt;  endmenu

Keep this and Makefile sorted - since this is a proper CODEC driver it
should be in with the CODECs and also sorted in alphabetical order.

&gt; +static int tas2552_startup(struct snd_pcm_substream *substream,
&gt; +			   struct snd_soc_dai *dai)
&gt; +{
&gt; +	struct snd_soc_codec *codec = dai-&gt;codec;
&gt; +
&gt; +	pm_runtime_get_sync(codec-&gt;dev);
&gt; +
&gt; +	return 0;
&gt; +}
&gt; +
&gt; +static void tas2552_shutdown(struct snd_pcm_substream *substream,
&gt; +			   struct snd_soc_dai *dai)
&gt; +{
&gt; +	struct snd_soc_codec *codec = dai-&gt;codec;
&gt; +
&gt; +	pm_runtime_put(codec-&gt;dev);
&gt; +}

These runtime calls should be redundant, the framework should hold a
runtime PM reference on devices while they are active.  Does this not
work for you?

&gt; +	pm_runtime_get_sync(codec-&gt;dev);

Check the return value here.

&gt; +	snd_soc_write(codec, TAS2552_CFG_2, TAS2552_CLASSD_EN |
&gt; +				  TAS2552_BOOST_EN | TAS2552_APT_EN |
&gt; +				  TAS2552_PLL_ENABLE | TAS2552_LIM_EN);

The PLL is enabled all the time not via DAPM or similar (it's never
disabled)?

&gt; +static int tas2552_resume(struct snd_soc_codec *codec)
&gt; +{
&gt; +	struct tas2552_data *tas2552 = snd_soc_codec_get_drvdata(codec);
&gt; +	int ret;
&gt; +
&gt; +	ret = regulator_bulk_enable(ARRAY_SIZE(tas2552-&gt;supplies),
&gt; +				    tas2552-&gt;supplies);
&gt; +
&gt; +	if (ret != 0) {
&gt; +		dev_err(codec-&gt;dev, &quot;Failed to enable supplies: %d\n&quot;,
&gt; +			ret);
&gt; +	}
&gt; +
&gt; +	pm_runtime_get_sync(codec-&gt;dev);

Remove these runtime PM calls from suspend and resume, they're not doing
what you think (and will prevent runtime PM from doing anything).  Let
the frameworks worry about it for now, or explicitly call the runtime
suspend and resume operators if and only if the device is runtime
active.

&gt; +	for (i = 0; i &lt; ARRAY_SIZE(data-&gt;supplies); i++)
&gt; +		data-&gt;supplies[i].supply = tas2552_supply_names[i];
&gt; +
&gt; +	ret = devm_regulator_bulk_get(dev, ARRAY_SIZE(data-&gt;supplies),
&gt; +				      data-&gt;supplies);
&gt; +	if (ret != 0)
&gt; +		dev_err(dev, &quot;Failed to request supplies: %d\n&quot;, ret);

These supplies are mandatory (as they should be) but weren't mentioned
in the DT binding - please add them there.

&gt; +static const struct i2c_device_id tas2552_id[] = {
&gt; +	{ &quot;tas2552-codec&quot;, 0 },
&gt; +	{ }
&gt; +};

No -codec.
</pre><p><strong>Attachment:
<a href="pgpkPd7Gaz3In.pgp" ><tt>signature.asc</tt></a></strong><br>
<em>Description:</em> Digital signature</p>

<!--X-Body-of-Message-End-->
<!--X-MsgBody-End-->
<!--X-Follow-Ups-->
<hr>
<ul><li><strong>Follow-Ups</strong>:
<ul>
<li><strong><a name="00503" href="msg00503.html">Re: [PATCH v6] ASoC: tas2552: Support TI TAS2552 Amplifier</a></strong>
<ul><li><em>From:</em> Murphy, Dan</li></ul></li>
</ul></li></ul>
<!--X-Follow-Ups-End-->
<!--X-References-->
<ul><li><strong>References</strong>:
<ul>
<li><strong><a name="00500" href="msg00500.html">[PATCH v6] ASoC: tas2552: Support TI TAS2552 Amplifier</a></strong>
<ul><li><em>From:</em> Dan Murphy</li></ul></li>
</ul></li></ul>
<!--X-References-End-->
<!--X-BotPNI-->
<ul>
<li>Prev by Date:
<strong><a href="msg00501.html">Re: [PATCH 1/1] ice1712: check if snd card loaded, if not do not proceed</a></strong>
</li>
<li>Next by Date:
<strong><a href="msg00503.html">Re: [PATCH v6] ASoC: tas2552: Support TI TAS2552 Amplifier</a></strong>
</li>
<li>Previous by thread:
<strong><a href="msg00500.html">[PATCH v6] ASoC: tas2552: Support TI TAS2552 Amplifier</a></strong>
</li>
<li>Next by thread:
<strong><a href="msg00503.html">Re: [PATCH v6] ASoC: tas2552: Support TI TAS2552 Amplifier</a></strong>
</li>
<li>Index(es):
<ul>
<li><a href="maillist.html#00502"><strong>Date</strong></a></li>
<li><a href="index.html#00502"><strong>Thread</strong></a></li>
</ul>
</li>
</ul>

<!--X-BotPNI-End-->
<!--X-User-Footer-->
<center>
<font size=-1>
<a href=/lists/>[Index&nbsp;of&nbsp;Archives]</a>
&nbsp;
&nbsp;
<a href=/lists/Pulseaudio/>[Pulseaudio]</a>
&nbsp;
&nbsp;
<a href=/lists/linux-audio-users/>[Linux&nbsp;Audio&nbsp;Users]</a>
&nbsp;
&nbsp;
<a href=/lists/alsa-devel/>[ALSA&nbsp;Devel]</a>
&nbsp;
&nbsp;
<a href=/lists/fedora-desktop/>[Fedora&nbsp;Desktop]</a>
&nbsp;
&nbsp;
<a href=/lists/fedora-selinux/>[Fedora&nbsp;SELinux]</a>
&nbsp;
&nbsp;
<a href=http://www.ske-art.com/z/biglist.html>[Big&nbsp;List&nbsp;of&nbsp;Linux&nbsp;Books]</a>
&nbsp;
&nbsp;
<a href=https://yosemitenews.info>[Yosemite&nbsp;News]</a>
&nbsp;
&nbsp;
<a href=/lists/kde/>[KDE&nbsp;Users]</a>
</font>
</center>
<hr>
<p>
<div>
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<ins class="adsbygoogle"
     style="display:block"
     data-ad-format="autorelaxed"
     data-ad-client="ca-pub-3422782820843221"
     data-ad-slot="1424524564"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
</div>
<table width="100%">
<tr>
<td valign=top align=left>&nbsp;</td>
<td valign=top align=right>
<a href=/lists/><img src=/button_01.gif border=0 alt="Powered by Linux"></a></td>
</tr></table>
<!--X-User-Footer-End-->
<script type="text/javascript"> 
 function initAddThis() {
    addthis.init()
 }
initAddThis();
</script>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-760190-1', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
