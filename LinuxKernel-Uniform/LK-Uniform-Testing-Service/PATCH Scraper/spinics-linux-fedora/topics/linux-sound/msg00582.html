<!-- MHonArc v2.6.19 -->
<!--X-Subject: Re: [alsa&#45;devel] [RFC PATCH] ASoC: wm8731: let codec to manage clock by itself -->
<!--X-From-R13: Znef&#45;Brgre Qynhfra &#60;ynefNzrgnsbb.qr> -->
<!--X-Date: Tue, 3 Feb 2015 09:26:11 &#45;0800 -->
<!--X-Message-Id: 54D104AC.5010603@metafoo.de -->
<!--X-Content-Type: text/plain -->
<!--X-Reference: 1422934415&#45;24957&#45;1&#45;git&#45;send&#45;email&#45;voice.shen@atmel.com -->
<!--X-Reference: CAOLZvyE6W8&#45;X2_M+&#45;KQNry2VPwLzwbBLuxr5Z5EdBQo7Skv2RQ@mail.gmail.com -->
<!--X-Reference: 20150203124441.GK21293@sirena.org.uk -->
<!--X-Reference: 54D0FD1C.9020305@metafoo.de -->
<!--X-Reference: 20150203171733.GY8656@n2100.arm.linux.org.uk -->
<!--X-Head-End-->
<!doctype html public "-//W3C//DTD HTML//EN">
<html>
<head>
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({
          google_ad_client: "ca-pub-3422782820843221",
          enable_page_level_ads: true
     });
</script>
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="description" content="Linux Sound: Re: [alsa-devel] [RFC PATCH] ASoC: wm8731: let codec to manage clock by itself">
<style>
<!--
 pre {white-space: pre-wrap;}
-->
</style>
<title>Linux Sound &mdash; Re: [alsa-devel] [RFC PATCH] ASoC: wm8731: let codec to manage clock by itself</title>
<link rel="alternate" type="application/rss+xml" title="Linux Sound" href="//feeds.feedburner.com/LinuxSound">
</head>
<body vlink=green>
<!--X-Body-Begin-->
<!--X-User-Header-->
<!--X-User-Header-End-->
<!--X-TopPNI-->
<form action="//www.google.com" id="cse-search-box" target="_blank">
  <div>
    <input type="hidden" name="cx" value="partner-pub-3422782820843221:6612422167" />
    <input type="hidden" name="ie" value="UTF-8" />
    <input type="text" name="q" size="55" />
    <input type="submit" name="sa" value="Search" />
  </div>
</form>
<script type="text/javascript" src="//www.google.com/coop/cse/brand?form=cse-search-box&amp;lang=en"></script>
<h1 itemprop="name">Re: [alsa-devel] [RFC PATCH] ASoC: wm8731: let codec to manage clock by itself</h1>
[<a href="msg00581.html">Date Prev</a>][<a href="msg00583.html">Date Next</a>][<a href="msg00581.html">Thread Prev</a>][<a href="msg00583.html">Thread Next</a>][<a href="maillist.html#00582">Date Index</a>][<a href="index.html#00582">Thread Index</a>]
<script src="https://apis.google.com/js/platform.js" async defer></script>
<g:plusone size="small"></g:plusone>
<p>
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- responsive test for archives -->
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-3422782820843221"
     data-ad-slot="6345952567"
     data-ad-format="auto"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
</div>

<!--X-TopPNI-End-->
<!--X-MsgBody-->
<!--X-Subject-Header-Begin-->
<hr>
<!--X-Subject-Header-End-->
<!--X-Head-of-Message-->
<ul>
<li><em>Subject</em>: Re: [alsa-devel] [RFC PATCH] ASoC: wm8731: let codec to manage clock by itself</li>
<li><em>From</em>: Lars-Peter Clausen &lt;<a href="mailto:lars@DOMAIN.HIDDEN">lars@xxxxxxxxxx</a>&gt;</li>
<li><em>Date</em>: Tue, 03 Feb 2015 18:26:04 +0100</li>
<li><em>Cc</em>: Mark Brown &lt;<a href="mailto:broonie@DOMAIN.HIDDEN">broonie@xxxxxxxxxx</a>&gt;, Manuel Lauss &lt;<a href="mailto:manuel.lauss@DOMAIN.HIDDEN">manuel.lauss@xxxxxxxxx</a>&gt;,        alsa-devel &lt;<a href="mailto:alsa-devel@DOMAIN.HIDDEN">alsa-devel@xxxxxxxxxxxxxxxx</a>&gt;,        Richard Purdie &lt;<a href="mailto:richard@DOMAIN.HIDDEN">richard@xxxxxxxxxxxxxx</a>&gt;,        <a href="mailto:patches@DOMAIN.HIDDEN">patches@xxxxxxxxxxxxxxxxxxxxxxxxxxx</a>,        LKML &lt;<a href="mailto:linux-kernel@DOMAIN.HIDDEN">linux-kernel@xxxxxxxxxxxxxxx</a>&gt;, <a href="mailto:linux-sound@DOMAIN.HIDDEN">linux-sound@xxxxxxxxxxxxxxx</a>,        Manuel Lauss &lt;<a href="mailto:manuel.lauss@DOMAIN.HIDDEN">manuel.lauss@xxxxxxxxxxxxxx</a>&gt;,        Bo Shen &lt;<a href="mailto:voice.shen@DOMAIN.HIDDEN">voice.shen@xxxxxxxxx</a>&gt;, <a href="mailto:linux-arm-kernel@DOMAIN.HIDDEN">linux-arm-kernel@xxxxxxxxxxxxxxxxxxx</a>,        Liam Girdwood &lt;<a href="mailto:lrg@DOMAIN.HIDDEN">lrg@xxxxxxxxxxxxxxx</a>&gt;</li>
<li><em>In-reply-to</em>: &lt;<a href="msg00581.html">20150203171733.GY8656@n2100.arm.linux.org.uk</a>&gt;</li>
<li><em>User-agent</em>: Mozilla/5.0 (X11; Linux x86_64; rv:31.0) Gecko/20100101 Icedove/31.4.0</li>
</ul>
<!--X-Head-of-Message-End-->
<!--X-Head-Body-Sep-Begin-->
<!-- AddThis Button BEGIN -->
<div class="addthis_toolbox addthis_default_style ">
<a class="addthis_button_preferred_1"></a>
<a class="addthis_button_preferred_2"></a>
<a class="addthis_button_preferred_3"></a>
<a class="addthis_button_preferred_4"></a>
<a class="addthis_button_compact"></a>
<a class="addthis_counter addthis_bubble_style"></a>
</div>
<script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5196c2ae1be43d18&async=1&domready=1" async></script>
<!-- AddThis Button END -->
<hr>
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- responsive link 1 -->
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-3422782820843221"
     data-ad-slot="8681825769"
     data-ad-format="link"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
<p>
<div class="content" itemprop="articleBody">
<!--X-Head-Body-Sep-End-->
<!--X-Body-of-Message-->
<pre style="margin: 0em;">
On 02/03/2015 06:17 PM, Russell King - ARM Linux wrote:
</pre><blockquote style="border-left: #5555EE solid 0.2em; margin: 0em; padding-left: 0.85em"><pre style="margin: 0em;">
On Tue, Feb 03, 2015 at 05:53:48PM +0100, Lars-Peter Clausen wrote:
</pre><blockquote style="border-left: #5555EE solid 0.2em; margin: 0em; padding-left: 0.85em"><pre style="margin: 0em;">
On 02/03/2015 01:44 PM, Mark Brown wrote:
</pre><blockquote style="border-left: #5555EE solid 0.2em; margin: 0em; padding-left: 0.85em"><pre style="margin: 0em;">
On Tue, Feb 03, 2015 at 08:54:57AM +0100, Manuel Lauss wrote:

</pre><blockquote style="border-left: #5555EE solid 0.2em; margin: 0em; padding-left: 0.85em"><pre style="margin: 0em;">
+    wm8731-&gt;mclk = devm_clk_get(&amp;spi-&gt;dev, &quot;mclk&quot;);
+    if (IS_ERR(wm8731-&gt;mclk)) {
+        wm8731-&gt;mclk = NULL;
+        dev_warn(&amp;spi-&gt;dev, &quot;assuming static MCLK\n&quot;);
+    }
</pre></blockquote><pre style="margin: 0em;">

This is broken for both deferred probe and in the case where the clock
API genuinely returns a NULL clock.  Other than that it's the kind of
thing that we've done for some other drivers, though it's not good to
have to do this.  Check them for correct behaviour.
</pre></blockquote><pre style="margin: 0em;">

Ideally we'd introduce a {devm_}clk_get_optional(), with the same semantics
as gpiod_get_optional(), which handles the finer details of differentiating
between clock specified, but not yet probed, clock specified, but
incorrectly and no clock specified, so this doesn't have to be done over and
over by each driver.
</pre></blockquote><pre style="margin: 0em;">

No, we don't need to.  It clk_get() already knows this distinction, and
it appropriately returns -ENOENT vs -EPROBE_DEFER according to whether
there's a clock specified in DT or not.
</pre></blockquote><pre style="margin: 0em;">

</pre><tt>I know, but it returns a error when no clock is specified (-ENOENT), whereas 
</tt><tt>gpiod_get_optional()-like semantics mean, it would return no error.
</tt><pre style="margin: 0em;">

--
To unsubscribe from this list: send the line &quot;unsubscribe linux-sound&quot; in
the body of a message to majordomo@xxxxxxxxxxxxxxx
More majordomo info at  <a  rel="nofollow" href="http://vger.kernel.org/majordomo-info.html">http://vger.kernel.org/majordomo-info.html</a>



</pre>
<!--X-Body-of-Message-End-->
<!--X-MsgBody-End-->
<!--X-Follow-Ups-->
<hr>
<ul><li><strong>Follow-Ups</strong>:
<ul>
<li><strong><a name="00583" href="msg00583.html">Re: [alsa-devel] [RFC PATCH] ASoC: wm8731: let codec to manage clock by itself</a></strong>
<ul><li><em>From:</em> Lars-Peter Clausen</li></ul></li>
</ul></li></ul>
<!--X-Follow-Ups-End-->
<!--X-References-->
<ul><li><strong>References</strong>:
<ul>
<li><strong><a name="00575" href="msg00575.html">[RFC PATCH] ASoC: wm8731: let codec to manage clock by itself</a></strong>
<ul><li><em>From:</em> Bo Shen</li></ul></li>
<li><strong><a name="00576" href="msg00576.html">Re: [RFC PATCH] ASoC: wm8731: let codec to manage clock by itself</a></strong>
<ul><li><em>From:</em> Manuel Lauss</li></ul></li>
<li><strong><a name="00577" href="msg00577.html">Re: [RFC PATCH] ASoC: wm8731: let codec to manage clock by itself</a></strong>
<ul><li><em>From:</em> Mark Brown</li></ul></li>
<li><strong><a name="00580" href="msg00580.html">Re: [alsa-devel] [RFC PATCH] ASoC: wm8731: let codec to manage clock by itself</a></strong>
<ul><li><em>From:</em> Lars-Peter Clausen</li></ul></li>
<li><strong><a name="00581" href="msg00581.html">Re: [alsa-devel] [RFC PATCH] ASoC: wm8731: let codec to manage clock by itself</a></strong>
<ul><li><em>From:</em> Russell King - ARM Linux</li></ul></li>
</ul></li></ul>
<!--X-References-End-->
<!--X-BotPNI-->
<ul>
<li>Prev by Date:
<strong><a href="msg00581.html">Re: [alsa-devel] [RFC PATCH] ASoC: wm8731: let codec to manage clock by itself</a></strong>
</li>
<li>Next by Date:
<strong><a href="msg00583.html">Re: [alsa-devel] [RFC PATCH] ASoC: wm8731: let codec to manage clock by itself</a></strong>
</li>
<li>Previous by thread:
<strong><a href="msg00581.html">Re: [alsa-devel] [RFC PATCH] ASoC: wm8731: let codec to manage clock by itself</a></strong>
</li>
<li>Next by thread:
<strong><a href="msg00583.html">Re: [alsa-devel] [RFC PATCH] ASoC: wm8731: let codec to manage clock by itself</a></strong>
</li>
<li>Index(es):
<ul>
<li><a href="maillist.html#00582"><strong>Date</strong></a></li>
<li><a href="index.html#00582"><strong>Thread</strong></a></li>
</ul>
</li>
</ul>

<!--X-BotPNI-End-->
<!--X-User-Footer-->
<center>
<font size=-1>
<a href=/lists/>[Index&nbsp;of&nbsp;Archives]</a>
&nbsp;
&nbsp;
<a href=/lists/Pulseaudio/>[Pulseaudio]</a>
&nbsp;
&nbsp;
<a href=/lists/linux-audio-users/>[Linux&nbsp;Audio&nbsp;Users]</a>
&nbsp;
&nbsp;
<a href=/lists/alsa-devel/>[ALSA&nbsp;Devel]</a>
&nbsp;
&nbsp;
<a href=/lists/fedora-desktop/>[Fedora&nbsp;Desktop]</a>
&nbsp;
&nbsp;
<a href=/lists/fedora-selinux/>[Fedora&nbsp;SELinux]</a>
&nbsp;
&nbsp;
<a href=http://www.ske-art.com/z/biglist.html>[Big&nbsp;List&nbsp;of&nbsp;Linux&nbsp;Books]</a>
&nbsp;
&nbsp;
<a href=https://yosemitenews.info>[Yosemite&nbsp;News]</a>
&nbsp;
&nbsp;
<a href=/lists/kde/>[KDE&nbsp;Users]</a>
</font>
</center>
<hr>
<p>
<div>
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<ins class="adsbygoogle"
     style="display:block"
     data-ad-format="autorelaxed"
     data-ad-client="ca-pub-3422782820843221"
     data-ad-slot="1424524564"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
</div>
<table width="100%">
<tr>
<td valign=top align=left>&nbsp;</td>
<td valign=top align=right>
<a href=/lists/><img src=/button_01.gif border=0 alt="Powered by Linux"></a></td>
</tr></table>
<!--X-User-Footer-End-->
<script type="text/javascript"> 
 function initAddThis() {
    addthis.init()
 }
initAddThis();
</script>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-760190-1', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
