<!-- MHonArc v2.6.19 -->
<!--X-Subject: Re: [alsa&#45;devel] [PATCH] ASoC: wm8731: let codec to manage clock by itself -->
<!--X-From-R13: Pb Eura &#60;ibvpr.furaNngzry.pbz> -->
<!--X-Date: Sun, 1 Mar 2015 18:06:01 &#45;0800 -->
<!--X-Message-Id: 54F3C433.3000400@atmel.com -->
<!--X-Content-Type: text/plain -->
<!--X-Reference: 1423121713&#45;19434&#45;1&#45;git&#45;send&#45;email&#45;voice.shen@atmel.com -->
<!--X-Reference: 54DC62EA.5030503@atmel.com -->
<!--X-Reference: 20150216103122.GA1091@opensource.wolfsonmicro.com -->
<!--X-Reference: CAOLZvyFS2fCry_cyeoZ_iXzVy8Yw5nnqvqT+Qth0m_CuDBzSMQ@mail.gmail.com -->
<!--X-Head-End-->
<!doctype html public "-//W3C//DTD HTML//EN">
<html>
<head>
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({
          google_ad_client: "ca-pub-3422782820843221",
          enable_page_level_ads: true
     });
</script>
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="description" content="Linux Sound: Re: [alsa-devel] [PATCH] ASoC: wm8731: let codec to manage clock by itself">
<style>
<!--
 pre {white-space: pre-wrap;}
-->
</style>
<title>Linux Sound &mdash; Re: [alsa-devel] [PATCH] ASoC: wm8731: let codec to manage clock by itself</title>
<link rel="alternate" type="application/rss+xml" title="Linux Sound" href="//feeds.feedburner.com/LinuxSound">
</head>
<body vlink=green>
<!--X-Body-Begin-->
<!--X-User-Header-->
<!--X-User-Header-End-->
<!--X-TopPNI-->
<form action="//www.google.com" id="cse-search-box" target="_blank">
  <div>
    <input type="hidden" name="cx" value="partner-pub-3422782820843221:6612422167" />
    <input type="hidden" name="ie" value="UTF-8" />
    <input type="text" name="q" size="55" />
    <input type="submit" name="sa" value="Search" />
  </div>
</form>
<script type="text/javascript" src="//www.google.com/coop/cse/brand?form=cse-search-box&amp;lang=en"></script>
<h1 itemprop="name">Re: [alsa-devel] [PATCH] ASoC: wm8731: let codec to manage clock by itself</h1>
[<a href="msg00591.html">Date Prev</a>][<a href="msg00593.html">Date Next</a>][<a href="msg00591.html">Thread Prev</a>][<a href="msg00593.html">Thread Next</a>][<a href="maillist.html#00592">Date Index</a>][<a href="index.html#00592">Thread Index</a>]
<script src="https://apis.google.com/js/platform.js" async defer></script>
<g:plusone size="small"></g:plusone>
<p>
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- responsive test for archives -->
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-3422782820843221"
     data-ad-slot="6345952567"
     data-ad-format="auto"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
</div>

<!--X-TopPNI-End-->
<!--X-MsgBody-->
<!--X-Subject-Header-Begin-->
<hr>
<!--X-Subject-Header-End-->
<!--X-Head-of-Message-->
<ul>
<li><em>Subject</em>: Re: [alsa-devel] [PATCH] ASoC: wm8731: let codec to manage clock by itself</li>
<li><em>From</em>: Bo Shen &lt;<a href="mailto:voice.shen@DOMAIN.HIDDEN">voice.shen@xxxxxxxxx</a>&gt;</li>
<li><em>Date</em>: Mon, 2 Mar 2015 10:00:19 +0800</li>
<li><em>Cc</em>: Mark Brown &lt;<a href="mailto:broonie@DOMAIN.HIDDEN">broonie@xxxxxxxxxx</a>&gt;,        Manuel Lauss &lt;<a href="mailto:manuel.lauss@DOMAIN.HIDDEN">manuel.lauss@xxxxxxxxxxxxxx</a>&gt;,        Liam Girdwood &lt;<a href="mailto:lrg@DOMAIN.HIDDEN">lrg@xxxxxxxxxxxxxxx</a>&gt;,        &quot;Richard Purdie&quot; &lt;<a href="mailto:richard@DOMAIN.HIDDEN">richard@xxxxxxxxxxxxxx</a>&gt;,        &lt;<a href="mailto:patches@DOMAIN.HIDDEN">patches@xxxxxxxxxxxxxxxxxxxxxxxxxxx</a>&gt;,        alsa-devel &lt;<a href="mailto:alsa-devel@DOMAIN.HIDDEN">alsa-devel@xxxxxxxxxxxxxxxx</a>&gt;,        &lt;<a href="mailto:linux-arm-kernel@DOMAIN.HIDDEN">linux-arm-kernel@xxxxxxxxxxxxxxxxxxx</a>&gt;, &lt;<a href="mailto:linux-sound@DOMAIN.HIDDEN">linux-sound@xxxxxxxxxxxxxxx</a>&gt;,        LKML &lt;<a href="mailto:linux-kernel@DOMAIN.HIDDEN">linux-kernel@xxxxxxxxxxxxxxx</a>&gt;</li>
<li><em>In-reply-to</em>: &lt;<a href="msg00591.html">CAOLZvyFS2fCry_cyeoZ_iXzVy8Yw5nnqvqT+Qth0m_CuDBzSMQ@mail.gmail.com</a>&gt;</li>
<li><em>User-agent</em>: Mozilla/5.0 (X11; Linux x86_64; rv:31.0) Gecko/20100101 Thunderbird/31.4.0</li>
</ul>
<!--X-Head-of-Message-End-->
<!--X-Head-Body-Sep-Begin-->
<!-- AddThis Button BEGIN -->
<div class="addthis_toolbox addthis_default_style ">
<a class="addthis_button_preferred_1"></a>
<a class="addthis_button_preferred_2"></a>
<a class="addthis_button_preferred_3"></a>
<a class="addthis_button_preferred_4"></a>
<a class="addthis_button_compact"></a>
<a class="addthis_counter addthis_bubble_style"></a>
</div>
<script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5196c2ae1be43d18&async=1&domready=1" async></script>
<!-- AddThis Button END -->
<hr>
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- responsive link 1 -->
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-3422782820843221"
     data-ad-slot="8681825769"
     data-ad-format="link"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
<p>
<div class="content" itemprop="articleBody">
<!--X-Head-Body-Sep-End-->
<!--X-Body-of-Message-->
<pre style="margin: 0em;">
On 02/16/2015 08:58 PM, Manuel Lauss wrote:
</pre><blockquote style="border-left: #5555EE solid 0.2em; margin: 0em; padding-left: 0.85em"><pre style="margin: 0em;">
On Mon, Feb 16, 2015 at 11:31 AM, Charles Keepax
&lt;ckeepax@xxxxxxxxxxxxxxxxxxxxxxxxxxx&gt; wrote:
</pre><blockquote style="border-left: #5555EE solid 0.2em; margin: 0em; padding-left: 0.85em"><pre style="margin: 0em;">
On Thu, Feb 12, 2015 at 04:23:06PM +0800, Bo Shen wrote:
</pre><blockquote style="border-left: #5555EE solid 0.2em; margin: 0em; padding-left: 0.85em"><pre style="margin: 0em;">
Hi All,

On 02/05/2015 03:35 PM, Bo Shen wrote:
</pre><blockquote style="border-left: #5555EE solid 0.2em; margin: 0em; padding-left: 0.85em"><pre style="margin: 0em;">
Let the wm8731 codec to manage clock by itself.

Signed-off-by: Bo Shen &lt;voice.shen@xxxxxxxxx&gt;
---

   sound/soc/codecs/wm8731.c | 28 ++++++++++++++++++++++++++++
   1 file changed, 28 insertions(+)
</pre></blockquote><pre style="margin: 0em;">

Any comments for this patch (aka ping?)
</pre></blockquote><pre style="margin: 0em;">

I preferred the idea of having the clock as optional and from the
discussion on the last patch it didn't look too tricky to
</pre></blockquote><pre style="margin: 0em;">

me too
</pre></blockquote><pre style="margin: 0em;">

OK, I will keep the clock as optional.

</pre><blockquote style="border-left: #5555EE solid 0.2em; margin: 0em; padding-left: 0.85em"><blockquote style="border-left: #5555EE solid 0.2em; margin: 0em; padding-left: 0.85em"><pre style="margin: 0em;">
achieve. OTOH I think the Atmel system is the only one that uses
both this CODEC and common clock so it doesn't look like this
would cause any problems, but might be nice for this not to be
one more thing for someone to fix up when moving a system to
common clock.
</pre></blockquote><pre style="margin: 0em;">

Not quite, there's one MIPS platform I maintain which needs a patch
like the one below (tested):
</pre></blockquote><pre style="margin: 0em;">

Do I need to seed the following patch together or you send it?

</pre><blockquote style="border-left: #5555EE solid 0.2em; margin: 0em; padding-left: 0.85em"><pre style="margin: 0em;">
diff --git a/arch/mips/alchemy/devboards/db1200.c
b/arch/mips/alchemy/devboards/db1200.c
index 8c13675..aa01ab2 100644
--- a/arch/mips/alchemy/devboards/db1200.c
+++ b/arch/mips/alchemy/devboards/db1200.c
@@ -19,6 +19,8 @@
   */

  #include &lt;linux/clk.h&gt;
+#include &lt;linux/clkdev.h&gt;
+#include &lt;linux/clk-provider.h&gt;
  #include &lt;linux/dma-mapping.h&gt;
  #include &lt;linux/gpio.h&gt;
  #include &lt;linux/i2c.h&gt;
@@ -862,6 +864,12 @@ int __init db1200_dev_setup(void)
      irq_set_status_flags(DB1200_PC1_INSERT_INT, IRQ_NOAUTOEN);
      irq_set_status_flags(DB1200_PC1_EJECT_INT, IRQ_NOAUTOEN);

+    /* register the 12MHz crystal for the WM8731 I2S codec */
+    c = clk_register_fixed_rate(NULL, &quot;wm8731xtal&quot;, NULL,
+                    CLK_IS_ROOT, 12000000);
+    if (!IS_ERR(c))
+        clk_register_clkdev(c, &quot;mclk&quot;, &quot;0-001b&quot;);
+
      i2c_register_board_info(0, db1200_i2c_devs,
                  ARRAY_SIZE(db1200_i2c_devs));
      spi_register_board_info(db1200_spi_devs,
diff --git a/arch/mips/alchemy/devboards/db1300.c
b/arch/mips/alchemy/devboards/db1300.c
index 1c64fdb..1aa01c8 100644
--- a/arch/mips/alchemy/devboards/db1300.c
+++ b/arch/mips/alchemy/devboards/db1300.c
@@ -5,6 +5,8 @@
   */

  #include &lt;linux/clk.h&gt;
+#include &lt;linux/clkdev.h&gt;
+#include &lt;linux/clk-provider.h&gt;
  #include &lt;linux/dma-mapping.h&gt;
  #include &lt;linux/gpio.h&gt;
  #include &lt;linux/gpio_keys.h&gt;
@@ -799,6 +801,12 @@ int __init db1300_dev_setup(void)
      if (platform_driver_register(&amp;db1300_wm97xx_driver))
          pr_warn(&quot;DB1300: failed to init touch pen irq support!\n&quot;);

+    /* register the 12MHz crystal for the WM8731 I2S codec */
+    c = clk_register_fixed_rate(NULL, &quot;wm8731xtal&quot;, NULL,
+                    CLK_IS_ROOT, 12000000);
+    if (!IS_ERR(c))
+        clk_register_clkdev(c, &quot;mclk&quot;, &quot;0-001b&quot;);
+
      /* Audio PSC clock is supplied by codecs (PSC1, 2) */
      __raw_writel(PSC_SEL_CLK_SERCLK,
          (void __iomem *)KSEG1ADDR(AU1300_PSC1_PHYS_ADDR) + PSC_SEL_OFFSET);

</pre></blockquote><pre style="margin: 0em;">

Best Regards,
Bo Shen
--
To unsubscribe from this list: send the line &quot;unsubscribe linux-sound&quot; in
the body of a message to majordomo@xxxxxxxxxxxxxxx
More majordomo info at  <a  rel="nofollow" href="http://vger.kernel.org/majordomo-info.html">http://vger.kernel.org/majordomo-info.html</a>



</pre>
<!--X-Body-of-Message-End-->
<!--X-MsgBody-End-->
<!--X-Follow-Ups-->
<hr>
<!--X-Follow-Ups-End-->
<!--X-References-->
<ul><li><strong>References</strong>:
<ul>
<li><strong><a name="00586" href="msg00586.html">[PATCH] ASoC: wm8731: let codec to manage clock by itself</a></strong>
<ul><li><em>From:</em> Bo Shen</li></ul></li>
<li><strong><a name="00589" href="msg00589.html">Re: [PATCH] ASoC: wm8731: let codec to manage clock by itself</a></strong>
<ul><li><em>From:</em> Bo Shen</li></ul></li>
<li><strong><a name="00590" href="msg00590.html">Re: [alsa-devel] [PATCH] ASoC: wm8731: let codec to manage clock	by itself</a></strong>
<ul><li><em>From:</em> Charles Keepax</li></ul></li>
<li><strong><a name="00591" href="msg00591.html">Re: [alsa-devel] [PATCH] ASoC: wm8731: let codec to manage clock by itself</a></strong>
<ul><li><em>From:</em> Manuel Lauss</li></ul></li>
</ul></li></ul>
<!--X-References-End-->
<!--X-BotPNI-->
<ul>
<li>Prev by Date:
<strong><a href="msg00591.html">Re: [alsa-devel] [PATCH] ASoC: wm8731: let codec to manage clock by itself</a></strong>
</li>
<li>Next by Date:
<strong><a href="msg00593.html">[RESEND RFC PATCH] ASoC: wm8731: let codec to manage clock by itself</a></strong>
</li>
<li>Previous by thread:
<strong><a href="msg00591.html">Re: [alsa-devel] [PATCH] ASoC: wm8731: let codec to manage clock by itself</a></strong>
</li>
<li>Next by thread:
<strong><a href="msg00593.html">[RESEND RFC PATCH] ASoC: wm8731: let codec to manage clock by itself</a></strong>
</li>
<li>Index(es):
<ul>
<li><a href="maillist.html#00592"><strong>Date</strong></a></li>
<li><a href="index.html#00592"><strong>Thread</strong></a></li>
</ul>
</li>
</ul>

<!--X-BotPNI-End-->
<!--X-User-Footer-->
<center>
<font size=-1>
<a href=/lists/>[Index&nbsp;of&nbsp;Archives]</a>
&nbsp;
&nbsp;
<a href=/lists/Pulseaudio/>[Pulseaudio]</a>
&nbsp;
&nbsp;
<a href=/lists/linux-audio-users/>[Linux&nbsp;Audio&nbsp;Users]</a>
&nbsp;
&nbsp;
<a href=/lists/alsa-devel/>[ALSA&nbsp;Devel]</a>
&nbsp;
&nbsp;
<a href=/lists/fedora-desktop/>[Fedora&nbsp;Desktop]</a>
&nbsp;
&nbsp;
<a href=/lists/fedora-selinux/>[Fedora&nbsp;SELinux]</a>
&nbsp;
&nbsp;
<a href=http://www.ske-art.com/z/biglist.html>[Big&nbsp;List&nbsp;of&nbsp;Linux&nbsp;Books]</a>
&nbsp;
&nbsp;
<a href=https://yosemitenews.info>[Yosemite&nbsp;News]</a>
&nbsp;
&nbsp;
<a href=/lists/kde/>[KDE&nbsp;Users]</a>
</font>
</center>
<hr>
<p>
<div>
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<ins class="adsbygoogle"
     style="display:block"
     data-ad-format="autorelaxed"
     data-ad-client="ca-pub-3422782820843221"
     data-ad-slot="1424524564"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
</div>
<table width="100%">
<tr>
<td valign=top align=left>&nbsp;</td>
<td valign=top align=right>
<a href=/lists/><img src=/button_01.gif border=0 alt="Powered by Linux"></a></td>
</tr></table>
<!--X-User-Footer-End-->
<script type="text/javascript"> 
 function initAddThis() {
    addthis.init()
 }
initAddThis();
</script>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-760190-1', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
