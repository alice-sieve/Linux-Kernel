<!-- MHonArc v2.6.19 -->
<!--X-Subject: Re: [PATCH] ALSA: usb&#45;audio: Fix double&#45;free in snd_usb_add_audio_stream() -->
<!--X-From-R13: Hynqvf Rebabi &#60;iqebabiNerqung.pbz> -->
<!--X-Date: Thu, 31 Mar 2016 07:04:06 &#45;0700 -->
<!--X-Message-Id: 805340847.43676741.1459433035733.JavaMail.zimbra@redhat.com -->
<!--X-Content-Type: text/plain -->
<!--X-Reference: 1459364602&#45;28997&#45;1&#45;git&#45;send&#45;email&#45;vdronov@redhat.com -->
<!--X-Reference: 1459364602&#45;28997&#45;2&#45;git&#45;send&#45;email&#45;vdronov@redhat.com -->
<!--X-Reference: s5hbn5v7lnw.wl&#45;tiwai@suse.de -->
<!--X-Reference: s5h8u0zgen2.wl&#45;tiwai@suse.de -->
<!--X-Reference: 882494379.43642280.1459427790768.JavaMail.zimbra@redhat.com -->
<!--X-Reference: s5hegaqg5zj.wl&#45;tiwai@suse.de -->
<!--X-Head-End-->
<!doctype html public "-//W3C//DTD HTML//EN">
<html>
<head>
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({
          google_ad_client: "ca-pub-3422782820843221",
          enable_page_level_ads: true
     });
</script>
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="description" content="Linux Sound: Re: [PATCH] ALSA: usb-audio: Fix double-free in snd_usb_add_audio_stream()">
<style>
<!--
 pre {white-space: pre-wrap;}
-->
</style>
<title>Linux Sound &mdash; Re: [PATCH] ALSA: usb-audio: Fix double-free in snd_usb_add_audio_stream()</title>
<link rel="alternate" type="application/rss+xml" title="Linux Sound" href="//feeds.feedburner.com/LinuxSound">
</head>
<body vlink=green>
<!--X-Body-Begin-->
<!--X-User-Header-->
<!--X-User-Header-End-->
<!--X-TopPNI-->
<form action="//www.google.com" id="cse-search-box" target="_blank">
  <div>
    <input type="hidden" name="cx" value="partner-pub-3422782820843221:6612422167" />
    <input type="hidden" name="ie" value="UTF-8" />
    <input type="text" name="q" size="55" />
    <input type="submit" name="sa" value="Search" />
  </div>
</form>
<script type="text/javascript" src="//www.google.com/coop/cse/brand?form=cse-search-box&amp;lang=en"></script>
<h1 itemprop="name">Re: [PATCH] ALSA: usb-audio: Fix double-free in snd_usb_add_audio_stream()</h1>
[<a href="msg00607.html">Date Prev</a>][<a href="msg00609.html">Date Next</a>][<a href="msg00607.html">Thread Prev</a>][<a href="msg00609.html">Thread Next</a>][<a href="maillist.html#00608">Date Index</a>][<a href="index.html#00608">Thread Index</a>]
<script src="https://apis.google.com/js/platform.js" async defer></script>
<g:plusone size="small"></g:plusone>
<p>
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- responsive test for archives -->
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-3422782820843221"
     data-ad-slot="6345952567"
     data-ad-format="auto"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
</div>

<!--X-TopPNI-End-->
<!--X-MsgBody-->
<!--X-Subject-Header-Begin-->
<hr>
<!--X-Subject-Header-End-->
<!--X-Head-of-Message-->
<ul>
<li><em>Subject</em>: Re: [PATCH] ALSA: usb-audio: Fix double-free in snd_usb_add_audio_stream()</li>
<li><em>From</em>: Vladis Dronov &lt;vdronov@xxxxxxxxxx&gt;</li>
<li><em>Date</em>: Thu, 31 Mar 2016 10:03:55 -0400 (EDT)</li>
<li><em>Cc</em>: Jaroslav Kysela &lt;perex@xxxxxxxx&gt;, alsa-devel@xxxxxxxxxxxxxxxx,        linux-kernel@xxxxxxxxxxxxxxx, linux-sound@xxxxxxxxxxxxxxx</li>
<li><em>In-reply-to</em>: &lt;<a href="msg00607.html">s5hegaqg5zj.wl-tiwai@suse.de</a>&gt;</li>
<li><em>Thread-index</em>: Au3J1+0NoenQW3EL6FxOlLxGmVbYGA==</li>
<li><em>Thread-topic</em>: ALSA: usb-audio: Fix double-free in snd_usb_add_audio_stream()</li>
</ul>
<!--X-Head-of-Message-End-->
<!--X-Head-Body-Sep-Begin-->
<!-- AddThis Button BEGIN -->
<div class="addthis_toolbox addthis_default_style ">
<a class="addthis_button_preferred_1"></a>
<a class="addthis_button_preferred_2"></a>
<a class="addthis_button_preferred_3"></a>
<a class="addthis_button_preferred_4"></a>
<a class="addthis_button_compact"></a>
<a class="addthis_counter addthis_bubble_style"></a>
</div>
<script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5196c2ae1be43d18&async=1&domready=1" async></script>
<!-- AddThis Button END -->
<hr>
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- responsive link 1 -->
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-3422782820843221"
     data-ad-slot="8681825769"
     data-ad-format="link"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
<p>
<div class="content" itemprop="articleBody">
<!--X-Head-Body-Sep-End-->
<!--X-Body-of-Message-->
<pre>Hello, Takashi, all,

&gt; No, it has nothing to do with the double-free bug itself.  Such an
&gt; optimization shouldn't be put in a fix patch

This piece of code move alone fixes the double-free bug in
create_fixed_stream_quirk(), so I believe it is related. Besides, a lot of stuff
is created and initialized in snd_usb_add_audio_stream() and while I do not see
another use-after-free bug, it could be there. By moving this code we avoid
these potential bugs we have not hit yet.

But anyway. If you still believe this code should not be moved, please, confirm,
I'll suggest the next patch version without it.

&gt; Vladis, if you take someone's patch as the base, you have to carry the
&gt; original authorship somewhere...

Yes, I was thinking about it, I was just not sure how should I do it. Will the
following form be fine? Or somehow else?

Based on a patch by Takashi Iwai&quot; &lt;tiwai@xxxxxxx&gt;

&gt; &gt; + * if not, create a new pcm stream. the caller must remove fp from
&gt; &gt; + * the substream fmt_list in the error path to avoid double-free.
&gt;
&gt; This comment isn't true.  The caller may leave it as is, too, like my
&gt; first version.  It just depends on the code.

Yes. Is the following rewrite acceptable for the next patch version?

 * if not, create a new pcm stream. Note, fp is added to the substream fmt_list
 * and will be freed on the chip instance release. Do not free fp or do remove
 * it from the substream fmt_list to avoid double-free.

Best regards,
Vladis Dronov | Red Hat, Inc. | Product Security Engineer
--
To unsubscribe from this list: send the line &quot;unsubscribe linux-sound&quot; in
the body of a message to majordomo@xxxxxxxxxxxxxxx
More majordomo info at  <a  rel="nofollow" href="http://vger.kernel.org/majordomo-info.html">http://vger.kernel.org/majordomo-info.html</a>


</pre>
<!--X-Body-of-Message-End-->
<!--X-MsgBody-End-->
<!--X-Follow-Ups-->
<hr>
<ul><li><strong>Follow-Ups</strong>:
<ul>
<li><strong><a name="00609" href="msg00609.html">Re: [PATCH] ALSA: usb-audio: Fix double-free in snd_usb_add_audio_stream()</a></strong>
<ul><li><em>From:</em> Takashi Iwai</li></ul></li>
</ul></li></ul>
<!--X-Follow-Ups-End-->
<!--X-References-->
<ul><li><strong>References</strong>:
<ul>
<li><strong><a name="00601" href="msg00601.html">[PATCH] ALSA: usb-audio: Fix double-free in snd_usb_add_audio_stream()</a></strong>
<ul><li><em>From:</em> Vladis Dronov</li></ul></li>
<li><strong><a name="00602" href="msg00602.html">[PATCH] ALSA: usb-audio: Fix double-free in snd_usb_add_audio_stream()</a></strong>
<ul><li><em>From:</em> Vladis Dronov</li></ul></li>
<li><strong><a name="00604" href="msg00604.html">Re: [PATCH] ALSA: usb-audio: Fix double-free in snd_usb_add_audio_stream()</a></strong>
<ul><li><em>From:</em> Takashi Iwai</li></ul></li>
<li><strong><a name="00605" href="msg00605.html">Re: [PATCH] ALSA: usb-audio: Fix double-free in snd_usb_add_audio_stream()</a></strong>
<ul><li><em>From:</em> Takashi Iwai</li></ul></li>
<li><strong><a name="00606" href="msg00606.html">Re: [PATCH] ALSA: usb-audio: Fix double-free in snd_usb_add_audio_stream()</a></strong>
<ul><li><em>From:</em> Vladis Dronov</li></ul></li>
<li><strong><a name="00607" href="msg00607.html">Re: [PATCH] ALSA: usb-audio: Fix double-free in snd_usb_add_audio_stream()</a></strong>
<ul><li><em>From:</em> Takashi Iwai</li></ul></li>
</ul></li></ul>
<!--X-References-End-->
<!--X-BotPNI-->
<ul>
<li>Prev by Date:
<strong><a href="msg00607.html">Re: [PATCH] ALSA: usb-audio: Fix double-free in snd_usb_add_audio_stream()</a></strong>
</li>
<li>Next by Date:
<strong><a href="msg00609.html">Re: [PATCH] ALSA: usb-audio: Fix double-free in snd_usb_add_audio_stream()</a></strong>
</li>
<li>Previous by thread:
<strong><a href="msg00607.html">Re: [PATCH] ALSA: usb-audio: Fix double-free in snd_usb_add_audio_stream()</a></strong>
</li>
<li>Next by thread:
<strong><a href="msg00609.html">Re: [PATCH] ALSA: usb-audio: Fix double-free in snd_usb_add_audio_stream()</a></strong>
</li>
<li>Index(es):
<ul>
<li><a href="maillist.html#00608"><strong>Date</strong></a></li>
<li><a href="index.html#00608"><strong>Thread</strong></a></li>
</ul>
</li>
</ul>

<!--X-BotPNI-End-->
<!--X-User-Footer-->
<center>
<font size=-1>
<a href=/lists/>[Index&nbsp;of&nbsp;Archives]</a>
&nbsp;
&nbsp;
<a href=/lists/Pulseaudio/>[Pulseaudio]</a>
&nbsp;
&nbsp;
<a href=/lists/linux-audio-users/>[Linux&nbsp;Audio&nbsp;Users]</a>
&nbsp;
&nbsp;
<a href=/lists/alsa-devel/>[ALSA&nbsp;Devel]</a>
&nbsp;
&nbsp;
<a href=/lists/fedora-desktop/>[Fedora&nbsp;Desktop]</a>
&nbsp;
&nbsp;
<a href=/lists/fedora-selinux/>[Fedora&nbsp;SELinux]</a>
&nbsp;
&nbsp;
<a href=http://www.ske-art.com/z/biglist.html>[Big&nbsp;List&nbsp;of&nbsp;Linux&nbsp;Books]</a>
&nbsp;
&nbsp;
<a href=https://yosemitenews.info>[Yosemite&nbsp;News]</a>
&nbsp;
&nbsp;
<a href=/lists/kde/>[KDE&nbsp;Users]</a>
</font>
</center>
<hr>
<p>
<div>
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<ins class="adsbygoogle"
     style="display:block"
     data-ad-format="autorelaxed"
     data-ad-client="ca-pub-3422782820843221"
     data-ad-slot="1424524564"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
</div>
<table width="100%">
<tr>
<td valign=top align=left>&nbsp;</td>
<td valign=top align=right>
<a href=/lists/><img src=/button_01.gif border=0 alt="Powered by Linux"></a></td>
</tr></table>
<!--X-User-Footer-End-->
<script type="text/javascript"> 
 function initAddThis() {
    addthis.init()
 }
initAddThis();
</script>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-760190-1', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
