<!-- MHonArc v2.6.19 -->
<!--X-Subject: Re: [RFC PATCH] security, capability: pass object information to security_capable -->
<!--X-From-R13: Egrcura Eznyyrl &#60;fqfNglpub.afn.tbi> -->
<!--X-Date: Fri, 12 Jul 2019 13:21:58 &#45;0700 -->
<!--X-Message-Id: 4fb3a599&#45;b1d8&#45;7cc2&#45;759a&#45;02195251e344@tycho.nsa.gov -->
<!--X-Content-Type: text/plain -->
<!--X-Reference: 20190712173404.14417&#45;1&#45;nhfran2@tycho.nsa.gov -->
<!--X-Reference: 680c35a8&#45;1ee5&#45;725d&#45;b33c&#45;7bdced39763c@schaufler&#45;ca.com -->
<!--X-Reference: e8de4a1c&#45;7e18&#45;fc20&#45;e372&#45;67bbaa93fd42@tycho.nsa.gov -->
<!--X-Reference: 16cade37&#45;9467&#45;ca7f&#45;ddea&#45;b8254c501f48@schaufler&#45;ca.com -->
<!--X-Head-End-->
<!doctype html public "-//W3C//DTD HTML//EN">
<html>
<head>
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({
          google_ad_client: "ca-pub-3422782820843221",
          enable_page_level_ads: true
     });
</script>
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="description" content="Linux Security Module, Re: [RFC PATCH] security, capability: pass object information to security_capable">
<style>
<!--
 pre {white-space: pre-wrap;}
-->
</style>
<title>Linux Security Module -- Re: [RFC PATCH] security, capability: pass object information to security_capable</title>
<link rel="alternate" type="application/rss+xml" title="Linux Security Module" href="//feeds.feedburner.com/LinuxSecurityModule">
</head>
<body vlink=green>
<!--X-Body-Begin-->
<!--X-User-Header-->
<!--X-User-Header-End-->
<!--X-TopPNI-->
<form action="//www.google.com" id="cse-search-box" target="_blank">
  <div>
    <input type="hidden" name="cx" value="partner-pub-3422782820843221:9580497365" />
    <input type="hidden" name="ie" value="UTF-8" />
    <input type="text" name="q" size="25" />
    <input type="submit" name="sa" value="Search" />
  </div>
</form>
<script type="text/javascript" src="//www.google.com/coop/cse/brand?form=cse-search-box&amp;lang=en"></script>
<h1 itemprop="name">Re: [RFC PATCH] security, capability: pass object information to security_capable</h1>
[<a href="msg29897.html">Date Prev</a>][<a href="msg29899.html">Date Next</a>][<a href="msg29896.html">Thread Prev</a>][<a href="msg29899.html">Thread Next</a>][<a href="maillist.html#29898">Date Index</a>][<a href="index.html#29898">Thread Index</a>]


<p>&nbsp;<br>
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- responsive test for archives -->
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-3422782820843221"
     data-ad-slot="6345952567"
     data-ad-format="auto"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>

<!--X-TopPNI-End-->
<!--X-MsgBody-->
<!--X-Subject-Header-Begin-->
<hr>
<!--X-Subject-Header-End-->
<!--X-Head-of-Message-->
<ul>
<li><em>Subject</em>: Re: [RFC PATCH] security, capability: pass object information to security_capable</li>
<li><em>From</em>: Stephen Smalley &lt;sds@xxxxxxxxxxxxx&gt;</li>
<li><em>Date</em>: Fri, 12 Jul 2019 16:21:51 -0400</li>
<li><em>Cc</em>: selinux@xxxxxxxxxxxxxxx, linux-security-module@xxxxxxxxxxxxxxx,        luto@xxxxxxxxxxxxxx, jmorris@xxxxxxxxx, keescook@xxxxxxxxxxxx,        serge@xxxxxxxxxx, john.johansen@xxxxxxxxxxxxx, mortonm@xxxxxxxxxxxx</li>
<li><em>In-reply-to</em>: &lt;<a href="msg29896.html">16cade37-9467-ca7f-ddea-b8254c501f48@schaufler-ca.com</a>&gt;</li>
<li><em>References</em>: &lt;<a href="msg29891.html">20190712173404.14417-1-nhfran2@tycho.nsa.gov</a>&gt; &lt;<a href="msg29893.html">680c35a8-1ee5-725d-b33c-7bdced39763c@schaufler-ca.com</a>&gt; &lt;<a href="msg29895.html">e8de4a1c-7e18-fc20-e372-67bbaa93fd42@tycho.nsa.gov</a>&gt; &lt;<a href="msg29896.html">16cade37-9467-ca7f-ddea-b8254c501f48@schaufler-ca.com</a>&gt;</li>
<li><em>User-agent</em>: Mozilla/5.0 (X11; Linux x86_64; rv:60.0) Gecko/20100101 Thunderbird/60.7.0</li>
</ul>
<!--X-Head-of-Message-End-->
<!--X-Head-Body-Sep-Begin-->
<!-- AddThis Button BEGIN -->
<div class="addthis_toolbox addthis_default_style ">
<a class="addthis_button_preferred_1"></a>
<a class="addthis_button_preferred_2"></a>
<a class="addthis_button_preferred_3"></a>
<a class="addthis_button_preferred_4"></a>
<a class="addthis_button_compact"></a>
<a class="addthis_counter addthis_bubble_style"></a>
</div>
<script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5196c2ae1be43d18&async=1&domready=1" async></script>
<!-- AddThis Button END -->
<hr>
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- responsive link 1 -->
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-3422782820843221"
     data-ad-slot="8681825769"
     data-ad-format="link"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
<p>
<div class="content" itemprop="articleBody">
<!--X-Head-Body-Sep-End-->
<!--X-Body-of-Message-->
<pre style="margin: 0em;">
On 7/12/19 3:54 PM, Casey Schaufler wrote:
</pre><blockquote style="border-left: #5555EE solid 0.2em; margin: 0em; padding-left: 0.85em"><pre style="margin: 0em;">
On 7/12/2019 11:25 AM, Stephen Smalley wrote:
</pre><blockquote style="border-left: #5555EE solid 0.2em; margin: 0em; padding-left: 0.85em"><pre style="margin: 0em;">
On 7/12/19 1:58 PM, Casey Schaufler wrote:
</pre><blockquote style="border-left: #5555EE solid 0.2em; margin: 0em; padding-left: 0.85em"><pre style="margin: 0em;">
On 7/12/2019 10:34 AM, Nicholas Franck wrote:
</pre><blockquote style="border-left: #5555EE solid 0.2em; margin: 0em; padding-left: 0.85em"><pre style="margin: 0em;">
At present security_capable does not pass any object information
and therefore can neither audit the particular object nor take it
into account. Augment the security_capable interface to support
passing supplementary data. Use this facility initially to convey
the inode for capability checks relevant to inodes. This only
addresses capable_wrt_inode_uidgid calls; other capability checks
relevant to inodes will be addressed in subsequent changes. In the
future, this will be further extended to pass object information for
other capability checks such as the target task for CAP_KILL.
</pre></blockquote><pre style="margin: 0em;">

This seems wrong to me. The capability system has nothing to do
with objects. Passing object information through security_capable()
may be convenient, but isn't relevant to the purpose of the interface.
It appears that there are very few places where the object information
is actually useful.
</pre></blockquote><pre style="margin: 0em;">

A fair number of capabilities are checked upon some attempted object access (often right after comparing UIDs or other per-object state), and the particular object can be very helpful in both audit and in access control.&#xA0; More below.
</pre></blockquote><pre style="margin: 0em;">

I'm not disagreeing with that. What I'm saying is that the capability
check interface is not the right place to pass that information. The
capability check has no use for the object information. I would much
rather see a security_pass_object_data() hook that gets called after
(or before) the security_capable() hook in the places where you want
the extra information.
</pre></blockquote><pre style="margin: 0em;">

</pre><tt>I don't see how that would work or be advantageous.  Within the capable 
</tt><tt>hook, the security module(s) decide whether or not to allow the 
</tt><tt>capability, and generate any relevant LSM audit records.  It is 
</tt><tt>precisely at those two points (deciding and auditing) that we need the 
</tt><tt>information; both occur within the existing capable hooks.  Calling a 
</tt><tt>separate hook before the capable call and e.g. saving the information in 
</tt><tt>the task security structure for later consumption during the capable 
</tt><tt>call offers only overhead, no benefit.  Calling a separate hook after 
</tt><tt>the capable call is too late to be of use - the decision and auditing 
</tt><tt>are already done.  And both hooks would be invoked from precisely the 
</tt><tt>same function at the same point.  If the information wasn't already 
</tt><tt>readily available at the point of the hook call, it might be a different 
</tt><tt>matter, but that isn't the case here.
</tt><pre style="margin: 0em;">

</pre><blockquote style="border-left: #5555EE solid 0.2em; margin: 0em; padding-left: 0.85em"><pre style="margin: 0em;">

</pre><blockquote style="border-left: #5555EE solid 0.2em; margin: 0em; padding-left: 0.85em"><blockquote style="border-left: #5555EE solid 0.2em; margin: 0em; padding-left: 0.85em"><blockquote style="border-left: #5555EE solid 0.2em; margin: 0em; padding-left: 0.85em"><pre style="margin: 0em;">
In SELinux this new information is leveraged here to include the inode
in the audit message. In the future, it could also be used to perform
a per inode capability checks.
</pre></blockquote><pre style="margin: 0em;">

I suggest that you want a mechanism for adding the inode information
to the audit record instead.
</pre></blockquote><pre style="margin: 0em;">

That is part of what we want, but not the entire picture.&#xA0; But with respect to audit, the problem today is that one sees SELinux dac_read_search, dac_override, etc denials with no indication as to the particular file, which is unfortunate both from a security auditing perspective and from a policy development perspective.
</pre></blockquote><pre style="margin: 0em;">

I can see how that is a problem.

</pre><blockquote style="border-left: #5555EE solid 0.2em; margin: 0em; padding-left: 0.85em"><pre style="margin: 0em;">
The only option today to gain that information is by enabling system call audit and setting at least one audit filter so that the audit framework will collect that information and include it in the audit records that are emitted upon syscall exit after any such AVC denial.&#xA0; Unfortunately, that is all disabled by default on most systems due to its associated performance overhead, and one doesn't even have the option of enabling it on some systems, e.g. Android devices.&#xA0; And even when one can enable syscall audit, one must correlate the syscall audit record to the associated AVC record to identify the object rather than having the information directly included in the same record.
</pre></blockquote><pre style="margin: 0em;">

None of which gives any rationale for adding the information
to the capability check. Sure, it's in the right place, but there
is no object interaction with the capability call.
</pre></blockquote><pre style="margin: 0em;">

We introducing such an interaction - that's the point.

</pre><blockquote style="border-left: #5555EE solid 0.2em; margin: 0em; padding-left: 0.85em"><pre style="margin: 0em;">

</pre><blockquote style="border-left: #5555EE solid 0.2em; margin: 0em; padding-left: 0.85em"><blockquote style="border-left: #5555EE solid 0.2em; margin: 0em; padding-left: 0.85em"><pre style="margin: 0em;">
What would a &quot;per inode&quot; capability check be? Capability checks are
process checks, not object checks.
</pre></blockquote><pre style="margin: 0em;">

Ideally it would be possible to scope dac_override and other capabilities to specific objects rather than having to allow it for all or none.
</pre></blockquote><pre style="margin: 0em;">

That would require a major overhaul of the capability scheme,
and you're going to get arguments from people like me about
whether or not that would be ideal. Besides, isn't that what
SELinux is all about, providing that sort of privilege granularity?
</pre></blockquote><pre style="margin: 0em;">

</pre><tt>It only requires passing the information to the security modules at the 
</tt><tt>point of the hook call, and then SELinux or other security modules can 
</tt><tt>implement it themselves without any other changes to the kernel.  We 
</tt><tt>aren't changing the way the base capabilities logic works.
</tt><pre style="margin: 0em;">

</pre><tt>We can't provide that degree of granularity without the additional 
</tt><tt>information.  Let's say domain A needs DAC override for files of type B 
</tt><tt>and for nothing else.  To support this requirement, SELinux policy has 
</tt><tt>to include at least:
</tt><pre style="margin: 0em;">
1) allow A self:capability dac_override;
2) allow A B:file { read write };

</pre><tt>Let's say that A also reads from files of type C and writes to file of 
</tt><tt>type D.  So SELinux policy also has to allow:
</tt><pre style="margin: 0em;">
3) allow A C:file read;
4) allow A D:file write;

</pre><tt>There are files within type C and within type D that are under different 
</tt><tt>DAC ownerships or modes.  Only some of these files should be accessible 
</tt><tt>to A.  But because dac_override is global and not scoped to specific 
</tt><tt>sets of files, the combination of these permissions now allows A to 
</tt><tt>override DAC on files of type C and of type D; thus it can read all 
</tt><tt>files of type C and write to all files of type D even though it has no 
</tt><tt>legitimate need to do so.
</tt><pre style="margin: 0em;">


</pre><blockquote style="border-left: #5555EE solid 0.2em; margin: 0em; padding-left: 0.85em"><pre style="margin: 0em;">

</pre><blockquote style="border-left: #5555EE solid 0.2em; margin: 0em; padding-left: 0.85em"><pre style="margin: 0em;">
Just because a process needs to override DAC on one file or one set of files is not a reason to allow it to do so on every file it can access at all.
</pre></blockquote><pre style="margin: 0em;">

That's an argument for privilege bracketing within the process.
Not something I recommend (the oft referenced sendmail problems
being but one example) but the only way to do it properly without
delving into path based controls.
</pre></blockquote><pre style="margin: 0em;">

</pre><tt>As you note, historically privilege bracketing hasn't worked so well, 
</tt><tt>and fundamentally it puts the trust burden on userspace for something 
</tt><tt>that could be enforced at the system level quite easily and in a 
</tt><tt>race-free manner.
</tt><pre style="margin: 0em;">

</pre><blockquote style="border-left: #5555EE solid 0.2em; margin: 0em; padding-left: 0.85em"><pre style="margin: 0em;">

</pre><blockquote style="border-left: #5555EE solid 0.2em; margin: 0em; padding-left: 0.85em"><pre style="margin: 0em;">
If we want to apply least privilege, then this is a desirable facility.
</pre></blockquote><pre style="margin: 0em;">

The capability mechanism is object agnostic by design.
</pre></blockquote><pre style="margin: 0em;">

Some might argue that's a flawed design.

</pre><blockquote style="border-left: #5555EE solid 0.2em; margin: 0em; padding-left: 0.85em"><blockquote style="border-left: #5555EE solid 0.2em; margin: 0em; padding-left: 0.85em"><pre style="margin: 0em;">
I understand that doesn't mesh with Smack's mental modelbut it would probably be useful to both SELinux and AppArmor, among others.
</pre></blockquote><pre style="margin: 0em;">

I'm perfectly happy to have the information transmitted.
I think a separate interface for doing so is appropriate.
</pre></blockquote><pre style="margin: 0em;">

As above, I don't see any way to do that that isn't just adding overhead.


</pre>
<!--X-Body-of-Message-End-->
<!--X-MsgBody-End-->
<!--X-Follow-Ups-->
</div>
<hr>
<ul><li><strong>Follow-Ups</strong>:
<ul>
<li><strong><a name="29903" href="msg29903.html">Re: [RFC PATCH] security, capability: pass object information to security_capable</a></strong>
<ul><li><em>From:</em> James Morris</li></ul></li>
<li><strong><a name="29899" href="msg29899.html">Re: [RFC PATCH] security, capability: pass object information to security_capable</a></strong>
<ul><li><em>From:</em> Casey Schaufler</li></ul></li>
</ul></li></ul>
<!--X-Follow-Ups-End-->
<!--X-References-->
<ul><li><strong>References</strong>:
<ul>
<li><strong><a name="29891" href="msg29891.html">[RFC PATCH] security,capability: pass object information to security_capable</a></strong>
<ul><li><em>From:</em> Nicholas Franck</li></ul></li>
<li><strong><a name="29893" href="msg29893.html">Re: [RFC PATCH] security,capability: pass object information to security_capable</a></strong>
<ul><li><em>From:</em> Casey Schaufler</li></ul></li>
<li><strong><a name="29895" href="msg29895.html">Re: [RFC PATCH] security, capability: pass object information to security_capable</a></strong>
<ul><li><em>From:</em> Stephen Smalley</li></ul></li>
<li><strong><a name="29896" href="msg29896.html">Re: [RFC PATCH] security, capability: pass object information to security_capable</a></strong>
<ul><li><em>From:</em> Casey Schaufler</li></ul></li>
</ul></li></ul>
<!--X-References-End-->
<!--X-BotPNI-->
<ul>
<li>Prev by Date:
<strong><a href="msg29897.html">Re: [PATCH 1/6] security: Add hooks to rule on setting a superblock or mount watch [ver #5]</a></strong>
</li>
<li>Next by Date:
<strong><a href="msg29899.html">Re: [RFC PATCH] security, capability: pass object information to security_capable</a></strong>
</li>
<li>Previous by thread:
<strong><a href="msg29896.html">Re: [RFC PATCH] security, capability: pass object information to security_capable</a></strong>
</li>
<li>Next by thread:
<strong><a href="msg29899.html">Re: [RFC PATCH] security, capability: pass object information to security_capable</a></strong>
</li>
<li>Index(es):
<ul>
<li><a href="maillist.html#29898"><strong>Date</strong></a></li>
<li><a href="index.html#29898"><strong>Thread</strong></a></li>
</ul>
</li>
</ul>

<!--X-BotPNI-End-->
<!--X-User-Footer-->
<center>
<font size=-1>
<a href=/lists/>[Index&nbsp;of&nbsp;Archives]</a>
&nbsp;
&nbsp;
<a href=/linux/fedora/fedora-users/>[Fedora&nbsp;Users]</a>
&nbsp;
&nbsp;
<a href=/lists/fedora-desktop/>[Fedora&nbsp;Desktop]</a>
&nbsp;
&nbsp;
<a href=/lists/fedora-selinux/>[Fedora&nbsp;SELinux]</a>
&nbsp;
&nbsp;
<a href=https://yosemitenews.info>[Yosemite&nbsp;News]</a>
&nbsp;
&nbsp;
<a href=/lists/kde/>[KDE&nbsp;Users]</a>
</font>
</center>
<hr>
<p>
<div>
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<ins class="adsbygoogle"
     style="display:block"
     data-ad-format="autorelaxed"
     data-ad-client="ca-pub-3422782820843221"
     data-ad-slot="1424524564"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
</div>
<table width=100%>
<tr>
<td align=left>&nbsp;</td>
<td align=right><a href=/lists/><img src=/button_01.gif border=0 alt="Powered by Linux"></a></td>
</tr>
</table>
<!--X-User-Footer-End-->
<script type="text/javascript"> 
 function initAddThis() {
    addthis.init()
 }
initAddThis();
</script>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-760190-1', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
