<!-- MHonArc v2.6.19 -->
<!--X-Subject: Re: [PATCH V33 24/30] bpf: Restrict bpf when kernel lockdown is in confidentiality mode -->
<!--X-From-R13: Egrcura Eznyyrl &#60;fqfNglpub.afn.tbi> -->
<!--X-Date: Thu, 27 Jun 2019 13:17:02 &#45;0700 -->
<!--X-Message-Id: de8b15eb&#45;ba6c&#45;847a&#45;7435&#45;42742203d4a5@tycho.nsa.gov -->
<!--X-Content-Type: text/plain -->
<!--X-Reference: 20190621011941.186255&#45;1&#45;matthewgarrett@google.com -->
<!--X-Reference: 20190621011941.186255&#45;25&#45;matthewgarrett@google.com -->
<!--X-Reference: CALCETrVUwQP7roLnW6kFG80Cc5U6X_T6AW+BTAftLccYGp8+Ow@mail.gmail.com -->
<!--X-Reference: alpine.LRH.2.21.1906270621080.28132@namei.org -->
<!--X-Reference: 6E53376F&#45;01BB&#45;4795&#45;BC02&#45;24F9CAE00001@amacapital.net -->
<!--X-Reference: bce70c8b&#45;9efd&#45;6362&#45;d536&#45;cfbbcf70b0b7@tycho.nsa.gov -->
<!--X-Reference: alpine.LRH.2.21.1906280332500.17363@namei.org -->
<!--X-Head-End-->
<!doctype html public "-//W3C//DTD HTML//EN">
<html>
<head>
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({
          google_ad_client: "ca-pub-3422782820843221",
          enable_page_level_ads: true
     });
</script>
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="description" content="Linux Security Module, Re: [PATCH V33 24/30] bpf: Restrict bpf when kernel lockdown is in confidentiality mode">
<style>
<!--
 pre {white-space: pre-wrap;}
-->
</style>
<title>Linux Security Module -- Re: [PATCH V33 24/30] bpf: Restrict bpf when kernel lockdown is in confidentiality mode</title>
<link rel="alternate" type="application/rss+xml" title="Linux Security Module" href="//feeds.feedburner.com/LinuxSecurityModule">
</head>
<body vlink=green>
<!--X-Body-Begin-->
<!--X-User-Header-->
<!--X-User-Header-End-->
<!--X-TopPNI-->
<form action="//www.google.com" id="cse-search-box" target="_blank">
  <div>
    <input type="hidden" name="cx" value="partner-pub-3422782820843221:9580497365" />
    <input type="hidden" name="ie" value="UTF-8" />
    <input type="text" name="q" size="25" />
    <input type="submit" name="sa" value="Search" />
  </div>
</form>
<script type="text/javascript" src="//www.google.com/coop/cse/brand?form=cse-search-box&amp;lang=en"></script>
<h1 itemprop="name">Re: [PATCH V33 24/30] bpf: Restrict bpf when kernel lockdown is in confidentiality mode</h1>
[<a href="msg29486.html">Date Prev</a>][<a href="msg29488.html">Date Next</a>][<a href="msg29477.html">Thread Prev</a>][<a href="msg29507.html">Thread Next</a>][<a href="maillist.html#29487">Date Index</a>][<a href="index.html#29487">Thread Index</a>]


<p>&nbsp;<br>
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- responsive test for archives -->
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-3422782820843221"
     data-ad-slot="6345952567"
     data-ad-format="auto"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>

<!--X-TopPNI-End-->
<!--X-MsgBody-->
<!--X-Subject-Header-Begin-->
<hr>
<!--X-Subject-Header-End-->
<!--X-Head-of-Message-->
<ul>
<li><em>Subject</em>: Re: [PATCH V33 24/30] bpf: Restrict bpf when kernel lockdown is in confidentiality mode</li>
<li><em>From</em>: Stephen Smalley &lt;sds@xxxxxxxxxxxxx&gt;</li>
<li><em>Date</em>: Thu, 27 Jun 2019 16:16:17 -0400</li>
<li><em>Cc</em>: Andy Lutomirski &lt;luto@xxxxxxxxxxxxxx&gt;,        Andy Lutomirski &lt;luto@xxxxxxxxxx&gt;,        Matthew Garrett &lt;matthewgarrett@xxxxxxxxxx&gt;,        linux-security@xxxxxxxxxxxxxxx, LKML &lt;linux-kernel@xxxxxxxxxxxxxxx&gt;,        Linux API &lt;linux-api@xxxxxxxxxxxxxxx&gt;,        David Howells &lt;dhowells@xxxxxxxxxx&gt;,        Alexei Starovoitov &lt;alexei.starovoitov@xxxxxxxxx&gt;,        Matthew Garrett &lt;mjg59@xxxxxxxxxx&gt;,        Network Development &lt;netdev@xxxxxxxxxxxxxxx&gt;,        Chun-Yi Lee &lt;jlee@xxxxxxxx&gt;, Daniel Borkmann &lt;daniel@xxxxxxxxxxxxx&gt;,        linux-security-module@xxxxxxxxxxxxxxx</li>
<li><em>In-reply-to</em>: &lt;<a href="msg29477.html">alpine.LRH.2.21.1906280332500.17363@namei.org</a>&gt;</li>
<li><em>References</em>: &lt;20190621011941.186255-1-matthewgarrett@google.com&gt; &lt;20190621011941.186255-25-matthewgarrett@google.com&gt; &lt;CALCETrVUwQP7roLnW6kFG80Cc5U6X_T6AW+BTAftLccYGp8+Ow@mail.gmail.com&gt; &lt;<a href="msg29394.html">alpine.LRH.2.21.1906270621080.28132@namei.org</a>&gt; &lt;<a href="msg29433.html">6E53376F-01BB-4795-BC02-24F9CAE00001@amacapital.net</a>&gt; &lt;<a href="msg29462.html">bce70c8b-9efd-6362-d536-cfbbcf70b0b7@tycho.nsa.gov</a>&gt; &lt;<a href="msg29477.html">alpine.LRH.2.21.1906280332500.17363@namei.org</a>&gt;</li>
<li><em>User-agent</em>: Mozilla/5.0 (X11; Linux x86_64; rv:60.0) Gecko/20100101 Thunderbird/60.7.0</li>
</ul>
<!--X-Head-of-Message-End-->
<!--X-Head-Body-Sep-Begin-->
<!-- AddThis Button BEGIN -->
<div class="addthis_toolbox addthis_default_style ">
<a class="addthis_button_preferred_1"></a>
<a class="addthis_button_preferred_2"></a>
<a class="addthis_button_preferred_3"></a>
<a class="addthis_button_preferred_4"></a>
<a class="addthis_button_compact"></a>
<a class="addthis_counter addthis_bubble_style"></a>
</div>
<script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5196c2ae1be43d18&async=1&domready=1" async></script>
<!-- AddThis Button END -->
<hr>
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- responsive link 1 -->
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-3422782820843221"
     data-ad-slot="8681825769"
     data-ad-format="link"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
<p>
<div class="content" itemprop="articleBody">
<!--X-Head-Body-Sep-End-->
<!--X-Body-of-Message-->
<pre style="margin: 0em;">
On 6/27/19 2:06 PM, James Morris wrote:
</pre><blockquote style="border-left: #5555EE solid 0.2em; margin: 0em; padding-left: 0.85em"><pre style="margin: 0em;">
On Thu, 27 Jun 2019, Stephen Smalley wrote:

</pre><blockquote style="border-left: #5555EE solid 0.2em; margin: 0em; padding-left: 0.85em"><pre style="margin: 0em;">
There are two scenarios where finer-grained distinctions make sense:

- Users may need to enable specific functionality that falls under the
umbrella of &quot;confidentiality&quot; or &quot;integrity&quot; lockdown.  Finer-grained lockdown
reasons free them from having to make an all-or-nothing choice between lost
functionality or no lockdown at all.
</pre></blockquote><pre style="margin: 0em;">

Agreed. This will be used for more than just UEFI secure boot on desktops,
e.g. embedded systems using verified boot, where finer grained policy will
be needed for what are sometimes very specific use-cases (which may be
also covered by other mitigations).

</pre><blockquote style="border-left: #5555EE solid 0.2em; margin: 0em; padding-left: 0.85em"><pre style="margin: 0em;">
This can be supported directly by the
lockdown module without any help from SELinux or other security modules; we
just need the ability to specify these finer-grained lockdown levels via the
boot parameters and securityfs nodes.
</pre></blockquote><pre style="margin: 0em;">

If the lockdown LSM implements fine grained policy (rather than the simple
coarse grained policy), I'd suggest adding a new lockdown level of
'custom' which by default enables all hooks but allows selective
disablement via params/sysfs.

This would be simpler than telling users to use a different lockdown LSM
for this.

</pre><blockquote style="border-left: #5555EE solid 0.2em; margin: 0em; padding-left: 0.85em"><pre style="margin: 0em;">
- Different processes/programs may need to use different sets of functionality
restricted via lockdown confidentiality or integrity categories.  If we have
to allow all-or-none for the set of interfaces/functionality covered by the
generic confidentiality or integrity categories, then we'll end up having to
choose between lost functionality or overprivileged processes, neither of
which is optimal.

Is it truly the case that everything under the &quot;confidentiality&quot; category
poses the same level of risk to kernel confidentiality, and similarly for
everything under the &quot;integrity&quot; category?  If not, then being able to
distinguish them definitely has benefit.
</pre></blockquote><pre style="margin: 0em;">

Good question. We can't know the answer to this unless we know how an
attacker might leverage access.

The value here IMHO is more in allowing tradeoffs to be made by system
designers vs. disabling lockdown entirely.

</pre><blockquote style="border-left: #5555EE solid 0.2em; margin: 0em; padding-left: 0.85em"><pre style="margin: 0em;">
I'm still not clear though on how/if this will compose with or be overridden
by other security modules.  We would need some means for another security
module to take over lockdown decisions once it has initialized (including
policy load), and to be able to access state that is currently private to the
lockdown module, like the level.
</pre></blockquote><pre style="margin: 0em;">

Why not utilize stacking (restrictively), similarly to capabilities?
</pre></blockquote><pre style="margin: 0em;">

</pre><tt>That would only allow the LSM to further lock down the system above the 
</tt><tt>lockdown level set at boot, not grant exemptions for specific 
</tt><tt>functionality/interfaces required by the user or by a specific 
</tt><tt>process/program. You'd have to boot with lockdown=none (or your 
</tt><tt>lockdown=custom suggestion) in order for the LSM to allow anything 
</tt><tt>covered by the integrity or confidentiality levels.  And then the kernel 
</tt><tt>would be unprotected prior to full initialization of the LSM, including 
</tt><tt>policy load.
</tt><pre style="margin: 0em;">

</pre><tt>It seems like one would want to be able to boot with lockdown=integrity 
</tt><tt>to protect the kernel initially, then switch over to allowing the LSM to 
</tt><tt>selectively override it.
</tt><pre style="margin: 0em;">


</pre>
<!--X-Body-of-Message-End-->
<!--X-MsgBody-End-->
<!--X-Follow-Ups-->
</div>
<hr>
<ul><li><strong>Follow-Ups</strong>:
<ul>
<li><strong><a name="29507" href="msg29507.html">Re: [PATCH V33 24/30] bpf: Restrict bpf when kernel lockdown is in confidentiality mode</a></strong>
<ul><li><em>From:</em> Matthew Garrett</li></ul></li>
</ul></li></ul>
<!--X-Follow-Ups-End-->
<!--X-References-->
<ul><li><strong>References</strong>:
<ul>
<li><strong><a name="29394" href="msg29394.html">Re: [PATCH V33 24/30] bpf: Restrict bpf when kernel lockdown is in confidentiality mode</a></strong>
<ul><li><em>From:</em> James Morris</li></ul></li>
<li><strong><a name="29433" href="msg29433.html">Re: [PATCH V33 24/30] bpf: Restrict bpf when kernel lockdown is in confidentiality mode</a></strong>
<ul><li><em>From:</em> Andy Lutomirski</li></ul></li>
<li><strong><a name="29462" href="msg29462.html">Re: [PATCH V33 24/30] bpf: Restrict bpf when kernel lockdown is in confidentiality mode</a></strong>
<ul><li><em>From:</em> Stephen Smalley</li></ul></li>
<li><strong><a name="29477" href="msg29477.html">Re: [PATCH V33 24/30] bpf: Restrict bpf when kernel lockdown is in confidentiality mode</a></strong>
<ul><li><em>From:</em> James Morris</li></ul></li>
</ul></li></ul>
<!--X-References-End-->
<!--X-BotPNI-->
<ul>
<li>Prev by Date:
<strong><a href="msg29486.html">Re: [PATCH v9 1/2] mm: security: introduce init_on_alloc=1 and init_on_free=1 boot options</a></strong>
</li>
<li>Next by Date:
<strong><a href="msg29488.html">RE: [RFC PATCH v4 10/12] security/selinux: Add enclave_load() implementation</a></strong>
</li>
<li>Previous by thread:
<strong><a href="msg29477.html">Re: [PATCH V33 24/30] bpf: Restrict bpf when kernel lockdown is in confidentiality mode</a></strong>
</li>
<li>Next by thread:
<strong><a href="msg29507.html">Re: [PATCH V33 24/30] bpf: Restrict bpf when kernel lockdown is in confidentiality mode</a></strong>
</li>
<li>Index(es):
<ul>
<li><a href="maillist.html#29487"><strong>Date</strong></a></li>
<li><a href="index.html#29487"><strong>Thread</strong></a></li>
</ul>
</li>
</ul>

<!--X-BotPNI-End-->
<!--X-User-Footer-->
<center>
<font size=-1>
<a href=/lists/>[Index&nbsp;of&nbsp;Archives]</a>
&nbsp;
&nbsp;
<a href=/linux/fedora/fedora-users/>[Fedora&nbsp;Users]</a>
&nbsp;
&nbsp;
<a href=/lists/fedora-desktop/>[Fedora&nbsp;Desktop]</a>
&nbsp;
&nbsp;
<a href=/lists/fedora-selinux/>[Fedora&nbsp;SELinux]</a>
&nbsp;
&nbsp;
<a href=https://yosemitenews.info>[Yosemite&nbsp;News]</a>
&nbsp;
&nbsp;
<a href=/lists/kde/>[KDE&nbsp;Users]</a>
</font>
</center>
<hr>
<p>
<div>
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<ins class="adsbygoogle"
     style="display:block"
     data-ad-format="autorelaxed"
     data-ad-client="ca-pub-3422782820843221"
     data-ad-slot="1424524564"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
</div>
<table width=100%>
<tr>
<td align=left>&nbsp;</td>
<td align=right><a href=/lists/><img src=/button_01.gif border=0 alt="Powered by Linux"></a></td>
</tr>
</table>
<!--X-User-Footer-End-->
<script type="text/javascript"> 
 function initAddThis() {
    addthis.init()
 }
initAddThis();
</script>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-760190-1', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
