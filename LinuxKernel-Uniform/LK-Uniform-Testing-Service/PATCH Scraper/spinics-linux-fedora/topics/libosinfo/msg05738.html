<!-- MHonArc v2.6.19 -->
<!--X-Subject: Re:  [osinfo&#45;db PATCH 2/2] tests: add a new test for dates -->
<!--X-From-R13: Tnovnab =?WEA&#45;8859&#45;1?C?Tvq=SOapvb?= &#60;svqrapvbNerqung.pbz> -->
<!--X-Date: Tue, 21 May 2019 05:30:33 &#45;0700 -->
<!--X-Message-Id: 0b450b402d26b2acd37f4e1d98a8756817add2f5.camel@redhat.com -->
<!--X-Content-Type: text/plain -->
<!--X-Reference: 20190521120139.21846&#45;1&#45;ptoscano@redhat.com -->
<!--X-Reference: 20190521120139.21846&#45;3&#45;ptoscano@redhat.com -->
<!--X-Head-End-->
<!doctype html public "-//W3C//DTD HTML//EN">
<html>
<head>
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({
          google_ad_client: "ca-pub-3422782820843221",
          enable_page_level_ads: true
     });
</script>
<title>Re:  [osinfo-db PATCH 2/2] tests: add a new test for dates &mdash; libosinfo</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="description" content="libosinfo: Re:  [osinfo-db PATCH 2/2] tests: add a new test for dates">
<style>
<!--
 pre {white-space: pre-wrap;}
-->
</style>
<link rel="alternate" type="application/rss+xml" title="libosinfo" href="//feeds.feedburner.com/libosinfo">
</head>
<body itemscope itemtype="//schema.org/Article" vlink=green>
<!--X-Body-Begin-->
<!--X-User-Header-->
<!--X-User-Header-End-->
<!--X-TopPNI-->
<form action="//www.google.com" id="cse-search-box" target="_blank">
  <div>
    <input type="hidden" name="cx" value="partner-pub-3422782820843221:9580497365" />
    <input type="hidden" name="ie" value="UTF-8" />
    <input type="text" name="q" size="25" />
    <input type="submit" name="sa" value="Search" />
  </div>
</form>
<script type="text/javascript" src="//www.google.com/coop/cse/brand?form=cse-search-box&amp;lang=en"></script>
<h1 itemprop="name">Re:  [osinfo-db PATCH 2/2] tests: add a new test for dates</h1>
[<a href="msg05737.html">Date Prev</a>][<a href="msg05739.html">Date Next</a>][<a href="msg05734.html">Thread Prev</a>][<a href="msg05740.html">Thread Next</a>][<a href="maillist.html#05738">Date Index</a>][<a href="index.html#05738">Thread Index</a>]


<p>&nbsp;<br>
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- responsive test for archives -->
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-3422782820843221"
     data-ad-slot="6345952567"
     data-ad-format="auto"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>

<!--X-TopPNI-End-->
<!--X-MsgBody-->
<!--X-Subject-Header-Begin-->
<hr>
<!--X-Subject-Header-End-->
<!--X-Head-of-Message-->
<ul>
<li><em>Subject</em>: Re:  [osinfo-db PATCH 2/2] tests: add a new test for dates</li>
<li><em>From</em>: Fabiano Fid&#xEA;ncio &lt;fidencio@xxxxxxxxxx&gt;</li>
<li><em>Date</em>: Tue, 21 May 2019 14:30:28 +0200</li>
<li><em>In-reply-to</em>: &lt;<a href="msg05734.html">20190521120139.21846-3-ptoscano@redhat.com</a>&gt;</li>
<li><em>References</em>: &lt;<a href="msg05736.html">20190521120139.21846-1-ptoscano@redhat.com</a>&gt;	&lt;<a href="msg05734.html">20190521120139.21846-3-ptoscano@redhat.com</a>&gt;</li>
<li><em>User-agent</em>: Evolution 3.32.2 (3.32.2-1.fc30) </li>
</ul>
<!--X-Head-of-Message-End-->
<!--X-Head-Body-Sep-Begin-->
<!-- AddThis Button BEGIN -->
<div class="addthis_toolbox addthis_default_style ">
<a class="addthis_button_preferred_1"></a>
<a class="addthis_button_preferred_2"></a>
<a class="addthis_button_preferred_3"></a>
<a class="addthis_button_preferred_4"></a>
<a class="addthis_button_compact"></a>
<a class="addthis_counter addthis_bubble_style"></a>
</div>
<script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5196c2ae1be43d18&async=1&domready=1" async></script>
<!-- AddThis Button END -->
<hr>
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- responsive link 1 -->
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-3422782820843221"
     data-ad-slot="8681825769"
     data-ad-format="link"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
<p>
<div class="content" itemprop="articleBody">
<!--X-Head-Body-Sep-End-->
<!--X-Body-of-Message-->
<pre>On Tue, 2019-05-21 at 14:01 +0200, Pino Toscano wrote:
&gt; For each OS, check two things:
&gt; - release-date/eol-date are actually valid dates; this is needed
&gt; because
&gt;   the schema just specifies the regex, and it cannot detect invalid
&gt;   dates such as &quot;2019-05-00&quot; or 2019-05-40&quot;
&gt; - if both release-date/eol-date are specified, eol-date must be later
&gt;   than release-date
&gt; ---
&gt;  tests/test_dates.py | 22 ++++++++++++++++++++++
&gt;  1 file changed, 22 insertions(+)
&gt;  create mode 100644 tests/test_dates.py
&gt; 
&gt; diff --git a/tests/test_dates.py b/tests/test_dates.py
&gt; new file mode 100644
&gt; index 0000000..60f70e6
&gt; --- /dev/null
&gt; +++ b/tests/test_dates.py
&gt; @@ -0,0 +1,22 @@
&gt; +# This work is licensed under the GNU GPLv2 or later.
&gt; +# See the COPYING file in the top-level directory.
&gt; +
&gt; +import datetime
&gt; +
&gt; +import pytest

There's no need to import pytest here.

&gt; +
&gt; +from . import util
&gt; +
&gt; +
&gt; +def _parse_date(date_string):
&gt; +    if not date_string:
&gt; +        return None
&gt; +    return datetime.date.fromisoformat(date_string)

With the change suggested in the first patch, you can just ditch this
method ...

&gt; +
&gt; +
&gt; +@pytest.mark.parametrize('os', util.DataFiles.oses())

Here, I'd suggest to use `@util.os_parametrize('osxml',
filter_dates=True)` and then un util.py just add a new filter_dates that would be something like:
oses = [o for o in oses if o.release_date and o.eol_date]

This will make the test to run only against the entries that have
release and eol date, instead of running against every entry we have.

Of course, by doing this you'll have to adjust os -&gt; osxml.


&gt; +def test_dates(os):
&gt; +    release_date = _parse_date(os.release_date)
&gt; +    eol_date = _parse_date(os.eol_date)

... and just call datetime.data.fromisoformat() directly here

&gt; +    if release_date and eol_date:
&gt; +        assert release_date &lt; eol_date

_______________________________________________
Libosinfo mailing list
Libosinfo@xxxxxxxxxx
<a  rel="nofollow" href="https://www.redhat.com/mailman/listinfo/libosinfo">https://www.redhat.com/mailman/listinfo/libosinfo</a>


</pre>
<!--X-Body-of-Message-End-->
<!--X-MsgBody-End-->
<!--X-Follow-Ups-->
</div>
<hr>
<!--X-Follow-Ups-End-->
<!--X-References-->
<!--X-References-End-->
<!--X-BotPNI-->
<ul>
<li>Prev by Date:
<strong><a href="msg05737.html">Re:  [osinfo-db PATCH 1/2] tests: get the release/EOL dates</a></strong>
</li>
<li>Next by Date:
<strong><a href="msg05739.html">Re:  [osinfo-db PATCH 1/2] tests: get the release/EOL dates</a></strong>
</li>
<li>Previous by thread:
<strong><a href="msg05734.html">[osinfo-db PATCH 2/2] tests: add a new test for dates</a></strong>
</li>
<li>Next by thread:
<strong><a href="msg05740.html">Re:  [osinfo-db PATCH 2/2] tests: add a new test for dates</a></strong>
</li>
<li>Index(es):
<ul>
<li><a href="maillist.html#05738"><strong>Date</strong></a></li>
<li><a href="index.html#05738"><strong>Thread</strong></a></li>
</ul>
</li>
</ul>

<!--X-BotPNI-End-->
<!--X-User-Footer-->
<center>
<font size=-1>
<a href=/lists/>[Index&nbsp;of&nbsp;Archives]</a>
&nbsp;
&nbsp;
<a href=/lists/virt-tools/>[Virt&nbsp;Tools]</a>
&nbsp;
&nbsp;
<a href=/linux/fedora/libvirt-users/>[Libvirt&nbsp;Users]</a>
&nbsp;
&nbsp;
<a href=/linux/fedora/fedora-users/>[Fedora&nbsp;Users]</a>
&nbsp;
&nbsp;
<a href=/linux/fedora/fedora-maintainers/>[Fedora&nbsp;Maintainers]</a>
&nbsp;
&nbsp;
<a href=/lists/fedora-desktop/>[Fedora&nbsp;Desktop]</a>
&nbsp;
&nbsp;
<a href=/lists/fedora-selinux/>[Fedora&nbsp;SELinux]</a>
&nbsp;
&nbsp;
<a href=http://www.ske-art.com/z/biglist.html>[Big&nbsp;List&nbsp;of&nbsp;Linux&nbsp;Books]</a>
&nbsp;
&nbsp;
<a href=https://yosemitenews.info>[Yosemite&nbsp;News]</a>
&nbsp;
&nbsp;
<a href=/lists/kde/>[KDE&nbsp;Users]</a>
</font>
</center>
<p>
<div>
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<ins class="adsbygoogle"
     style="display:block"
     data-ad-format="autorelaxed"
     data-ad-client="ca-pub-3422782820843221"
     data-ad-slot="1424524564"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
</div>
<table width=100%>
<tr>
<td align=left>&nbsp;</td>
<td align=right><a href=/lists/><img src=/button_01.gif border=0 alt="Powered by Linux"></a></td>
</tr>
</table>
<!--X-User-Footer-End-->
<script type="text/javascript"> 
 function initAddThis() {
    addthis.init()
 }
initAddThis();
</script>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-760190-1', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
