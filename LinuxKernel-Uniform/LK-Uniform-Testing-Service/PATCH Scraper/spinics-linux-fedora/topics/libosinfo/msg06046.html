<!-- MHonArc v2.6.19 -->
<!--X-Subject: [libosinfo PATCH] install&#45;script: Add	_generate_*_for_tree() -->
<!--X-From-R13: =?GFT&#45;8?d?Tnovnab=20Tvq=Q3=OOapvb?= &#60;svqrapvbNerqung.pbz> -->
<!--X-Date: Tue, 16 Jul 2019 08:03:58 &#45;0700 -->
<!--X-Message-Id: 20190716150351.2708&#45;1&#45;fidencio@redhat.com -->
<!--X-Content-Type: text/plain -->
<!--X-Head-End-->
<!doctype html public "-//W3C//DTD HTML//EN">
<html>
<head>
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({
          google_ad_client: "ca-pub-3422782820843221",
          enable_page_level_ads: true
     });
</script>
<title>[libosinfo PATCH] install-script: Add	_generate_*_for_tree() &mdash; libosinfo</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="description" content="libosinfo: [libosinfo PATCH] install-script: Add	_generate_*_for_tree()">
<style>
<!--
 pre {white-space: pre-wrap;}
-->
</style>
<link rel="alternate" type="application/rss+xml" title="libosinfo" href="//feeds.feedburner.com/libosinfo">
</head>
<body itemscope itemtype="//schema.org/Article" vlink=green>
<!--X-Body-Begin-->
<!--X-User-Header-->
<!--X-User-Header-End-->
<!--X-TopPNI-->
<form action="//www.google.com" id="cse-search-box" target="_blank">
  <div>
    <input type="hidden" name="cx" value="partner-pub-3422782820843221:9580497365" />
    <input type="hidden" name="ie" value="UTF-8" />
    <input type="text" name="q" size="25" />
    <input type="submit" name="sa" value="Search" />
  </div>
</form>
<script type="text/javascript" src="//www.google.com/coop/cse/brand?form=cse-search-box&amp;lang=en"></script>
<h1 itemprop="name">[libosinfo PATCH] install-script: Add	_generate_*_for_tree()</h1>
[<a href="msg06045.html">Date Prev</a>][<a href="msg06047.html">Date Next</a>][<a href="msg06038.html">Thread Prev</a>][<a href="msg06048.html">Thread Next</a>][<a href="maillist.html#06046">Date Index</a>][<a href="index.html#06046">Thread Index</a>]


<p>&nbsp;<br>
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- responsive test for archives -->
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-3422782820843221"
     data-ad-slot="6345952567"
     data-ad-format="auto"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>

<!--X-TopPNI-End-->
<!--X-MsgBody-->
<!--X-Subject-Header-Begin-->
<hr>
<!--X-Subject-Header-End-->
<!--X-Head-of-Message-->
<ul>
<li><em>Subject</em>: [libosinfo PATCH] install-script: Add	_generate_*_for_tree()</li>
<li><em>From</em>: Fabiano Fid&#xEA;ncio &lt;fidencio@xxxxxxxxxx&gt;</li>
<li><em>Date</em>: Tue, 16 Jul 2019 17:03:51 +0200</li>
</ul>
<!--X-Head-of-Message-End-->
<!--X-Head-Body-Sep-Begin-->
<!-- AddThis Button BEGIN -->
<div class="addthis_toolbox addthis_default_style ">
<a class="addthis_button_preferred_1"></a>
<a class="addthis_button_preferred_2"></a>
<a class="addthis_button_preferred_3"></a>
<a class="addthis_button_preferred_4"></a>
<a class="addthis_button_compact"></a>
<a class="addthis_counter addthis_bubble_style"></a>
</div>
<script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5196c2ae1be43d18&async=1&domready=1" async></script>
<!-- AddThis Button END -->
<hr>
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- responsive link 1 -->
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-3422782820843221"
     data-ad-slot="8681825769"
     data-ad-format="link"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
<p>
<div class="content" itemprop="articleBody">
<!--X-Head-Body-Sep-End-->
<!--X-Body-of-Message-->
<pre>Similarly to what we already have for media, let's add APIs for
generating both the install-script and the install-script command line
for trees.

These new APIs take a tree as parameter and, by that, can access tree
specific elements as such its URLs.

Signed-off-by: Fabiano Fid&#xEA;ncio &lt;fidencio@xxxxxxxxxx&gt;
---
 osinfo/libosinfo.syms          |  10 +
 osinfo/osinfo_install_script.c | 326 ++++++++++++++++++++++++++++++++-
 osinfo/osinfo_install_script.h |  36 ++++
 3 files changed, 371 insertions(+), 1 deletion(-)

diff --git a/osinfo/libosinfo.syms b/osinfo/libosinfo.syms
index 016d167..fa1de2f 100644
--- a/osinfo/libosinfo.syms
+++ b/osinfo/libosinfo.syms
@@ -588,6 +588,16 @@ LIBOSINFO_1.6.0 {
     global:
 	osinfo_db_identify_tree;
 
+	osinfo_install_script_generate_command_line_for_tree;
+
+	osinfo_install_script_generate_for_tree;
+	osinfo_install_script_generate_for_tree_async;
+	osinfo_install_script_generate_for_tree_finish;
+
+	osinfo_install_script_generate_output_for_tree;
+	osinfo_install_script_generate_output_for_tree_async;
+	osinfo_install_script_generate_output_for_tree_finish;
+
 	osinfo_media_create_from_location_with_flags;
 	osinfo_media_create_from_location_with_flags_async;
 	osinfo_media_create_from_location_with_flags_finish;
diff --git a/osinfo/osinfo_install_script.c b/osinfo/osinfo_install_script.c
index b96e134..906fb83 100644
--- a/osinfo/osinfo_install_script.c
+++ b/osinfo/osinfo_install_script.c
@@ -671,6 +671,7 @@ struct _OsinfoInstallScriptGenerateData {
     GTask *res;
     OsinfoOs *os;
     OsinfoMedia *media;
+    OsinfoTree *tree;
     OsinfoInstallConfig *config;
     OsinfoInstallScript *script;
 };
@@ -681,6 +682,8 @@ static void osinfo_install_script_generate_data_free(OsinfoInstallScriptGenerate
     g_object_unref(data-&gt;os);
     if (data-&gt;media != NULL)
         g_object_unref(data-&gt;media);
+    if (data-&gt;tree != NULL)
+        g_object_unref(data-&gt;tree);
     g_object_unref(data-&gt;config);
     g_object_unref(data-&gt;script);
     g_object_unref(data-&gt;res);
@@ -884,6 +887,7 @@ static xmlNodePtr osinfo_install_script_generate_entity_xml(OsinfoInstallScript
 static xmlDocPtr osinfo_install_script_generate_config_xml(OsinfoInstallScript *script,
                                                            OsinfoOs *os,
                                                            OsinfoMedia *media,
+                                                           OsinfoTree *tree,
                                                            OsinfoInstallConfig *config,
                                                            const gchar *node_name,
                                                            GError **error)
@@ -930,6 +934,18 @@ static xmlDocPtr osinfo_install_script_generate_config_xml(OsinfoInstallScript *
         }
     }
 
+    if (tree != NULL) {
+        if (!(node = osinfo_install_script_generate_entity_xml(script,
+                                                               OSINFO_ENTITY(tree),
+                                                               &quot;tree&quot;,
+                                                               error)))
+            goto error;
+        if (!(xmlAddChild(root, node))) {
+            propagate_libxml_error(error, _(&quot;Unable to set 'tree' node&quot;));
+            goto error;
+        }
+    }
+
     if (!(node = osinfo_install_script_generate_entity_xml(script,
                                                            OSINFO_ENTITY(config),
                                                            &quot;config&quot;,
@@ -985,6 +1001,7 @@ static gchar *osinfo_install_script_apply_xslt(xsltStylesheetPtr ss,
 static gboolean osinfo_install_script_apply_template(OsinfoInstallScript *script,
                                                      OsinfoOs *os,
                                                      OsinfoMedia *media,
+                                                     OsinfoTree *tree,
                                                      const gchar *templateUri,
                                                      const gchar *template,
                                                      const gchar *node_name,
@@ -994,7 +1011,7 @@ static gboolean osinfo_install_script_apply_template(OsinfoInstallScript *script
 {
     gboolean ret = FALSE;
     xsltStylesheetPtr templateXsl = osinfo_install_script_load_template(templateUri, template, error);
-    xmlDocPtr configXml = osinfo_install_script_generate_config_xml(script, os, media, config, node_name, error);
+    xmlDocPtr configXml = osinfo_install_script_generate_config_xml(script, os, media, tree, config, node_name, error);
 
     if (!templateXsl || !configXml)
         goto cleanup;
@@ -1038,6 +1055,7 @@ static void osinfo_install_script_template_loaded(GObject *src,
     if (!osinfo_install_script_apply_template(data-&gt;script,
                                               data-&gt;os,
                                               data-&gt;media,
+                                              data-&gt;tree,
                                               uri,
                                               input,
                                               &quot;install-script-config&quot;,
@@ -1061,6 +1079,7 @@ static void osinfo_install_script_template_loaded(GObject *src,
 static void osinfo_install_script_generate_async_common(OsinfoInstallScript *script,
                                                         OsinfoOs *os,
                                                         OsinfoMedia *media,
+                                                        OsinfoTree *tree,
                                                         OsinfoInstallConfig *config,
                                                         GCancellable *cancellable,
                                                         GAsyncReadyCallback callback,
@@ -1079,6 +1098,8 @@ static void osinfo_install_script_generate_async_common(OsinfoInstallScript *scr
     data-&gt;os = g_object_ref(os);
     if (media != NULL)
         data-&gt;media = g_object_ref(media);
+    if (tree != NULL)
+        data-&gt;tree = g_object_ref(tree);
     data-&gt;config = g_object_ref(config);
     data-&gt;script = g_object_ref(script);
     data-&gt;res = g_task_new(G_OBJECT(script),
@@ -1092,6 +1113,7 @@ static void osinfo_install_script_generate_async_common(OsinfoInstallScript *scr
         if (!osinfo_install_script_apply_template(script,
                                                   os,
                                                   media,
+                                                  NULL,
                                                   &quot;&lt;data&gt;&quot;,
                                                   templateData,
                                                   &quot;install-script-config&quot;,
@@ -1144,6 +1166,7 @@ void osinfo_install_script_generate_async(OsinfoInstallScript *script,
     osinfo_install_script_generate_async_common(script,
                                                 os,
                                                 NULL,
+                                                NULL,
                                                 config,
                                                 cancellable,
                                                 callback,
@@ -1199,6 +1222,25 @@ gchar *osinfo_install_script_generate_for_media_finish(OsinfoInstallScript *scri
                                                         error);
 }
 
+/**
+ * osinfo_install_script_generate_for_tree_finish:
+ * @script: the install script
+ * @res:    a #GAsyncResult
+ * @error:  the location where to story any error, or NULL
+ *
+ * Returns: (transfer full): the generated script, or NULL or error
+ *
+ * Since: 1.6.0
+ */
+gchar *osinfo_install_script_generate_for_tree_finish(OsinfoInstallScript *script,
+                                                      GAsyncResult *res,
+                                                      GError **error)
+{
+    return osinfo_install_script_generate_finish_common(script,
+                                                        res,
+                                                        error);
+}
+
 /**
  * osinfo_install_script_generate_output_finish:
  * @script: the install script
@@ -1237,6 +1279,25 @@ GFile *osinfo_install_script_generate_output_for_media_finish(OsinfoInstallScrip
                                                         error);
 }
 
+/**
+ * osinfo_install_script_generate_output_for_tree_finish:
+ * @script: the install script
+ * @res:    a #GAsyncResult
+ * @error:  the location where to store any error, or NULL
+ *
+ * Returns: (transfer full): a file containing the script, or NULL on error.
+ *
+ * Since: 1.6.0
+ */
+GFile *osinfo_install_script_generate_output_for_tree_finish(OsinfoInstallScript *script,
+                                                             GAsyncResult *res,
+                                                             GError **error)
+{
+    return osinfo_install_script_generate_finish_common(script,
+                                                        res,
+                                                        error);
+}
+
 struct _OsinfoInstallScriptGenerateSyncData {
     GMainLoop *loop;
     GError *error;
@@ -1270,6 +1331,19 @@ static void osinfo_install_script_generate_output_for_media_done(GObject *src,
     g_main_loop_quit(data-&gt;loop);
 }
 
+static void osinfo_install_script_generate_output_for_tree_done(GObject *src,
+                                                                 GAsyncResult *res,
+                                                                 gpointer user_data)
+{
+    OsinfoInstallScriptGenerateSyncData *data = user_data;
+
+    data-&gt;file =
+        osinfo_install_script_generate_output_for_tree_finish(OSINFO_INSTALL_SCRIPT(src),
+                                                              res,
+                                                              &amp;data-&gt;error);
+    g_main_loop_quit(data-&gt;loop);
+}
+
 static void osinfo_install_script_generate_output_close_file(GObject *src,
                                                             GAsyncResult *res,
                                                             gpointer user_data)
@@ -1313,6 +1387,9 @@ static void osinfo_install_script_generate_done(GObject *src,
  * If you are generating the script for a specific media, it is recommended
  * that you use #osinfo_install_script_generate_for_media() instead.
  *
+ * If you are generating the script for a specific tree, it is recommended
+ * that you use #osinfo_install_script_generate_for_tree() in instead.
+ *
  * Since: 0.2.0
  */
 gchar *osinfo_install_script_generate(OsinfoInstallScript *script,
@@ -1374,6 +1451,7 @@ void osinfo_install_script_generate_for_media_async(OsinfoInstallScript *script,
     osinfo_install_script_generate_async_common(script,
                                                 os,
                                                 media,
+                                                NULL,
                                                 config,
                                                 cancellable,
                                                 callback,
@@ -1439,6 +1517,102 @@ gchar *osinfo_install_script_generate_for_media(OsinfoInstallScript *script,
     return data.output;
 }
 
+/**
+ * osinfo_install_script_generate_for_tree_async:
+ * @script:     the install script
+ * @tree:       the tree
+ * @config:     the install script config
+ * @cancellable: (allow-none): a #GCancellable, or %NULL
+ * @callback: Function to call when result of this call is ready
+ * @user_data: The user data to pass to @callback, or %NULL
+ *
+ * Asynchronous variant of #osinfo_install_script_generate_for_tree(). From the
+ * callback, call #osinfo_install_script_generate_for_tree_finish() to
+ * conclude this call and get the generated script.
+ *
+ * Since: 1.6.0
+ */
+void osinfo_install_script_generate_for_tree_async(OsinfoInstallScript *script,
+                                                    OsinfoTree *tree,
+                                                    OsinfoInstallConfig *config,
+                                                    GCancellable *cancellable,
+                                                    GAsyncReadyCallback callback,
+                                                    gpointer user_data) {
+    OsinfoOs *os;
+
+    g_return_if_fail(tree != NULL);
+
+    os = osinfo_tree_get_os(tree);
+
+    osinfo_install_script_generate_async_common(script,
+                                                os,
+                                                NULL,
+                                                tree,
+                                                config,
+                                                cancellable,
+                                                callback,
+                                                user_data);
+
+    g_object_unref(os);
+}
+
+static void osinfo_install_script_generate_for_tree_done(GObject *src,
+                                                         GAsyncResult *res,
+                                                         gpointer user_data)
+{
+    OsinfoInstallScriptGenerateSyncData *data = user_data;
+
+    data-&gt;output =
+        osinfo_install_script_generate_for_tree_finish(OSINFO_INSTALL_SCRIPT(src),
+                                                        res,
+                                                        &amp;data-&gt;error);
+    g_main_loop_quit(data-&gt;loop);
+}
+
+/**
+ * osinfo_install_script_generate_for_tree:
+ * @script:     the install script
+ * @tree:       the tree
+ * @config:     the install script config
+ * @cancellable: (allow-none): a #GCancellable, or %NULL
+ * @error: The location where to store any error, or %NULL
+ *
+ * Creates an install script. The tree @tree must have been identified
+ * successfully using #osinfo_db_identify_tree() before calling this function.
+ *
+ * Returns: (transfer full): the script as string.
+ *
+ * Since: 1.6.0
+ */
+gchar *osinfo_install_script_generate_for_tree(OsinfoInstallScript *script,
+                                               OsinfoTree *tree,
+                                               OsinfoInstallConfig *config,
+                                               GCancellable *cancellable,
+                                               GError **error)
+{
+    GMainLoop *loop = g_main_loop_new(g_main_context_get_thread_default(),
+                                      FALSE);
+    OsinfoInstallScriptGenerateSyncData data = {
+        loop, NULL, NULL, NULL
+    };
+
+    osinfo_install_script_generate_for_tree_async(script,
+                                                   tree,
+                                                   config,
+                                                   cancellable,
+                                                   osinfo_install_script_generate_for_tree_done,
+                                                   &amp;data);
+
+    g_main_loop_run(loop);
+
+    if (data.error)
+        g_propagate_error(error, data.error);
+
+    g_main_loop_unref(loop);
+
+    return data.output;
+}
+
 static void osinfo_install_script_generate_output_write_file(GObject *src,
                                                              GAsyncResult *res,
                                                              gpointer user_data)
@@ -1473,6 +1647,7 @@ static void osinfo_install_script_generate_output_write_file(GObject *src,
 static void osinfo_install_script_generate_output_async_common(OsinfoInstallScript *script,
                                                                OsinfoOs *os,
                                                                OsinfoMedia *media,
+                                                               OsinfoTree *tree,
                                                                OsinfoInstallConfig *config,
                                                                GFile *output_dir,
                                                                GCancellable *cancellable,
@@ -1498,6 +1673,12 @@ static void osinfo_install_script_generate_output_async_common(OsinfoInstallScri
                                                                 config,
                                                                 cancellable,
                                                                 &amp;data-&gt;error);
+    } else if (tree != NULL) {
+        data-&gt;output = osinfo_install_script_generate_for_tree(script,
+                                                               tree,
+                                                               config,
+                                                               cancellable,
+                                                               &amp;data-&gt;error);
     } else {
         data-&gt;output = osinfo_install_script_generate(script,
                                                       os,
@@ -1562,6 +1743,7 @@ void osinfo_install_script_generate_output_async(OsinfoInstallScript *script,
     osinfo_install_script_generate_output_async_common(script,
                                                        os,
                                                        NULL,
+                                                       NULL,
                                                        config,
                                                        output_dir,
                                                        cancellable,
@@ -1572,6 +1754,7 @@ void osinfo_install_script_generate_output_async(OsinfoInstallScript *script,
 static GFile *osinfo_install_script_generate_output_common(OsinfoInstallScript *script,
                                                            OsinfoOs *os,
                                                            OsinfoMedia *media,
+                                                           OsinfoTree *tree,
                                                            OsinfoInstallConfig *config,
                                                            GFile *output_dir,
                                                            GCancellable *cancellable,
@@ -1592,6 +1775,15 @@ static GFile *osinfo_install_script_generate_output_common(OsinfoInstallScript *
              cancellable,
              osinfo_install_script_generate_output_for_media_done,
              &amp;data);
+    } else if (tree != NULL) {
+        osinfo_install_script_generate_output_for_tree_async
+            (script,
+             tree,
+             config,
+             output_dir,
+             cancellable,
+             osinfo_install_script_generate_output_for_tree_done,
+             &amp;data);
     } else {
         osinfo_install_script_generate_output_async
             (script,
@@ -1630,6 +1822,9 @@ static GFile *osinfo_install_script_generate_output_common(OsinfoInstallScript *
  * If you are generating the script for a specific media, it is recommended
  * that you use #osinfo_install_script_generate_output_for_media() instead.
  *
+ * If you are generating the script for a specific tree, it is recommended
+ * that you use #osinfo_install_script_generate_output_for_tree() instead.
+ *
  * Since: 0.2.0
  */
 GFile *osinfo_install_script_generate_output(OsinfoInstallScript *script,
@@ -1642,6 +1837,7 @@ GFile *osinfo_install_script_generate_output(OsinfoInstallScript *script,
     return osinfo_install_script_generate_output_common(script,
                                                         os,
                                                         NULL,
+                                                        NULL,
                                                         config,
                                                         output_dir,
                                                         cancellable,
@@ -1677,6 +1873,7 @@ void osinfo_install_script_generate_output_for_media_async(OsinfoInstallScript *
     osinfo_install_script_generate_output_async_common(script,
                                                        NULL,
                                                        media,
+                                                       NULL,
                                                        config,
                                                        output_dir,
                                                        cancellable,
@@ -1710,6 +1907,77 @@ GFile *osinfo_install_script_generate_output_for_media(OsinfoInstallScript *scri
     return osinfo_install_script_generate_output_common(script,
                                                         NULL,
                                                         media,
+                                                        NULL,
+                                                        config,
+                                                        output_dir,
+                                                        cancellable,
+                                                        error);
+}
+
+/**
+ * osinfo_install_script_generate_output_for_tree_async:
+ * @script:     the install script
+ * @tree:       the tree
+ * @config:     the install script config
+ * @output_dir: the directory where the file containing the output script
+ *              will be written
+ * @cancellable: (allow-none): a #GCancellable, or %NULL
+ * @callback: Function to call when result of this call is ready
+ * @user_data: The user data to pass to @callback, or %NULL
+ *
+ * Asynchronous variant of #osinfo_install_script_generate_output_for_tree().
+ * From the callback, call
+ * #osinfo_install_script_generate_output_for_tree_finish() to conclude this
+ * call and get the generated file.
+ *
+ * Since: 1.6.0
+ */
+void osinfo_install_script_generate_output_for_tree_async(OsinfoInstallScript *script,
+                                                          OsinfoTree *tree,
+                                                          OsinfoInstallConfig *config,
+                                                          GFile *output_dir,
+                                                          GCancellable *cancellable,
+                                                          GAsyncReadyCallback callback,
+                                                          gpointer user_data)
+{
+    osinfo_install_script_generate_output_async_common(script,
+                                                       NULL,
+                                                       NULL,
+                                                       tree,
+                                                       config,
+                                                       output_dir,
+                                                       cancellable,
+                                                       callback,
+                                                       user_data);
+}
+
+/**
+ * osinfo_install_script_generate_output_for_tree:
+ * @script:     the install script
+ * @tree:       the tree
+ * @config:     the install script config
+ * @output_dir: the directory where the file containing the output script
+ *              will be written
+ * @cancellable: (allow-none): a #GCancellable, or %NULL
+ * @error: The location where to store any error, or %NULL
+ *
+ * Creates an install script that is written to the returned file.
+ *
+ * Returns: (transfer full): a file containing the script.
+ *
+ * Since: 1.6.0
+ */
+GFile *osinfo_install_script_generate_output_for_tree(OsinfoInstallScript *script,
+                                                      OsinfoTree *tree,
+                                                      OsinfoInstallConfig *config,
+                                                      GFile *output_dir,
+                                                      GCancellable *cancellable,
+                                                      GError **error)
+{
+    return osinfo_install_script_generate_output_common(script,
+                                                        NULL,
+                                                        NULL,
+                                                        tree,
                                                         config,
                                                         output_dir,
                                                         cancellable,
@@ -1732,6 +2000,10 @@ GFile *osinfo_install_script_generate_output_for_media(OsinfoInstallScript *scri
  * recommended that you use
  * #osinfo_install_script_generate_command_line_for_media() instead.
  *
+ * If you are generating the command line for a specific tree, it is
+ * recommended that you use
+ * #osinfo_install_script_generate_command_line_for_tree() instead.
+ *
  * Returns: (transfer full): The generated command line string, NULL otherwise.
  *
  * Since: 0.2.7
@@ -1748,6 +2020,7 @@ gchar *osinfo_install_script_generate_command_line(OsinfoInstallScript *script,
         if (!osinfo_install_script_apply_template(script,
                                                   os,
                                                   NULL,
+                                                  NULL,
                                                   &quot;&lt;data&gt;&quot;,
                                                   templateData,
                                                   &quot;command-line&quot;,
@@ -1798,6 +2071,57 @@ gchar *osinfo_install_script_generate_command_line_for_media(OsinfoInstallScript
         if (!osinfo_install_script_apply_template(script,
                                                   os,
                                                   media,
+                                                  NULL,
+                                                  &quot;&lt;data&gt;&quot;,
+                                                  templateData,
+                                                  &quot;command-line&quot;,
+                                                  &amp;output,
+                                                  config,
+                                                  &amp;error)) {
+            g_prefix_error(&amp;error, &quot;%s&quot;, _(&quot;Failed to apply script template: &quot;));
+        }
+    }
+    g_object_unref(os);
+
+    return output;
+}
+
+/**
+ * osinfo_install_script_generate_command_line_for_tree:
+ * @script: the install script
+ * @tree:   the tree
+ * @config: the install script config
+ *
+ * Some install scripts need to pass a command line to the kernel, Such install
+ * scripts belong to OSs that provide paths to the kernel and initrd files that
+ * can be used to directly boot
+ * (<a  rel="nofollow" href="http://wiki.qemu.org/download/qemu-doc.html#direct_005flinux_005fboot">http://wiki.qemu.org/download/qemu-doc.html#direct_005flinux_005fboot</a>)
+ * the OS in order to pass the needed commandline to it.
+ *
+ * The tree @tree must have been identified successfully using
+ * #osinfo_db_identify_tree() before calling this function.
+ *
+ * Returns: (transfer full): The generated command line string, NULL otherwise.
+ */
+gchar *osinfo_install_script_generate_command_line_for_tree(OsinfoInstallScript *script,
+                                                            OsinfoTree *tree,
+                                                            OsinfoInstallConfig *config)
+{
+    const gchar *templateData = osinfo_install_script_get_template_data(script);
+    gchar *output = NULL;
+    OsinfoOs *os;
+
+    g_return_val_if_fail(tree != NULL, NULL);
+
+    os = osinfo_tree_get_os(tree);
+    g_return_val_if_fail(os != NULL, NULL);
+
+    if (templateData) {
+        GError *error = NULL;
+        if (!osinfo_install_script_apply_template(script,
+                                                  os,
+                                                  NULL,
+                                                  tree,
                                                   &quot;&lt;data&gt;&quot;,
                                                   templateData,
                                                   &quot;command-line&quot;,
diff --git a/osinfo/osinfo_install_script.h b/osinfo/osinfo_install_script.h
index 626e66c..8235aac 100644
--- a/osinfo/osinfo_install_script.h
+++ b/osinfo/osinfo_install_script.h
@@ -41,6 +41,7 @@
 
 typedef struct _OsinfoOs        OsinfoOs;
 typedef struct _OsinfoMedia     OsinfoMedia;
+typedef struct _OsinfoTree      OsinfoTree;
 typedef struct _OsinfoInstallScript        OsinfoInstallScript;
 typedef struct _OsinfoInstallScriptClass   OsinfoInstallScriptClass;
 typedef struct _OsinfoInstallScriptPrivate OsinfoInstallScriptPrivate;
@@ -251,6 +252,9 @@ gchar *osinfo_install_script_generate_command_line(OsinfoInstallScript *script,
 gchar *osinfo_install_script_generate_command_line_for_media(OsinfoInstallScript *script,
                                                              OsinfoMedia *media,
                                                              OsinfoInstallConfig *config);
+gchar *osinfo_install_script_generate_command_line_for_tree(OsinfoInstallScript *script,
+                                                            OsinfoTree *tree,
+                                                            OsinfoInstallConfig *config);
 
 gboolean osinfo_install_script_has_config_param(OsinfoInstallScript *script, OsinfoInstallConfigParam *config_param);
 
@@ -280,4 +284,36 @@ void osinfo_install_script_set_installation_source(OsinfoInstallScript *script,
                                                    OsinfoInstallScriptInstallationSource source);
 OsinfoInstallScriptInstallationSource osinfo_install_script_get_installation_source(OsinfoInstallScript *script);
 
+void osinfo_install_script_generate_for_tree_async(OsinfoInstallScript *script,
+                                                   OsinfoTree *tree,
+                                                   OsinfoInstallConfig *config,
+                                                   GCancellable *cancellable,
+                                                   GAsyncReadyCallback callback,
+                                                   gpointer user_data);
+gchar *osinfo_install_script_generate_for_tree_finish(OsinfoInstallScript *script,
+                                                      GAsyncResult *res,
+                                                      GError **error);
+gchar *osinfo_install_script_generate_for_tree(OsinfoInstallScript *script,
+                                               OsinfoTree *tree,
+                                               OsinfoInstallConfig *config,
+                                               GCancellable *cancellable,
+                                               GError **error);
+
+void osinfo_install_script_generate_output_for_tree_async(OsinfoInstallScript *script,
+                                                          OsinfoTree *tree,
+                                                          OsinfoInstallConfig *config,
+                                                          GFile *output_dir,
+                                                          GCancellable *cancellable,
+                                                          GAsyncReadyCallback callback,
+                                                          gpointer user_data);
+GFile *osinfo_install_script_generate_output_for_tree_finish(OsinfoInstallScript *script,
+                                                             GAsyncResult *res,
+                                                             GError **error);
+GFile *osinfo_install_script_generate_output_for_tree(OsinfoInstallScript *script,
+                                                      OsinfoTree *tree,
+                                                      OsinfoInstallConfig *config,
+                                                      GFile *output_dir,
+                                                      GCancellable *cancellable,
+                                                      GError **error);
+
 #endif /* __OSINFO_INSTALL_SCRIPT_H__ */
-- 
2.21.0

_______________________________________________
Libosinfo mailing list
Libosinfo@xxxxxxxxxx
<a  rel="nofollow" href="https://www.redhat.com/mailman/listinfo/libosinfo">https://www.redhat.com/mailman/listinfo/libosinfo</a>



</pre>
<!--X-Body-of-Message-End-->
<!--X-MsgBody-End-->
<!--X-Follow-Ups-->
</div>
<hr>
<!--X-Follow-Ups-End-->
<!--X-References-->
<!--X-References-End-->
<!--X-BotPNI-->
<ul>
<li>Prev by Date:
<strong><a href="msg06045.html">[libosinfo PATCH v3 7/7] spec: Drop gvfs dependency</a></strong>
</li>
<li>Next by Date:
<strong><a href="msg06047.html">Re:  [libosinfo PATCH v3 5/7] media: Use libsoup for http:// &amp; https:// requests</a></strong>
</li>
<li>Previous by thread:
<strong><a href="msg06038.html">[libosinfo PATCH v3 0/7] Drop GVFS dependency in favour	of libsoup</a></strong>
</li>
<li>Next by thread:
<strong><a href="msg06048.html">Re:  [libosinfo PATCH] install-script: Add _generate_*_for_tree()</a></strong>
</li>
<li>Index(es):
<ul>
<li><a href="maillist.html#06046"><strong>Date</strong></a></li>
<li><a href="index.html#06046"><strong>Thread</strong></a></li>
</ul>
</li>
</ul>

<!--X-BotPNI-End-->
<!--X-User-Footer-->
<center>
<font size=-1>
<a href=/lists/>[Index&nbsp;of&nbsp;Archives]</a>
&nbsp;
&nbsp;
<a href=/lists/virt-tools/>[Virt&nbsp;Tools]</a>
&nbsp;
&nbsp;
<a href=/linux/fedora/libvirt-users/>[Libvirt&nbsp;Users]</a>
&nbsp;
&nbsp;
<a href=/linux/fedora/fedora-users/>[Fedora&nbsp;Users]</a>
&nbsp;
&nbsp;
<a href=/linux/fedora/fedora-maintainers/>[Fedora&nbsp;Maintainers]</a>
&nbsp;
&nbsp;
<a href=/lists/fedora-desktop/>[Fedora&nbsp;Desktop]</a>
&nbsp;
&nbsp;
<a href=/lists/fedora-selinux/>[Fedora&nbsp;SELinux]</a>
&nbsp;
&nbsp;
<a href=http://www.ske-art.com/z/biglist.html>[Big&nbsp;List&nbsp;of&nbsp;Linux&nbsp;Books]</a>
&nbsp;
&nbsp;
<a href=https://yosemitenews.info>[Yosemite&nbsp;News]</a>
&nbsp;
&nbsp;
<a href=/lists/kde/>[KDE&nbsp;Users]</a>
</font>
</center>
<p>
<div>
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<ins class="adsbygoogle"
     style="display:block"
     data-ad-format="autorelaxed"
     data-ad-client="ca-pub-3422782820843221"
     data-ad-slot="1424524564"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
</div>
<table width=100%>
<tr>
<td align=left>&nbsp;</td>
<td align=right><a href=/lists/><img src=/button_01.gif border=0 alt="Powered by Linux"></a></td>
</tr>
</table>
<!--X-User-Footer-End-->
<script type="text/javascript"> 
 function initAddThis() {
    addthis.init()
 }
initAddThis();
</script>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-760190-1', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
