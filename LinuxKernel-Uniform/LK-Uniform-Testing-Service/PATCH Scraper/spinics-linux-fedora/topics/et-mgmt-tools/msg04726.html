<!-- MHonArc v2.6.19 -->
<!--X-Subject: [PATCH 1/3]: Add NodeDeviceParser module -->
<!--X-From-R13: Qbyr Dbovafba &#60;pebovafbNerqung.pbz> -->
<!--X-Date: Sun, 1 Mar 2009 20:44:15 &#45;0800 -->
<!--X-Message-Id: 49AB639F.6080101@redhat.com -->
<!--X-Content-Type: multipart/mixed -->
<!--X-Reference: 49AB6367.3040108@redhat.com -->
<!--X-Head-End-->
<!doctype html public "-//W3C//DTD HTML//EN">
<html>
<head>
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({
          google_ad_client: "ca-pub-3422782820843221",
          enable_page_level_ads: true
     });
</script>
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="description" content="Fedora Management Tools, [PATCH 1/3]: Add NodeDeviceParser module">
<style>
<!--
 pre {white-space: pre-wrap;}
-->
</style>
<link rel="alternate" type="application/rss+xml" title="Fedora Management Tools" href="//feedproxy.google.com/Fedora/linuxManagementTools">
<title>Fedora Management Tools -- [PATCH 1/3]: Add NodeDeviceParser module</title>
</head>
<body vlink=green>
<!--X-Body-Begin-->
<!--X-User-Header-->
<!--X-User-Header-End-->
<!--X-TopPNI-->
<form action="//www.google.com" id="cse-search-box" target="_blank">
  <div>
    <input type="hidden" name="cx" value="partner-pub-3422782820843221:9580497365" />
    <input type="hidden" name="ie" value="UTF-8" />
    <input type="text" name="q" size="25" />
    <input type="submit" name="sa" value="Search" />
  </div>
</form>
<script type="text/javascript" src="//www.google.com/coop/cse/brand?form=cse-search-box&amp;lang=en"></script>
<h1 itemprop="name">[PATCH 1/3]: Add NodeDeviceParser module</h1>
[<a href="msg04725.html">Date Prev</a>][<a href="msg04727.html">Date Next</a>][<a href="msg04725.html">Thread Prev</a>][<a href="msg04727.html">Thread Next</a>][<a href="maillist.html#04726">Date Index</a>][<a href="index.html#04726">Thread Index</a>]


<p>&nbsp;<br>
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- responsive test for archives -->
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-3422782820843221"
     data-ad-slot="6345952567"
     data-ad-format="auto"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>

<!--X-TopPNI-End-->
<!--X-MsgBody-->
<!--X-Subject-Header-Begin-->
<hr>
<!--X-Subject-Header-End-->
<!--X-Head-of-Message-->
<ul>
<li><em>Subject</em>: [PATCH 1/3]: Add NodeDeviceParser module</li>
<li><em>From</em>: Cole Robinson &lt;<a href="mailto:crobinso@DOMAIN.HIDDEN">crobinso@xxxxxxxxxx</a>&gt;</li>
<li><em>Date</em>: Sun, 01 Mar 2009 23:42:07 -0500</li>
<li><em>In-reply-to</em>: &lt;<a href="mailto:49AB6367.3040108@DOMAIN.HIDDEN">49AB6367.3040108@xxxxxxxxxx</a>&gt;</li>
<li><em>References</em>: &lt;<a href="mailto:49AB6367.3040108@DOMAIN.HIDDEN">49AB6367.3040108@xxxxxxxxxx</a>&gt;</li>
<li><em>Reply-to</em>: Fedora/Linux Management Tools &lt;<a href="mailto:et-mgmt-tools@DOMAIN.HIDDEN">et-mgmt-tools@xxxxxxxxxx</a>&gt;</li>
<li><em>User-agent</em>: Thunderbird 2.0.0.19 (X11/20090105)</li>
</ul>
<!--X-Head-of-Message-End-->
<!--X-Head-Body-Sep-Begin-->
<!-- AddThis Button BEGIN -->
<div class="addthis_toolbox addthis_default_style ">
<a class="addthis_button_preferred_1"></a>
<a class="addthis_button_preferred_2"></a>
<a class="addthis_button_preferred_3"></a>
<a class="addthis_button_preferred_4"></a>
<a class="addthis_button_compact"></a>
<a class="addthis_counter addthis_bubble_style"></a>
</div>
<script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5196c2ae1be43d18&async=1&domready=1" async></script>
<!-- AddThis Button END -->
<hr>
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- responsive link 1 -->
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-3422782820843221"
     data-ad-slot="8681825769"
     data-ad-format="link"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
<p>
<div class="content" itemprop="articleBody">
<!--X-Head-Body-Sep-End-->
<!--X-Body-of-Message-->
<pre>Add NodeDeviceParser module for parsing libvirt host device xml,
associated helper functions and tests.

Thanks,
Cole
</pre><pre># HG changeset patch
# User Cole Robinson &lt;crobinso@xxxxxxxxxx&gt;
# Node ID 391354aef31a1a8e21e43ba3799af3a79c69985e
# Parent  9f02b1bb16e2d47088ab928ccc1ba2a59d26d1c8
Add NodeDeviceParser module for parsing libvirt host device xml.

diff -r 9f02b1bb16e2 -r 391354aef31a tests/__init__.py
--- a/tests/__init__.py	Sun Mar 01 21:19:29 2009 -0500
+++ b/tests/__init__.py	Sun Mar 01 21:29:18 2009 -0500
@@ -70,4 +70,5 @@
 import storage
 import urltest
 import clonetest
+import nodedev
 
diff -r 9f02b1bb16e2 -r 391354aef31a tests/nodedev-xml/nodexml/net1.xml
--- /dev/null	Thu Jan 01 00:00:00 1970 +0000
+++ b/tests/nodedev-xml/nodexml/net1.xml	Sun Mar 01 21:29:18 2009 -0500
@@ -0,0 +1,9 @@
+&lt;device&gt;
+  &lt;name&gt;net_00_1c_25_10_b1_e4&lt;/name&gt;
+  &lt;parent&gt;pci_8086_1049&lt;/parent&gt;
+  &lt;capability type='net'&gt;
+    &lt;interface&gt;eth0&lt;/interface&gt;
+    &lt;address&gt;00:1c:25:10:b1:e4&lt;/address&gt;
+    &lt;capability type='80203'/&gt;
+  &lt;/capability&gt;
+&lt;/device&gt;
diff -r 9f02b1bb16e2 -r 391354aef31a tests/nodedev-xml/nodexml/net2.xml
--- /dev/null	Thu Jan 01 00:00:00 1970 +0000
+++ b/tests/nodedev-xml/nodexml/net2.xml	Sun Mar 01 21:29:18 2009 -0500
@@ -0,0 +1,9 @@
+&lt;device&gt;
+  &lt;name&gt;net_00_1c_bf_04_29_a4&lt;/name&gt;
+  &lt;parent&gt;pci_8086_4227&lt;/parent&gt;
+  &lt;capability type='net'&gt;
+    &lt;interface&gt;wlan0&lt;/interface&gt;
+    &lt;address&gt;00:1c:bf:04:29:a4&lt;/address&gt;
+    &lt;capability type='80211'/&gt;
+  &lt;/capability&gt;
+&lt;/device&gt;
diff -r 9f02b1bb16e2 -r 391354aef31a tests/nodedev-xml/nodexml/pci1.xml
--- /dev/null	Thu Jan 01 00:00:00 1970 +0000
+++ b/tests/nodedev-xml/nodexml/pci1.xml	Sun Mar 01 21:29:18 2009 -0500
@@ -0,0 +1,12 @@
+&lt;device&gt;
+  &lt;name&gt;pci_1180_592&lt;/name&gt;
+  &lt;parent&gt;pci_8086_2448&lt;/parent&gt;
+  &lt;capability type='pci'&gt;
+    &lt;domain&gt;0&lt;/domain&gt;
+    &lt;bus&gt;21&lt;/bus&gt;
+    &lt;slot&gt;0&lt;/slot&gt;
+    &lt;function&gt;4&lt;/function&gt;
+    &lt;product id='0x0592'&gt;R5C592 Memory Stick Bus Host Adapter&lt;/product&gt;
+    &lt;vendor id='0x1180'&gt;Ricoh Co Ltd&lt;/vendor&gt;
+  &lt;/capability&gt;
+&lt;/device&gt;
diff -r 9f02b1bb16e2 -r 391354aef31a tests/nodedev-xml/nodexml/pci2.xml
--- /dev/null	Thu Jan 01 00:00:00 1970 +0000
+++ b/tests/nodedev-xml/nodexml/pci2.xml	Sun Mar 01 21:29:18 2009 -0500
@@ -0,0 +1,12 @@
+&lt;device&gt;
+  &lt;name&gt;pci_8086_1049&lt;/name&gt;
+  &lt;parent&gt;computer&lt;/parent&gt;
+  &lt;capability type='pci'&gt;
+    &lt;domain&gt;0&lt;/domain&gt;
+    &lt;bus&gt;0&lt;/bus&gt;
+    &lt;slot&gt;25&lt;/slot&gt;
+    &lt;function&gt;0&lt;/function&gt;
+    &lt;product id='0x1049'&gt;82566MM Gigabit Network Connection&lt;/product&gt;
+    &lt;vendor id='0x8086'&gt;Intel Corporation&lt;/vendor&gt;
+  &lt;/capability&gt;
+&lt;/device&gt;
diff -r 9f02b1bb16e2 -r 391354aef31a tests/nodedev-xml/nodexml/scsibus.xml
--- /dev/null	Thu Jan 01 00:00:00 1970 +0000
+++ b/tests/nodedev-xml/nodexml/scsibus.xml	Sun Mar 01 21:29:18 2009 -0500
@@ -0,0 +1,7 @@
+&lt;device&gt;
+  &lt;name&gt;usb_device_781_5151_2004453082054CA1BEEE_if0_scsi_host_0&lt;/name&gt;
+  &lt;parent&gt;usb_device_781_5151_2004453082054CA1BEEE_if0&lt;/parent&gt;
+  &lt;capability type='scsi_host'&gt;
+    &lt;host&gt;5&lt;/host&gt;
+  &lt;/capability&gt;
+&lt;/device&gt;
diff -r 9f02b1bb16e2 -r 391354aef31a tests/nodedev-xml/nodexml/scsidev.xml
--- /dev/null	Thu Jan 01 00:00:00 1970 +0000
+++ b/tests/nodedev-xml/nodexml/scsidev.xml	Sun Mar 01 21:29:18 2009 -0500
@@ -0,0 +1,11 @@
+&lt;device&gt;
+  &lt;name&gt;usb_device_781_5151_2004453082054CA1BEEE_if0_scsi_host_0_scsi_device_lun0&lt;/name&gt;
+  &lt;parent&gt;usb_device_781_5151_2004453082054CA1BEEE_if0_scsi_host_0&lt;/parent&gt;
+  &lt;capability type='scsi'&gt;
+    &lt;host&gt;5&lt;/host&gt;
+    &lt;bus&gt;0&lt;/bus&gt;
+    &lt;target&gt;0&lt;/target&gt;
+    &lt;lun&gt;0&lt;/lun&gt;
+    &lt;type&gt;disk&lt;/type&gt;
+  &lt;/capability&gt;
+&lt;/device&gt;
diff -r 9f02b1bb16e2 -r 391354aef31a tests/nodedev-xml/nodexml/storage1.xml
--- /dev/null	Thu Jan 01 00:00:00 1970 +0000
+++ b/tests/nodedev-xml/nodexml/storage1.xml	Sun Mar 01 21:29:18 2009 -0500
@@ -0,0 +1,12 @@
+&lt;device&gt;
+  &lt;name&gt;storage_serial_SATA_WDC_WD1600AAJS__WD_WCAP95119685&lt;/name&gt;
+  &lt;parent&gt;pci_8086_27c0_scsi_host_scsi_device_lun0&lt;/parent&gt;
+  &lt;capability type='storage'&gt;
+    &lt;block&gt;/dev/sda&lt;/block&gt;
+    &lt;bus&gt;scsi&lt;/bus&gt;
+    &lt;drive_type&gt;disk&lt;/drive_type&gt;
+    &lt;model&gt;WDC WD1600AAJS-2&lt;/model&gt;
+    &lt;vendor&gt;ATA&lt;/vendor&gt;
+    &lt;size&gt;160041885696&lt;/size&gt;
+  &lt;/capability&gt;
+&lt;/device&gt;
diff -r 9f02b1bb16e2 -r 391354aef31a tests/nodedev-xml/nodexml/storage2.xml
--- /dev/null	Thu Jan 01 00:00:00 1970 +0000
+++ b/tests/nodedev-xml/nodexml/storage2.xml	Sun Mar 01 21:29:18 2009 -0500
@@ -0,0 +1,16 @@
+&lt;device&gt;
+  &lt;name&gt;storage_serial_SanDisk_Cruzer_Micro_2004453082054CA1BEEE_0_0&lt;/name&gt;
+  &lt;parent&gt;usb_device_781_5151_2004453082054CA1BEEE_if0_scsi_host_0_scsi_device_lun0&lt;/parent&gt;
+  &lt;capability type='storage'&gt;
+    &lt;block&gt;/dev/sdb&lt;/block&gt;
+    &lt;bus&gt;usb&lt;/bus&gt;
+    &lt;drive_type&gt;disk&lt;/drive_type&gt;
+    &lt;model&gt;Cruzer Micro&lt;/model&gt;
+    &lt;vendor&gt;SanDisk&lt;/vendor&gt;
+    &lt;capability type='removable'&gt;
+      &lt;media_available&gt;1&lt;/media_available&gt;
+      &lt;media_size&gt;12345678&lt;/media_size&gt;
+    &lt;/capability&gt;
+    &lt;capability type='hotpluggable' /&gt;
+  &lt;/capability&gt;
+&lt;/device&gt;
diff -r 9f02b1bb16e2 -r 391354aef31a tests/nodedev-xml/nodexml/system.xml
--- /dev/null	Thu Jan 01 00:00:00 1970 +0000
+++ b/tests/nodedev-xml/nodexml/system.xml	Sun Mar 01 21:29:18 2009 -0500
@@ -0,0 +1,17 @@
+&lt;device&gt;
+  &lt;name&gt;computer&lt;/name&gt;
+  &lt;capability type='system'&gt;
+    &lt;hardware&gt;
+      &lt;vendor&gt;LENOVO&lt;/vendor&gt;
+      &lt;version&gt;ThinkPad T61&lt;/version&gt;
+      &lt;serial&gt;L3B2616&lt;/serial&gt;
+      &lt;uuid&gt;97e80381-494f-11cb-8e0e-cbc168f7d753&lt;/uuid&gt;
+    &lt;/hardware&gt;
+    &lt;firmware&gt;
+      &lt;vendor&gt;LENOVO&lt;/vendor&gt;
+      &lt;version&gt;7LET51WW (1.21 )&lt;/version&gt;
+      &lt;release_date&gt;08/22/2007&lt;/release_date&gt;
+    &lt;/firmware&gt;
+  &lt;/capability&gt;
+&lt;/device&gt;
+
diff -r 9f02b1bb16e2 -r 391354aef31a tests/nodedev-xml/nodexml/usbbus.xml
--- /dev/null	Thu Jan 01 00:00:00 1970 +0000
+++ b/tests/nodedev-xml/nodexml/usbbus.xml	Sun Mar 01 21:29:18 2009 -0500
@@ -0,0 +1,10 @@
+&lt;device&gt;
+  &lt;name&gt;usb_device_781_5151_2004453082054CA1BEEE_if0&lt;/name&gt;
+  &lt;parent&gt;usb_device_781_5151_2004453082054CA1BEEE&lt;/parent&gt;
+  &lt;capability type='usb'&gt;
+    &lt;number&gt;0&lt;/number&gt;
+    &lt;class&gt;8&lt;/class&gt;
+    &lt;subclass&gt;6&lt;/subclass&gt;
+    &lt;protocol&gt;80&lt;/protocol&gt;
+  &lt;/capability&gt;
+&lt;/device&gt;
diff -r 9f02b1bb16e2 -r 391354aef31a tests/nodedev-xml/nodexml/usbdev1.xml
--- /dev/null	Thu Jan 01 00:00:00 1970 +0000
+++ b/tests/nodedev-xml/nodexml/usbdev1.xml	Sun Mar 01 21:29:18 2009 -0500
@@ -0,0 +1,10 @@
+&lt;device&gt;
+  &lt;name&gt;usb_device_781_5151_2004453082054CA1BEEE&lt;/name&gt;
+  &lt;parent&gt;usb_device_1d6b_2_0000_00_1a_7&lt;/parent&gt;
+  &lt;capability type='usb_device'&gt;
+    &lt;bus&gt;1&lt;/bus&gt;
+    &lt;device&gt;4&lt;/device&gt;
+    &lt;product id='0x5151'&gt;Cruzer Micro 256/512MB Flash Drive&lt;/product&gt;
+    &lt;vendor id='0x0781'&gt;SanDisk Corp.&lt;/vendor&gt;
+  &lt;/capability&gt;
+&lt;/device&gt;
diff -r 9f02b1bb16e2 -r 391354aef31a tests/nodedev-xml/nodexml/usbdev2.xml
--- /dev/null	Thu Jan 01 00:00:00 1970 +0000
+++ b/tests/nodedev-xml/nodexml/usbdev2.xml	Sun Mar 01 21:29:18 2009 -0500
@@ -0,0 +1,10 @@
+&lt;device&gt;
+  &lt;name&gt;usb_device_483_2016_noserial&lt;/name&gt;
+  &lt;parent&gt;usb_device_1d6b_1_0000_00_1a_0&lt;/parent&gt;
+  &lt;capability type='usb_device'&gt;
+    &lt;bus&gt;3&lt;/bus&gt;
+    &lt;device&gt;3&lt;/device&gt;
+    &lt;product id='0x2016'&gt;Fingerprint Reader&lt;/product&gt;
+    &lt;vendor id='0x0483'&gt;SGS Thomson Microelectronics&lt;/vendor&gt;
+  &lt;/capability&gt;
+&lt;/device&gt;
diff -r 9f02b1bb16e2 -r 391354aef31a tests/nodedev.py
--- /dev/null	Thu Jan 01 00:00:00 1970 +0000
+++ b/tests/nodedev.py	Sun Mar 01 21:29:18 2009 -0500
@@ -0,0 +1,154 @@
+#
+# This program is free software; you can redistribute it and/or modify
+# it under the terms of the GNU General Public License as published by
+# the Free  Software Foundation; either version 2 of the License, or
+# (at your option)  any later version.
+#
+# This program is distributed in the hope that it will be useful,
+# but WITHOUT ANY WARRANTY; without even the implied warranty of
+# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+# GNU General Public License for more details.
+#
+# You should have received a copy of the GNU General Public License
+# along with this program; if not, write to the Free Software
+# Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston,
+# MA 02110-1301 USA.
+
+import os.path
+import unittest
+import virtinst.NodeDeviceParser as nodeparse
+import libvirt
+
+conn = libvirt.open(&quot;test:///default&quot;)
+
+class TestNodeDev(unittest.TestCase):
+
+    def _nodeDevFromFile(self, filename):
+        xml = file(os.path.join(&quot;tests/nodedev-xml/nodexml&quot;, filename)).read()
+        return nodeparse.parse(xml)
+
+    def _testCompare(self, filename, vals):
+        dev = self._nodeDevFromFile(filename)
+
+        for attr in vals.keys():
+            self.assertEqual(vals[attr], getattr(dev, attr))
+
+    def testSystemDevice(self):
+        filename = &quot;system.xml&quot;
+        vals = {&quot;hw_vendor&quot;: &quot;LENOVO&quot;, &quot;hw_version&quot;: &quot;ThinkPad T61&quot;,
+                &quot;hw_serial&quot;: &quot;L3B2616&quot;,
+                &quot;hw_uuid&quot;: &quot;97e80381-494f-11cb-8e0e-cbc168f7d753&quot;,
+                &quot;fw_vendor&quot;: &quot;LENOVO&quot;, &quot;fw_version&quot;: &quot;7LET51WW (1.21 )&quot;,
+                &quot;fw_date&quot;: &quot;08/22/2007&quot;,
+                &quot;device_type&quot;: nodeparse.CAPABILITY_TYPE_SYSTEM,
+                &quot;name&quot;: &quot;computer&quot;, &quot;parent&quot;: None}
+        self._testCompare(filename, vals)
+
+    def testNetDevice1(self):
+        filename = &quot;net1.xml&quot;
+        vals = {&quot;name&quot;: &quot;net_00_1c_25_10_b1_e4&quot;, &quot;parent&quot;: &quot;pci_8086_1049&quot;,
+                &quot;device_type&quot;: nodeparse.CAPABILITY_TYPE_NET,
+                &quot;interface&quot;: &quot;eth0&quot;, &quot;address&quot;: &quot;00:1c:25:10:b1:e4&quot;,
+                &quot;capability_type&quot;: &quot;80203&quot;}
+        self._testCompare(filename, vals)
+
+    def testNetDevice2(self):
+        filename = &quot;net2.xml&quot;
+        vals = {&quot;name&quot;: &quot;net_00_1c_bf_04_29_a4&quot;, &quot;parent&quot;: &quot;pci_8086_4227&quot;,
+                &quot;device_type&quot;: nodeparse.CAPABILITY_TYPE_NET,
+                &quot;interface&quot;: &quot;wlan0&quot;, &quot;address&quot;: &quot;00:1c:bf:04:29:a4&quot;,
+                &quot;capability_type&quot;: &quot;80211&quot;}
+        self._testCompare(filename, vals)
+
+    def testPCIDevice1(self):
+        filename = &quot;pci1.xml&quot;
+        vals = {&quot;name&quot;: &quot;pci_1180_592&quot;, &quot;parent&quot;: &quot;pci_8086_2448&quot;,
+                &quot;device_type&quot;: nodeparse.CAPABILITY_TYPE_PCI,
+                &quot;domain&quot;: &quot;0&quot;, &quot;bus&quot;: &quot;21&quot;, &quot;slot&quot;: &quot;0&quot;, &quot;function&quot;: &quot;4&quot;,
+                &quot;product_id&quot;: &quot;0x0592&quot;, &quot;vendor_id&quot;: &quot;0x1180&quot;,
+                &quot;product_name&quot;: &quot;R5C592 Memory Stick Bus Host Adapter&quot;,
+                &quot;vendor_name&quot;: &quot;Ricoh Co Ltd&quot;,}
+        self._testCompare(filename, vals)
+
+    def testPCIDevice2(self):
+        filename = &quot;pci2.xml&quot;
+        vals = {&quot;name&quot;: &quot;pci_8086_1049&quot;, &quot;parent&quot;: &quot;computer&quot;,
+                &quot;device_type&quot;: nodeparse.CAPABILITY_TYPE_PCI,
+                &quot;domain&quot;: &quot;0&quot;, &quot;bus&quot;: &quot;0&quot;, &quot;slot&quot;: &quot;25&quot;, &quot;function&quot;: &quot;0&quot;,
+                &quot;product_id&quot;: &quot;0x1049&quot;, &quot;vendor_id&quot;: &quot;0x8086&quot;,
+                &quot;product_name&quot;: &quot;82566MM Gigabit Network Connection&quot;,
+                &quot;vendor_name&quot;: &quot;Intel Corporation&quot;,}
+        self._testCompare(filename, vals)
+
+    def testUSBDevDevice1(self):
+        filename = &quot;usbdev1.xml&quot;
+        vals = {&quot;name&quot;: &quot;usb_device_781_5151_2004453082054CA1BEEE&quot;,
+                &quot;parent&quot;: &quot;usb_device_1d6b_2_0000_00_1a_7&quot;,
+                &quot;device_type&quot;: nodeparse.CAPABILITY_TYPE_USBDEV,
+                &quot;bus&quot;: &quot;1&quot;, &quot;device&quot;: &quot;4&quot;, &quot;product_id&quot;: '0x5151',
+                &quot;vendor_id&quot;: '0x0781',
+                &quot;vendor_name&quot;: &quot;SanDisk Corp.&quot;,
+                &quot;product_name&quot;: &quot;Cruzer Micro 256/512MB Flash Drive&quot; }
+        self._testCompare(filename, vals)
+
+    def testUSBDevDevice2(self):
+        filename = &quot;usbdev2.xml&quot;
+        vals = {&quot;name&quot;: &quot;usb_device_483_2016_noserial&quot;,
+                &quot;parent&quot;: &quot;usb_device_1d6b_1_0000_00_1a_0&quot;,
+                &quot;device_type&quot;: nodeparse.CAPABILITY_TYPE_USBDEV,
+                &quot;bus&quot;: &quot;3&quot;, &quot;device&quot;: &quot;3&quot;, &quot;product_id&quot;: '0x2016',
+                &quot;vendor_id&quot;: '0x0483',
+                &quot;vendor_name&quot;: &quot;SGS Thomson Microelectronics&quot;,
+                &quot;product_name&quot;: &quot;Fingerprint Reader&quot; }
+        self._testCompare(filename, vals)
+
+    def testStorageDevice1(self):
+        filename = &quot;storage1.xml&quot;
+        vals = {&quot;name&quot;: &quot;storage_serial_SATA_WDC_WD1600AAJS__WD_WCAP95119685&quot;,
+                &quot;parent&quot;: &quot;pci_8086_27c0_scsi_host_scsi_device_lun0&quot;,
+                &quot;device_type&quot;: nodeparse.CAPABILITY_TYPE_STORAGE,
+                &quot;block&quot;: &quot;/dev/sda&quot;, &quot;bus&quot;: &quot;scsi&quot;, &quot;drive_type&quot;: &quot;disk&quot;,
+                &quot;model&quot;: &quot;WDC WD1600AAJS-2&quot;, &quot;vendor&quot;: &quot;ATA&quot;,
+                &quot;size&quot;: 160041885696, &quot;removable&quot;: False,
+                &quot;hotpluggable&quot;: False, &quot;media_available&quot;: False,
+                &quot;media_size&quot;: 0}
+        self._testCompare(filename, vals)
+
+    def testStorageDevice2(self):
+        filename = &quot;storage2.xml&quot;
+        vals = {&quot;name&quot;: &quot;storage_serial_SanDisk_Cruzer_Micro_2004453082054CA1BEEE_0_0&quot;,
+                &quot;parent&quot;: &quot;usb_device_781_5151_2004453082054CA1BEEE_if0_scsi_host_0_scsi_device_lun0&quot;,
+                &quot;device_type&quot;: nodeparse.CAPABILITY_TYPE_STORAGE,
+                &quot;block&quot;: &quot;/dev/sdb&quot;, &quot;bus&quot;: &quot;usb&quot;, &quot;drive_type&quot;: &quot;disk&quot;,
+                &quot;model&quot;: &quot;Cruzer Micro&quot;, &quot;vendor&quot;: &quot;SanDisk&quot;, &quot;size&quot;: 0,
+                &quot;removable&quot;: True, &quot;hotpluggable&quot;: True,
+                &quot;media_available&quot;: True, &quot;media_size&quot;: 12345678}
+        self._testCompare(filename, vals)
+
+    def testUSBBus(self):
+        filename = &quot;usbbus.xml&quot;
+        vals = {&quot;name&quot;: &quot;usb_device_781_5151_2004453082054CA1BEEE_if0&quot;,
+                &quot;parent&quot;: &quot;usb_device_781_5151_2004453082054CA1BEEE&quot;,
+                &quot;device_type&quot;: nodeparse.CAPABILITY_TYPE_USBBUS,
+                &quot;number&quot;: &quot;0&quot;, &quot;classval&quot;: &quot;8&quot;, &quot;subclass&quot;: &quot;6&quot;,
+                &quot;protocol&quot;: &quot;80&quot;}
+        self._testCompare(filename, vals)
+
+    def testSCSIBus(self):
+        filename = &quot;scsibus.xml&quot;
+        vals = {&quot;name&quot;: &quot;usb_device_781_5151_2004453082054CA1BEEE_if0_scsi_host_0&quot;,
+                &quot;parent&quot;: &quot;usb_device_781_5151_2004453082054CA1BEEE_if0&quot;,
+                &quot;device_type&quot;: nodeparse.CAPABILITY_TYPE_SCSIBUS,
+                &quot;host&quot;: &quot;5&quot;}
+        self._testCompare(filename, vals)
+
+    def testSCSIDevice(self):
+        filename = &quot;scsidev.xml&quot;
+        vals = {&quot;name&quot;: &quot;usb_device_781_5151_2004453082054CA1BEEE_if0_scsi_host_0_scsi_device_lun0&quot;,
+                &quot;parent&quot;: &quot;usb_device_781_5151_2004453082054CA1BEEE_if0_scsi_host_0&quot;,
+                &quot;host&quot;: &quot;5&quot;, &quot;bus&quot;: &quot;0&quot;, &quot;target&quot;: &quot;0&quot;, &quot;lun&quot;: &quot;0&quot;,
+                &quot;type&quot;: &quot;disk&quot;}
+        self._testCompare(filename, vals)
+
+if __name__ == &quot;__main__&quot;:
+    unittest.main()
diff -r 9f02b1bb16e2 -r 391354aef31a virtinst/NodeDeviceParser.py
--- /dev/null	Thu Jan 01 00:00:00 1970 +0000
+++ b/virtinst/NodeDeviceParser.py	Sun Mar 01 21:29:18 2009 -0500
@@ -0,0 +1,421 @@
+#
+# Copyright 2009  Red Hat, Inc.
+# Cole Robinson &lt;crobinso@xxxxxxxxxx&gt;
+#
+# This program is free software; you can redistribute it and/or modify
+# it under the terms of the GNU General Public License as published by
+# the Free  Software Foundation; either version 2 of the License, or
+# (at your option)  any later version.
+#
+# This program is distributed in the hope that it will be useful,
+# but WITHOUT ANY WARRANTY; without even the implied warranty of
+# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+# GNU General Public License for more details.
+#
+# You should have received a copy of the GNU General Public License
+# along with this program; if not, write to the Free Software
+# Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston,
+# MA 02110-1301 USA.
+
+import libxml2
+import libvirt
+from virtinst import _virtinst as _
+
+# class USBDevice
+
+CAPABILITY_TYPE_SYSTEM = &quot;system&quot;
+CAPABILITY_TYPE_NET = &quot;net&quot;
+CAPABILITY_TYPE_PCI = &quot;pci&quot;
+CAPABILITY_TYPE_USBDEV = &quot;usb_device&quot;
+CAPABILITY_TYPE_USBBUS = &quot;usb&quot;
+CAPABILITY_TYPE_STORAGE = &quot;storage&quot;
+CAPABILITY_TYPE_SCSIBUS = &quot;scsi_host&quot;
+CAPABILITY_TYPE_SCSIDEV = &quot;scsi&quot;
+
+class NodeDevice(object):
+    def __init__(self, node):
+        self.name = None
+        self.parent = None
+        self.device_type = None
+
+        self._parseNodeXML(node)
+
+    def getVirtualHostDevice(self, conn):
+        &quot;&quot;&quot;
+        Convert this NodeDevice to a VirtualHostDevice for attaching to a
+        guest.
+
+        @param conn: connection to pass to the VirtualHostDevice instance
+        @type conn: libvirt.virConnect
+
+        @rtype: L{virtinst.VirtualHostDevice}
+        &quot;&quot;&quot;
+        raise ValueError(_(&quot;Node device type '%s' cannot be &quot;
+                           &quot;attached.&quot;) % self.device_type)
+
+    def _parseNodeXML(self, node):
+        child = node.children
+        while child:
+            if child.name == &quot;name&quot;:
+                self.name = child.content
+            elif child.name == &quot;parent&quot;:
+                self.parent = child.content
+            elif child.name == &quot;capability&quot;:
+                self.device_type = child.prop(&quot;type&quot;)
+            child = child.next
+
+    def _getCapabilityNode(self, node):
+        child = node.children
+        while child:
+            if child.name == &quot;capability&quot;:
+                return child
+            child = child.next
+        return None
+
+    def _parseValueHelper(self, node, value_map):
+        if value_map.has_key(node.name):
+            setattr(self, value_map[node.name], node.content)
+
+    def _parseHelper(self, main_node, value_map):
+        node = main_node.children
+        while node:
+            self._parseValueHelper(node, value_map)
+            node = node.next
+
+class SystemDevice(NodeDevice):
+    def __init__(self, node):
+        NodeDevice.__init__(self, node)
+
+        self.hw_vendor = None
+        self.hw_version = None
+        self.hw_serial = None
+        self.hw_uuid = None
+
+        self.fw_vendor = None
+        self.fw_version = None
+        self.fw_date = None
+
+        self.parseXML(self._getCapabilityNode(node))
+
+    def parseXML(self, node):
+        child = node.children
+        hardware_map = {&quot;vendor&quot;: &quot;hw_vendor&quot;,
+                        &quot;version&quot;: &quot;hw_version&quot;,
+                        &quot;serial&quot;: &quot;hw_serial&quot;,
+                        &quot;uuid&quot;: &quot;hw_uuid&quot;}
+        firmware_map = {&quot;vendor&quot;: &quot;fw_vendor&quot;,
+                        &quot;version&quot;: &quot;fw_version&quot;,
+                        &quot;release_date&quot;: &quot;fw_date&quot; }
+        while child:
+            if child.name == &quot;hardware&quot;:
+                self._parseHelper(child, hardware_map)
+            elif child.name == &quot;firmware&quot;:
+                self._parseHelper(child, firmware_map)
+            child = child.next
+
+class NetDevice(NodeDevice):
+    def __init__(self, node):
+        NodeDevice.__init__(self, node)
+
+        self.interface = None
+        self.address = None
+        self.capability_type = None
+
+        self.parseXML(self._getCapabilityNode(node))
+
+    def parseXML(self, node):
+        value_map = { &quot;interface&quot; : &quot;interface&quot;,
+                      &quot;address&quot; : &quot;address&quot;, }
+        child = node.children
+        while child:
+            if child.name == &quot;capability&quot;:
+                self.capability_type = child.prop(&quot;type&quot;)
+            else:
+                self._parseValueHelper(child, value_map)
+            child = child.next
+
+class PCIDevice(NodeDevice):
+    def __init__(self, node):
+        NodeDevice.__init__(self, node)
+
+        self.domain = None
+        self.bus = None
+        self.slot = None
+        self.function = None
+
+        self.product_id = None
+        self.product_name = None
+        self.vendor_id = None
+        self.vendor_name = None
+
+        self.parseXML(self._getCapabilityNode(node))
+
+    def parseXML(self, node):
+        val_map = { &quot;domain&quot; : &quot;domain&quot;,
+                    &quot;bus&quot; : &quot;bus&quot;,
+                    &quot;slot&quot; : &quot;slot&quot;,
+                    &quot;function&quot; : &quot;function&quot; }
+        child = node.children
+        while child:
+            if child.name == &quot;vendor&quot;:
+                self.vendor_name = child.content
+                self.vendor_id = child.prop(&quot;id&quot;)
+
+            elif child.name == &quot;product&quot;:
+                self.product_name = child.content
+                self.product_id = child.prop(&quot;id&quot;)
+
+            else:
+                self._parseValueHelper(child, val_map)
+
+            child = child.next
+
+class USBDevice(NodeDevice):
+    def __init__(self, node):
+        NodeDevice.__init__(self, node)
+
+        self.bus = None
+        self.device = None
+
+        self.product_id = None
+        self.product_name = None
+        self.vendor_id = None
+        self.vendor_name = None
+
+        self.parseXML(self._getCapabilityNode(node))
+
+    def parseXML(self, node):
+        val_map = { &quot;bus&quot;: &quot;bus&quot;, &quot;device&quot;: &quot;device&quot;}
+        child = node.children
+        while child:
+            if child.name == &quot;vendor&quot;:
+                self.vendor_name = child.content
+                self.vendor_id = child.prop(&quot;id&quot;)
+
+            elif child.name == &quot;product&quot;:
+                self.product_name = child.content
+                self.product_id = child.prop(&quot;id&quot;)
+
+            else:
+                self._parseValueHelper(child, val_map)
+
+            child = child.next
+
+class StorageDevice(NodeDevice):
+    def __init__(self, node):
+        NodeDevice.__init__(self, node)
+
+        self.block = None
+        self.bus = None
+        # FIXME: Map this to virtinst.device?
+        self.drive_type = None
+        self.size = 0
+
+        self.model = None
+        self.vendor = None
+
+        self.removable = False
+        self.media_available = False
+        self.media_size = 0
+
+        self.hotpluggable = False
+
+        self.parseXML(self._getCapabilityNode(node))
+
+    def parseXML(self, node):
+        val_map = { &quot;block&quot; : &quot;block&quot;,
+                    &quot;bus&quot; : &quot;bus&quot;,
+                    &quot;drive_type&quot; : &quot;drive_type&quot;,
+                    &quot;model&quot; : &quot;model&quot;,
+                    &quot;vendor&quot; : &quot;vendor&quot;}
+        child = node.children
+        while child:
+            if child.name == &quot;size&quot;:
+                self.size = int(child.content)
+            elif child.name == &quot;capability&quot;:
+
+                captype = child.prop(&quot;type&quot;)
+                if captype == &quot;hotpluggable&quot;:
+                    self.hotpluggable = True
+                elif captype == &quot;removable&quot;:
+                    self.removable = True
+                    rmchild = child.children
+                    while rmchild:
+                        if rmchild.name == &quot;media_available&quot;:
+                            self.media_available = bool(int(rmchild.content))
+                        elif rmchild.name == &quot;media_size&quot;:
+                            self.media_size = int(rmchild.content)
+                        rmchild = rmchild.next
+            else:
+                self._parseValueHelper(child, val_map)
+
+            child = child.next
+
+class USBBus(NodeDevice):
+    def __init__(self, node):
+        NodeDevice.__init__(self, node)
+
+        self.number = None
+        self.classval = None
+        self.subclass = None
+        self.protocol = None
+
+        self.parseXML(self._getCapabilityNode(node))
+
+    def parseXML(self, node):
+        val_map = { &quot;number&quot; : &quot;number&quot;,
+                    &quot;class&quot; : &quot;classval&quot;,
+                    &quot;subclass&quot; : &quot;subclass&quot;,
+                    &quot;protocol&quot; : &quot;protocol&quot; }
+        self._parseHelper(node, val_map)
+
+class SCSIDevice(NodeDevice):
+    def __init__(self, node):
+        NodeDevice.__init__(self, node)
+
+        self.host = None
+        self.bus = None
+        self.target = None
+        self.lun = None
+        self.disk = None
+
+        self.parseXML(self._getCapabilityNode(node))
+
+    def parseXML(self, node):
+        val_map = { &quot;host&quot; : &quot;host&quot;,
+                    &quot;bus&quot; : &quot;bus&quot;,
+                    &quot;target&quot;: &quot;target&quot;,
+                    &quot;lun&quot; : &quot;lun&quot;,
+                    &quot;type&quot; : &quot;type&quot;}
+        self._parseHelper(node, val_map)
+
+class SCSIBus(NodeDevice):
+    def __init__(self, node):
+        NodeDevice.__init__(self, node)
+
+        self.host = None
+
+        self.parseXML(self._getCapabilityNode(node))
+
+    def parseXML(self, node):
+        val_map = { &quot;host&quot; : &quot;host&quot; }
+        self._parseHelper(node, val_map)
+
+
+def is_nodedev_capable(conn):
+    &quot;&quot;&quot;
+    Check if the passed libvirt connection supports host device routines
+
+    @param conn: Connection to check
+    @type conn: libvirt.virConnect
+
+    @rtype: C{bool}
+    &quot;&quot;&quot;
+    if not conn:
+        return False
+    if not isinstance(conn, libvirt.virConnect):
+        raise ValueError(_(&quot;'conn' must be a virConnect instance.&quot;))
+
+    if dir(libvirt).count(&quot;virNodeDevice&quot;) == 0:
+        # Local libvirt doesn't support it
+        return False
+
+    try:
+        conn.listDevices(None, 0)
+        return True
+    except Exception, e:
+        if (e.get_error_code() == libvirt.VIR_ERR_RPC or
+            e.get_error_code() == libvirt.VIR_ERR_NO_SUPPORT):
+            return False
+
+    return True
+
+def lookupNodeName(conn, name):
+    &quot;&quot;&quot;
+    Convert the passed libvirt node device name to a NodeDevice
+    instance, with proper error reporting.
+
+    @param conn: libvirt.virConnect instance to perform the lookup on
+    @param name: libvirt node device name to lookup
+
+    @rtype: L{NodeDevice} instance
+    &quot;&quot;&quot;
+
+    if not is_nodedev_capable(conn):
+        raise ValueError(_(&quot;Connection does not support host device &quot;
+                           &quot;enumeration.&quot;))
+
+    nodedev = conn.nodeDeviceLookupByName(name)
+    xml = nodedev.XMLDesc(0)
+    return parse(xml)
+
+
+def parse(xml):
+    &quot;&quot;&quot;
+    Convert the passed libvirt node device xml into a NodeDevice object
+
+    @param xml: libvirt node device xml
+    @type xml: C{str}
+
+    @returns: L{NodeDevice} instance
+    &quot;&quot;&quot;
+
+    class ErrorHandler:
+        def __init__(self):
+            self.msg = &quot;&quot;
+        def handler(self, ignore, s):
+            self.msg += s
+    error = ErrorHandler()
+    libxml2.registerErrorHandler(error.handler, None)
+
+    try:
+        # try/except/finally is only available in python-2.5
+        try:
+            doc = libxml2.readMemory(xml, len(xml),
+                                     None, None,
+                                     libxml2.XML_PARSE_NOBLANKS)
+        except (libxml2.parserError, libxml2.treeError), e:
+            raise ValueError(&quot;%s\n%s&quot; % (e, error.msg))
+    finally:
+        libxml2.registerErrorHandler(None, None)
+
+    try:
+        root = doc.getRootElement()
+        if root.name != &quot;device&quot;:
+            raise ValueError(&quot;Root element is not 'device'&quot;)
+
+        t = _findNodeType(root)
+        devclass = _typeToDeviceClass(t)
+        device = devclass(root)
+    finally:
+        doc.freeDoc()
+
+    return device
+
+def _findNodeType(node):
+    child = node.children
+    while child:
+        if child.name == &quot;capability&quot;:
+            return child.prop(&quot;type&quot;)
+        child = child.next
+    return None
+
+def _typeToDeviceClass(t):
+    if t == CAPABILITY_TYPE_SYSTEM:
+        return SystemDevice
+    elif t == CAPABILITY_TYPE_NET:
+        return NetDevice
+    elif t == CAPABILITY_TYPE_PCI:
+        return PCIDevice
+    elif t == CAPABILITY_TYPE_USBDEV:
+        return USBDevice
+    elif t == CAPABILITY_TYPE_USBBUS:
+        return USBBus
+    elif t == CAPABILITY_TYPE_STORAGE:
+        return StorageDevice
+    elif t == CAPABILITY_TYPE_SCSIBUS:
+        return SCSIBus
+    elif t == CAPABILITY_TYPE_SCSIDEV:
+        return SCSIDevice
+
+    raise ValueError(_(&quot;Unknown host device capability '%s'.&quot;) % t)
</pre><pre>_______________________________________________
et-mgmt-tools mailing list
et-mgmt-tools@xxxxxxxxxx
<a  rel="nofollow" href="https://www.redhat.com/mailman/listinfo/et-mgmt-tools">https://www.redhat.com/mailman/listinfo/et-mgmt-tools</a></pre>
<!--X-Body-of-Message-End-->
<!--X-MsgBody-End-->
<!--X-Follow-Ups-->
</div>
<hr>
<!--X-Follow-Ups-End-->
<!--X-References-->
<ul><li><strong>References</strong>:
<ul>
<li><strong><a name="04725" href="msg04725.html">[PATCH 0/3] virt-install: support host device	assignment</a></strong>
<ul><li><em>From:</em> Cole Robinson</li></ul></li>
</ul></li></ul>
<!--X-References-End-->
<!--X-BotPNI-->
<ul>
<li>Prev by Date:
<strong><a href="msg04725.html">[PATCH 0/3] virt-install: support host device	assignment</a></strong>
</li>
<li>Next by Date:
<strong><a href="msg04727.html">[PATCH 2/3]: Add VirtualHostDevice classes</a></strong>
</li>
<li>Previous by thread:
<strong><a href="msg04725.html">[PATCH 0/3] virt-install: support host device	assignment</a></strong>
</li>
<li>Next by thread:
<strong><a href="msg04727.html">[PATCH 2/3]: Add VirtualHostDevice classes</a></strong>
</li>
<li>Index(es):
<ul>
<li><a href="maillist.html#04726"><strong>Date</strong></a></li>
<li><a href="index.html#04726"><strong>Thread</strong></a></li>
</ul>
</li>
</ul>

<!--X-BotPNI-End-->
<!--X-User-Footer-->
<center>
<font size=-1>
<a href=/lists/>[Index&nbsp;of&nbsp;Archives]</a>
&nbsp;
&nbsp;
<a href=/linux/fedora/fedora-users/>[Fedora&nbsp;Users]</a>
&nbsp;
&nbsp;
<a href=/lists/fll/>[Fedora&nbsp;Legacy&nbsp;List]</a>
&nbsp;
&nbsp;
<a href=/linux/fedora/fedora-maintainers/>[Fedora&nbsp;Maintainers]</a>
&nbsp;
&nbsp;
<a href=/lists/fedora-desktop/>[Fedora&nbsp;Desktop]</a>
&nbsp;
&nbsp;
<a href=/lists/fedora-selinux/>[Fedora&nbsp;SELinux]</a>
&nbsp;
&nbsp;
<a href=http://www.ske-art.com/z/biglist.html>[Big&nbsp;List&nbsp;of&nbsp;Linux&nbsp;Books]</a>
&nbsp;
&nbsp;
<a href=https://yosemitenews.info>[Yosemite&nbsp;News]</a>
&nbsp;
&nbsp;
<a href=/lists/kde/>[KDE&nbsp;Users]</a>
&nbsp;
&nbsp;
<a href=/lists/fedora-tools/>[Fedora&nbsp;Tools]</a>
</font>
</center>
<hr>
<p>
<div>
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<ins class="adsbygoogle"
     style="display:block"
     data-ad-format="autorelaxed"
     data-ad-client="ca-pub-3422782820843221"
     data-ad-slot="1424524564"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
</div>
<table width=100%>
<tr>
<td align=left>&nbsp;</td>
<td align=right><a href=/lists/><img src=/button_01.gif border=0 alt="Powered by Linux"></a></td>
</tr>
</table>
<!--X-User-Footer-End-->
<script type="text/javascript"> 
 function initAddThis() {
    addthis.init()
 }
initAddThis();
</script>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-760190-1', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
