<!-- MHonArc v2.6.19 -->
<!--X-Subject: [PATCH 1/2] Add new ImportInstaller class -->
<!--X-From-R13: Qbyr Dbovafba &#60;pebovafbNerqung.pbz> -->
<!--X-Date: Wed, 18 Feb 2009 18:46:01 &#45;0800 -->
<!--X-Message-Id: 499CC75B.9000203@redhat.com -->
<!--X-Content-Type: multipart/mixed -->
<!--X-Reference: 499CC728.8060101@redhat.com -->
<!--X-Head-End-->
<!doctype html public "-//W3C//DTD HTML//EN">
<html>
<head>
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({
          google_ad_client: "ca-pub-3422782820843221",
          enable_page_level_ads: true
     });
</script>
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="description" content="Fedora Management Tools, [PATCH 1/2] Add new ImportInstaller class">
<style>
<!--
 pre {white-space: pre-wrap;}
-->
</style>
<link rel="alternate" type="application/rss+xml" title="Fedora Management Tools" href="//feedproxy.google.com/Fedora/linuxManagementTools">
<title>Fedora Management Tools -- [PATCH 1/2] Add new ImportInstaller class</title>
</head>
<body vlink=green>
<!--X-Body-Begin-->
<!--X-User-Header-->
<!--X-User-Header-End-->
<!--X-TopPNI-->
<form action="//www.google.com" id="cse-search-box" target="_blank">
  <div>
    <input type="hidden" name="cx" value="partner-pub-3422782820843221:9580497365" />
    <input type="hidden" name="ie" value="UTF-8" />
    <input type="text" name="q" size="25" />
    <input type="submit" name="sa" value="Search" />
  </div>
</form>
<script type="text/javascript" src="//www.google.com/coop/cse/brand?form=cse-search-box&amp;lang=en"></script>
<h1 itemprop="name">[PATCH 1/2] Add new ImportInstaller class</h1>
[<a href="msg04687.html">Date Prev</a>][<a href="msg04689.html">Date Next</a>][<a href="msg04687.html">Thread Prev</a>][<a href="msg04689.html">Thread Next</a>][<a href="maillist.html#04688">Date Index</a>][<a href="index.html#04688">Thread Index</a>]


<p>&nbsp;<br>
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- responsive test for archives -->
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-3422782820843221"
     data-ad-slot="6345952567"
     data-ad-format="auto"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>

<!--X-TopPNI-End-->
<!--X-MsgBody-->
<!--X-Subject-Header-Begin-->
<hr>
<!--X-Subject-Header-End-->
<!--X-Head-of-Message-->
<ul>
<li><em>Subject</em>: [PATCH 1/2] Add new ImportInstaller class</li>
<li><em>From</em>: Cole Robinson &lt;<a href="mailto:crobinso@DOMAIN.HIDDEN">crobinso@xxxxxxxxxx</a>&gt;</li>
<li><em>Date</em>: Wed, 18 Feb 2009 21:43:39 -0500</li>
<li><em>In-reply-to</em>: &lt;<a href="mailto:499CC728.8060101@DOMAIN.HIDDEN">499CC728.8060101@xxxxxxxxxx</a>&gt;</li>
<li><em>References</em>: &lt;<a href="mailto:499CC728.8060101@DOMAIN.HIDDEN">499CC728.8060101@xxxxxxxxxx</a>&gt;</li>
<li><em>Reply-to</em>: Fedora/Linux Management Tools &lt;<a href="mailto:et-mgmt-tools@DOMAIN.HIDDEN">et-mgmt-tools@xxxxxxxxxx</a>&gt;</li>
<li><em>User-agent</em>: Thunderbird 2.0.0.19 (X11/20090105)</li>
</ul>
<!--X-Head-of-Message-End-->
<!--X-Head-Body-Sep-Begin-->
<!-- AddThis Button BEGIN -->
<div class="addthis_toolbox addthis_default_style ">
<a class="addthis_button_preferred_1"></a>
<a class="addthis_button_preferred_2"></a>
<a class="addthis_button_preferred_3"></a>
<a class="addthis_button_preferred_4"></a>
<a class="addthis_button_compact"></a>
<a class="addthis_counter addthis_bubble_style"></a>
</div>
<script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5196c2ae1be43d18&async=1&domready=1" async></script>
<!-- AddThis Button END -->
<hr>
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- responsive link 1 -->
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-3422782820843221"
     data-ad-slot="8681825769"
     data-ad-format="link"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
<p>
<div class="content" itemprop="articleBody">
<!--X-Head-Body-Sep-End-->
<!--X-Body-of-Message-->
<pre>This patch adds a new ImportInstaller class, as well as test suite
changes to exercise the new code.

Thanks,
Cole

</pre><pre># HG changeset patch
# User Cole Robinson &lt;crobinso@xxxxxxxxxx&gt;
# Date 1235006163 18000
# Node ID 38db2ccaff913afb4c4ef823e58f2ce7d609b73f
# Parent  ef6c4d5ed38687ef5d42eb2a5d1c66edd8c7077a
Add ImportInstaller class.

Used for creating guest xml around an existing disk image. Just uses the
first Guest disk device as the assumed boot device.

diff -r ef6c4d5ed386 -r 38db2ccaff91 tests/pylint-virtinst.sh
--- a/tests/pylint-virtinst.sh	Wed Feb 18 19:52:11 2009 -0500
+++ b/tests/pylint-virtinst.sh	Wed Feb 18 20:16:03 2009 -0500
@@ -46,7 +46,7 @@
 PROT_MEM_BUGS=&quot;protected member (_lookup_osdict_key|_OS_TYPES|_prepare_install|_create_devices|_install_disks)&quot;
 
 # Scattered examples of legitimately unused arguments
-UNUSED_ARGS=&quot;(SuseDistro|SolarisDistro).isValidStore.*Unused argument 'progresscb'|LiveCDInstaller.prepare.*Unused argument|ImageInstaller.prepare.*Unused argument|post_install_check.*Unused argument 'guest'|Guest.__init__.*Unused argument 'type'&quot;
+UNUSED_ARGS=&quot;(SuseDistro|SolarisDistro).isValidStore.*Unused argument 'progresscb'|.*Installer.prepare.*Unused argument|post_install_check.*Unused argument 'guest'|Guest.__init__.*Unused argument 'type'&quot;
 
 # Outside __init__ checks throw false positives with distutils custom commands
 # tests.storage also invokes false positives using hasattr
diff -r ef6c4d5ed386 -r 38db2ccaff91 tests/xmlconfig-xml/install-fullyvirt-import.xml
--- /dev/null	Thu Jan 01 00:00:00 1970 +0000
+++ b/tests/xmlconfig-xml/install-fullyvirt-import.xml	Wed Feb 18 20:16:03 2009 -0500
@@ -0,0 +1,29 @@
+&lt;domain type='xen'&gt;
+  &lt;name&gt;TestGuest&lt;/name&gt;
+  &lt;currentMemory&gt;204800&lt;/currentMemory&gt;
+  &lt;memory&gt;409600&lt;/memory&gt;
+  &lt;uuid&gt;12345678-1234-1234-1234-123456789012&lt;/uuid&gt;
+  &lt;os&gt;
+    &lt;type arch='i686'&gt;hvm&lt;/type&gt;
+    &lt;loader&gt;/usr/lib/xen/boot/hvmloader&lt;/loader&gt;
+    &lt;boot dev='hd'/&gt;
+  &lt;/os&gt;
+  &lt;features&gt;
+    &lt;acpi/&gt;&lt;apic/&gt;
+  &lt;/features&gt;
+  &lt;clock offset=&quot;utc&quot;/&gt;
+  &lt;on_poweroff&gt;destroy&lt;/on_poweroff&gt;
+  &lt;on_reboot&gt;restart&lt;/on_reboot&gt;
+  &lt;on_crash&gt;restart&lt;/on_crash&gt;
+  &lt;vcpu&gt;5&lt;/vcpu&gt;
+  &lt;devices&gt;
+    &lt;emulator&gt;/usr/lib/xen/bin/qemu-dm&lt;/emulator&gt;
+    &lt;console type='pty'/&gt;
+    &lt;disk type='file' device='disk'&gt;
+      &lt;source file='/tmp/test.img'/&gt;
+      &lt;target dev='hda' bus='ide'/&gt;
+    &lt;/disk&gt;
+    &lt;input type='mouse' bus='ps2'/&gt;
+    &lt;graphics type='sdl' display=':3.4' xauth='/testdir/.Xauthority'/&gt;
+  &lt;/devices&gt;
+&lt;/domain&gt;
diff -r ef6c4d5ed386 -r 38db2ccaff91 tests/xmlconfig-xml/install-paravirt-import.xml
--- /dev/null	Thu Jan 01 00:00:00 1970 +0000
+++ b/tests/xmlconfig-xml/install-paravirt-import.xml	Wed Feb 18 20:16:03 2009 -0500
@@ -0,0 +1,19 @@
+&lt;domain type='xen'&gt;
+  &lt;name&gt;TestGuest&lt;/name&gt;
+  &lt;currentMemory&gt;204800&lt;/currentMemory&gt;
+  &lt;memory&gt;409600&lt;/memory&gt;
+  &lt;uuid&gt;12345678-1234-1234-1234-123456789012&lt;/uuid&gt;
+  &lt;bootloader&gt;/usr/bin/pygrub&lt;/bootloader&gt;
+  &lt;on_poweroff&gt;destroy&lt;/on_poweroff&gt;
+  &lt;on_reboot&gt;restart&lt;/on_reboot&gt;
+  &lt;on_crash&gt;restart&lt;/on_crash&gt;
+  &lt;vcpu&gt;5&lt;/vcpu&gt;
+  &lt;devices&gt;
+    &lt;disk type='file' device='disk'&gt;
+      &lt;source file='/tmp/test.img'/&gt;
+      &lt;target dev='xvda' bus='xen'/&gt;
+    &lt;/disk&gt;
+    &lt;input type='mouse' bus='xen'/&gt;
+    &lt;graphics type='vnc' port='-1' keymap='ja'/&gt;
+  &lt;/devices&gt;
+&lt;/domain&gt;
diff -r ef6c4d5ed386 -r 38db2ccaff91 tests/xmlconfig.py
--- a/tests/xmlconfig.py	Wed Feb 18 19:52:11 2009 -0500
+++ b/tests/xmlconfig.py	Wed Feb 18 20:16:03 2009 -0500
@@ -70,6 +70,8 @@
             # Should probably break this out into a separate function
             dom = xenguest.conn.defineXML(actualXML)
             dom.create()
+            dom.destroy()
+            dom.undefine()
         finally:
             xenguest.installer.cleanup()
 
@@ -230,6 +232,20 @@
                                                location=&quot;/dev/loop0&quot;)
         self._compare(g, &quot;install-fullyvirt-livecd&quot;, False)
 
+    def testInstallFVImport(self):
+        g = get_basic_fullyvirt_guest()
+        g.disks.append(get_filedisk())
+        g.installer = virtinst.ImportInstaller(type=&quot;xen&quot;, os_type=&quot;hvm&quot;,
+                                               conn=g.conn)
+        self._compare(g, &quot;install-fullyvirt-import&quot;, False)
+
+    def testInstallPVImport(self):
+        g = get_basic_paravirt_guest()
+        g.disks.append(get_filedisk())
+        g.installer = virtinst.ImportInstaller(type=&quot;xen&quot;, os_type=&quot;xen&quot;,
+                                               conn=g.conn)
+        self._compare(g, &quot;install-paravirt-import&quot;, False)
+
     def testXMLEscaping(self):
         g = get_basic_fullyvirt_guest()
         g.disks.append(get_filedisk(&quot;/tmp/ISO&amp;'&amp;s&quot;))
diff -r ef6c4d5ed386 -r 38db2ccaff91 virtinst/ImportInstaller.py
--- /dev/null	Thu Jan 01 00:00:00 1970 +0000
+++ b/virtinst/ImportInstaller.py	Wed Feb 18 20:16:03 2009 -0500
@@ -0,0 +1,63 @@
+#
+# Copyright 2009 Red Hat, Inc.
+# Cole Robinson &lt;crobinso@xxxxxxxxxx&gt;
+#
+# This program is free software; you can redistribute it and/or modify
+# it under the terms of the GNU General Public License as published by
+# the Free  Software Foundation; either version 2 of the License, or
+# (at your option)  any later version.
+#
+# This program is distributed in the hope that it will be useful,
+# but WITHOUT ANY WARRANTY; without even the implied warranty of
+# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+# GNU General Public License for more details.
+#
+# You should have received a copy of the GNU General Public License
+# along with this program; if not, write to the Free Software
+# Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston,
+# MA 02110-1301 USA.
+
+import Installer
+from VirtualDisk import VirtualDisk
+
+class ImportInstaller(Installer.Installer):
+    &quot;&quot;&quot;
+    Create a Guest around an existing disk device, and perform no 'install'
+    stage.
+
+    ImportInstaller sets the Guest's boot device to that of the first disk
+    attached to the Guest (so, one of 'hd', 'cdrom', or 'floppy'). All the
+    user has to do is fill in the Guest object with the desired parameters.
+    &quot;&quot;&quot;
+
+    # General Installer methods
+
+    def prepare(self, guest, meter, distro = None):
+        if len(guest.disks) == 0:
+            raise ValueError(_(&quot;A disk device must be specified.&quot;))
+
+    def get_install_xml(self, guest, isinstall):
+        if isinstall:
+            # Signifies to the 'Guest' that there is no 'install' phase
+            return None
+        else:
+            bootdev = self._disk_to_bootdev(guest.disks[0])
+
+        return self._get_osblob_helper(isinstall=isinstall, guest=guest,
+                                       kernel=None, bootdev=bootdev)
+
+    def post_install_check(self, guest):
+        return True
+
+
+    # Private methods
+
+    def _disk_to_bootdev(self, disk):
+        if disk.device == VirtualDisk.DEVICE_DISK:
+            return &quot;hd&quot;
+        elif disk.device == VirtualDisk.DEVICE_CDROM:
+            return &quot;cdrom&quot;
+        elif disk.device == VirtualDisk.DEVICE_FLOPPY:
+            return &quot;floppy&quot;
+        else:
+            return &quot;hd&quot;
diff -r ef6c4d5ed386 -r 38db2ccaff91 virtinst/ParaVirtGuest.py
--- a/virtinst/ParaVirtGuest.py	Wed Feb 18 19:52:11 2009 -0500
+++ b/virtinst/ParaVirtGuest.py	Wed Feb 18 20:16:03 2009 -0500
@@ -21,7 +21,6 @@
 
 from Guest import Guest
 from DistroInstaller import DistroInstaller
-from virtinst import _virtinst as _
 
 class ParaVirtGuest(Guest):
     def __init__(self, type=None, connection=None, hypervisorURI=None,
@@ -35,11 +34,6 @@
     def _get_input_device(self):
         return (&quot;mouse&quot;, &quot;xen&quot;)
 
-    def validate_parms(self):
-        if not self.location and not self.boot:
-            raise ValueError, _(&quot;A location must be specified to install from&quot;)
-        Guest.validate_parms(self)
-
     def _get_disk_xml(self, install = True):
         &quot;&quot;&quot;Get the disk config in the libvirt XML format&quot;&quot;&quot;
         ret = &quot;&quot;
diff -r ef6c4d5ed386 -r 38db2ccaff91 virtinst/__init__.py
--- a/virtinst/__init__.py	Wed Feb 18 19:52:11 2009 -0500
+++ b/virtinst/__init__.py	Wed Feb 18 20:16:03 2009 -0500
@@ -37,6 +37,7 @@
 from DistroInstaller import DistroInstaller
 from PXEInstaller import PXEInstaller
 from LiveCDInstaller import LiveCDInstaller
+from ImportInstaller import ImportInstaller
 from ImageManager import ImageInstaller
 from CloneManager import CloneDesign
 from User import User
@@ -47,4 +48,5 @@
            &quot;XenNetworkInterface&quot;, &quot;VirtualGraphics&quot;, &quot;VirtualAudio&quot;,
            &quot;VirtualDisk&quot;, &quot;XenDisk&quot;, &quot;FullVirtGuest&quot;, &quot;ParaVirtGuest&quot;,
            &quot;DistroInstaller&quot;, &quot;PXEInstaller&quot;, &quot;LiveCDInstaller&quot;,
-           &quot;ImageInstaller&quot;, &quot;CloneDesign&quot;, &quot;Storage&quot;, &quot;User&quot;, &quot;util&quot;]
+           &quot;ImportInstaller&quot;, &quot;ImageInstaller&quot;, &quot;CloneDesign&quot;, &quot;Storage&quot;,
+           &quot;User&quot;, &quot;util&quot;]
</pre><pre>_______________________________________________
et-mgmt-tools mailing list
et-mgmt-tools@xxxxxxxxxx
<a  rel="nofollow" href="https://www.redhat.com/mailman/listinfo/et-mgmt-tools">https://www.redhat.com/mailman/listinfo/et-mgmt-tools</a></pre>
<!--X-Body-of-Message-End-->
<!--X-MsgBody-End-->
<!--X-Follow-Ups-->
</div>
<hr>
<!--X-Follow-Ups-End-->
<!--X-References-->
<ul><li><strong>References</strong>:
<ul>
<li><strong><a name="04687" href="msg04687.html">[PATCH 0/2] Add virt-install --import option</a></strong>
<ul><li><em>From:</em> Cole Robinson</li></ul></li>
</ul></li></ul>
<!--X-References-End-->
<!--X-BotPNI-->
<ul>
<li>Prev by Date:
<strong><a href="msg04687.html">[PATCH 0/2] Add virt-install --import option</a></strong>
</li>
<li>Next by Date:
<strong><a href="msg04689.html">[PATCH 2/2] Add virt-install --import option</a></strong>
</li>
<li>Previous by thread:
<strong><a href="msg04687.html">[PATCH 0/2] Add virt-install --import option</a></strong>
</li>
<li>Next by thread:
<strong><a href="msg04689.html">[PATCH 2/2] Add virt-install --import option</a></strong>
</li>
<li>Index(es):
<ul>
<li><a href="maillist.html#04688"><strong>Date</strong></a></li>
<li><a href="index.html#04688"><strong>Thread</strong></a></li>
</ul>
</li>
</ul>

<!--X-BotPNI-End-->
<!--X-User-Footer-->
<center>
<font size=-1>
<a href=/lists/>[Index&nbsp;of&nbsp;Archives]</a>
&nbsp;
&nbsp;
<a href=/linux/fedora/fedora-users/>[Fedora&nbsp;Users]</a>
&nbsp;
&nbsp;
<a href=/lists/fll/>[Fedora&nbsp;Legacy&nbsp;List]</a>
&nbsp;
&nbsp;
<a href=/linux/fedora/fedora-maintainers/>[Fedora&nbsp;Maintainers]</a>
&nbsp;
&nbsp;
<a href=/lists/fedora-desktop/>[Fedora&nbsp;Desktop]</a>
&nbsp;
&nbsp;
<a href=/lists/fedora-selinux/>[Fedora&nbsp;SELinux]</a>
&nbsp;
&nbsp;
<a href=http://www.ske-art.com/z/biglist.html>[Big&nbsp;List&nbsp;of&nbsp;Linux&nbsp;Books]</a>
&nbsp;
&nbsp;
<a href=https://yosemitenews.info>[Yosemite&nbsp;News]</a>
&nbsp;
&nbsp;
<a href=/lists/kde/>[KDE&nbsp;Users]</a>
&nbsp;
&nbsp;
<a href=/lists/fedora-tools/>[Fedora&nbsp;Tools]</a>
</font>
</center>
<hr>
<p>
<div>
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<ins class="adsbygoogle"
     style="display:block"
     data-ad-format="autorelaxed"
     data-ad-client="ca-pub-3422782820843221"
     data-ad-slot="1424524564"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
</div>
<table width=100%>
<tr>
<td align=left>&nbsp;</td>
<td align=right><a href=/lists/><img src=/button_01.gif border=0 alt="Powered by Linux"></a></td>
</tr>
</table>
<!--X-User-Footer-End-->
<script type="text/javascript"> 
 function initAddThis() {
    addthis.init()
 }
initAddThis();
</script>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-760190-1', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
