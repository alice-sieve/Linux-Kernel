<!-- MHonArc v2.6.19 -->
<!--X-Subject: [PATCH 23/26] drm/amdgpu/dm: Resume short HPD IRQs before resuming MST topology -->
<!--X-From-R13: Zlhqr Bnhy &#60;ylhqrNerqung.pbz> -->
<!--X-Date: Wed, 17 Jul 2019 18:45:27 &#45;0700 -->
<!--X-Message-Id: 20190718014329.8107&#45;24&#45;lyude@redhat.com -->
<!--X-Content-Type: text/plain -->
<!--X-Reference: 20190718014329.8107&#45;1&#45;lyude@redhat.com -->
<!--X-Head-End-->
<!doctype html public "-//W3C//DTD HTML//EN">
<html>
<head>
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({
          google_ad_client: "ca-pub-3422782820843221",
          enable_page_level_ads: true
     });
</script>
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="description" content="AMD GFX: [PATCH 23/26] drm/amdgpu/dm: Resume short HPD IRQs before resuming MST topology">
<style>
<!--
 pre {white-space: pre-wrap;}
-->
</style>
<title>[PATCH 23/26] drm/amdgpu/dm: Resume short HPD IRQs before resuming MST topology &mdash; Linux AMD GFX</title>
<link rel="alternate" type="application/rss+xml" title="Linux AMD GFX" href="//feeds.feedburner.com/LinuxAmdGraphics">
</head>
<body itemscope itemtype="//schema.org/Article" bgcolor=white vlink=green link=blue>
<!--X-Body-Begin-->
<!--X-User-Header-->
<!--X-User-Header-End-->
<!--X-TopPNI-->
<form action="//www.google.com" id="cse-search-box" target="_blank">
  <div>
    <input type="hidden" name="cx" value="partner-pub-3422782820843221:9580497365" />
    <input type="hidden" name="ie" value="UTF-8" />
    <input type="text" name="q" size="25" />
    <input type="submit" name="sa" value="Search" />
  </div>
</form>
<script type="text/javascript" src="//www.google.com/coop/cse/brand?form=cse-search-box&amp;lang=en" async defer></script>
<h1 itemprop="name">[PATCH 23/26] drm/amdgpu/dm: Resume short HPD IRQs before resuming MST topology</h1>
[<a href="msg36136.html">Date Prev</a>][<a href="msg36138.html">Date Next</a>][<a href="msg36136.html">Thread Prev</a>][<a href="msg36138.html">Thread Next</a>][<a href="maillist.html#36137">Date Index</a>][<a href="index.html#36137">Thread Index</a>]


<p>&nbsp;<br>
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- responsive test for archives -->
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-3422782820843221"
     data-ad-slot="6345952567"
     data-ad-format="auto"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>

<!--X-TopPNI-End-->
<!--X-MsgBody-->
<!--X-Subject-Header-Begin-->
<hr>
<!--X-Subject-Header-End-->
<!--X-Head-of-Message-->
<ul>
<li><em>To</em>: dri-devel@xxxxxxxxxxxxxxxxxxxxx</li>
<li><em>Subject</em>: [PATCH 23/26] drm/amdgpu/dm: Resume short HPD IRQs before resuming MST topology</li>
<li><em>From</em>: Lyude Paul &lt;lyude@xxxxxxxxxx&gt;</li>
<li><em>Date</em>: Wed, 17 Jul 2019 21:42:46 -0400</li>
<li><em>Cc</em>: &quot;David \(ChunMing\) Zhou&quot; &lt;David1.Zhou@xxxxxxx&gt;,        Mario Kleiner &lt;mario.kleiner.de@xxxxxxxxx&gt;,        Anthony Koo &lt;Anthony.Koo@xxxxxxx&gt;, Leo Li &lt;sunpeng.li@xxxxxxx&gt;,        Harry Wentland &lt;hwentlan@xxxxxxx&gt;, Imre Deak &lt;imre.deak@xxxxxxxxx&gt;,        linux-kernel@xxxxxxxxxxxxxxx, amd-gfx@xxxxxxxxxxxxxxxxxxxxx,        Nicholas Kazlauskas &lt;nicholas.kazlauskas@xxxxxxx&gt;,        Bhawanpreet Lakha &lt;Bhawanpreet.Lakha@xxxxxxx&gt;,        David Airlie &lt;airlied@xxxxxxxx&gt;, Juston Li &lt;juston.li@xxxxxxxxx&gt;,        Daniel Vetter &lt;daniel@xxxxxxxx&gt;, David Francis &lt;David.Francis@xxxxxxx&gt;,        Alex Deucher &lt;alexander.deucher@xxxxxxx&gt;,        Harry Wentland &lt;harry.wentland@xxxxxxx&gt;,        Christian K&#xF6;nig &lt;christian.koenig@xxxxxxx&gt;,        Ville Syrj&#xE4;l&#xE4; &lt;ville.syrjala@xxxxxxxxxxxxxxx&gt;</li>
<li><em>In-reply-to</em>: &lt;<a href="msg36135.html">20190718014329.8107-1-lyude@redhat.com</a>&gt;</li>
<li><em>References</em>: &lt;<a href="msg36135.html">20190718014329.8107-1-lyude@redhat.com</a>&gt;</li>
</ul>
<!--X-Head-of-Message-End-->
<!--X-Head-Body-Sep-Begin-->
<!-- AddThis Button BEGIN -->
<div class="addthis_toolbox addthis_default_style ">
<a class="addthis_button_preferred_1"></a>
<a class="addthis_button_preferred_2"></a>
<a class="addthis_button_preferred_3"></a>
<a class="addthis_button_preferred_4"></a>
<a class="addthis_button_compact"></a>
<a class="addthis_counter addthis_bubble_style"></a>
</div>
<script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5196c2ae1be43d18&async=1&domready=1" async></script>
<!-- AddThis Button END -->
<hr>
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- responsive link 1 -->
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-3422782820843221"
     data-ad-slot="8681825769"
     data-ad-format="link"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
<p>
<div class="content" itemprop="articleBody">
<!--X-Head-Body-Sep-End-->
<!--X-Body-of-Message-->
<pre>Since we're going to be reprobing the entire topology state on resume
now using sideband transactions, we need to ensure that we actually have
short HPD irqs enabled before calling drm_dp_mst_topology_mgr_resume().
So, do that.

Cc: Juston Li &lt;juston.li@xxxxxxxxx&gt;
Cc: Imre Deak &lt;imre.deak@xxxxxxxxx&gt;
Cc: Ville Syrj&#xE4;l&#xE4; &lt;ville.syrjala@xxxxxxxxxxxxxxx&gt;
Cc: Harry Wentland &lt;hwentlan@xxxxxxx&gt;
Signed-off-by: Lyude Paul &lt;lyude@xxxxxxxxxx&gt;
---
 drivers/gpu/drm/amd/display/amdgpu_dm/amdgpu_dm.c | 6 +++---
 1 file changed, 3 insertions(+), 3 deletions(-)

diff --git a/drivers/gpu/drm/amd/display/amdgpu_dm/amdgpu_dm.c b/drivers/gpu/drm/amd/display/amdgpu_dm/amdgpu_dm.c
index 0ef49db0f08d..e33e080cf16d 100644
--- a/drivers/gpu/drm/amd/display/amdgpu_dm/amdgpu_dm.c
+++ b/drivers/gpu/drm/amd/display/amdgpu_dm/amdgpu_dm.c
@@ -1041,15 +1041,15 @@ static int dm_resume(void *handle)
 	/* program HPD filter */
 	dc_resume(dm-&gt;dc);
 
-	/* On resume we need to  rewrite the MSTM control bits to enamble MST*/
-	s3_handle_mst(ddev, false);
-
 	/*
 	 * early enable HPD Rx IRQ, should be done before set mode as short
 	 * pulse interrupts are used for MST
 	 */
 	amdgpu_dm_irq_resume_early(adev);
 
+	/* On resume we need to  rewrite the MSTM control bits to enamble MST*/
+	s3_handle_mst(ddev, false);
+
 	/* Do detection*/
 	drm_connector_list_iter_begin(ddev, &amp;iter);
 	drm_for_each_connector_iter(connector, &amp;iter) {
-- 
2.21.0

_______________________________________________
amd-gfx mailing list
amd-gfx@xxxxxxxxxxxxxxxxxxxxx
<a  rel="nofollow" href="https://lists.freedesktop.org/mailman/listinfo/amd-gfx">https://lists.freedesktop.org/mailman/listinfo/amd-gfx</a>



</pre>
<!--X-Body-of-Message-End-->
<!--X-MsgBody-End-->
<!--X-Follow-Ups-->
</div>
<hr>
<!--X-Follow-Ups-End-->
<!--X-References-->
<ul><li><strong>References</strong>:
<ul>
<li><strong><a name="36135" href="msg36135.html">[PATCH 00/26] DP MST Refactors + debugging tools + suspend/resume reprobing</a></strong>
<ul><li><em>From:</em> Lyude Paul</li></ul></li>
</ul></li></ul>
<!--X-References-End-->
<!--X-BotPNI-->
<ul>
<li>Prev by Date:
<strong><a href="msg36136.html">[PATCH 22/26] drm/amdgpu: Iterate through DRM connectors correctly</a></strong>
</li>
<li>Next by Date:
<strong><a href="msg36138.html">[PATCH 24/26] drm/dp_mst: Add basic topology reprobing when resuming</a></strong>
</li>
<li>Previous by thread:
<strong><a href="msg36136.html">[PATCH 22/26] drm/amdgpu: Iterate through DRM connectors correctly</a></strong>
</li>
<li>Next by thread:
<strong><a href="msg36138.html">[PATCH 24/26] drm/dp_mst: Add basic topology reprobing when resuming</a></strong>
</li>
<li>Index(es):
<ul>
<li><a href="maillist.html#36137"><strong>Date</strong></a></li>
<li><a href="index.html#36137"><strong>Thread</strong></a></li>
</ul>
</li>
</ul>

<!--X-BotPNI-End-->
<!--X-User-Footer-->
<center>
<font size=-1>
<a href=/lists/>[Index&nbsp;of&nbsp;Archives]</a>
&nbsp;
&nbsp;
<a href=/lists/linux-usb/>[Linux&nbsp;USB&nbsp;Devel]</a>
&nbsp;
&nbsp;
<a href=/lists/linux-audio-users/>[Linux&nbsp;Audio&nbsp;Users]</a>
&nbsp;
&nbsp;
<a href=https://yosemitenews.info/>[Yosemite&nbsp;News]</a>
&nbsp;
&nbsp;
<a href=/lists/kernel/>[Linux&nbsp;Kernel]</a>
&nbsp;
&nbsp;
<a href=/lists/linux-scsi/>[Linux&nbsp;SCSI]</a>
</font>
</center>
<hr>
<p>
<div>
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<ins class="adsbygoogle"
     style="display:block"
     data-ad-format="autorelaxed"
     data-ad-client="ca-pub-3422782820843221"
     data-ad-slot="1424524564"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
</div>
<table width=100%>
<tr>
<td align=left>&nbsp;</td>
<td align=right><a href=/lists/><img src=/button_01.gif border=0 alt="Powered by Linux"></a></td>
</tr>
</table>
<!--X-User-Footer-End-->
<script type="text/javascript"> 
 function initAddThis() {
    addthis.init()
 }
initAddThis();
</script>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-760190-1', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
