<!-- MHonArc v2.6.19 -->
<!--X-Subject: Re: [PATCH 1/3] drm/amdgpu: Add flag for allocating memory for sensitive data -->
<!--X-From-R13: "Yhruyvat, Tryvk" &#60;Tryvk.YhruyvatNnzq.pbz> -->
<!--X-Date: Wed, 10 Jul 2019 11:58:41 &#45;0700 -->
<!--X-Message-Id: 11769749&#45;a0de&#45;e121&#45;e0f6&#45;eeba7bae58e2@amd.com -->
<!--X-Content-Type: text/plain -->
<!--X-Reference: 20190709053222.22588&#45;1&#45;Felix.Kuehling@amd.com -->
<!--X-Reference: b1a0638a&#45;4be3&#45;0a7b&#45;7d29&#45;309942f24263@daenzer.net -->
<!--X-Reference: da90e4c0&#45;067b&#45;2ffe&#45;01df&#45;f59c2b7ec556@amd.com -->
<!--X-Reference: 519e26e8&#45;c363&#45;2b4c&#45;756c&#45;d87fbe2543d9@daenzer.net -->
<!--X-Head-End-->
<!doctype html public "-//W3C//DTD HTML//EN">
<html>
<head>
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({
          google_ad_client: "ca-pub-3422782820843221",
          enable_page_level_ads: true
     });
</script>
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="description" content="AMD GFX: Re: [PATCH 1/3] drm/amdgpu: Add flag for allocating memory for sensitive data">
<style>
<!--
 pre {white-space: pre-wrap;}
-->
</style>
<title>Re: [PATCH 1/3] drm/amdgpu: Add flag for allocating memory for sensitive data &mdash; Linux AMD GFX</title>
<link rel="alternate" type="application/rss+xml" title="Linux AMD GFX" href="//feeds.feedburner.com/LinuxAmdGraphics">
</head>
<body itemscope itemtype="//schema.org/Article" bgcolor=white vlink=green link=blue>
<!--X-Body-Begin-->
<!--X-User-Header-->
<!--X-User-Header-End-->
<!--X-TopPNI-->
<form action="//www.google.com" id="cse-search-box" target="_blank">
  <div>
    <input type="hidden" name="cx" value="partner-pub-3422782820843221:9580497365" />
    <input type="hidden" name="ie" value="UTF-8" />
    <input type="text" name="q" size="25" />
    <input type="submit" name="sa" value="Search" />
  </div>
</form>
<script type="text/javascript" src="//www.google.com/coop/cse/brand?form=cse-search-box&amp;lang=en" async defer></script>
<h1 itemprop="name">Re: [PATCH 1/3] drm/amdgpu: Add flag for allocating memory for sensitive data</h1>
[<a href="msg35703.html">Date Prev</a>][<a href="msg35705.html">Date Next</a>][<a href="msg35686.html">Thread Prev</a>][<a href="msg35720.html">Thread Next</a>][<a href="maillist.html#35704">Date Index</a>][<a href="index.html#35704">Thread Index</a>]


<p>&nbsp;<br>
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- responsive test for archives -->
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-3422782820843221"
     data-ad-slot="6345952567"
     data-ad-format="auto"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>

<!--X-TopPNI-End-->
<!--X-MsgBody-->
<!--X-Subject-Header-Begin-->
<hr>
<!--X-Subject-Header-End-->
<!--X-Head-of-Message-->
<ul>
<li><em>To</em>: Michel D&#xE4;nzer &lt;michel@xxxxxxxxxxx&gt;</li>
<li><em>Subject</em>: Re: [PATCH 1/3] drm/amdgpu: Add flag for allocating memory for sensitive data</li>
<li><em>From</em>: &quot;Kuehling, Felix&quot; &lt;Felix.Kuehling@xxxxxxx&gt;</li>
<li><em>Date</em>: Wed, 10 Jul 2019 18:58:36 +0000</li>
<li><em>Accept-language</em>: en-US</li>
<li><em>Cc</em>: &quot;amd-gfx@xxxxxxxxxxxxxxxxxxxxx&quot; &lt;amd-gfx@xxxxxxxxxxxxxxxxxxxxx&gt;</li>
<li><em>In-reply-to</em>: &lt;<a href="msg35686.html">519e26e8-c363-2b4c-756c-d87fbe2543d9@daenzer.net</a>&gt;</li>
<li><em>References</em>: &lt;<a href="msg35652.html">20190709053222.22588-1-Felix.Kuehling@amd.com</a>&gt; &lt;<a href="msg35655.html">b1a0638a-4be3-0a7b-7d29-309942f24263@daenzer.net</a>&gt; &lt;<a href="msg35666.html">da90e4c0-067b-2ffe-01df-f59c2b7ec556@amd.com</a>&gt; &lt;<a href="msg35686.html">519e26e8-c363-2b4c-756c-d87fbe2543d9@daenzer.net</a>&gt;</li>
<li><em>User-agent</em>: Mozilla/5.0 (X11; Linux x86_64; rv:60.0) Gecko/20100101 Thunderbird/60.7.2</li>
</ul>
<!--X-Head-of-Message-End-->
<!--X-Head-Body-Sep-Begin-->
<!-- AddThis Button BEGIN -->
<div class="addthis_toolbox addthis_default_style ">
<a class="addthis_button_preferred_1"></a>
<a class="addthis_button_preferred_2"></a>
<a class="addthis_button_preferred_3"></a>
<a class="addthis_button_preferred_4"></a>
<a class="addthis_button_compact"></a>
<a class="addthis_counter addthis_bubble_style"></a>
</div>
<script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5196c2ae1be43d18&async=1&domready=1" async></script>
<!-- AddThis Button END -->
<hr>
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- responsive link 1 -->
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-3422782820843221"
     data-ad-slot="8681825769"
     data-ad-format="link"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
<p>
<div class="content" itemprop="articleBody">
<!--X-Head-Body-Sep-End-->
<!--X-Body-of-Message-->
<pre>On 2019-07-10 3:22 a.m., Michel D&#xE4;nzer wrote:
&gt;<i> On 2019-07-09 9:00 p.m., Kuehling, Felix wrote:</i>
&gt;<i>&gt; On 2019-07-09 6:34 a.m., Michel D&#xE4;nzer wrote:</i>
&gt;<i>&gt;&gt; On 2019-07-09 7:32 a.m., Kuehling, Felix wrote:</i>
&gt;<i>&gt;&gt;&gt; This memory allocation flag will be used to indicate BOs containing</i>
&gt;<i>&gt;&gt;&gt; sensitive data that should not be leaked to other processes.</i>
&gt;<i>&gt;&gt;&gt;</i>
&gt;<i>&gt;&gt;&gt; Signed-off-by: Felix Kuehling &lt;Felix.Kuehling@xxxxxxx&gt;</i>
&gt;<i>&gt;&gt;&gt; ---</i>
&gt;<i>&gt;&gt;&gt;    include/uapi/drm/amdgpu_drm.h | 4 ++++</i>
&gt;<i>&gt;&gt;&gt;    1 file changed, 4 insertions(+)</i>
&gt;<i>&gt;&gt;&gt;</i>
&gt;<i>&gt;&gt;&gt; diff --git a/include/uapi/drm/amdgpu_drm.h b/include/uapi/drm/amdgpu_drm.h</i>
&gt;<i>&gt;&gt;&gt; index 61870478bc9c..58659c28c26e 100644</i>
&gt;<i>&gt;&gt;&gt; --- a/include/uapi/drm/amdgpu_drm.h</i>
&gt;<i>&gt;&gt;&gt; +++ b/include/uapi/drm/amdgpu_drm.h</i>
&gt;<i>&gt;&gt;&gt; @@ -131,6 +131,10 @@ extern &quot;C&quot; {</i>
&gt;<i>&gt;&gt;&gt;     * for the second page onward should be set to NC.</i>
&gt;<i>&gt;&gt;&gt;     */</i>
&gt;<i>&gt;&gt;&gt;    #define AMDGPU_GEM_CREATE_MQD_GFX9		(1 &lt;&lt; 8)</i>
&gt;<i>&gt;&gt;&gt; +/* Flag that BO may contain sensitive data that must be cleared before</i>
&gt;<i>&gt;&gt;&gt; + * releasing the memory</i>
&gt;<i>&gt;&gt;&gt; + */</i>
&gt;<i>&gt;&gt;&gt; +#define AMDGPU_GEM_CREATE_VRAM_SENSITIVE	(1 &lt;&lt; 9)</i>
&gt;<i>&gt;&gt;&gt;    </i>
&gt;<i>&gt;&gt;&gt;    struct drm_amdgpu_gem_create_in  {</i>
&gt;<i>&gt;&gt;&gt;    	/** the requested memory size */</i>
&gt;<i>&gt;&gt;&gt;</i>
&gt;<i>&gt;&gt; This flag essentially means &quot;Please don't leak my BO contents&quot;.</i>
&gt;<i>&gt;&gt; Similarly, AMDGPU_GEM_CREATE_VRAM_CLEARED essentially means &quot;Please</i>
&gt;<i>&gt;&gt; don't let me see previous memory contents&quot;.</i>
&gt;<i>&gt;&gt;</i>
&gt;<i>&gt;&gt; I'd argue that neither flag should really be needed; BO contents</i>
&gt;<i>&gt;&gt; shouldn't be leaked by default.</i>
&gt;<i>&gt; My conclusion from previous discussions was that CREATE_VRAM_CLEARED has</i>
&gt;<i>&gt; no security implications. It's basically completely ineffective as a</i>
&gt;<i>&gt; security measure.</i>
&gt;<i> Absolutely, which is why I argued against it when it was proposed.</i>
&gt;<i></i>
&gt;<i>&gt; It's more a convenience feature. Therefore I think it still has a place</i>
&gt;<i>&gt; as that.</i>
&gt;<i> It'd be a no-op if memory was always cleared. :)</i>
&gt;<i></i>
&gt;<i></i>
&gt;<i>&gt; I'd agree on principle that data shouldn't be leaked by default, but it</i>
&gt;<i>&gt; has been the default for a long time. My impression was that graphics</i>
&gt;<i>&gt; guys cared more about performance than security. So changing the default</i>
&gt;<i>&gt; may be a hard sell. On the compute side we already took a big</i>
&gt;<i>&gt; performance hit by clearing all our VRAM, so this change would be an</i>
&gt;<i>&gt; improvement for us. Therefore I think it still makes sense to let the</i>
&gt;<i>&gt; application choose.</i>
&gt;<i> What exactly could userspace be allowed to choose though? I can only</i>
&gt;<i> think of disabling the clearing of memory it allocates (&quot;Please leak my</i>
&gt;<i> BO contents&quot;), which seems of rather dubious value.</i>

I'm not insisting to leave it to user mode. But I think it makes sense 
to have the choice per BO. The GEM ioctl could set the flag by default 
for all user mode allocations. But some kernel mode BOs may not need it. 
E.g. firmware, page tables, etc.

There are other AMDGPU_GEM_CREATE_ flags that don't make sense for user 
mode to choose. This just adds one more.

Regards,
 &#xA0; Felix


&gt;<i></i>
&gt;<i> What might be feasible is allowing the system administrator to disable</i>
&gt;<i> it, similar to the mitigations for Meltdown/Spectre/... vulnerabilities.</i>
&gt;<i> OTOH I don't know of any mechanism for disabling the clearing of normal</i>
&gt;<i> system RAM (which is also effective at least to some degree for BOs</i>
&gt;<i> outside of VRAM, making the whole thing a bit inconsistent).</i>
&gt;<i></i>
&gt;<i></i>
_______________________________________________
amd-gfx mailing list
amd-gfx@xxxxxxxxxxxxxxxxxxxxx
<a  rel="nofollow" href="https://lists.freedesktop.org/mailman/listinfo/amd-gfx">https://lists.freedesktop.org/mailman/listinfo/amd-gfx</a>



</pre>
<!--X-Body-of-Message-End-->
<!--X-MsgBody-End-->
<!--X-Follow-Ups-->
</div>
<hr>
<ul><li><strong>Follow-Ups</strong>:
<ul>
<li><strong><a name="35720" href="msg35720.html">Re: [PATCH 1/3] drm/amdgpu: Add flag for allocating memory for sensitive data</a></strong>
<ul><li><em>From:</em> Michel D&#xE4;nzer</li></ul></li>
</ul></li></ul>
<!--X-Follow-Ups-End-->
<!--X-References-->
<ul><li><strong>References</strong>:
<ul>
<li><strong><a name="35652" href="msg35652.html">[PATCH 1/3] drm/amdgpu: Add flag for allocating memory for sensitive data</a></strong>
<ul><li><em>From:</em> Kuehling, Felix</li></ul></li>
<li><strong><a name="35655" href="msg35655.html">Re: [PATCH 1/3] drm/amdgpu: Add flag for allocating memory for sensitive data</a></strong>
<ul><li><em>From:</em> Michel D&#xE4;nzer</li></ul></li>
<li><strong><a name="35666" href="msg35666.html">Re: [PATCH 1/3] drm/amdgpu: Add flag for allocating memory for sensitive data</a></strong>
<ul><li><em>From:</em> Kuehling, Felix</li></ul></li>
<li><strong><a name="35686" href="msg35686.html">Re: [PATCH 1/3] drm/amdgpu: Add flag for allocating memory for sensitive data</a></strong>
<ul><li><em>From:</em> Michel D&#xE4;nzer</li></ul></li>
</ul></li></ul>
<!--X-References-End-->
<!--X-BotPNI-->
<ul>
<li>Prev by Date:
<strong><a href="msg35703.html">Re: [PATCH -next v4] drm/amdgpu: return 'ret' immediately if failed in amdgpu_pmu_init</a></strong>
</li>
<li>Next by Date:
<strong><a href="msg35705.html">Re: [PATCH 02/10] drm/dp_mst: Enable registration of AUX devices for MST ports (v2)</a></strong>
</li>
<li>Previous by thread:
<strong><a href="msg35686.html">Re: [PATCH 1/3] drm/amdgpu: Add flag for allocating memory for sensitive data</a></strong>
</li>
<li>Next by thread:
<strong><a href="msg35720.html">Re: [PATCH 1/3] drm/amdgpu: Add flag for allocating memory for sensitive data</a></strong>
</li>
<li>Index(es):
<ul>
<li><a href="maillist.html#35704"><strong>Date</strong></a></li>
<li><a href="index.html#35704"><strong>Thread</strong></a></li>
</ul>
</li>
</ul>

<!--X-BotPNI-End-->
<!--X-User-Footer-->
<center>
<font size=-1>
<a href=/lists/>[Index&nbsp;of&nbsp;Archives]</a>
&nbsp;
&nbsp;
<a href=/lists/linux-usb/>[Linux&nbsp;USB&nbsp;Devel]</a>
&nbsp;
&nbsp;
<a href=/lists/linux-audio-users/>[Linux&nbsp;Audio&nbsp;Users]</a>
&nbsp;
&nbsp;
<a href=https://yosemitenews.info/>[Yosemite&nbsp;News]</a>
&nbsp;
&nbsp;
<a href=/lists/kernel/>[Linux&nbsp;Kernel]</a>
&nbsp;
&nbsp;
<a href=/lists/linux-scsi/>[Linux&nbsp;SCSI]</a>
</font>
</center>
<hr>
<p>
<div>
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<ins class="adsbygoogle"
     style="display:block"
     data-ad-format="autorelaxed"
     data-ad-client="ca-pub-3422782820843221"
     data-ad-slot="1424524564"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
</div>
<table width=100%>
<tr>
<td align=left>&nbsp;</td>
<td align=right><a href=/lists/><img src=/button_01.gif border=0 alt="Powered by Linux"></a></td>
</tr>
</table>
<!--X-User-Footer-End-->
<script type="text/javascript"> 
 function initAddThis() {
    addthis.init()
 }
initAddThis();
</script>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-760190-1', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
