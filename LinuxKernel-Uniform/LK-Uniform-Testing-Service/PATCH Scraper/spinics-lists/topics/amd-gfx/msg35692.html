<!-- MHonArc v2.6.19 -->
<!--X-Subject: Re: [PATCH 2/2] drm/amd/display: Add drm_audio_component support to amdgpu_dm -->
<!--X-From-R13: Fnxnfuv Wjnv &#60;gvjnvNfhfr.qr> -->
<!--X-Date: Wed, 10 Jul 2019 06:48:36 &#45;0700 -->
<!--X-Message-Id: s5hy316q9u8.wl&#45;tiwai@suse.de -->
<!--X-Content-Type: text/plain -->
<!--X-Reference: 20190709163019.32085&#45;1&#45;nicholas.kazlauskas@amd.com -->
<!--X-Reference: 20190709163019.32085&#45;2&#45;nicholas.kazlauskas@amd.com -->
<!--X-Head-End-->
<!doctype html public "-//W3C//DTD HTML//EN">
<html>
<head>
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({
          google_ad_client: "ca-pub-3422782820843221",
          enable_page_level_ads: true
     });
</script>
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="description" content="AMD GFX: Re: [PATCH 2/2] drm/amd/display: Add drm_audio_component support to amdgpu_dm">
<style>
<!--
 pre {white-space: pre-wrap;}
-->
</style>
<title>Re: [PATCH 2/2] drm/amd/display: Add drm_audio_component support to amdgpu_dm &mdash; Linux AMD GFX</title>
<link rel="alternate" type="application/rss+xml" title="Linux AMD GFX" href="//feeds.feedburner.com/LinuxAmdGraphics">
</head>
<body itemscope itemtype="//schema.org/Article" bgcolor=white vlink=green link=blue>
<!--X-Body-Begin-->
<!--X-User-Header-->
<!--X-User-Header-End-->
<!--X-TopPNI-->
<form action="//www.google.com" id="cse-search-box" target="_blank">
  <div>
    <input type="hidden" name="cx" value="partner-pub-3422782820843221:9580497365" />
    <input type="hidden" name="ie" value="UTF-8" />
    <input type="text" name="q" size="25" />
    <input type="submit" name="sa" value="Search" />
  </div>
</form>
<script type="text/javascript" src="//www.google.com/coop/cse/brand?form=cse-search-box&amp;lang=en" async defer></script>
<h1 itemprop="name">Re: [PATCH 2/2] drm/amd/display: Add drm_audio_component support to amdgpu_dm</h1>
[<a href="msg35691.html">Date Prev</a>][<a href="msg35693.html">Date Next</a>][<a href="msg35677.html">Thread Prev</a>][<a href="msg35693.html">Thread Next</a>][<a href="maillist.html#35692">Date Index</a>][<a href="index.html#35692">Thread Index</a>]


<p>&nbsp;<br>
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- responsive test for archives -->
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-3422782820843221"
     data-ad-slot="6345952567"
     data-ad-format="auto"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>

<!--X-TopPNI-End-->
<!--X-MsgBody-->
<!--X-Subject-Header-Begin-->
<hr>
<!--X-Subject-Header-End-->
<!--X-Head-of-Message-->
<ul>
<li><em>To</em>: Nicholas Kazlauskas &lt;nicholas.kazlauskas@xxxxxxx&gt;</li>
<li><em>Subject</em>: Re: [PATCH 2/2] drm/amd/display: Add drm_audio_component support to amdgpu_dm</li>
<li><em>From</em>: Takashi Iwai &lt;tiwai@xxxxxxx&gt;</li>
<li><em>Date</em>: Wed, 10 Jul 2019 15:48:31 +0200</li>
<li><em>Cc</em>: Leo Li &lt;sunpeng.li@xxxxxxx&gt;, Harry Wentland &lt;harry.wentland@xxxxxxx&gt;,        amd-gfx@xxxxxxxxxxxxxxxxxxxxx</li>
<li><em>In-reply-to</em>: &lt;<a href="msg35663.html">20190709163019.32085-2-nicholas.kazlauskas@amd.com</a>&gt;</li>
<li><em>References</em>: &lt;<a href="msg35662.html">20190709163019.32085-1-nicholas.kazlauskas@amd.com</a>&gt; &lt;<a href="msg35663.html">20190709163019.32085-2-nicholas.kazlauskas@amd.com</a>&gt;</li>
<li><em>User-agent</em>: Wanderlust/2.15.9 (Almost Unreal) SEMI/1.14.6 (Maruoka) FLIM/1.14.9 (Goj&#x14D;) APEL/10.8 Emacs/25.3 (x86_64-suse-linux-gnu) MULE/6.0 (HANACHIRUSATO)</li>
</ul>
<!--X-Head-of-Message-End-->
<!--X-Head-Body-Sep-Begin-->
<!-- AddThis Button BEGIN -->
<div class="addthis_toolbox addthis_default_style ">
<a class="addthis_button_preferred_1"></a>
<a class="addthis_button_preferred_2"></a>
<a class="addthis_button_preferred_3"></a>
<a class="addthis_button_preferred_4"></a>
<a class="addthis_button_compact"></a>
<a class="addthis_counter addthis_bubble_style"></a>
</div>
<script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5196c2ae1be43d18&async=1&domready=1" async></script>
<!-- AddThis Button END -->
<hr>
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- responsive link 1 -->
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-3422782820843221"
     data-ad-slot="8681825769"
     data-ad-format="link"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
<p>
<div class="content" itemprop="articleBody">
<!--X-Head-Body-Sep-End-->
<!--X-Body-of-Message-->
<pre>On Tue, 09 Jul 2019 18:30:19 +0200,
Nicholas Kazlauskas wrote:
&gt;<i> </i>
&gt;<i> [Why]</i>
&gt;<i> The drm_audio_component can be used to give pin ELD notifications</i>
&gt;<i> directly to the sound driver. This fixes audio endpoints disappearing</i>
&gt;<i> due to missing unsolicited notifications.</i>
&gt;<i> </i>
&gt;<i> [How]</i>
&gt;<i> Send the notification via the audio component whenever we enable or</i>
&gt;<i> disable audio state on a stream. This matches what i915 does with</i>
&gt;<i> their drm_audio_component and what Takashi Iwai's proposed hack for</i>
&gt;<i> radeon/amdpgu did.</i>
&gt;<i> </i>
&gt;<i> This is a bit delayed in when the notification actually occurs, however.</i>
&gt;<i> We wait until after all the programming is complete rather than sending</i>
&gt;<i> the notification mid sequence.</i>
&gt;<i> </i>
&gt;<i> Particular care is needed for the get ELD callback since it can happen</i>
&gt;<i> outside the locking and fencing DRM does for atomic commits.</i>
&gt;<i> </i>
&gt;<i> Cc: Takashi Iwai &lt;tiwai@xxxxxxx&gt;</i>
&gt;<i> Cc: Leo Li &lt;sunpeng.li@xxxxxxx&gt;</i>
&gt;<i> Cc: Harry Wentland &lt;harry.wentland@xxxxxxx&gt;</i>
&gt;<i> Signed-off-by: Nicholas Kazlauskas &lt;nicholas.kazlauskas@xxxxxxx&gt;</i>

Thanks for the patch, this has been a long-standing TODO for me, too!

Do you have the patch for HD-audio part as well?  Or you tested with
my old patch?  Then I'll resurrect my patch set as well.

This patch itself looks almost good.  One caveat is that you might
want the reverse select of CONFIG_SND_HDA_COMPONENT, something like:

================================================================
--- a/drivers/gpu/drm/Kconfig
+++ b/drivers/gpu/drm/Kconfig
@@ -223,6 +223,7 @@ config DRM_AMDGPU
 	select BACKLIGHT_CLASS_DEVICE
 	select INTERVAL_TREE
 	select CHASH
+	select SND_HDA_COMPONENT if SND_HDA_CORE
 	help
 	  Choose this option if you have a recent AMD Radeon graphics card.
 
================================================================

Other than that, feel free to take my r-b tag:
  Reviewed-by: Takashi Iwai &lt;tiwai@xxxxxxx&gt;


thanks,

Takashi
_______________________________________________
amd-gfx mailing list
amd-gfx@xxxxxxxxxxxxxxxxxxxxx
<a  rel="nofollow" href="https://lists.freedesktop.org/mailman/listinfo/amd-gfx">https://lists.freedesktop.org/mailman/listinfo/amd-gfx</a>



</pre>
<!--X-Body-of-Message-End-->
<!--X-MsgBody-End-->
<!--X-Follow-Ups-->
</div>
<hr>
<ul><li><strong>Follow-Ups</strong>:
<ul>
<li><strong><a name="35693" href="msg35693.html">Re: [PATCH 2/2] drm/amd/display: Add drm_audio_component support to amdgpu_dm</a></strong>
<ul><li><em>From:</em> Kazlauskas, Nicholas</li></ul></li>
</ul></li></ul>
<!--X-Follow-Ups-End-->
<!--X-References-->
<ul><li><strong>References</strong>:
<ul>
<li><strong><a name="35662" href="msg35662.html">[PATCH 1/2] drm/amd/display: Expose audio inst from DC to DM</a></strong>
<ul><li><em>From:</em> Nicholas Kazlauskas</li></ul></li>
<li><strong><a name="35663" href="msg35663.html">[PATCH 2/2] drm/amd/display: Add drm_audio_component support to amdgpu_dm</a></strong>
<ul><li><em>From:</em> Nicholas Kazlauskas</li></ul></li>
</ul></li></ul>
<!--X-References-End-->
<!--X-BotPNI-->
<ul>
<li>Prev by Date:
<strong><a href="msg35691.html">Re: Intermittent errors when using amdgpu_job_submit_direct</a></strong>
</li>
<li>Next by Date:
<strong><a href="msg35693.html">Re: [PATCH 2/2] drm/amd/display: Add drm_audio_component support to amdgpu_dm</a></strong>
</li>
<li>Previous by thread:
<strong><a href="msg35677.html">Re: [PATCH 2/2] drm/amd/display: Add drm_audio_component support to amdgpu_dm</a></strong>
</li>
<li>Next by thread:
<strong><a href="msg35693.html">Re: [PATCH 2/2] drm/amd/display: Add drm_audio_component support to amdgpu_dm</a></strong>
</li>
<li>Index(es):
<ul>
<li><a href="maillist.html#35692"><strong>Date</strong></a></li>
<li><a href="index.html#35692"><strong>Thread</strong></a></li>
</ul>
</li>
</ul>

<!--X-BotPNI-End-->
<!--X-User-Footer-->
<center>
<font size=-1>
<a href=/lists/>[Index&nbsp;of&nbsp;Archives]</a>
&nbsp;
&nbsp;
<a href=/lists/linux-usb/>[Linux&nbsp;USB&nbsp;Devel]</a>
&nbsp;
&nbsp;
<a href=/lists/linux-audio-users/>[Linux&nbsp;Audio&nbsp;Users]</a>
&nbsp;
&nbsp;
<a href=https://yosemitenews.info/>[Yosemite&nbsp;News]</a>
&nbsp;
&nbsp;
<a href=/lists/kernel/>[Linux&nbsp;Kernel]</a>
&nbsp;
&nbsp;
<a href=/lists/linux-scsi/>[Linux&nbsp;SCSI]</a>
</font>
</center>
<hr>
<p>
<div>
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<ins class="adsbygoogle"
     style="display:block"
     data-ad-format="autorelaxed"
     data-ad-client="ca-pub-3422782820843221"
     data-ad-slot="1424524564"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
</div>
<table width=100%>
<tr>
<td align=left>&nbsp;</td>
<td align=right><a href=/lists/><img src=/button_01.gif border=0 alt="Powered by Linux"></a></td>
</tr>
</table>
<!--X-User-Footer-End-->
<script type="text/javascript"> 
 function initAddThis() {
    addthis.init()
 }
initAddThis();
</script>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-760190-1', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
