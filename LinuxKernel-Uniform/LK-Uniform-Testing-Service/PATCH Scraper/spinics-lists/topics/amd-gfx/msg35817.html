<!-- MHonArc v2.6.19 -->
<!--X-Subject: Re: [PATCH] drm/amd/display: Support clang option for stack alignment -->
<!--X-From-R13: Oeaq Pretznaa &#60;neaqNneaqo.qr> -->
<!--X-Date: Mon, 15 Jul 2019 00:58:40 &#45;0700 -->
<!--X-Message-Id: CAK8P3a0vTwtDtxDhfmhzOViUp+DPzuJ_qsQsnVFw4B7oBaudTQ@mail.gmail.com -->
<!--X-Content-Type: text/plain -->
<!--X-Reference: 20190712093720.1461418&#45;1&#45;arnd@arndb.de -->
<!--X-Reference: CAKwvOd=Xdp_=G3UU9ubayeTvkKCJ9hak0a&#45;7yK90&#45;RPUBQKrpw@mail.gmail.com -->
<!--X-Head-End-->
<!doctype html public "-//W3C//DTD HTML//EN">
<html>
<head>
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({
          google_ad_client: "ca-pub-3422782820843221",
          enable_page_level_ads: true
     });
</script>
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="description" content="AMD GFX: Re: [PATCH] drm/amd/display: Support clang option for stack alignment">
<style>
<!--
 pre {white-space: pre-wrap;}
-->
</style>
<title>Re: [PATCH] drm/amd/display: Support clang option for stack alignment &mdash; Linux AMD GFX</title>
<link rel="alternate" type="application/rss+xml" title="Linux AMD GFX" href="//feeds.feedburner.com/LinuxAmdGraphics">
</head>
<body itemscope itemtype="//schema.org/Article" bgcolor=white vlink=green link=blue>
<!--X-Body-Begin-->
<!--X-User-Header-->
<!--X-User-Header-End-->
<!--X-TopPNI-->
<form action="//www.google.com" id="cse-search-box" target="_blank">
  <div>
    <input type="hidden" name="cx" value="partner-pub-3422782820843221:9580497365" />
    <input type="hidden" name="ie" value="UTF-8" />
    <input type="text" name="q" size="25" />
    <input type="submit" name="sa" value="Search" />
  </div>
</form>
<script type="text/javascript" src="//www.google.com/coop/cse/brand?form=cse-search-box&amp;lang=en" async defer></script>
<h1 itemprop="name">Re: [PATCH] drm/amd/display: Support clang option for stack alignment</h1>
[<a href="msg35816.html">Date Prev</a>][<a href="msg35818.html">Date Next</a>][<a href="msg35797.html">Thread Prev</a>][<a href="msg35783.html">Thread Next</a>][<a href="maillist.html#35817">Date Index</a>][<a href="index.html#35817">Thread Index</a>]


<p>&nbsp;<br>
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- responsive test for archives -->
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-3422782820843221"
     data-ad-slot="6345952567"
     data-ad-format="auto"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>

<!--X-TopPNI-End-->
<!--X-MsgBody-->
<!--X-Subject-Header-Begin-->
<hr>
<!--X-Subject-Header-End-->
<!--X-Head-of-Message-->
<ul>
<li><em>To</em>: Nick Desaulniers &lt;ndesaulniers@xxxxxxxxxx&gt;</li>
<li><em>Subject</em>: Re: [PATCH] drm/amd/display: Support clang option for stack alignment</li>
<li><em>From</em>: Arnd Bergmann &lt;arnd@xxxxxxxx&gt;</li>
<li><em>Date</em>: Fri, 12 Jul 2019 22:30:14 +0200</li>
<li><em>Cc</em>: &quot;David \(ChunMing\) Zhou&quot; &lt;David1.Zhou@xxxxxxx&gt;, Duke Du &lt;Duke.Du@xxxxxxx&gt;,        clang-built-linux &lt;clang-built-linux@xxxxxxxxxxxxxxxx&gt;,        Charlene Liu &lt;charlene.liu@xxxxxxx&gt;, Leo Li &lt;sunpeng.li@xxxxxxx&gt;,        Matthias Kaehlcke &lt;mka@xxxxxxxxxx&gt;,        LKML &lt;linux-kernel@xxxxxxxxxxxxxxx&gt;,        amd-gfx list &lt;amd-gfx@xxxxxxxxxxxxxxxxxxxxx&gt;,        David Airlie &lt;airlied@xxxxxxxx&gt;,        Dmytro Laktyushkin &lt;Dmytro.Laktyushkin@xxxxxxx&gt;,        dri-devel &lt;dri-devel@xxxxxxxxxxxxxxxxxxxxx&gt;,        Daniel Vetter &lt;daniel@xxxxxxxx&gt;,        Alex Deucher &lt;alexander.deucher@xxxxxxx&gt;,        Harry Wentland &lt;harry.wentland@xxxxxxx&gt;,        Christian K&#xF6;nig &lt;christian.koenig@xxxxxxx&gt;,        Masahiro Yamada &lt;yamada.masahiro@xxxxxxxxxxxxx&gt;</li>
<li><em>In-reply-to</em>: &lt;CAKwvOd=Xdp_=G3UU9ubayeTvkKCJ9hak0a-7yK90-RPUBQKrpw@mail.gmail.com&gt;</li>
<li><em>References</em>: &lt;<a href="msg35780.html">20190712093720.1461418-1-arnd@arndb.de</a>&gt; &lt;CAKwvOd=Xdp_=G3UU9ubayeTvkKCJ9hak0a-7yK90-RPUBQKrpw@mail.gmail.com&gt;</li>
</ul>
<!--X-Head-of-Message-End-->
<!--X-Head-Body-Sep-Begin-->
<!-- AddThis Button BEGIN -->
<div class="addthis_toolbox addthis_default_style ">
<a class="addthis_button_preferred_1"></a>
<a class="addthis_button_preferred_2"></a>
<a class="addthis_button_preferred_3"></a>
<a class="addthis_button_preferred_4"></a>
<a class="addthis_button_compact"></a>
<a class="addthis_counter addthis_bubble_style"></a>
</div>
<script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5196c2ae1be43d18&async=1&domready=1" async></script>
<!-- AddThis Button END -->
<hr>
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- responsive link 1 -->
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-3422782820843221"
     data-ad-slot="8681825769"
     data-ad-format="link"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
<p>
<div class="content" itemprop="articleBody">
<!--X-Head-Body-Sep-End-->
<!--X-Body-of-Message-->
<pre>On Fri, Jul 12, 2019 at 8:49 PM 'Nick Desaulniers' via Clang Built
Linux &lt;clang-built-linux@xxxxxxxxxxxxxxxx&gt; wrote:
&gt;<i></i>
&gt;<i> On Fri, Jul 12, 2019 at 2:37 AM Arnd Bergmann &lt;arnd@xxxxxxxx&gt; wrote:</i>
&gt;<i> &gt;</i>
&gt;<i> &gt; As previously fixed for dml in commit 4769278e5c7f (&quot;amdgpu/dc/dml:</i>
&gt;<i> &gt; Support clang option for stack alignment&quot;) and calcs in commit</i>
&gt;<i> &gt; cc32ad8f559c (&quot;amdgpu/dc/calcs: Support clang option for stack</i>
&gt;<i> &gt; alignment&quot;), dcn20 uses an option that is not available with clang:</i>
&gt;<i> &gt;</i>
&gt;<i> &gt; clang: error: unknown argument: '-mpreferred-stack-boundary=4'</i>
&gt;<i> &gt; scripts/Makefile.build:281: recipe for target 'drivers/gpu/drm/amd/amdgpu/../display/dc/dcn20/dcn20_resource.o' failed</i>
&gt;<i> &gt;</i>
&gt;<i> &gt; Use the same trick that we have in the other two files.</i>
&gt;<i></i>
&gt;<i> Maybe time for a macro in Kbuild.include or some such, if we see this</i>
&gt;<i> pattern being repeated?</i>

I'm not actually convinced that the argument does anything useful
at all, if the kernel stack is normally not 16-byte aligned
when we enter the driver, and it clearly is not needed if the stack
is already aligned.

Unless any code calling into the portions that want the alignment
manually aligns the kernel stack pointer, we could just as well
leave it out. The git history does not explain why it was added in the
first place though, so I really have no idea.

I see in the architecture makefiles that i386 kernels are built with
the same flag globally, but other architectures (including x86_64)
use the default stack alignment, which may be different.

      Arnd
_______________________________________________
amd-gfx mailing list
amd-gfx@xxxxxxxxxxxxxxxxxxxxx
<a  rel="nofollow" href="https://lists.freedesktop.org/mailman/listinfo/amd-gfx">https://lists.freedesktop.org/mailman/listinfo/amd-gfx</a>



</pre>
<!--X-Body-of-Message-End-->
<!--X-MsgBody-End-->
<!--X-Follow-Ups-->
</div>
<hr>
<!--X-Follow-Ups-End-->
<!--X-References-->
<ul><li><strong>References</strong>:
<ul>
<li><strong><a name="35780" href="msg35780.html">[PATCH] drm/amd/display: Support clang option for stack alignment</a></strong>
<ul><li><em>From:</em> Arnd Bergmann</li></ul></li>
<li><strong><a name="35797" href="msg35797.html">Re: [PATCH] drm/amd/display: Support clang option for stack alignment</a></strong>
<ul><li><em>From:</em> Nick Desaulniers</li></ul></li>
</ul></li></ul>
<!--X-References-End-->
<!--X-BotPNI-->
<ul>
<li>Prev by Date:
<strong><a href="msg35816.html">[PATCH v3 05/24] drm/amdgpu: remove memset after kzalloc</a></strong>
</li>
<li>Next by Date:
<strong><a href="msg35818.html">Re: [GIT PULL] Please pull hmm changes</a></strong>
</li>
<li>Previous by thread:
<strong><a href="msg35797.html">Re: [PATCH] drm/amd/display: Support clang option for stack alignment</a></strong>
</li>
<li>Next by thread:
<strong><a href="msg35783.html">[PATCH] drm/amd: work around llvm bug #42576</a></strong>
</li>
<li>Index(es):
<ul>
<li><a href="maillist.html#35817"><strong>Date</strong></a></li>
<li><a href="index.html#35817"><strong>Thread</strong></a></li>
</ul>
</li>
</ul>

<!--X-BotPNI-End-->
<!--X-User-Footer-->
<center>
<font size=-1>
<a href=/lists/>[Index&nbsp;of&nbsp;Archives]</a>
&nbsp;
&nbsp;
<a href=/lists/linux-usb/>[Linux&nbsp;USB&nbsp;Devel]</a>
&nbsp;
&nbsp;
<a href=/lists/linux-audio-users/>[Linux&nbsp;Audio&nbsp;Users]</a>
&nbsp;
&nbsp;
<a href=https://yosemitenews.info/>[Yosemite&nbsp;News]</a>
&nbsp;
&nbsp;
<a href=/lists/kernel/>[Linux&nbsp;Kernel]</a>
&nbsp;
&nbsp;
<a href=/lists/linux-scsi/>[Linux&nbsp;SCSI]</a>
</font>
</center>
<hr>
<p>
<div>
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<ins class="adsbygoogle"
     style="display:block"
     data-ad-format="autorelaxed"
     data-ad-client="ca-pub-3422782820843221"
     data-ad-slot="1424524564"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
</div>
<table width=100%>
<tr>
<td align=left>&nbsp;</td>
<td align=right><a href=/lists/><img src=/button_01.gif border=0 alt="Powered by Linux"></a></td>
</tr>
</table>
<!--X-User-Footer-End-->
<script type="text/javascript"> 
 function initAddThis() {
    addthis.init()
 }
initAddThis();
</script>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-760190-1', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
