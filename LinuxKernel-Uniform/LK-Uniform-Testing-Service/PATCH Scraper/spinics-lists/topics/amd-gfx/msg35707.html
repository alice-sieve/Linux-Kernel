<!-- MHonArc v2.6.19 -->
<!--X-Subject: Re: [PATCH v2] drm/sysfs: Add mstpath attribute to connector devices -->
<!--X-From-R13: Zlhqr Bnhy &#60;ylhqrNerqung.pbz> -->
<!--X-Date: Wed, 10 Jul 2019 15:51:00 &#45;0700 -->
<!--X-Message-Id: 346980b73f3b1fbbc70cbf3771788cec0777d4c0.camel@redhat.com -->
<!--X-Content-Type: text/plain -->
<!--X-Reference: 20190704190519.29525&#45;4&#45;sunpeng.li@amd.com -->
<!--X-Reference: 20190705143220.11109&#45;1&#45;sunpeng.li@amd.com -->
<!--X-Head-End-->
<!doctype html public "-//W3C//DTD HTML//EN">
<html>
<head>
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({
          google_ad_client: "ca-pub-3422782820843221",
          enable_page_level_ads: true
     });
</script>
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="description" content="AMD GFX: Re: [PATCH v2] drm/sysfs: Add mstpath attribute to connector devices">
<style>
<!--
 pre {white-space: pre-wrap;}
-->
</style>
<title>Re: [PATCH v2] drm/sysfs: Add mstpath attribute to connector devices &mdash; Linux AMD GFX</title>
<link rel="alternate" type="application/rss+xml" title="Linux AMD GFX" href="//feeds.feedburner.com/LinuxAmdGraphics">
</head>
<body itemscope itemtype="//schema.org/Article" bgcolor=white vlink=green link=blue>
<!--X-Body-Begin-->
<!--X-User-Header-->
<!--X-User-Header-End-->
<!--X-TopPNI-->
<form action="//www.google.com" id="cse-search-box" target="_blank">
  <div>
    <input type="hidden" name="cx" value="partner-pub-3422782820843221:9580497365" />
    <input type="hidden" name="ie" value="UTF-8" />
    <input type="text" name="q" size="25" />
    <input type="submit" name="sa" value="Search" />
  </div>
</form>
<script type="text/javascript" src="//www.google.com/coop/cse/brand?form=cse-search-box&amp;lang=en" async defer></script>
<h1 itemprop="name">Re: [PATCH v2] drm/sysfs: Add mstpath attribute to connector devices</h1>
[<a href="msg35706.html">Date Prev</a>][<a href="msg35708.html">Date Next</a>][<a href="msg35689.html">Thread Prev</a>][<a href="msg36092.html">Thread Next</a>][<a href="maillist.html#35707">Date Index</a>][<a href="index.html#35707">Thread Index</a>]


<p>&nbsp;<br>
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- responsive test for archives -->
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-3422782820843221"
     data-ad-slot="6345952567"
     data-ad-format="auto"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>

<!--X-TopPNI-End-->
<!--X-MsgBody-->
<!--X-Subject-Header-Begin-->
<hr>
<!--X-Subject-Header-End-->
<!--X-Head-of-Message-->
<ul>
<li><em>To</em>: sunpeng.li@xxxxxxx, ville.syrjala@xxxxxxxxxxxxxxx</li>
<li><em>Subject</em>: Re: [PATCH v2] drm/sysfs: Add mstpath attribute to connector devices</li>
<li><em>From</em>: Lyude Paul &lt;lyude@xxxxxxxxxx&gt;</li>
<li><em>Date</em>: Wed, 10 Jul 2019 18:50:54 -0400</li>
<li><em>Cc</em>: dri-devel@xxxxxxxxxxxxxxxxxxxxx, amd-gfx@xxxxxxxxxxxxxxxxxxxxx</li>
<li><em>In-reply-to</em>: &lt;<a href="msg35582.html">20190705143220.11109-1-sunpeng.li@amd.com</a>&gt;</li>
<li><em>Organization</em>: Red Hat</li>
<li><em>References</em>: &lt;<a href="msg35559.html">20190704190519.29525-4-sunpeng.li@amd.com</a>&gt; &lt;<a href="msg35582.html">20190705143220.11109-1-sunpeng.li@amd.com</a>&gt;</li>
<li><em>Reply-to</em>: lyude@xxxxxxxxxx</li>
<li><em>User-agent</em>: Evolution 3.32.3 (3.32.3-1.fc30) </li>
</ul>
<!--X-Head-of-Message-End-->
<!--X-Head-Body-Sep-Begin-->
<!-- AddThis Button BEGIN -->
<div class="addthis_toolbox addthis_default_style ">
<a class="addthis_button_preferred_1"></a>
<a class="addthis_button_preferred_2"></a>
<a class="addthis_button_preferred_3"></a>
<a class="addthis_button_preferred_4"></a>
<a class="addthis_button_compact"></a>
<a class="addthis_counter addthis_bubble_style"></a>
</div>
<script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5196c2ae1be43d18&async=1&domready=1" async></script>
<!-- AddThis Button END -->
<hr>
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- responsive link 1 -->
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-3422782820843221"
     data-ad-slot="8681825769"
     data-ad-format="link"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
<p>
<div class="content" itemprop="articleBody">
<!--X-Head-Body-Sep-End-->
<!--X-Body-of-Message-->
<pre>gah. So, I was originally going to ask &quot;why didn't we add the connector name
into this?&quot;, but then I realized we're doing the right thing already and just
doing card%d-%s % (card_number, path_prop). Which means we probably really don't
want to add a property called mstpath, since it's hardly different from path
(whoops!).

Additionally, after some thinking I realized I may have made a mistake as I'm
not entirely sure if we would need to specify the DRM card in the path prop for
udev, considering that's specified in the sysfs path all ready. Even if I'm
wrong on that though, I think it might be better not to add an mstpath property
and just go the route of just adding a new path_v2 property that we could use
for both MST and non-MST connector paths. (I cc'd you on the email thread about
this, so you can read more about this there.

So, I would actually suggest we just drop this patch entirely for now. We should
be fine without it, even though the dp_aux_dev paths will be kind of ugly for a
little while. I'd rather the rest of this series get upstream first, and try to
do the path prop stuff separately.


On Fri, 2019-07-05 at 10:32 -0400, sunpeng.li@xxxxxxx wrote:
&gt;<i> From: Leo Li &lt;sunpeng.li@xxxxxxx&gt;</i>
&gt;<i> </i>
&gt;<i> This can be used to create more descriptive symlinks for MST aux</i>
&gt;<i> devices. Consider the following udev rule:</i>
&gt;<i> </i>
&gt;<i> SUBSYSTEM==&quot;drm_dp_aux_dev&quot;, SUBSYSTEMS==&quot;drm&quot;, ATTRS{mstpath}==&quot;?*&quot;,</i>
&gt;<i> 	SYMLINK+=&quot;drm_dp_aux/by-path/$attr{mstpath}&quot;</i>
&gt;<i> </i>
&gt;<i> The following symlinks will be created (depending on your MST topology):</i>
&gt;<i> </i>
&gt;<i> $ ls /dev/drm_dp_aux/by-path/</i>
&gt;<i> card0-mst:0-1  card0-mst:0-1-1  card0-mst:0-1-8  card0-mst:0-8</i>
&gt;<i> </i>
&gt;<i> v2: remove unnecessary locking of mode_config.mutex</i>
&gt;<i> </i>
&gt;<i> Signed-off-by: Leo Li &lt;sunpeng.li@xxxxxxx&gt;</i>
&gt;<i> ---</i>
&gt;<i>  drivers/gpu/drm/drm_sysfs.c | 20 ++++++++++++++++++++</i>
&gt;<i>  1 file changed, 20 insertions(+)</i>
&gt;<i> </i>
&gt;<i> diff --git a/drivers/gpu/drm/drm_sysfs.c b/drivers/gpu/drm/drm_sysfs.c</i>
&gt;<i> index ad10810bc972..7d483ab684a0 100644</i>
&gt;<i> --- a/drivers/gpu/drm/drm_sysfs.c</i>
&gt;<i> +++ b/drivers/gpu/drm/drm_sysfs.c</i>
&gt;<i> @@ -236,16 +236,36 @@ static ssize_t modes_show(struct device *device,</i>
&gt;<i>  	return written;</i>
&gt;<i>  }</i>
&gt;<i>  </i>
&gt;<i> +static ssize_t mstpath_show(struct device *device,</i>
&gt;<i> +			    struct device_attribute *attr,</i>
&gt;<i> +			    char *buf)</i>
&gt;<i> +{</i>
&gt;<i> +	struct drm_connector *connector = to_drm_connector(device);</i>
&gt;<i> +	ssize_t ret = 0;</i>
&gt;<i> +	char *path;</i>
&gt;<i> +</i>
&gt;<i> +	if (!connector-&gt;path_blob_ptr)</i>
&gt;<i> +		return ret;</i>
&gt;<i> +</i>
&gt;<i> +	path = connector-&gt;path_blob_ptr-&gt;data;</i>
&gt;<i> +	ret = snprintf(buf, PAGE_SIZE, &quot;card%d-%s\n&quot;,</i>
&gt;<i> +		       connector-&gt;dev-&gt;primary-&gt;index, path);</i>
&gt;<i> +</i>
&gt;<i> +	return ret;</i>
&gt;<i> +}</i>
&gt;<i> +</i>
&gt;<i>  static DEVICE_ATTR_RW(status);</i>
&gt;<i>  static DEVICE_ATTR_RO(enabled);</i>
&gt;<i>  static DEVICE_ATTR_RO(dpms);</i>
&gt;<i>  static DEVICE_ATTR_RO(modes);</i>
&gt;<i> +static DEVICE_ATTR_RO(mstpath);</i>
&gt;<i>  </i>
&gt;<i>  static struct attribute *connector_dev_attrs[] = {</i>
&gt;<i>  	&amp;dev_attr_status.attr,</i>
&gt;<i>  	&amp;dev_attr_enabled.attr,</i>
&gt;<i>  	&amp;dev_attr_dpms.attr,</i>
&gt;<i>  	&amp;dev_attr_modes.attr,</i>
&gt;<i> +	&amp;dev_attr_mstpath.attr,</i>
&gt;<i>  	NULL</i>
&gt;<i>  };</i>
&gt;<i>  </i>

_______________________________________________
amd-gfx mailing list
amd-gfx@xxxxxxxxxxxxxxxxxxxxx
<a  rel="nofollow" href="https://lists.freedesktop.org/mailman/listinfo/amd-gfx">https://lists.freedesktop.org/mailman/listinfo/amd-gfx</a>



</pre>
<!--X-Body-of-Message-End-->
<!--X-MsgBody-End-->
<!--X-Follow-Ups-->
</div>
<hr>
<ul><li><strong>Follow-Ups</strong>:
<ul>
<li><strong><a name="36092" href="msg36092.html">Re: [PATCH v2] drm/sysfs: Add mstpath attribute to connector devices</a></strong>
<ul><li><em>From:</em> Li, Sun peng (Leo)</li></ul></li>
</ul></li></ul>
<!--X-Follow-Ups-End-->
<!--X-References-->
<ul><li><strong>References</strong>:
<ul>
<li><strong><a name="35559" href="msg35559.html">[PATCH 03/10] drm/sysfs: Add mstpath attribute to connector devices</a></strong>
<ul><li><em>From:</em> sunpeng.li</li></ul></li>
<li><strong><a name="35582" href="msg35582.html">[PATCH v2] drm/sysfs: Add mstpath attribute to connector devices</a></strong>
<ul><li><em>From:</em> sunpeng.li</li></ul></li>
</ul></li></ul>
<!--X-References-End-->
<!--X-BotPNI-->
<ul>
<li>Prev by Date:
<strong><a href="msg35706.html">Re: [PATCH 3/5] drm/ttm: Add release_notify callback to ttm_bo_driver</a></strong>
</li>
<li>Next by Date:
<strong><a href="msg35708.html">Re: [PATCH 02/10] drm/dp_mst: Enable registration of AUX devices for MST ports (v2)</a></strong>
</li>
<li>Previous by thread:
<strong><a href="msg35689.html">Re: [PATCH v2] drm/sysfs: Add mstpath attribute to connector devices</a></strong>
</li>
<li>Next by thread:
<strong><a href="msg36092.html">Re: [PATCH v2] drm/sysfs: Add mstpath attribute to connector devices</a></strong>
</li>
<li>Index(es):
<ul>
<li><a href="maillist.html#35707"><strong>Date</strong></a></li>
<li><a href="index.html#35707"><strong>Thread</strong></a></li>
</ul>
</li>
</ul>

<!--X-BotPNI-End-->
<!--X-User-Footer-->
<center>
<font size=-1>
<a href=/lists/>[Index&nbsp;of&nbsp;Archives]</a>
&nbsp;
&nbsp;
<a href=/lists/linux-usb/>[Linux&nbsp;USB&nbsp;Devel]</a>
&nbsp;
&nbsp;
<a href=/lists/linux-audio-users/>[Linux&nbsp;Audio&nbsp;Users]</a>
&nbsp;
&nbsp;
<a href=https://yosemitenews.info/>[Yosemite&nbsp;News]</a>
&nbsp;
&nbsp;
<a href=/lists/kernel/>[Linux&nbsp;Kernel]</a>
&nbsp;
&nbsp;
<a href=/lists/linux-scsi/>[Linux&nbsp;SCSI]</a>
</font>
</center>
<hr>
<p>
<div>
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<ins class="adsbygoogle"
     style="display:block"
     data-ad-format="autorelaxed"
     data-ad-client="ca-pub-3422782820843221"
     data-ad-slot="1424524564"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
</div>
<table width=100%>
<tr>
<td align=left>&nbsp;</td>
<td align=right><a href=/lists/><img src=/button_01.gif border=0 alt="Powered by Linux"></a></td>
</tr>
</table>
<!--X-User-Footer-End-->
<script type="text/javascript"> 
 function initAddThis() {
    addthis.init()
 }
initAddThis();
</script>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-760190-1', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
