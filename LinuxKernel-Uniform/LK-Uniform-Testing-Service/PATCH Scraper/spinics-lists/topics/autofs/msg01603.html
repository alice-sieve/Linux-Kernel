<!-- MHonArc v2.6.19 -->
<!--X-Subject: Re: [PATCH] Fix usage of uninitialized pointer -->
<!--X-From-R13: Wna Yrag &#60;eniraNgurznj.arg> -->
<!--X-Date: Thu, 1 Jun 2017 02:13:49 &#45;0700 -->
<!--X-Message-Id: 1496308413.2580.6.camel@themaw.net -->
<!--X-Content-Type: text/plain -->
<!--X-Reference: 1496151337&#45;21367&#45;1&#45;git&#45;send&#45;email&#45;buczek@molgen.mpg.de -->
<!--X-Reference: 1496190434.3804.1.camel@themaw.net -->
<!--X-Reference: 1496194664.3804.3.camel@themaw.net -->
<!--X-Reference: e4e26a3f&#45;7bda&#45;1c6a&#45;18e6&#45;af05c2490d6d@molgen.mpg.de -->
<!--X-Reference: 350fd28e&#45;8e61&#45;24b0&#45;f2e4&#45;38a4476c8108@molgen.mpg.de -->
<!--X-Head-End-->
<!doctype html public "-//W3C//DTD HTML//EN">
<html>
<head>
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({
          google_ad_client: "ca-pub-3422782820843221",
          enable_page_level_ads: true
     });
</script>
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="description" content="Re: [PATCH] Fix usage of uninitialized pointer &mdash; Linux AutoFS">
<style>
<!--
 pre {white-space: pre-wrap;}
-->
</style>
<title>Re: [PATCH] Fix usage of uninitialized pointer &mdash; Linux AutoFS</title>
<link rel="alternate" type="application/rss+xml" title="Linux AutoFS" href="//feeds.feedburner.com/autofs">
<script type="text/javascript">
var addthis_config = addthis_config||{};
addthis_config.data_track_addressbar = false;
</script>
</head>
<body itemscope itemtype="//schema.org/Article" vlink=green>
<!--X-Body-Begin-->
<!--X-User-Header-->
<!--X-User-Header-End-->
<!--X-TopPNI-->
<form action="//www.google.com/cse" id="cse-search-box" target="_blank">
  <div>
    <input type="hidden" name="cx" value="partner-pub-3422782820843221:isdiegq275o" />
    <input type="hidden" name="ie" value="ISO-8859-1" />
    <input type="text" name="q" size="37" />
    <input type="submit" name="sa" value="Search" />
  </div>
</form>
<script type="text/javascript" src="//www.google.com/cse/brand?form=cse-search-box&amp;lang=en"></script>
<h1 itemprop="name">Re: [PATCH] Fix usage of uninitialized pointer</h1>
[<a href="msg01602.html">Date Prev</a>][<a href="msg01604.html">Date Next</a>][<a href="msg01602.html">Thread Prev</a>][<a href="msg01604.html">Thread Next</a>][<a href="maillist.html#01603">Date Index</a>][<a href="index.html#01603">Thread Index</a>]


<p>&nbsp;<br>
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- responsive test for archives -->
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-3422782820843221"
     data-ad-slot="6345952567"
     data-ad-format="auto"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>

<!--X-TopPNI-End-->
<!--X-MsgBody-->
<!--X-Subject-Header-Begin-->
<hr>
<!--X-Subject-Header-End-->
<!--X-Head-of-Message-->
<ul>
<li><em>To</em>: Donald Buczek &lt;buczek@xxxxxxxxxxxxx&gt;</li>
<li><em>Subject</em>: Re: [PATCH] Fix usage of uninitialized pointer</li>
<li><em>From</em>: Ian Kent &lt;raven@xxxxxxxxxx&gt;</li>
<li><em>Date</em>: Thu, 01 Jun 2017 17:13:33 +0800</li>
<li><em>Cc</em>: autofs@xxxxxxxxxxxxxxx</li>
<li><em>In-reply-to</em>: &lt;<a href="msg01602.html">350fd28e-8e61-24b0-f2e4-38a4476c8108@molgen.mpg.de</a>&gt;</li>
<li><em>References</em>: &lt;<a href="msg01598.html">1496151337-21367-1-git-send-email-buczek@molgen.mpg.de</a>&gt;         &lt;<a href="msg01599.html">1496190434.3804.1.camel@themaw.net</a>&gt; &lt;<a href="msg01600.html">1496194664.3804.3.camel@themaw.net</a>&gt;         &lt;<a href="msg01601.html">e4e26a3f-7bda-1c6a-18e6-af05c2490d6d@molgen.mpg.de</a>&gt;         &lt;<a href="msg01602.html">350fd28e-8e61-24b0-f2e4-38a4476c8108@molgen.mpg.de</a>&gt;</li>
</ul>
<!--X-Head-of-Message-End-->
<!--X-Head-Body-Sep-Begin-->
<!-- AddThis Button BEGIN -->
<div class="addthis_toolbox addthis_default_style ">
<a class="addthis_button_preferred_1"></a>
<a class="addthis_button_preferred_2"></a>
<a class="addthis_button_preferred_3"></a>
<a class="addthis_button_preferred_4"></a>
<a class="addthis_button_compact"></a>
<a class="addthis_counter addthis_bubble_style"></a>
</div>
<script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5196c2ae1be43d18&async=1&domready=1" async></script>
<!-- AddThis Button END -->
<hr>
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- responsive link 1 -->
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-3422782820843221"
     data-ad-slot="8681825769"
     data-ad-format="link"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
<p>
<div class="content" itemprop="articleBody">
<!--X-Head-Body-Sep-End-->
<!--X-Body-of-Message-->
<pre>On Wed, 2017-05-31 at 22:28 +0200, Donald Buczek wrote:
&gt; On 31.05.2017 16:22, Donald Buczek wrote:
&gt; &gt; On 05/31/17 03:37, Ian Kent wrote:
&gt; &gt; &gt; On Wed, 2017-05-31 at 08:27 +0800, Ian Kent wrote:
&gt; &gt; &gt; &gt; On Tue, 2017-05-30 at 15:35 +0200, Donald Buczek wrote:
&gt; &gt; &gt; &gt; &gt; In the error path after a getgrgid_r failure (e.g. when a unnamed gid
&gt; &gt; &gt; &gt; &gt; was used), the pointer tsv-&gt;group was left unitialized. Still the tsv
&gt; &gt; &gt; &gt; &gt; was given to pthread_setspecific(key_thread_stdenv_vars,...) and the
&gt; &gt; &gt; &gt; &gt; consumers used and freed the uninitialized pointer.
&gt; &gt; &gt; &gt; 
&gt; &gt; &gt; &gt; Umm ... ok, I'll check ... good catch.
&gt; &gt; &gt; 
&gt; &gt; &gt; I think this bug will warrant another release.
&gt; &gt; &gt; 
&gt; &gt; &gt; &gt; &gt; &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;2017-05-29T18:16:11+02:00 rofl automount[14749]: attempting to
&gt; &gt; &gt; &gt; &gt; mount
&gt; &gt; &gt; &gt; &gt; entry
&gt; &gt; &gt; &gt; &gt; /package/twiki
&gt; &gt; &gt; &gt; &gt; &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;2017-05-29T18:16:11+02:00 rofl automount[14749]:
&gt; &gt; &gt; &gt; &gt; set_tsd_user_vars:
&gt; &gt; &gt; &gt; &gt; failed
&gt; &gt; &gt; &gt; &gt; to get group info from getgrgid_r
&gt; &gt; &gt; &gt; &gt; &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;2017-05-29T18:16:11+02:00 rofl automount[14749]: mounted
&gt; &gt; &gt; &gt; &gt; /package/twiki
&gt; &gt; &gt; &gt; &gt; &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;2017-05-29T18:16:11+02:00 rofl systemd[1]: automount.service:
&gt; &gt; &gt; &gt; &gt; main
&gt; &gt; &gt; &gt; &gt; process
&gt; &gt; &gt; &gt; &gt; exited, code=dumped, status=6
&gt; &gt; &gt; &gt; &gt; &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;2017-05-29T18:16:12+02:00 rofl systemd[1]: automount.service
&gt; &gt; &gt; &gt; &gt; holdoff
&gt; &gt; &gt; &gt; &gt; time
&gt; &gt; &gt; &gt; &gt; over, scheduling restart.
&gt; &gt; &gt; &gt; &gt; &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;2017-05-29T18:16:12+02:00 rofl systemd[1]: Unit automount.service
&gt; &gt; &gt; &gt; &gt; entered
&gt; &gt; &gt; &gt; &gt; failed state.
&gt; &gt; &gt; &gt; &gt; &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;2017-05-29T18:16:12+02:00 rofl automount[17936]: Starting
&gt; &gt; &gt; &gt; &gt; automounter
&gt; &gt; &gt; &gt; &gt; version 5.1.3, master map auto.master
&gt; &gt; &gt; &gt; &gt; 
&gt; &gt; &gt; &gt; &gt; &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;[May29 18:16] traps: automount[18234] general protection
&gt; &gt; &gt; &gt; &gt; ip:7f8b025c324a
&gt; &gt; &gt; &gt; &gt; sp:7f8b0049a508 error:0 in libc-2.19.so[7f8b02541000+1a2000]
&gt; &gt; &gt; &gt; &gt; 
&gt; &gt; &gt; &gt; &gt; Handle the error by not calling pthread_setspecific. Clean up
&gt; &gt; &gt; &gt; &gt; and return instead.
&gt; &gt; &gt; &gt; &gt; ---
&gt; &gt; &gt; &gt; &gt; &#xA0; lib/mounts.c | 21 ++++++++++++---------
&gt; &gt; &gt; &gt; &gt; &#xA0; 1 file changed, 12 insertions(+), 9 deletions(-)
&gt; &gt; &gt; &gt; &gt; 
&gt; &gt; &gt; &gt; &gt; diff --git a/lib/mounts.c b/lib/mounts.c
&gt; &gt; &gt; &gt; &gt; index ce6a60a..fe1a6cd 100644
&gt; &gt; &gt; &gt; &gt; --- a/lib/mounts.c
&gt; &gt; &gt; &gt; &gt; +++ b/lib/mounts.c
&gt; &gt; &gt; &gt; &gt; @@ -1552,28 +1552,31 @@ void set_tsd_user_vars(unsigned int logopt,
&gt; &gt; &gt; &gt; &gt; uid_t
&gt; &gt; &gt; &gt; &gt; uid,
&gt; &gt; &gt; &gt; &gt; gid_t gid)
&gt; &gt; &gt; &gt; &gt; &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;}
&gt; &gt; &gt; &gt; &gt; &#xA0;&#xA0;&#xA0;&#xA0;no_group:
&gt; &gt; &gt; &gt; &gt; -&#xA0;&#xA0;&#xA0;&#xA0;if (status || !pgr)
&gt; &gt; &gt; &gt; &gt; +&#xA0;&#xA0;&#xA0;&#xA0;if (status || !pgr) {
&gt; &gt; &gt; &gt; &gt; &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;error(logopt, &quot;failed to get group info from getgrgid_r&quot;);
&gt; &gt; &gt; &gt; &gt; -&#xA0;&#xA0;&#xA0;&#xA0;else {
&gt; &gt; &gt; &gt; 
&gt; &gt; &gt; &gt; Extra braces, I leave these out (when I can) on single statement clauses
&gt; &gt; &gt; &gt; deliberately and always try to put the single statement as the first
&gt; &gt; &gt; &gt; branch of
&gt; &gt; &gt; &gt; the if.
&gt; &gt; &gt; &gt; 
&gt; &gt; &gt; &gt; &gt; +&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;goto free_gr_tmp;
&gt; &gt; &gt; &gt; &gt; +&#xA0;&#xA0;&#xA0;&#xA0;} else {
&gt; &gt; &gt; &gt; &gt; &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;tsv-&gt;group = strdup(gr.gr_name);
&gt; &gt; &gt; &gt; &gt; -&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;if (!tsv-&gt;group)
&gt; &gt; &gt; &gt; &gt; +&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;if (!tsv-&gt;group) {
&gt; &gt; &gt; &gt; &gt; &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;error(logopt, &quot;failed to malloc buffer for group&quot;);
&gt; &gt; &gt; &gt; &gt; +&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;goto free_gr_tmp;
&gt; &gt; &gt; &gt; &gt; +&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;}
&gt; &gt; &gt; &gt; &gt; &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;}
&gt; &gt; &gt; &gt; &gt; &#xA0; -&#xA0;&#xA0;&#xA0;&#xA0;if (gr_tmp)
&gt; &gt; &gt; &gt; &gt; -&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;free(gr_tmp);
&gt; &gt; &gt; &gt; &gt; -
&gt; &gt; &gt; &gt; &gt; &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;status = pthread_setspecific(key_thread_stdenv_vars, tsv);
&gt; &gt; &gt; &gt; &gt; &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;if (status) {
&gt; &gt; &gt; &gt; &gt; &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;error(logopt, &quot;failed to set stdenv thread var&quot;);
&gt; &gt; &gt; &gt; &gt; &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;goto free_tsv_group;
&gt; &gt; &gt; &gt; &gt; &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;}
&gt; &gt; &gt; &gt; &gt; -
&gt; &gt; &gt; &gt; &gt; +&#xA0;&#xA0;&#xA0;&#xA0;if (gr_tmp)
&gt; &gt; &gt; &gt; &gt; +&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;free(gr_tmp);
&gt; &gt; &gt; &gt; 
&gt; &gt; &gt; &gt; But this doesn't do what I intended.
&gt; &gt; &gt; &gt; 
&gt; &gt; &gt; &gt; What I want to do is set the thread specific standard variables even
&gt; &gt; &gt; &gt; if the
&gt; &gt; &gt; &gt; group name can't be obtained.
&gt; &gt; &gt; &gt; 
&gt; &gt; &gt; &gt; It looks like I've made an assumption elsewhere that if the tsd is
&gt; &gt; &gt; &gt; set then
&gt; &gt; &gt; &gt; all
&gt; &gt; &gt; &gt; the variables have valid values, I'd rather fix that than do this.
&gt; &gt; &gt; 
&gt; &gt; &gt; I would prefer to do this instead.
&gt; &gt; &gt; 
&gt; &gt; &gt; Could you check this resolves the problem you have seen please.
&gt; &gt; 
&gt; &gt; Sorry, the patch doesn't apply, because it is line wrapped and contains
&gt; &gt; utf8 unicode non breaking space characters. Can I pull it?
&gt; 
&gt; 
&gt; Never mind, edited it in by hand.
&gt; 
&gt; I can confirm, that the bug is fixed.
&gt; 
&gt; Test procedure:
&gt; 
&gt; run
&gt; 
&gt; &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;valgrind --leak-check=full daemon/automount -f -v
&gt; 
&gt; in one shell. Run
&gt; 
&gt; &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;perl -e '$(=65533;$)=65533;system(&quot;ls /project/SOME_AUTOMOUNT_PATH&quot;)'
&gt; 
&gt; in another.
&gt; 
&gt; Result from master (release_5.1.3) are several valgrind warnings and&#xA0;
&gt; death by segv:
&gt; 
&gt; &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;set_tsd_user_vars: failed to get group info from getgrgid_r
&gt; &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;==18686== Use of uninitialised value of size 8
&gt; &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;==18686==&#xA0;&#xA0;&#xA0;&#xA0;at 0x4C2AAF2: strlen (vg_replace_strmem.c:454)
&gt; &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;==18686==&#xA0;&#xA0;&#xA0;&#xA0;by 0x619FF8D: strdup (strdup.c:41)
&gt; &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;[...]
&gt; &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;==18686== Invalid read of size 1
&gt; &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;==18686==&#xA0;&#xA0;&#xA0;&#xA0;at 0x4C2AAF2: strlen (vg_replace_strmem.c:454)
&gt; &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;==18686==&#xA0;&#xA0;&#xA0;&#xA0;by 0x619FF8D: strdup (strdup.c:41)
&gt; &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;==18686==&#xA0;&#xA0;&#xA0;&#xA0;by 0x13A18D: macro_addvar (macros.c:305)
&gt; &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;[...]
&gt; &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;==18686==&#xA0;&#xA0;Address 0x0 is not stack'd, malloc'd or (recently) free'd
&gt; &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;==18686== Process terminating with default action of signal 11&#xA0;
&gt; (SIGSEGV): dumping core
&gt; &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;==18686==&#xA0;&#xA0;Access not within mapped region at address 0x0
&gt; &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;==18686==&#xA0;&#xA0;&#xA0;&#xA0;at 0x4C2AAF2: strlen (vg_replace_strmem.c:454)
&gt; &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;==18686==&#xA0;&#xA0;&#xA0;&#xA0;by 0x619FF8D: strdup (strdup.c:41)
&gt; &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;==18686==&#xA0;&#xA0;&#xA0;&#xA0;by 0x13A18D: macro_addvar (macros.c:305)
&gt; &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;==18686==&#xA0;&#xA0;&#xA0;&#xA0;by 0x12F1E4: do_macro_addvar (mounts.c:368)
&gt; 
&gt; Result with you patch on top: No errors (aside from expected&#xA0;
&gt; &quot;set_tsd_user_vars: failed to get group info from getgrgid_r&quot;) and a&#xA0;
&gt; mounted directory.
&gt; 
&gt; Didn't try to expand the variables in a map, though.
&gt; 
&gt; Thumbs up from my side.

Thanks for doing this.

&gt; 
&gt; &#xA0;&#xA0;&#xA0;Donald
&gt; 
&gt; 
&gt; 
&gt; &gt; 
&gt; &gt; Donald
&gt; &gt; 
&gt; &gt; 
&gt; &gt; &gt; 
&gt; &gt; &gt; autofs-5.1.3 - fix unset tsd group name handling
&gt; &gt; &gt; 
&gt; &gt; &gt; From: Ian Kent &lt;raven@xxxxxxxxxx&gt;
&gt; &gt; &gt; 
&gt; &gt; &gt; Commit 1a64a6bbc5 changed set_tsd_user_vars() to set the thread specific
&gt; &gt; &gt; values even if the group name could not be obtained.
&gt; &gt; &gt; 
&gt; &gt; &gt; But the structure holding the values was not initialized on allocation
&gt; &gt; &gt; so the group field might not be NULL when no group name is available.
&gt; &gt; &gt; 
&gt; &gt; &gt; Also the macro addition and removal functions didn't handle setting a
&gt; &gt; &gt; macro name with a NULL value.
&gt; &gt; &gt; 
&gt; &gt; &gt; Signed-off-by: Ian Kent &lt;raven@xxxxxxxxxx&gt;
&gt; &gt; &gt; Reported-by: Donald Buczek &lt;buczek@xxxxxxxxxxxxx&gt;
&gt; &gt; &gt; ---
&gt; &gt; &gt; &#xA0; lib/macros.c |&#xA0;&#xA0;&#xA0;27 +++++++++++++--------------
&gt; &gt; &gt; &#xA0; lib/mounts.c |&#xA0;&#xA0;&#xA0;&#xA0;1 +
&gt; &gt; &gt; &#xA0; 2 files changed, 14 insertions(+), 14 deletions(-)
&gt; &gt; &gt; 
&gt; &gt; &gt; diff --git a/lib/macros.c b/lib/macros.c
&gt; &gt; &gt; index ff9ba89..30dbcdb 100644
&gt; &gt; &gt; --- a/lib/macros.c
&gt; &gt; &gt; +++ b/lib/macros.c
&gt; &gt; &gt; @@ -281,19 +281,21 @@ macro_addvar(struct substvar *table, const char
&gt; &gt; &gt; *str, int
&gt; &gt; &gt; len, const char *value
&gt; &gt; &gt; &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;}
&gt; &gt; &gt; &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;if (lv) {
&gt; &gt; &gt; -&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;char *this = malloc(strlen(value) + 1);
&gt; &gt; &gt; -&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;if (!this) {
&gt; &gt; &gt; -&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;lv = table;
&gt; &gt; &gt; -&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;goto done;
&gt; &gt; &gt; +&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;char *this = NULL;
&gt; &gt; &gt; +
&gt; &gt; &gt; +&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;if (value) {
&gt; &gt; &gt; +&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;this = malloc(strlen(value) + 1);
&gt; &gt; &gt; +&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;if (this)
&gt; &gt; &gt; +&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;strcpy(this, value);
&gt; &gt; &gt; &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;}
&gt; &gt; &gt; -&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;strcpy(this, value);
&gt; &gt; &gt; -&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;free(lv-&gt;val);
&gt; &gt; &gt; +&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;if (lv-&gt;val)
&gt; &gt; &gt; +&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;free(lv-&gt;val);
&gt; &gt; &gt; &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;lv-&gt;val = this;
&gt; &gt; &gt; &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;if (lv != table)
&gt; &gt; &gt; &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;lv = table;
&gt; &gt; &gt; &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;} else {
&gt; &gt; &gt; &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;struct substvar *new;
&gt; &gt; &gt; -&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;char *def, *val;
&gt; &gt; &gt; +&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;char *def, *val = NULL;
&gt; &gt; &gt; &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;def = strdup(str);
&gt; &gt; &gt; &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;if (!def) {
&gt; &gt; &gt; @@ -302,18 +304,15 @@ macro_addvar(struct substvar *table, const char
&gt; &gt; &gt; *str, int
&gt; &gt; &gt; len, const char *value
&gt; &gt; &gt; &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;}
&gt; &gt; &gt; &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;def[len] = '\0';
&gt; &gt; &gt; &#xA0; -&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;val = strdup(value);
&gt; &gt; &gt; -&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;if (!val) {
&gt; &gt; &gt; -&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;lv = table;
&gt; &gt; &gt; -&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;free(def);
&gt; &gt; &gt; -&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;goto done;
&gt; &gt; &gt; -&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;}
&gt; &gt; &gt; +&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;if (value)
&gt; &gt; &gt; +&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;val = strdup(value);
&gt; &gt; &gt; &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;new = malloc(sizeof(struct substvar));
&gt; &gt; &gt; &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;if (!new) {
&gt; &gt; &gt; &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;lv = table;
&gt; &gt; &gt; &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;free(def);
&gt; &gt; &gt; -&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;free(val);
&gt; &gt; &gt; +&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;if (val)
&gt; &gt; &gt; +&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;free(val);
&gt; &gt; &gt; &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;goto done;
&gt; &gt; &gt; &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;}
&gt; &gt; &gt; &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;new-&gt;def = def;
&gt; &gt; &gt; diff --git a/lib/mounts.c b/lib/mounts.c
&gt; &gt; &gt; index ce6a60a..0b38bd8 100644
&gt; &gt; &gt; --- a/lib/mounts.c
&gt; &gt; &gt; +++ b/lib/mounts.c
&gt; &gt; &gt; @@ -1463,6 +1463,7 @@ void set_tsd_user_vars(unsigned int logopt,
&gt; &gt; &gt; uid_t uid,
&gt; &gt; &gt; gid_t gid)
&gt; &gt; &gt; &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;error(logopt, &quot;failed alloc tsv storage&quot;);
&gt; &gt; &gt; &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;return;
&gt; &gt; &gt; &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;}
&gt; &gt; &gt; +&#xA0;&#xA0;&#xA0;&#xA0;memset(tsv, 0, sizeof(struct thread_stdenv_vars));
&gt; &gt; &gt; &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;tsv-&gt;uid = uid;
&gt; &gt; &gt; &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;tsv-&gt;gid = gid;
&gt; &gt; 
&gt; &gt; 
&gt; 
&gt; 
--
To unsubscribe from this list: send the line &quot;unsubscribe autofs&quot; in


</pre>
<!--X-Body-of-Message-End-->
<!--X-MsgBody-End-->
<!--X-Follow-Ups-->
</div>
<hr>
<!--X-Follow-Ups-End-->
<!--X-References-->
<ul><li><strong>References</strong>:
<ul>
<li><strong><a name="01598" href="msg01598.html">[PATCH] Fix usage of uninitialized pointer</a></strong>
<ul><li><em>From:</em> Donald Buczek</li></ul></li>
<li><strong><a name="01599" href="msg01599.html">Re: [PATCH] Fix usage of uninitialized pointer</a></strong>
<ul><li><em>From:</em> Ian Kent</li></ul></li>
<li><strong><a name="01600" href="msg01600.html">Re: [PATCH] Fix usage of uninitialized pointer</a></strong>
<ul><li><em>From:</em> Ian Kent</li></ul></li>
<li><strong><a name="01601" href="msg01601.html">Re: [PATCH] Fix usage of uninitialized pointer</a></strong>
<ul><li><em>From:</em> Donald Buczek</li></ul></li>
<li><strong><a name="01602" href="msg01602.html">Re: [PATCH] Fix usage of uninitialized pointer</a></strong>
<ul><li><em>From:</em> Donald Buczek</li></ul></li>
</ul></li></ul>
<!--X-References-End-->
<!--X-BotPNI-->
<ul>
<li>Prev by Date:
<strong><a href="msg01602.html">Re: [PATCH] Fix usage of uninitialized pointer</a></strong>
</li>
<li>Next by Date:
<strong><a href="msg01604.html">[autofs PATCH] Add -c option when calling /bin/umount - if supported.</a></strong>
</li>
<li>Previous by thread:
<strong><a href="msg01602.html">Re: [PATCH] Fix usage of uninitialized pointer</a></strong>
</li>
<li>Next by thread:
<strong><a href="msg01604.html">[autofs PATCH] Add -c option when calling /bin/umount - if supported.</a></strong>
</li>
<li>Index(es):
<ul>
<li><a href="maillist.html#01603"><strong>Date</strong></a></li>
<li><a href="index.html#01603"><strong>Thread</strong></a></li>
</ul>
</li>
</ul>

<!--X-BotPNI-End-->
<!--X-User-Footer-->
<center>
<font size=-1>
<a href=/lists/>[Index&nbsp;of&nbsp;Archives]</a>
&nbsp;
&nbsp;
<a href=/lists/linux-fsdevel/>[Linux&nbsp;Filesystem&nbsp;Development]</a>
&nbsp;
&nbsp;
<a href=/lists/linux-ext4/>[Linux&nbsp;Ext4]</a>
&nbsp;
&nbsp;
<a href=/lists/arm-kernel/>[Linux&nbsp;ARM&nbsp;Kernel]</a>
&nbsp;
&nbsp;
<a href=/lists/arm/>[Linux&nbsp;ARM]</a>
&nbsp;
&nbsp;
<a href=/lists/linux-omap/>[Linux&nbsp;Omap]</a>
&nbsp;
&nbsp;
<a href=/linux/fedora/fedora-arm/>[Fedora&nbsp;ARM]</a>
&nbsp;
&nbsp;
<a href=/lists/ietf-ann/>[IETF&nbsp;Annouce]</a>
&nbsp;
&nbsp;
<a href=/lists/security/>[Security]</a>
&nbsp;
&nbsp;
<a href=/lists/bugtraq/>[Bugtraq]</a>
&nbsp;
&nbsp;
<a href=/linux/>[Linux]</a>
&nbsp;
&nbsp;
<a href=/lists/linux-omap/>[Linux&nbsp;OMAP]</a>
&nbsp;
&nbsp;
<a href=/lists/mips/>[Linux&nbsp;MIPS]</a>
&nbsp;
&nbsp;
<a href=/lists/ecos/>[ECOS]</a>
&nbsp;
&nbsp;
<a href=/lists/asterisk/>[Asterisk&nbsp;Internet&nbsp;PBX]</a>
&nbsp;
&nbsp;
<a href=/lists/linux-api/>[Linux&nbsp;API]</a>
</font>
</center>
<hr>
<p>
<div>
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<ins class="adsbygoogle"
     style="display:block"
     data-ad-format="autorelaxed"
     data-ad-client="ca-pub-3422782820843221"
     data-ad-slot="1424524564"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
</div>
<table width=100%>
<tr>
<td align=left>&nbsp;</td>
<td align=right><a href=/lists/><img src=/button_01.gif border=0 alt="Powered by Linux"></a></td>
</tr>
</table>
<!--X-User-Footer-End-->
<script type="text/javascript"> 
 function initAddThis() {
    addthis.init()
 }
initAddThis();
</script>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-760190-1', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
