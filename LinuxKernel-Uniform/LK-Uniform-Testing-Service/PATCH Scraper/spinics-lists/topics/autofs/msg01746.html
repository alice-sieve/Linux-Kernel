<!-- MHonArc v2.6.19 -->
<!--X-Subject: Re: [PATCH 12/35] autofs&#45;5.1.3 &#45; fix a couple of compiler warnings -->
<!--X-From-R13: Xrss [nubarl &#60;wrsszNfhfr.pbz> -->
<!--X-Date: Wed, 18 Oct 2017 13:46:24 &#45;0700 -->
<!--X-Message-Id: cf4f19a9&#45;cbf4&#45;2077&#45;a26a&#45;922268c80507@suse.com -->
<!--X-Content-Type: multipart/signed -->
<!--X-Reference: 150813019190.25695.13810689562896522990.stgit@pluto.themaw.net -->
<!--X-Reference: 150813043348.25695.10697953082315362911.stgit@pluto.themaw.net -->
<!--X-Derived: pgp0DYWVXfubx.pgp -->
<!--X-Head-End-->
<!doctype html public "-//W3C//DTD HTML//EN">
<html>
<head>
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({
          google_ad_client: "ca-pub-3422782820843221",
          enable_page_level_ads: true
     });
</script>
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="description" content="Re: [PATCH 12/35] autofs-5.1.3 - fix a couple of compiler warnings &mdash; Linux AutoFS">
<style>
<!--
 pre {white-space: pre-wrap;}
-->
</style>
<title>Re: [PATCH 12/35] autofs-5.1.3 - fix a couple of compiler warnings &mdash; Linux AutoFS</title>
<link rel="alternate" type="application/rss+xml" title="Linux AutoFS" href="//feeds.feedburner.com/autofs">
<script type="text/javascript">
var addthis_config = addthis_config||{};
addthis_config.data_track_addressbar = false;
</script>
</head>
<body itemscope itemtype="//schema.org/Article" vlink=green>
<!--X-Body-Begin-->
<!--X-User-Header-->
<!--X-User-Header-End-->
<!--X-TopPNI-->
<form action="//www.google.com/cse" id="cse-search-box" target="_blank">
  <div>
    <input type="hidden" name="cx" value="partner-pub-3422782820843221:isdiegq275o" />
    <input type="hidden" name="ie" value="ISO-8859-1" />
    <input type="text" name="q" size="37" />
    <input type="submit" name="sa" value="Search" />
  </div>
</form>
<script type="text/javascript" src="//www.google.com/cse/brand?form=cse-search-box&amp;lang=en"></script>
<h1 itemprop="name">Re: [PATCH 12/35] autofs-5.1.3 - fix a couple of compiler warnings</h1>
[<a href="msg01745.html">Date Prev</a>][<a href="msg01747.html">Date Next</a>][<a href="msg01737.html">Thread Prev</a>][<a href="msg01747.html">Thread Next</a>][<a href="maillist.html#01746">Date Index</a>][<a href="index.html#01746">Thread Index</a>]


<p>&nbsp;<br>
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- responsive test for archives -->
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-3422782820843221"
     data-ad-slot="6345952567"
     data-ad-format="auto"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>

<!--X-TopPNI-End-->
<!--X-MsgBody-->
<!--X-Subject-Header-Begin-->
<hr>
<!--X-Subject-Header-End-->
<!--X-Head-of-Message-->
<ul>
<li><em>To</em>: Ian Kent &lt;raven@xxxxxxxxxx&gt;,        autofs mailing list &lt;autofs@xxxxxxxxxxxxxxx&gt;</li>
<li><em>Subject</em>: Re: [PATCH 12/35] autofs-5.1.3 - fix a couple of compiler warnings</li>
<li><em>From</em>: Jeff Mahoney &lt;jeffm@xxxxxxxx&gt;</li>
<li><em>Date</em>: Wed, 18 Oct 2017 16:46:11 -0400</li>
<li><em>In-reply-to</em>: &lt;<a href="msg01737.html">150813043348.25695.10697953082315362911.stgit@pluto.themaw.net</a>&gt;</li>
<li><em>References</em>: &lt;<a href="msg01722.html">150813019190.25695.13810689562896522990.stgit@pluto.themaw.net</a>&gt; &lt;<a href="msg01737.html">150813043348.25695.10697953082315362911.stgit@pluto.themaw.net</a>&gt;</li>
<li><em>User-agent</em>: Mozilla/5.0 (Macintosh; Intel Mac OS X 10.12; rv:52.0) Gecko/20100101 Thunderbird/52.4.0</li>
</ul>
<!--X-Head-of-Message-End-->
<!--X-Head-Body-Sep-Begin-->
<!-- AddThis Button BEGIN -->
<div class="addthis_toolbox addthis_default_style ">
<a class="addthis_button_preferred_1"></a>
<a class="addthis_button_preferred_2"></a>
<a class="addthis_button_preferred_3"></a>
<a class="addthis_button_preferred_4"></a>
<a class="addthis_button_compact"></a>
<a class="addthis_counter addthis_bubble_style"></a>
</div>
<script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5196c2ae1be43d18&async=1&domready=1" async></script>
<!-- AddThis Button END -->
<hr>
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- responsive link 1 -->
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-3422782820843221"
     data-ad-slot="8681825769"
     data-ad-format="link"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
<p>
<div class="content" itemprop="articleBody">
<!--X-Head-Body-Sep-End-->
<!--X-Body-of-Message-->
<pre>On 10/16/17 1:07 AM, Ian Kent wrote:
&gt; Fix a few compiler warnings that have been around far too long.

Hi Ian -
&gt; diff --git a/daemon/spawn.c b/daemon/spawn.c
&gt; index 4515607b..b931d678 100644
&gt; --- a/daemon/spawn.c
&gt; +++ b/daemon/spawn.c
&gt; @@ -195,8 +195,14 @@ static int do_spawn(unsigned logopt, unsigned int wait,
&gt;  			 * program group to trigger mount
&gt;  			 */
&gt;  			if (euid) {
&gt; -				seteuid(euid);
&gt; -				setegid(egid);
&gt; +				if (seteuid(euid) == -1)
&gt; +					fprintf(stderr,
&gt; +						&quot;warning: seteuid: %s\n&quot;,
&gt; +						strerror(errno));
&gt; +				if (setegid(egid) == -1)
&gt; +					fprintf(stderr,
&gt; +						&quot;warning: setegid: %s\n&quot;,
&gt; +						strerror(errno));
&gt;  			}
&gt;  			setpgrp();


This one fixes the warning but there are a few issues with it, but none
of them are new.

1) We'll see that second warning *every* time since we just dropped root
privs and no longer have permission to change groups.  That's a bug
that's been lurking there for a while but now we're informed of it.

2) We're only changing the primary group and not the supplementary
groups, so the open is being performed with root's other group
membership (if any) and none of the user's other groups.

3) Do we really want to continue if we couldn't setuid?

I'll post a patch to address the first two as a reply to this post.
What's your take on point 3?

-Jeff

-- 
Jeff Mahoney
SUSE Labs

</pre><p><strong>Attachment:
<a href="attachments/pgp0DYWVXfubx.pgp" ><tt>signature.asc</tt></a></strong><br>
<em>Description:</em> OpenPGP digital signature</p>

<!--X-Body-of-Message-End-->
<!--X-MsgBody-End-->
<!--X-Follow-Ups-->
</div>
<hr>
<ul><li><strong>Follow-Ups</strong>:
<ul>
<li><strong><a name="01749" href="msg01749.html">[PATCH v2] autofs-5.1.3 - fix ordering of seteuid/setegid in do_spawn</a></strong>
<ul><li><em>From:</em> Jeff Mahoney</li></ul></li>
<li><strong><a name="01747" href="msg01747.html">[PATCH] autofs-5.1.3 - fix ordering of seteuid/setegid in do_spawn</a></strong>
<ul><li><em>From:</em> Jeff Mahoney</li></ul></li>
</ul></li></ul>
<!--X-Follow-Ups-End-->
<!--X-References-->
<ul><li><strong>References</strong>:
<ul>
<li><strong><a name="01722" href="msg01722.html">[PATCH 00/35] Current autofs patch queue (lets try again)</a></strong>
<ul><li><em>From:</em> Ian Kent</li></ul></li>
<li><strong><a name="01737" href="msg01737.html">[PATCH 12/35] autofs-5.1.3 - fix a couple of compiler warnings</a></strong>
<ul><li><em>From:</em> Ian Kent</li></ul></li>
</ul></li></ul>
<!--X-References-End-->
<!--X-BotPNI-->
<ul>
<li>Prev by Date:
<strong><a href="msg01745.html">Re: [PATCH 26/35] autofs-5.1.3 - document ghost option in auto.master man page</a></strong>
</li>
<li>Next by Date:
<strong><a href="msg01747.html">[PATCH] autofs-5.1.3 - fix ordering of seteuid/setegid in do_spawn</a></strong>
</li>
<li>Previous by thread:
<strong><a href="msg01737.html">[PATCH 12/35] autofs-5.1.3 - fix a couple of compiler warnings</a></strong>
</li>
<li>Next by thread:
<strong><a href="msg01747.html">[PATCH] autofs-5.1.3 - fix ordering of seteuid/setegid in do_spawn</a></strong>
</li>
<li>Index(es):
<ul>
<li><a href="maillist.html#01746"><strong>Date</strong></a></li>
<li><a href="index.html#01746"><strong>Thread</strong></a></li>
</ul>
</li>
</ul>

<!--X-BotPNI-End-->
<!--X-User-Footer-->
<center>
<font size=-1>
<a href=/lists/>[Index&nbsp;of&nbsp;Archives]</a>
&nbsp;
&nbsp;
<a href=/lists/linux-fsdevel/>[Linux&nbsp;Filesystem&nbsp;Development]</a>
&nbsp;
&nbsp;
<a href=/lists/linux-ext4/>[Linux&nbsp;Ext4]</a>
&nbsp;
&nbsp;
<a href=/lists/arm-kernel/>[Linux&nbsp;ARM&nbsp;Kernel]</a>
&nbsp;
&nbsp;
<a href=/lists/arm/>[Linux&nbsp;ARM]</a>
&nbsp;
&nbsp;
<a href=/lists/linux-omap/>[Linux&nbsp;Omap]</a>
&nbsp;
&nbsp;
<a href=/linux/fedora/fedora-arm/>[Fedora&nbsp;ARM]</a>
&nbsp;
&nbsp;
<a href=/lists/ietf-ann/>[IETF&nbsp;Annouce]</a>
&nbsp;
&nbsp;
<a href=/lists/security/>[Security]</a>
&nbsp;
&nbsp;
<a href=/lists/bugtraq/>[Bugtraq]</a>
&nbsp;
&nbsp;
<a href=/linux/>[Linux]</a>
&nbsp;
&nbsp;
<a href=/lists/linux-omap/>[Linux&nbsp;OMAP]</a>
&nbsp;
&nbsp;
<a href=/lists/mips/>[Linux&nbsp;MIPS]</a>
&nbsp;
&nbsp;
<a href=/lists/ecos/>[ECOS]</a>
&nbsp;
&nbsp;
<a href=/lists/asterisk/>[Asterisk&nbsp;Internet&nbsp;PBX]</a>
&nbsp;
&nbsp;
<a href=/lists/linux-api/>[Linux&nbsp;API]</a>
</font>
</center>
<hr>
<p>
<div>
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<ins class="adsbygoogle"
     style="display:block"
     data-ad-format="autorelaxed"
     data-ad-client="ca-pub-3422782820843221"
     data-ad-slot="1424524564"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
</div>
<table width=100%>
<tr>
<td align=left>&nbsp;</td>
<td align=right><a href=/lists/><img src=/button_01.gif border=0 alt="Powered by Linux"></a></td>
</tr>
</table>
<!--X-User-Footer-End-->
<script type="text/javascript"> 
 function initAddThis() {
    addthis.init()
 }
initAddThis();
</script>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-760190-1', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
