<!-- MHonArc v2.6.19 -->
<!--X-Subject: Re:  [PATCH 2/3] ASoC: fsl_sai: derive TX FIFO watermark from FIFO depth -->
<!--X-From-R13: Oathf Ovafyvr &#60;nathfNnxxrn.pn> -->
<!--X-Date: Thu, 18 Jul 2019 03:35:21 &#45;0700 -->
<!--X-Message-Id: 6cc95da1373307eb2bace8b4af3c884d@akkea.ca -->
<!--X-Content-Type: text/plain -->
<!--X-Reference: 20190717105635.18514&#45;1&#45;l.stach@pengutronix.de -->
<!--X-Reference: 20190717105635.18514&#45;3&#45;l.stach@pengutronix.de -->
<!--X-Head-End-->
<!doctype html public "-//W3C//DTD HTML//EN">
<html>
<head>
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({
          google_ad_client: "ca-pub-3422782820843221",
          enable_page_level_ads: true
     });
</script>
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="description" content="Re:  [PATCH 2/3] ASoC: fsl_sai: derive TX FIFO watermark from FIFO depth &mdash; ALSA Devel">
<style>
<!--
 pre {white-space: pre-wrap;}
-->
</style>
<title>Re:  [PATCH 2/3] ASoC: fsl_sai: derive TX FIFO watermark from FIFO depth &mdash; ALSA Devel</title>
<link rel="alternate" type="application/rss+xml" title="ALSA Devel" href="//feedproxy.google.com/AlsaDevel">
</head>
<body itemscope itemtype="//schema.org/Article" vlink=green>
<!--X-Body-Begin-->
<!--X-User-Header-->
<!--X-User-Header-End-->
<!--X-TopPNI-->
<form action="//www.google.com" id="cse-search-box" target="_blank">
  <div>
    <input type="hidden" name="cx" value="partner-pub-3422782820843221:9580497365" />
    <input type="hidden" name="ie" value="UTF-8" />
    <input type="text" name="q" size="25" />
    <input type="submit" name="sa" value="Search" />
  </div>
</form>
<script type="text/javascript" src="//www.google.com/coop/cse/brand?form=cse-search-box&amp;lang=en"></script>
<h1 itemprop="name">Re:  [PATCH 2/3] ASoC: fsl_sai: derive TX FIFO watermark from FIFO depth</h1>
[<a href="msg93899.html">Date Prev</a>][<a href="msg93901.html">Date Next</a>][<a href="msg93849.html">Thread Prev</a>][<a href="msg93852.html">Thread Next</a>][<a href="maillist.html#93900">Date Index</a>][<a href="threads.html#93900">Thread Index</a>]


<p>&nbsp;<br>
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- responsive test for archives -->
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-3422782820843221"
     data-ad-slot="6345952567"
     data-ad-format="auto"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>

<!--X-TopPNI-End-->
<!--X-MsgBody-->
<!--X-Subject-Header-Begin-->
<hr>
<!--X-Subject-Header-End-->
<!--X-Head-of-Message-->
<ul>
<li><em>To</em>: Lucas Stach &lt;l.stach@xxxxxxxxxxxxxx&gt;</li>
<li><em>Subject</em>: Re:  [PATCH 2/3] ASoC: fsl_sai: derive TX FIFO watermark from FIFO depth</li>
<li><em>From</em>: Angus Ainslie &lt;angus@xxxxxxxx&gt;</li>
<li><em>Date</em>: Wed, 17 Jul 2019 07:43:18 -0600</li>
<li><em>Cc</em>: alsa-devel@xxxxxxxxxxxxxxxx, Timur Tabi &lt;timur@xxxxxxxxxx&gt;,        Xiubo Li &lt;Xiubo.Lee@xxxxxxxxx&gt;, Liam Girdwood &lt;lgirdwood@xxxxxxxxx&gt;,        patchwork-lst@xxxxxxxxxxxxxx, Nicolin Chen &lt;nicoleotsuka@xxxxxxxxx&gt;,        Mark Brown &lt;broonie@xxxxxxxxxx&gt;, NXP Linux Team &lt;linux-imx@xxxxxxx&gt;,        kernel@xxxxxxxxxxxxxx, Fabio Estevam &lt;festevam@xxxxxxxxx&gt;</li>
<li><em>In-reply-to</em>: &lt;<a href="msg93849.html">20190717105635.18514-3-l.stach@pengutronix.de</a>&gt;</li>
<li><em>References</em>: &lt;<a href="msg93846.html">20190717105635.18514-1-l.stach@pengutronix.de</a>&gt; &lt;<a href="msg93849.html">20190717105635.18514-3-l.stach@pengutronix.de</a>&gt;</li>
<li><em>User-agent</em>: Roundcube Webmail/1.3.6</li>
</ul>
<!--X-Head-of-Message-End-->
<!--X-Head-Body-Sep-Begin-->
<!-- AddThis Button BEGIN -->
<div class="addthis_toolbox addthis_default_style ">
<a class="addthis_button_preferred_1"></a>
<a class="addthis_button_preferred_2"></a>
<a class="addthis_button_preferred_3"></a>
<a class="addthis_button_preferred_4"></a>
<a class="addthis_button_compact"></a>
<a class="addthis_counter addthis_bubble_style"></a>
</div>
<script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5196c2ae1be43d18&async=1&domready=1" async></script>
<!-- AddThis Button END -->
<hr>
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- responsive link 1 -->
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-3422782820843221"
     data-ad-slot="8681825769"
     data-ad-format="link"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
<p>
<div class="content" itemprop="articleBody">
<!--X-Head-Body-Sep-End-->
<!--X-Body-of-Message-->
<pre style="margin: 0em;">
On 2019-07-17 04:56, Lucas Stach wrote:
</pre><blockquote style="border-left: #5555EE solid 0.2em; margin: 0em; padding-left: 0.85em"><pre style="margin: 0em;">
The DMA request schould be triggered as soon as the FIFO has space
for another burst. As different versions of the SAI block have
different FIFO sizes, the watrmark level needs to be derived from
version specific data.

Signed-off-by: Lucas Stach &lt;l.stach@xxxxxxxxxxxxxx&gt;
</pre></blockquote><pre style="margin: 0em;">

Tested-by: Angus Ainslie &lt;angus@xxxxxxxx&gt;
Reviewed-by: Angus Ainslie &lt;angus@xxxxxxxx&gt;

</pre><blockquote style="border-left: #5555EE solid 0.2em; margin: 0em; padding-left: 0.85em"><pre style="margin: 0em;">
---
 sound/soc/fsl/fsl_sai.c | 4 +++-
 sound/soc/fsl/fsl_sai.h | 1 +
 2 files changed, 4 insertions(+), 1 deletion(-)

diff --git a/sound/soc/fsl/fsl_sai.c b/sound/soc/fsl/fsl_sai.c
index 3a1ed8b857d6..b3cd055a61c7 100644
--- a/sound/soc/fsl/fsl_sai.c
+++ b/sound/soc/fsl/fsl_sai.c
</pre><tt>@@ -649,7 +649,7 @@ static int fsl_sai_dai_probe(struct snd_soc_dai 
</tt><tt>*cpu_dai)
</tt><pre style="margin: 0em;">
 	regmap_write(sai-&gt;regmap, FSL_SAI_RCSR, 0);

 	regmap_update_bits(sai-&gt;regmap, FSL_SAI_TCR1, FSL_SAI_CR1_RFW_MASK,
-			   FSL_SAI_MAXBURST_TX * 2);
+			   sai-&gt;soc_data-&gt;fifo_depth - FSL_SAI_MAXBURST_TX);
 	regmap_update_bits(sai-&gt;regmap, FSL_SAI_RCR1, FSL_SAI_CR1_RFW_MASK,
 			   FSL_SAI_MAXBURST_RX - 1);

</pre><tt>@@ -923,10 +923,12 @@ static int fsl_sai_remove(struct platform_device 
</tt><tt>*pdev)
</tt><pre style="margin: 0em;">

 static const struct fsl_sai_soc_data fsl_sai_vf610_data = {
 	.use_imx_pcm = false,
+	.fifo_depth = 32,
 };

 static const struct fsl_sai_soc_data fsl_sai_imx6sx_data = {
 	.use_imx_pcm = true,
+	.fifo_depth = 32,
 };

 static const struct of_device_id fsl_sai_ids[] = {
diff --git a/sound/soc/fsl/fsl_sai.h b/sound/soc/fsl/fsl_sai.h
index 83e2bfe05b1b..7c1ef671da28 100644
--- a/sound/soc/fsl/fsl_sai.h
+++ b/sound/soc/fsl/fsl_sai.h
@@ -128,6 +128,7 @@

 struct fsl_sai_soc_data {
 	bool use_imx_pcm;
+	unsigned int fifo_depth;
 };

 struct fsl_sai {
</pre></blockquote><pre style="margin: 0em;">
_______________________________________________
Alsa-devel mailing list
Alsa-devel@xxxxxxxxxxxxxxxx
<a  rel="nofollow" href="https://mailman.alsa-project.org/mailman/listinfo/alsa-devel">https://mailman.alsa-project.org/mailman/listinfo/alsa-devel</a>


</pre>
<!--X-Body-of-Message-End-->
<!--X-MsgBody-End-->
<!--X-Follow-Ups-->
</div>
<hr>
<!--X-Follow-Ups-End-->
<!--X-References-->
<ul><li><strong>References</strong>:
<ul>
<li><strong><a name="93846" href="msg93846.html">[PATCH 0/3] i.MX8M support for FSL SAI</a></strong>
<ul><li><em>From:</em> Lucas Stach</li></ul></li>
<li><strong><a name="93849" href="msg93849.html">[PATCH 2/3] ASoC: fsl_sai: derive TX FIFO watermark	from FIFO depth</a></strong>
<ul><li><em>From:</em> Lucas Stach</li></ul></li>
</ul></li></ul>
<!--X-References-End-->
<!--X-BotPNI-->
<ul>
<li>Prev by Date:
<strong><a href="msg93899.html">Re:  [PATCH 1/3] ASoC: fsl_sai: add of_match data</a></strong>
</li>
<li>Next by Date:
<strong><a href="msg93901.html">Re:  [PATCH 3/3] ASoC: fsl_sai: add i.MX8M support</a></strong>
</li>
<li>Previous by thread:
<strong><a href="msg93849.html">[PATCH 2/3] ASoC: fsl_sai: derive TX FIFO watermark	from FIFO depth</a></strong>
</li>
<li>Next by thread:
<strong><a href="msg93852.html">[PATCH] ALSA: hda - Optimize resume for codecs without	jack detection</a></strong>
</li>
<li>Index(es):
<ul>
<li><a href="maillist.html#93900"><strong>Date</strong></a></li>
<li><a href="threads.html#93900"><strong>Thread</strong></a></li>
</ul>
</li>
</ul>

<!--X-BotPNI-End-->
<!--X-User-Footer-->
<center>
<font size=-1>
<a href=/lists/>[Index&nbsp;of&nbsp;Archives]</a>
&nbsp;
&nbsp;
<a href=/linux/fedora/alsa-user/>[ALSA&nbsp;User]</a>
&nbsp;
&nbsp;
<a href=/lists/linux-audio-users/>[Linux&nbsp;Audio&nbsp;Users]</a>
&nbsp;
&nbsp;
<a href=/lists/pulse-audio/>[Pulse&nbsp;Audio]</a>
&nbsp;
&nbsp;
<a href=/lists/kernel/>[Kernel&nbsp;Archive]</a>
&nbsp;
&nbsp;
<a href=/lists/asterisk/>[Asterisk&nbsp;PBX]</a>
&nbsp;
&nbsp;
<a href=http://yosemitephotos.net/>[Photo&nbsp;Sharing]</a>
&nbsp;
&nbsp;
<a href=/linux/fedora/linux-sound/>[Linux&nbsp;Sound]</a>
&nbsp;
&nbsp;
<a href=/lists/linux-media/>[Video&nbsp;4&nbsp;Linux]</a>
&nbsp;
&nbsp;
<a href=/lists/gimp/>[Gimp]</a>
&nbsp;
&nbsp;
<a href=https://yosemitenews.info>[Yosemite&nbsp;News]</a>
</font>
</center>
<hr>
<p>
<div>
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<ins class="adsbygoogle"
     style="display:block"
     data-ad-format="autorelaxed"
     data-ad-client="ca-pub-3422782820843221"
     data-ad-slot="1424524564"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
</div>
<table width=100%>
<tr>
<td align=left>&nbsp;</td>
<td align=right><a href=/lists/><img src=/button_01.gif border=0 alt="Powered by Linux"></a></td>
</tr>
</table>
<!--X-User-Footer-End-->
<script type="text/javascript"> 
 function initAddThis() {
    addthis.init()
 }
initAddThis();
</script>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-760190-1', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
