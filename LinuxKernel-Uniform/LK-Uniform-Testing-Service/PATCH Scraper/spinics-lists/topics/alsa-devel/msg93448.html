<!-- MHonArc v2.6.19 -->
<!--X-Subject: Re:  [PATCH] ALSA: usb&#45;audio: fix Line6 Helix audio	format rates -->
<!--X-From-R13: Fnxnfuv Wjnv &#60;gvjnvNfhfr.qr> -->
<!--X-Date: Tue, 2 Jul 2019 08:58:04 &#45;0700 -->
<!--X-Message-Id: s5ha7dw4egd.wl&#45;tiwai@suse.de -->
<!--X-Content-Type: text/plain -->
<!--X-Reference: 20190702004439.30131&#45;1&#45;nick83ola@gmail.com -->
<!--X-Reference: s5hlfxg4i4r.wl&#45;tiwai@suse.de -->
<!--X-Reference: 4181a467&#45;5332&#45;c256&#45;5124&#45;513a0343ec70@linux.intel.com -->
<!--X-Head-End-->
<!doctype html public "-//W3C//DTD HTML//EN">
<html>
<head>
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({
          google_ad_client: "ca-pub-3422782820843221",
          enable_page_level_ads: true
     });
</script>
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="description" content="Re:  [PATCH] ALSA: usb-audio: fix Line6 Helix audio	format rates &mdash; ALSA Devel">
<style>
<!--
 pre {white-space: pre-wrap;}
-->
</style>
<title>Re:  [PATCH] ALSA: usb-audio: fix Line6 Helix audio	format rates &mdash; ALSA Devel</title>
<link rel="alternate" type="application/rss+xml" title="ALSA Devel" href="//feedproxy.google.com/AlsaDevel">
</head>
<body itemscope itemtype="//schema.org/Article" vlink=green>
<!--X-Body-Begin-->
<!--X-User-Header-->
<!--X-User-Header-End-->
<!--X-TopPNI-->
<form action="//www.google.com" id="cse-search-box" target="_blank">
  <div>
    <input type="hidden" name="cx" value="partner-pub-3422782820843221:9580497365" />
    <input type="hidden" name="ie" value="UTF-8" />
    <input type="text" name="q" size="25" />
    <input type="submit" name="sa" value="Search" />
  </div>
</form>
<script type="text/javascript" src="//www.google.com/coop/cse/brand?form=cse-search-box&amp;lang=en"></script>
<h1 itemprop="name">Re:  [PATCH] ALSA: usb-audio: fix Line6 Helix audio	format rates</h1>
[<a href="msg93447.html">Date Prev</a>][<a href="msg93449.html">Date Next</a>][<a href="msg93447.html">Thread Prev</a>][<a href="msg93472.html">Thread Next</a>][<a href="maillist.html#93448">Date Index</a>][<a href="threads.html#93448">Thread Index</a>]


<p>&nbsp;<br>
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- responsive test for archives -->
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-3422782820843221"
     data-ad-slot="6345952567"
     data-ad-format="auto"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>

<!--X-TopPNI-End-->
<!--X-MsgBody-->
<!--X-Subject-Header-Begin-->
<hr>
<!--X-Subject-Header-End-->
<!--X-Head-of-Message-->
<ul>
<li><em>To</em>: &quot;Wasko, Michal&quot; &lt;michal.wasko@xxxxxxxxxxxxxxx&gt;</li>
<li><em>Subject</em>: Re:  [PATCH] ALSA: usb-audio: fix Line6 Helix audio	format rates</li>
<li><em>From</em>: Takashi Iwai &lt;tiwai@xxxxxxx&gt;</li>
<li><em>Date</em>: Tue, 02 Jul 2019 17:57:06 +0200</li>
<li><em>Cc</em>: alsa-devel@xxxxxxxxxxxxxxxx, info@xxxxxxxxxxxxxxx,        Greg Kroah-Hartman &lt;gregkh@xxxxxxxxxxxxxxxxxxx&gt;,        linux-kernel@xxxxxxxxxxxxxxx, Richard Fontana &lt;rfontana@xxxxxxxxxx&gt;,        Jussi Laako &lt;jussi@xxxxxxxxxxxxx&gt;, Nicola Lunghi &lt;nick83ola@xxxxxxxxx&gt;,        Thomas Gleixner &lt;tglx@xxxxxxxxxxxxx&gt;,        Allison Randal &lt;allison@xxxxxxxxxxx&gt;</li>
<li><em>In-reply-to</em>: &lt;<a href="msg93447.html">4181a467-5332-c256-5124-513a0343ec70@linux.intel.com</a>&gt;</li>
<li><em>References</em>: &lt;<a href="msg93413.html">20190702004439.30131-1-nick83ola@gmail.com</a>&gt; &lt;<a href="msg93446.html">s5hlfxg4i4r.wl-tiwai@suse.de</a>&gt; &lt;<a href="msg93447.html">4181a467-5332-c256-5124-513a0343ec70@linux.intel.com</a>&gt;</li>
<li><em>User-agent</em>: Wanderlust/2.15.9 (Almost Unreal) SEMI/1.14.6 (Maruoka) FLIM/1.14.9 (Goj&#x14D;) APEL/10.8 Emacs/25.3 (x86_64-suse-linux-gnu) MULE/6.0 (HANACHIRUSATO)</li>
</ul>
<!--X-Head-of-Message-End-->
<!--X-Head-Body-Sep-Begin-->
<!-- AddThis Button BEGIN -->
<div class="addthis_toolbox addthis_default_style ">
<a class="addthis_button_preferred_1"></a>
<a class="addthis_button_preferred_2"></a>
<a class="addthis_button_preferred_3"></a>
<a class="addthis_button_preferred_4"></a>
<a class="addthis_button_compact"></a>
<a class="addthis_counter addthis_bubble_style"></a>
</div>
<script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5196c2ae1be43d18&async=1&domready=1" async></script>
<!-- AddThis Button END -->
<hr>
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- responsive link 1 -->
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-3422782820843221"
     data-ad-slot="8681825769"
     data-ad-format="link"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
<p>
<div class="content" itemprop="articleBody">
<!--X-Head-Body-Sep-End-->
<!--X-Body-of-Message-->
<pre>On Tue, 02 Jul 2019 17:52:01 +0200,
Wasko, Michal wrote:
&gt; 
&gt; On 7/2/2019 4:37 PM, Takashi Iwai wrote:
&gt; &gt; On Tue, 02 Jul 2019 02:43:14 +0200,
&gt; &gt; Nicola Lunghi wrote:
&gt; &gt;&gt; Line6 Helix and HX stomp don't support retrieving
&gt; &gt;&gt; the number of clock sample rate.
&gt; &gt;&gt;
&gt; &gt;&gt; Add a quirk to return the default value of 48Khz.
&gt; &gt;&gt;
&gt; &gt;&gt; Signed-off-by: Nicola Lunghi &lt;nick83ola@xxxxxxxxx&gt;
&gt; &gt; It's not particularly good place to put a quirk, but there seems no
&gt; &gt; other better place, unfortunately.  Is this specific to certain unit
&gt; &gt; or all I/Os on the device suffer from this problem?
&gt; &gt;
&gt; &gt; In anyway, if the behavior is expected, we don't need to use
&gt; &gt; dev_warn() to annoy users unnecessarily.  Replace it with dev_info().
&gt; &gt;
&gt; &gt; Also, the code that creates a single 48k entry would be better to be
&gt; &gt; put into a function for readability.
&gt; &gt;
&gt; &gt; Could you resubmit with that change?
&gt; &gt;
&gt; &gt;
&gt; &gt; Thanks!
&gt; &gt;
&gt; &gt; Takashi
&gt; 
&gt; If the listed USB devices do not support sample rate format retrieval
&gt; then maybe it would be a better idea to perform below check before
&gt; sending message?

Yes, if we know that it always fails, we don't need to query.

&gt; Have you also considered new function or macro that check device
&gt; support? This would separate formatfunctionality code from routine
&gt; that identifies applicable devices- in case if in future more devices
&gt; will require quirk.

The split can be done later.  It's always hard to know what kind of
quirk would be needed in future.  If any more devices show the same
problem, we can reorganize the quirk in a saner way.


thanks,

Takashi

&gt; 
&gt; Michal W.
&gt; 
&gt; &gt;&gt; ---
&gt; &gt;&gt;   sound/usb/format.c | 28 +++++++++++++++++++++++++---
&gt; &gt;&gt;   1 file changed, 25 insertions(+), 3 deletions(-)
&gt; &gt;&gt;
&gt; &gt;&gt; diff --git a/sound/usb/format.c b/sound/usb/format.c
&gt; &gt;&gt; index c02b51a82775..05442f6ada62 100644
&gt; &gt;&gt; --- a/sound/usb/format.c
&gt; &gt;&gt; +++ b/sound/usb/format.c
&gt; &gt;&gt; @@ -313,10 +313,32 @@ static int parse_audio_format_rates_v2v3(struct snd_usb_audio *chip,
&gt; &gt;&gt;   			      tmp, sizeof(tmp));
&gt; &gt;&gt;     	if (ret &lt; 0) {
&gt; &gt;&gt; -		dev_err(&amp;dev-&gt;dev,
&gt; &gt;&gt; -			&quot;%s(): unable to retrieve number of sample rates (clock %d)\n&quot;,
&gt; &gt;&gt; +		switch (chip-&gt;usb_id) {
&gt; &gt;&gt; +		/* LINE 6 HX pedals don't support getting the clock sample rate.
&gt; &gt;&gt; +		 * Set the framerate to 48khz by default
&gt; &gt;&gt; +		 */
&gt; &gt;&gt; +		case USB_ID(0x0E41, 0x4244): /* HELIX */
&gt; &gt;&gt; +		case USB_ID(0x0E41, 0x4246): /* HX STOMP */
&gt; &gt;&gt; +			dev_warn(&amp;dev-&gt;dev,
&gt; &gt;&gt; +				&quot;%s(): line6 helix: unable to retrieve number of sample rates. Set it to default value (clock %d).\n&quot;,
&gt; &gt;&gt;   				__func__, clock);
&gt; &gt;&gt; -		goto err;
&gt; &gt;&gt; +			fp-&gt;nr_rates = 1;
&gt; &gt;&gt; +			fp-&gt;rate_min = 48000;
&gt; &gt;&gt; +			fp-&gt;rate_max = 48000;
&gt; &gt;&gt; +			fp-&gt;rates = SNDRV_PCM_RATE_48000;
&gt; &gt;&gt; +			fp-&gt;rate_table = kmalloc(sizeof(int), GFP_KERNEL);
&gt; &gt;&gt; +			if (!fp-&gt;rate_table) {
&gt; &gt;&gt; +				ret = -ENOMEM;
&gt; &gt;&gt; +				goto err_free;
&gt; &gt;&gt; +			}
&gt; &gt;&gt; +			fp-&gt;rate_table[0] = 48000;
&gt; &gt;&gt; +			return 0;
&gt; &gt;&gt; +		default:
&gt; &gt;&gt; +			dev_err(&amp;dev-&gt;dev,
&gt; &gt;&gt; +				&quot;%s(): unable to retrieve number of sample rates (clock %d)\n&quot;,
&gt; &gt;&gt; +					__func__, clock);
&gt; &gt;&gt; +			goto err;
&gt; &gt;&gt; +		}
&gt; &gt;&gt;   	}
&gt; &gt;&gt;     	nr_triplets = (tmp[1] &lt;&lt; 8) | tmp[0];
&gt; &gt;&gt; -- 
&gt; &gt;&gt; 2.19.1
&gt; &gt;&gt;
&gt; &gt;&gt;
&gt; &gt; _______________________________________________
&gt; &gt; Alsa-devel mailing list
&gt; &gt; Alsa-devel@xxxxxxxxxxxxxxxx
&gt; &gt; <a  rel="nofollow" href="https://mailman.alsa-project.org/mailman/listinfo/alsa-devel">https://mailman.alsa-project.org/mailman/listinfo/alsa-devel</a>
&gt; &gt;
&gt; 
_______________________________________________
Alsa-devel mailing list
Alsa-devel@xxxxxxxxxxxxxxxx
<a  rel="nofollow" href="https://mailman.alsa-project.org/mailman/listinfo/alsa-devel">https://mailman.alsa-project.org/mailman/listinfo/alsa-devel</a>


</pre>
<!--X-Body-of-Message-End-->
<!--X-MsgBody-End-->
<!--X-Follow-Ups-->
</div>
<hr>
<ul><li><strong>Follow-Ups</strong>:
<ul>
<li><strong><a name="93472" href="msg93472.html">Re:  [PATCH] ALSA: usb-audio: fix Line6 Helix audio format rates</a></strong>
<ul><li><em>From:</em> nick83ola</li></ul></li>
</ul></li></ul>
<!--X-Follow-Ups-End-->
<!--X-References-->
<ul><li><strong>References</strong>:
<ul>
<li><strong><a name="93413" href="msg93413.html">[PATCH] ALSA: usb-audio: fix Line6 Helix audio format	rates</a></strong>
<ul><li><em>From:</em> Nicola Lunghi</li></ul></li>
<li><strong><a name="93446" href="msg93446.html">Re:  [PATCH] ALSA: usb-audio: fix Line6 Helix audio	format rates</a></strong>
<ul><li><em>From:</em> Takashi Iwai</li></ul></li>
<li><strong><a name="93447" href="msg93447.html">Re:  [PATCH] ALSA: usb-audio: fix Line6 Helix audio format rates</a></strong>
<ul><li><em>From:</em> Wasko, Michal</li></ul></li>
</ul></li></ul>
<!--X-References-End-->
<!--X-BotPNI-->
<ul>
<li>Prev by Date:
<strong><a href="msg93447.html">Re:  [PATCH] ALSA: usb-audio: fix Line6 Helix audio format rates</a></strong>
</li>
<li>Next by Date:
<strong><a href="msg93449.html">Re:  [PATCH 1/6] ASoC: dt-bindings: add dt bindings for WCD9340/WCD9341 audio codec</a></strong>
</li>
<li>Previous by thread:
<strong><a href="msg93447.html">Re:  [PATCH] ALSA: usb-audio: fix Line6 Helix audio format rates</a></strong>
</li>
<li>Next by thread:
<strong><a href="msg93472.html">Re:  [PATCH] ALSA: usb-audio: fix Line6 Helix audio format rates</a></strong>
</li>
<li>Index(es):
<ul>
<li><a href="maillist.html#93448"><strong>Date</strong></a></li>
<li><a href="threads.html#93448"><strong>Thread</strong></a></li>
</ul>
</li>
</ul>

<!--X-BotPNI-End-->
<!--X-User-Footer-->
<center>
<font size=-1>
<a href=/lists/>[Index&nbsp;of&nbsp;Archives]</a>
&nbsp;
&nbsp;
<a href=/linux/fedora/alsa-user/>[ALSA&nbsp;User]</a>
&nbsp;
&nbsp;
<a href=/lists/linux-audio-users/>[Linux&nbsp;Audio&nbsp;Users]</a>
&nbsp;
&nbsp;
<a href=/lists/pulse-audio/>[Pulse&nbsp;Audio]</a>
&nbsp;
&nbsp;
<a href=/lists/kernel/>[Kernel&nbsp;Archive]</a>
&nbsp;
&nbsp;
<a href=/lists/asterisk/>[Asterisk&nbsp;PBX]</a>
&nbsp;
&nbsp;
<a href=http://yosemitephotos.net/>[Photo&nbsp;Sharing]</a>
&nbsp;
&nbsp;
<a href=/linux/fedora/linux-sound/>[Linux&nbsp;Sound]</a>
&nbsp;
&nbsp;
<a href=/lists/linux-media/>[Video&nbsp;4&nbsp;Linux]</a>
&nbsp;
&nbsp;
<a href=/lists/gimp/>[Gimp]</a>
&nbsp;
&nbsp;
<a href=https://yosemitenews.info>[Yosemite&nbsp;News]</a>
</font>
</center>
<hr>
<p>
<div>
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<ins class="adsbygoogle"
     style="display:block"
     data-ad-format="autorelaxed"
     data-ad-client="ca-pub-3422782820843221"
     data-ad-slot="1424524564"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
</div>
<table width=100%>
<tr>
<td align=left>&nbsp;</td>
<td align=right><a href=/lists/><img src=/button_01.gif border=0 alt="Powered by Linux"></a></td>
</tr>
</table>
<!--X-User-Footer-End-->
<script type="text/javascript"> 
 function initAddThis() {
    addthis.init()
 }
initAddThis();
</script>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-760190-1', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
