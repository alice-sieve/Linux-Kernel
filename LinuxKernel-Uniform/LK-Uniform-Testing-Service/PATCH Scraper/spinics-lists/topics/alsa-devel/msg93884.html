<!-- MHonArc v2.6.19 -->
<!--X-Subject: Re:  [PATCH 3/3] ASoC: fsl_sai: add i.MX8M support -->
<!--X-From-R13: Rnavry Pnyhgn &#60;qnavry.onyhgnNtznvy.pbz> -->
<!--X-Date: Thu, 18 Jul 2019 01:36:50 &#45;0700 -->
<!--X-Message-Id: CAEnQRZDZ11LSK62qCYq9VuDRBtWrbgbooDFa6A7DV=Z2ftTq&#45;g@mail.gmail.com -->
<!--X-Content-Type: text/plain -->
<!--X-Reference: 20190717105635.18514&#45;1&#45;l.stach@pengutronix.de -->
<!--X-Reference: 20190717105635.18514&#45;4&#45;l.stach@pengutronix.de -->
<!--X-Reference: CAEnQRZCCTwMJKQnvP2mSQPcKNwtoAaMdXmQt_H+CGro=zVLsNA@mail.gmail.com -->
<!--X-Reference: 1563374027.2676.18.camel@pengutronix.de -->
<!--X-Reference: CAEnQRZB96Q4stM4JsJskMhdH&#45;7ktbc&#45;QxPeibNOLHEXghtS&#45;1w@mail.gmail.com -->
<!--X-Reference: ee809845f1a5fd5af3f73b35eaa79314@akkea.ca -->
<!--X-Head-End-->
<!doctype html public "-//W3C//DTD HTML//EN">
<html>
<head>
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({
          google_ad_client: "ca-pub-3422782820843221",
          enable_page_level_ads: true
     });
</script>
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="description" content="Re:  [PATCH 3/3] ASoC: fsl_sai: add i.MX8M support &mdash; ALSA Devel">
<style>
<!--
 pre {white-space: pre-wrap;}
-->
</style>
<title>Re:  [PATCH 3/3] ASoC: fsl_sai: add i.MX8M support &mdash; ALSA Devel</title>
<link rel="alternate" type="application/rss+xml" title="ALSA Devel" href="//feedproxy.google.com/AlsaDevel">
</head>
<body itemscope itemtype="//schema.org/Article" vlink=green>
<!--X-Body-Begin-->
<!--X-User-Header-->
<!--X-User-Header-End-->
<!--X-TopPNI-->
<form action="//www.google.com" id="cse-search-box" target="_blank">
  <div>
    <input type="hidden" name="cx" value="partner-pub-3422782820843221:9580497365" />
    <input type="hidden" name="ie" value="UTF-8" />
    <input type="text" name="q" size="25" />
    <input type="submit" name="sa" value="Search" />
  </div>
</form>
<script type="text/javascript" src="//www.google.com/coop/cse/brand?form=cse-search-box&amp;lang=en"></script>
<h1 itemprop="name">Re:  [PATCH 3/3] ASoC: fsl_sai: add i.MX8M support</h1>
[<a href="msg93883.html">Date Prev</a>][<a href="msg93885.html">Date Next</a>][<a href="msg93858.html">Thread Prev</a>][<a href="msg93901.html">Thread Next</a>][<a href="maillist.html#93884">Date Index</a>][<a href="threads.html#93884">Thread Index</a>]


<p>&nbsp;<br>
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- responsive test for archives -->
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-3422782820843221"
     data-ad-slot="6345952567"
     data-ad-format="auto"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>

<!--X-TopPNI-End-->
<!--X-MsgBody-->
<!--X-Subject-Header-Begin-->
<hr>
<!--X-Subject-Header-End-->
<!--X-Head-of-Message-->
<ul>
<li><em>To</em>: Angus Ainslie &lt;angus@xxxxxxxx&gt;</li>
<li><em>Subject</em>: Re:  [PATCH 3/3] ASoC: fsl_sai: add i.MX8M support</li>
<li><em>From</em>: Daniel Baluta &lt;daniel.baluta@xxxxxxxxx&gt;</li>
<li><em>Date</em>: Thu, 18 Jul 2019 11:35:37 +0300</li>
<li><em>Cc</em>: Linux-ALSA &lt;alsa-devel@xxxxxxxxxxxxxxxx&gt;, Timur Tabi &lt;timur@xxxxxxxxxx&gt;,        Xiubo Li &lt;Xiubo.Lee@xxxxxxxxx&gt;, Liam Girdwood &lt;lgirdwood@xxxxxxxxx&gt;,        patchwork-lst@xxxxxxxxxxxxxx, Nicolin Chen &lt;nicoleotsuka@xxxxxxxxx&gt;,        Mark Brown &lt;broonie@xxxxxxxxxx&gt;, NXP Linux Team &lt;linux-imx@xxxxxxx&gt;,        Pengutronix Kernel Team &lt;kernel@xxxxxxxxxxxxxx&gt;,        Fabio Estevam &lt;festevam@xxxxxxxxx&gt;,        Lucas Stach &lt;l.stach@xxxxxxxxxxxxxx&gt;</li>
<li><em>In-reply-to</em>: &lt;<a href="msg93858.html">ee809845f1a5fd5af3f73b35eaa79314@akkea.ca</a>&gt;</li>
<li><em>References</em>: &lt;<a href="msg93846.html">20190717105635.18514-1-l.stach@pengutronix.de</a>&gt; &lt;<a href="msg93848.html">20190717105635.18514-4-l.stach@pengutronix.de</a>&gt; &lt;CAEnQRZCCTwMJKQnvP2mSQPcKNwtoAaMdXmQt_H+CGro=zVLsNA@mail.gmail.com&gt; &lt;<a href="msg93856.html">1563374027.2676.18.camel@pengutronix.de</a>&gt; &lt;<a href="msg93857.html">CAEnQRZB96Q4stM4JsJskMhdH-7ktbc-QxPeibNOLHEXghtS-1w@mail.gmail.com</a>&gt; &lt;<a href="msg93858.html">ee809845f1a5fd5af3f73b35eaa79314@akkea.ca</a>&gt;</li>
</ul>
<!--X-Head-of-Message-End-->
<!--X-Head-Body-Sep-Begin-->
<!-- AddThis Button BEGIN -->
<div class="addthis_toolbox addthis_default_style ">
<a class="addthis_button_preferred_1"></a>
<a class="addthis_button_preferred_2"></a>
<a class="addthis_button_preferred_3"></a>
<a class="addthis_button_preferred_4"></a>
<a class="addthis_button_compact"></a>
<a class="addthis_counter addthis_bubble_style"></a>
</div>
<script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5196c2ae1be43d18&async=1&domready=1" async></script>
<!-- AddThis Button END -->
<hr>
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- responsive link 1 -->
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-3422782820843221"
     data-ad-slot="8681825769"
     data-ad-format="link"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
<p>
<div class="content" itemprop="articleBody">
<!--X-Head-Body-Sep-End-->
<!--X-Body-of-Message-->
<pre>On Wed, Jul 17, 2019 at 6:15 PM Angus Ainslie &lt;angus@xxxxxxxx&gt; wrote:
&gt;
&gt; On 2019-07-17 09:06, Daniel Baluta wrote:
&gt; &gt; On Wed, Jul 17, 2019 at 5:33 PM Lucas Stach &lt;l.stach@xxxxxxxxxxxxxx&gt;
&gt; &gt; wrote:
&gt; &gt;&gt;
&gt; &gt;&gt; Hi Daniel,
&gt; &gt;&gt;
&gt; &gt;&gt; Am Mittwoch, den 17.07.2019, 17:16 +0300 schrieb Daniel Baluta:
&gt; &gt;&gt; &gt; &gt; On Wed, Jul 17, 2019 at 1:59 PM Lucas Stach &lt;l.stach@xxxxxxxxxxxxxx&gt; wrote:
&gt; &gt;&gt; &gt; &gt;
&gt; &gt;&gt; &gt; &gt; The SAI block on the i.MX8M moved the register layout, as 2 version
&gt; &gt;&gt; &gt; &gt; registers were added at the start of the register map. We deal with
&gt; &gt;&gt; &gt; &gt; this by moving the start of the regmap, so both register layouts
&gt; &gt;&gt; &gt; &gt; look the same to accesses going through the regmap.
&gt; &gt;&gt; &gt; &gt;
&gt; &gt;&gt; &gt; &gt; Signed-off-by: Lucas Stach &lt;l.stach@xxxxxxxxxxxxxx&gt;
&gt; &gt;&gt; &gt;
&gt; &gt;&gt; &gt; This is a little bit tricky. We need the verid register in order
&gt; &gt;&gt; &gt; to differentiate IPs which can support 1:1 ratio for bclk:mclk
&gt; &gt;&gt;
&gt; &gt;&gt; And this patch doesn't prevent this usage. If needed we can just read
&gt; &gt;&gt; the verid via a plain readl on the base mapping in the probe function
&gt; &gt;&gt; and cache it in struct fsl_sai. This seems way less intrusive than
&gt; &gt;&gt; carrying a register offset through all of the regmap accessors and
&gt; &gt;&gt; validation functions. I simply haven't implemented it in this patch,
&gt; &gt;&gt; as
&gt; &gt;&gt; I had no need for it right now.
&gt; &gt;
&gt; &gt; I must admit this is a very clever idea! Anyhow, I'm having some
&gt; &gt; concerns
&gt; &gt; because unfortunately not all registers were shifted by 8 bytes.
&gt; &gt;
&gt; &gt; See: imx6sx [1] (page 3575)  and imx8X [2] (page 5512) RMs.
&gt; &gt;
&gt; &gt; We have something like this:
&gt; &gt;
&gt; &gt; i.mx6 SX:
&gt; &gt;
&gt; &gt; 00: TCSR
&gt; &gt; 04: TCR1
&gt; &gt; 08: TCR2
&gt; &gt; 0C: TCR3
&gt; &gt; ....
&gt; &gt; 60: TMR
&gt; &gt; 80: RCSR
&gt; &gt;
&gt; &gt; i.mx 8X
&gt; &gt;
&gt; &gt; 00: VERID
&gt; &gt; 04: PARAM
&gt; &gt; 08: TCSR
&gt; &gt; 0C: TCR1
&gt; &gt; ...
&gt; &gt; 60: TMR
&gt; &gt; 88: RCSR
&gt; &gt;
&gt;
&gt; We could split it into an upper and a lower regmap. Only the lower would
&gt; need the version register offset.

That would work but will be unnecessary complicated. Let me send the
imx8M support
as we implemented in our tree by Friday.

It has the disadvantage that we've wrapped all shifted register with a
macro but I don't
see other solution.
_______________________________________________
Alsa-devel mailing list
Alsa-devel@xxxxxxxxxxxxxxxx
<a  rel="nofollow" href="https://mailman.alsa-project.org/mailman/listinfo/alsa-devel">https://mailman.alsa-project.org/mailman/listinfo/alsa-devel</a>


</pre>
<!--X-Body-of-Message-End-->
<!--X-MsgBody-End-->
<!--X-Follow-Ups-->
</div>
<hr>
<!--X-Follow-Ups-End-->
<!--X-References-->
<ul><li><strong>References</strong>:
<ul>
<li><strong><a name="93846" href="msg93846.html">[PATCH 0/3] i.MX8M support for FSL SAI</a></strong>
<ul><li><em>From:</em> Lucas Stach</li></ul></li>
<li><strong><a name="93848" href="msg93848.html">[PATCH 3/3] ASoC: fsl_sai: add i.MX8M support</a></strong>
<ul><li><em>From:</em> Lucas Stach</li></ul></li>
<li><strong><a name="93853" href="msg93853.html">Re:  [PATCH 3/3] ASoC: fsl_sai: add i.MX8M support</a></strong>
<ul><li><em>From:</em> Daniel Baluta</li></ul></li>
<li><strong><a name="93856" href="msg93856.html">Re:  [PATCH 3/3] ASoC: fsl_sai: add i.MX8M support</a></strong>
<ul><li><em>From:</em> Lucas Stach</li></ul></li>
<li><strong><a name="93857" href="msg93857.html">Re:  [PATCH 3/3] ASoC: fsl_sai: add i.MX8M support</a></strong>
<ul><li><em>From:</em> Daniel Baluta</li></ul></li>
<li><strong><a name="93858" href="msg93858.html">Re:  [PATCH 3/3] ASoC: fsl_sai: add i.MX8M support</a></strong>
<ul><li><em>From:</em> Angus Ainslie</li></ul></li>
</ul></li></ul>
<!--X-References-End-->
<!--X-BotPNI-->
<ul>
<li>Prev by Date:
<strong><a href="msg93883.html">Re:  [PATCH v3 1/2] ASoC: SOF: add flag for position	update ipc</a></strong>
</li>
<li>Next by Date:
<strong><a href="msg93885.html">[PATCH] ASoC: dapm: Fix handling of	custom_stop_condition on DAPM graph walks</a></strong>
</li>
<li>Previous by thread:
<strong><a href="msg93858.html">Re:  [PATCH 3/3] ASoC: fsl_sai: add i.MX8M support</a></strong>
</li>
<li>Next by thread:
<strong><a href="msg93901.html">Re:  [PATCH 3/3] ASoC: fsl_sai: add i.MX8M support</a></strong>
</li>
<li>Index(es):
<ul>
<li><a href="maillist.html#93884"><strong>Date</strong></a></li>
<li><a href="threads.html#93884"><strong>Thread</strong></a></li>
</ul>
</li>
</ul>

<!--X-BotPNI-End-->
<!--X-User-Footer-->
<center>
<font size=-1>
<a href=/lists/>[Index&nbsp;of&nbsp;Archives]</a>
&nbsp;
&nbsp;
<a href=/linux/fedora/alsa-user/>[ALSA&nbsp;User]</a>
&nbsp;
&nbsp;
<a href=/lists/linux-audio-users/>[Linux&nbsp;Audio&nbsp;Users]</a>
&nbsp;
&nbsp;
<a href=/lists/pulse-audio/>[Pulse&nbsp;Audio]</a>
&nbsp;
&nbsp;
<a href=/lists/kernel/>[Kernel&nbsp;Archive]</a>
&nbsp;
&nbsp;
<a href=/lists/asterisk/>[Asterisk&nbsp;PBX]</a>
&nbsp;
&nbsp;
<a href=http://yosemitephotos.net/>[Photo&nbsp;Sharing]</a>
&nbsp;
&nbsp;
<a href=/linux/fedora/linux-sound/>[Linux&nbsp;Sound]</a>
&nbsp;
&nbsp;
<a href=/lists/linux-media/>[Video&nbsp;4&nbsp;Linux]</a>
&nbsp;
&nbsp;
<a href=/lists/gimp/>[Gimp]</a>
&nbsp;
&nbsp;
<a href=https://yosemitenews.info>[Yosemite&nbsp;News]</a>
</font>
</center>
<hr>
<p>
<div>
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<ins class="adsbygoogle"
     style="display:block"
     data-ad-format="autorelaxed"
     data-ad-client="ca-pub-3422782820843221"
     data-ad-slot="1424524564"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
</div>
<table width=100%>
<tr>
<td align=left>&nbsp;</td>
<td align=right><a href=/lists/><img src=/button_01.gif border=0 alt="Powered by Linux"></a></td>
</tr>
</table>
<!--X-User-Footer-End-->
<script type="text/javascript"> 
 function initAddThis() {
    addthis.init()
 }
initAddThis();
</script>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-760190-1', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
