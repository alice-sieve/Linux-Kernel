<!-- MHonArc v2.6.19 -->
<!--X-Subject: Re:  [PATCH v2 1/2] ASoC: tas5720.c: cleanup variant	management -->
<!--X-From-R13: "Oaqerj T. Rnivf" &#60;nsqNgv.pbz> -->
<!--X-Date: Mon, 1 Jul 2019 09:10:28 &#45;0700 -->
<!--X-Message-Id: 074d4df3&#45;51d8&#45;6e20&#45;869d&#45;5f88b46cc172@ti.com -->
<!--X-Content-Type: text/plain -->
<!--X-Reference: 20190628143037.GH5379@sirena.org.uk -->
<!--X-Reference: cover.1561988282.git.nikolaus.voss@loewensteinmedical.de -->
<!--X-Reference: c79df50175d59265a37c5e7c8a0cfbf8119bcf78.1561988282.git.nikolaus.voss@loewensteinmedical.de -->
<!--X-Reference: 80af3fca&#45;f71b&#45;c118&#45;e5d8&#45;fde8b7d21705@ti.com -->
<!--X-Reference: alpine.DEB.2.20.1907011633310.4353@fox.voss.local -->
<!--X-Head-End-->
<!doctype html public "-//W3C//DTD HTML//EN">
<html>
<head>
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({
          google_ad_client: "ca-pub-3422782820843221",
          enable_page_level_ads: true
     });
</script>
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="description" content="Re:  [PATCH v2 1/2] ASoC: tas5720.c: cleanup variant	management &mdash; ALSA Devel">
<style>
<!--
 pre {white-space: pre-wrap;}
-->
</style>
<title>Re:  [PATCH v2 1/2] ASoC: tas5720.c: cleanup variant	management &mdash; ALSA Devel</title>
<link rel="alternate" type="application/rss+xml" title="ALSA Devel" href="//feedproxy.google.com/AlsaDevel">
</head>
<body itemscope itemtype="//schema.org/Article" vlink=green>
<!--X-Body-Begin-->
<!--X-User-Header-->
<!--X-User-Header-End-->
<!--X-TopPNI-->
<form action="//www.google.com" id="cse-search-box" target="_blank">
  <div>
    <input type="hidden" name="cx" value="partner-pub-3422782820843221:9580497365" />
    <input type="hidden" name="ie" value="UTF-8" />
    <input type="text" name="q" size="25" />
    <input type="submit" name="sa" value="Search" />
  </div>
</form>
<script type="text/javascript" src="//www.google.com/coop/cse/brand?form=cse-search-box&amp;lang=en"></script>
<h1 itemprop="name">Re:  [PATCH v2 1/2] ASoC: tas5720.c: cleanup variant	management</h1>
[<a href="msg93409.html">Date Prev</a>][<a href="msg93411.html">Date Next</a>][<a href="msg93460.html">Thread Prev</a>][<a href="msg93461.html">Thread Next</a>][<a href="maillist.html#93410">Date Index</a>][<a href="threads.html#93410">Thread Index</a>]


<p>&nbsp;<br>
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- responsive test for archives -->
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-3422782820843221"
     data-ad-slot="6345952567"
     data-ad-format="auto"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>

<!--X-TopPNI-End-->
<!--X-MsgBody-->
<!--X-Subject-Header-Begin-->
<hr>
<!--X-Subject-Header-End-->
<!--X-Head-of-Message-->
<ul>
<li><em>To</em>: Nikolaus Voss &lt;nv@xxxxxxx&gt;</li>
<li><em>Subject</em>: Re:  [PATCH v2 1/2] ASoC: tas5720.c: cleanup variant	management</li>
<li><em>From</em>: &quot;Andrew F. Davis&quot; &lt;afd@xxxxxx&gt;</li>
<li><em>Date</em>: Mon, 1 Jul 2019 12:09:26 -0400</li>
<li><em>Cc</em>: Kate Stewart &lt;kstewart@xxxxxxxxxxxxxxxxxxx&gt;, alsa-devel@xxxxxxxxxxxxxxxx,        linux-kernel@xxxxxxxxxxxxxxx, Takashi Iwai &lt;tiwai@xxxxxxxx&gt;,        Liam Girdwood &lt;lgirdwood@xxxxxxxxx&gt;, linux-acpi@xxxxxxxxxxxxxxx,        Mark Brown &lt;broonie@xxxxxxxxxx&gt;,        Andreas Dannenberg &lt;dannenberg@xxxxxx&gt;</li>
<li><em>In-reply-to</em>: &lt;alpine.DEB.2.20.1907011633310.4353@fox.voss.local&gt;</li>
<li><em>References</em>: &lt;<a href="msg93322.html">20190628143037.GH5379@sirena.org.uk</a>&gt; &lt;<a href="msg93457.html">cover.1561988282.git.nikolaus.voss@loewensteinmedical.de</a>&gt; &lt;<a href="msg93458.html">c79df50175d59265a37c5e7c8a0cfbf8119bcf78.1561988282.git.nikolaus.voss@loewensteinmedical.de</a>&gt; &lt;<a href="msg93404.html">80af3fca-f71b-c118-e5d8-fde8b7d21705@ti.com</a>&gt; &lt;alpine.DEB.2.20.1907011633310.4353@fox.voss.local&gt;</li>
<li><em>User-agent</em>: Mozilla/5.0 (X11; Linux x86_64; rv:60.0) Gecko/20100101 Thunderbird/60.7.1</li>
</ul>
<!--X-Head-of-Message-End-->
<!--X-Head-Body-Sep-Begin-->
<!-- AddThis Button BEGIN -->
<div class="addthis_toolbox addthis_default_style ">
<a class="addthis_button_preferred_1"></a>
<a class="addthis_button_preferred_2"></a>
<a class="addthis_button_preferred_3"></a>
<a class="addthis_button_preferred_4"></a>
<a class="addthis_button_compact"></a>
<a class="addthis_counter addthis_bubble_style"></a>
</div>
<script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5196c2ae1be43d18&async=1&domready=1" async></script>
<!-- AddThis Button END -->
<hr>
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- responsive link 1 -->
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-3422782820843221"
     data-ad-slot="8681825769"
     data-ad-format="link"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
<p>
<div class="content" itemprop="articleBody">
<!--X-Head-Body-Sep-End-->
<!--X-Body-of-Message-->
<pre>On 7/1/19 11:35 AM, Nikolaus Voss wrote:
&gt; On Mon, 1 Jul 2019, Andrew F. Davis wrote:
&gt;&gt; On 7/1/19 9:42 AM, Nikolaus Voss wrote:
&gt;&gt;&gt; Replace enum tas572x_type with struct tas5720_variant which aggregates
&gt;&gt;&gt; variant specific stuff and can be directly referenced from an id table.
&gt;&gt;&gt;
&gt;&gt;&gt; Signed-off-by: Nikolaus Voss &lt;nikolaus.voss@xxxxxxxxxxxxxxxxxxxxx&gt;
&gt;&gt;&gt; ---
&gt;&gt;&gt; &#xA0;sound/soc/codecs/tas5720.c | 98 +++++++++++++-------------------------
&gt;&gt;&gt; &#xA0;1 file changed, 33 insertions(+), 65 deletions(-)
&gt;&gt;&gt;
&gt;&gt;&gt; diff --git a/sound/soc/codecs/tas5720.c b/sound/soc/codecs/tas5720.c
&gt;&gt;&gt; index 37fab8f22800..b2e897f094b4 100644
&gt;&gt;&gt; --- a/sound/soc/codecs/tas5720.c
&gt;&gt;&gt; +++ b/sound/soc/codecs/tas5720.c
&gt;&gt;&gt; @@ -28,9 +28,10 @@
&gt;&gt;&gt; &#xA0;/* Define how often to check (and clear) the fault status register
&gt;&gt;&gt; (in ms) */
&gt;&gt;&gt; &#xA0;#define TAS5720_FAULT_CHECK_INTERVAL&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; 200
&gt;&gt;&gt;
&gt;&gt;&gt; -enum tas572x_type {
&gt;&gt;&gt; -&#xA0;&#xA0;&#xA0; TAS5720,
&gt;&gt;&gt; -&#xA0;&#xA0;&#xA0; TAS5722,
&gt;&gt;&gt; +struct tas5720_variant {
&gt;&gt;&gt; +&#xA0;&#xA0;&#xA0; const int device_id;
&gt;&gt;&gt; +&#xA0;&#xA0;&#xA0; const struct regmap_config *reg_config;
&gt;&gt;&gt; +&#xA0;&#xA0;&#xA0; const struct snd_soc_component_driver *comp_drv;
&gt;&gt;&gt; &#xA0;};
&gt;&gt;&gt;
&gt;&gt;&gt; &#xA0;static const char * const tas5720_supply_names[] = {
&gt;&gt;&gt; @@ -44,7 +45,7 @@ struct tas5720_data {
&gt;&gt;&gt; &#xA0;&#xA0;&#xA0;&#xA0; struct snd_soc_component *component;
&gt;&gt;&gt; &#xA0;&#xA0;&#xA0;&#xA0; struct regmap *regmap;
&gt;&gt;&gt; &#xA0;&#xA0;&#xA0;&#xA0; struct i2c_client *tas5720_client;
&gt;&gt;&gt; -&#xA0;&#xA0;&#xA0; enum tas572x_type devtype;
&gt;&gt;&gt; +&#xA0;&#xA0;&#xA0; const struct tas5720_variant *variant;
&gt;&gt;
&gt;&gt; Why add a new struct? Actually I don't see the need for this patch at
&gt;&gt; all, the commit message only explains the 'what' not the 'why'. We can
&gt;&gt; and do already build this info from the tas572x_type.
&gt; 
&gt; As the commit message says, the purpose is to aggregate the variant
&gt; specifics and make it accessible via one pointer. This is a standard
&gt; approach for of/acpi_device_id tables and thus makes the code simpler
&gt; and improves readability. This is a maintenance patch to prepare using
&gt; the device match API in a proper way.
&gt; 


&quot;make it accessible via one pointer&quot; is again a &quot;what&quot;, the &quot;why&quot; is:

&quot;This is a standard approach&quot;
&quot;makes the code simpler and improves readability&quot;

Those are valid reasons and should be what you put in the commit message.


&gt;&gt;
&gt;&gt; Also below are several functional changes, the cover letter says this is
&gt;&gt; not a functional change, yet the driver behaves differently now.
&gt; 
&gt; Can you be a little bit more specific? The code should behave exactly as
&gt; before.
&gt; 


Sure, for instance the line &quot;unexpected private driver data&quot; is removed,
this can now never happen, that is a functional change. The phrase &quot;no
functional change&quot;, should be reserved for only changes to spelling,
formatting, code organizing, etc..


&gt; Niko
&gt; 
&gt;&gt;
&gt;&gt; Andrew
&gt;&gt;
&gt;&gt;&gt; &#xA0;&#xA0;&#xA0;&#xA0; struct regulator_bulk_data supplies[TAS5720_NUM_SUPPLIES];
&gt;&gt;&gt; &#xA0;&#xA0;&#xA0;&#xA0; struct delayed_work fault_check_work;
&gt;&gt;&gt; &#xA0;&#xA0;&#xA0;&#xA0; unsigned int last_fault;
&gt;&gt;&gt; @@ -179,17 +180,13 @@ static int tas5720_set_dai_tdm_slot(struct
&gt;&gt;&gt; snd_soc_dai *dai,
&gt;&gt;&gt; &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; goto error_snd_soc_component_update_bits;
&gt;&gt;&gt;
&gt;&gt;&gt; &#xA0;&#xA0;&#xA0;&#xA0; /* Configure TDM slot width. This is only applicable to TAS5722. */
&gt;&gt;&gt; -&#xA0;&#xA0;&#xA0; switch (tas5720-&gt;devtype) {
&gt;&gt;&gt; -&#xA0;&#xA0;&#xA0; case TAS5722:
&gt;&gt;&gt; +&#xA0;&#xA0;&#xA0; if (tas5720-&gt;variant-&gt;device_id == TAS5722_DEVICE_ID) {


I also don't like this, TAS5722_DEVICE_ID is the expected contents of a
register, you are using it like the enum tas572x_type that you removed.
I'd leave that enum, the device ID register itself is not guaranteed to
be correct or unique, which is why we warn about mismatches below but
then continue to use the user provided device type anyway.

Andrew


&gt;&gt;&gt; &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ret = snd_soc_component_update_bits(component,
&gt;&gt;&gt; TAS5722_DIGITAL_CTRL2_REG,
&gt;&gt;&gt; &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; TAS5722_TDM_SLOT_16B,
&gt;&gt;&gt; &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; slot_width == 16 ?
&gt;&gt;&gt; &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; TAS5722_TDM_SLOT_16B : 0);
&gt;&gt;&gt; &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; if (ret &lt; 0)
&gt;&gt;&gt; &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; goto error_snd_soc_component_update_bits;
&gt;&gt;&gt; -&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; break;
&gt;&gt;&gt; -&#xA0;&#xA0;&#xA0; default:
&gt;&gt;&gt; -&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; break;
&gt;&gt;&gt; &#xA0;&#xA0;&#xA0;&#xA0; }
&gt;&gt;&gt;
&gt;&gt;&gt; &#xA0;&#xA0;&#xA0;&#xA0; return 0;
&gt;&gt;&gt; @@ -277,7 +274,7 @@ static void tas5720_fault_check_work(struct
&gt;&gt;&gt; work_struct *work)
&gt;&gt;&gt; &#xA0;static int tas5720_codec_probe(struct snd_soc_component *component)
&gt;&gt;&gt; &#xA0;{
&gt;&gt;&gt; &#xA0;&#xA0;&#xA0;&#xA0; struct tas5720_data *tas5720 =
&gt;&gt;&gt; snd_soc_component_get_drvdata(component);
&gt;&gt;&gt; -&#xA0;&#xA0;&#xA0; unsigned int device_id, expected_device_id;
&gt;&gt;&gt; +&#xA0;&#xA0;&#xA0; unsigned int device_id;
&gt;&gt;&gt; &#xA0;&#xA0;&#xA0;&#xA0; int ret;
&gt;&gt;&gt;
&gt;&gt;&gt; &#xA0;&#xA0;&#xA0;&#xA0; tas5720-&gt;component = component;
&gt;&gt;&gt; @@ -301,21 +298,9 @@ static int tas5720_codec_probe(struct
&gt;&gt;&gt; snd_soc_component *component)
&gt;&gt;&gt; &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; goto probe_fail;
&gt;&gt;&gt; &#xA0;&#xA0;&#xA0;&#xA0; }
&gt;&gt;&gt;
&gt;&gt;&gt; -&#xA0;&#xA0;&#xA0; switch (tas5720-&gt;devtype) {
&gt;&gt;&gt; -&#xA0;&#xA0;&#xA0; case TAS5720:
&gt;&gt;&gt; -&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; expected_device_id = TAS5720_DEVICE_ID;
&gt;&gt;&gt; -&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; break;
&gt;&gt;&gt; -&#xA0;&#xA0;&#xA0; case TAS5722:
&gt;&gt;&gt; -&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; expected_device_id = TAS5722_DEVICE_ID;
&gt;&gt;&gt; -&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; break;
&gt;&gt;&gt; -&#xA0;&#xA0;&#xA0; default:
&gt;&gt;&gt; -&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; dev_err(component-&gt;dev, &quot;unexpected private driver data\n&quot;);
&gt;&gt;&gt; -&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; return -EINVAL;
&gt;&gt;&gt; -&#xA0;&#xA0;&#xA0; }
&gt;&gt;&gt; -
&gt;&gt;&gt; -&#xA0;&#xA0;&#xA0; if (device_id != expected_device_id)
&gt;&gt;&gt; +&#xA0;&#xA0;&#xA0; if (device_id != tas5720-&gt;variant-&gt;device_id)
&gt;&gt;&gt; &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; dev_warn(component-&gt;dev, &quot;wrong device ID. expected: %u
&gt;&gt;&gt; read: %u\n&quot;,
&gt;&gt;&gt; -&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; expected_device_id, device_id);
&gt;&gt;&gt; +&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; tas5720-&gt;variant-&gt;device_id, device_id);
&gt;&gt;&gt;
&gt;&gt;&gt; &#xA0;&#xA0;&#xA0;&#xA0; /* Set device to mute */
&gt;&gt;&gt; &#xA0;&#xA0;&#xA0;&#xA0; ret = snd_soc_component_update_bits(component,
&gt;&gt;&gt; TAS5720_DIGITAL_CTRL2_REG,
&gt;&gt;&gt; @@ -637,7 +622,6 @@ static int tas5720_probe(struct i2c_client *client,
&gt;&gt;&gt; &#xA0;{
&gt;&gt;&gt; &#xA0;&#xA0;&#xA0;&#xA0; struct device *dev = &amp;client-&gt;dev;
&gt;&gt;&gt; &#xA0;&#xA0;&#xA0;&#xA0; struct tas5720_data *data;
&gt;&gt;&gt; -&#xA0;&#xA0;&#xA0; const struct regmap_config *regmap_config;
&gt;&gt;&gt; &#xA0;&#xA0;&#xA0;&#xA0; int ret;
&gt;&gt;&gt; &#xA0;&#xA0;&#xA0;&#xA0; int i;
&gt;&gt;&gt;
&gt;&gt;&gt; @@ -646,20 +630,10 @@ static int tas5720_probe(struct i2c_client
&gt;&gt;&gt; *client,
&gt;&gt;&gt; &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; return -ENOMEM;
&gt;&gt;&gt;
&gt;&gt;&gt; &#xA0;&#xA0;&#xA0;&#xA0; data-&gt;tas5720_client = client;
&gt;&gt;&gt; -&#xA0;&#xA0;&#xA0; data-&gt;devtype = id-&gt;driver_data;
&gt;&gt;&gt;
&gt;&gt;&gt; -&#xA0;&#xA0;&#xA0; switch (id-&gt;driver_data) {
&gt;&gt;&gt; -&#xA0;&#xA0;&#xA0; case TAS5720:
&gt;&gt;&gt; -&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; regmap_config = &amp;tas5720_regmap_config;
&gt;&gt;&gt; -&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; break;
&gt;&gt;&gt; -&#xA0;&#xA0;&#xA0; case TAS5722:
&gt;&gt;&gt; -&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; regmap_config = &amp;tas5722_regmap_config;
&gt;&gt;&gt; -&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; break;
&gt;&gt;&gt; -&#xA0;&#xA0;&#xA0; default:
&gt;&gt;&gt; -&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; dev_err(dev, &quot;unexpected private driver data\n&quot;);
&gt;&gt;&gt; -&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; return -EINVAL;
&gt;&gt;&gt; -&#xA0;&#xA0;&#xA0; }
&gt;&gt;&gt; -&#xA0;&#xA0;&#xA0; data-&gt;regmap = devm_regmap_init_i2c(client, regmap_config);
&gt;&gt;&gt; +&#xA0;&#xA0;&#xA0; data-&gt;variant = (const struct tas5720_variant *)id-&gt;driver_data;
&gt;&gt;&gt; +
&gt;&gt;&gt; +&#xA0;&#xA0;&#xA0; data-&gt;regmap = devm_regmap_init_i2c(client,
&gt;&gt;&gt; data-&gt;variant-&gt;reg_config);
&gt;&gt;&gt; &#xA0;&#xA0;&#xA0;&#xA0; if (IS_ERR(data-&gt;regmap)) {
&gt;&gt;&gt; &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ret = PTR_ERR(data-&gt;regmap);
&gt;&gt;&gt; &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; dev_err(dev, &quot;failed to allocate register map: %d\n&quot;, ret);
&gt;&gt;&gt; @@ -678,42 +652,36 @@ static int tas5720_probe(struct i2c_client
&gt;&gt;&gt; *client,
&gt;&gt;&gt;
&gt;&gt;&gt; &#xA0;&#xA0;&#xA0;&#xA0; dev_set_drvdata(dev, data);
&gt;&gt;&gt;
&gt;&gt;&gt; -&#xA0;&#xA0;&#xA0; switch (id-&gt;driver_data) {
&gt;&gt;&gt; -&#xA0;&#xA0;&#xA0; case TAS5720:
&gt;&gt;&gt; -&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ret = devm_snd_soc_register_component(&amp;client-&gt;dev,
&gt;&gt;&gt; -&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; &amp;soc_component_dev_tas5720,
&gt;&gt;&gt; -&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; tas5720_dai,
&gt;&gt;&gt; -&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ARRAY_SIZE(tas5720_dai));
&gt;&gt;&gt; -&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; break;
&gt;&gt;&gt; -&#xA0;&#xA0;&#xA0; case TAS5722:
&gt;&gt;&gt; -&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ret = devm_snd_soc_register_component(&amp;client-&gt;dev,
&gt;&gt;&gt; -&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; &amp;soc_component_dev_tas5722,
&gt;&gt;&gt; -&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; tas5720_dai,
&gt;&gt;&gt; -&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ARRAY_SIZE(tas5720_dai));
&gt;&gt;&gt; -&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; break;
&gt;&gt;&gt; -&#xA0;&#xA0;&#xA0; default:
&gt;&gt;&gt; -&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; dev_err(dev, &quot;unexpected private driver data\n&quot;);
&gt;&gt;&gt; -&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; return -EINVAL;
&gt;&gt;&gt; -&#xA0;&#xA0;&#xA0; }
&gt;&gt;&gt; -&#xA0;&#xA0;&#xA0; if (ret &lt; 0) {
&gt;&gt;&gt; -&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; dev_err(dev, &quot;failed to register component: %d\n&quot;, ret);
&gt;&gt;&gt; -&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; return ret;
&gt;&gt;&gt; -&#xA0;&#xA0;&#xA0; }
&gt;&gt;&gt; -
&gt;&gt;&gt; -&#xA0;&#xA0;&#xA0; return 0;
&gt;&gt;&gt; +&#xA0;&#xA0;&#xA0; ret = devm_snd_soc_register_component(&amp;client-&gt;dev,
&gt;&gt;&gt; +&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; data-&gt;variant-&gt;comp_drv,
&gt;&gt;&gt; +&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; tas5720_dai,
&gt;&gt;&gt; +&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; ARRAY_SIZE(tas5720_dai));
&gt;&gt;&gt; +&#xA0;&#xA0;&#xA0; return ret;
&gt;&gt;&gt; &#xA0;}
&gt;&gt;&gt;
&gt;&gt;&gt; +static const struct tas5720_variant tas5720 = {
&gt;&gt;&gt; +&#xA0;&#xA0;&#xA0; .device_id = TAS5720_DEVICE_ID,
&gt;&gt;&gt; +&#xA0;&#xA0;&#xA0; .reg_config = &amp;tas5720_regmap_config,
&gt;&gt;&gt; +&#xA0;&#xA0;&#xA0; .comp_drv = &amp;soc_component_dev_tas5720,
&gt;&gt;&gt; +};
&gt;&gt;&gt; +
&gt;&gt;&gt; +static const struct tas5720_variant tas5722 = {
&gt;&gt;&gt; +&#xA0;&#xA0;&#xA0; .device_id = TAS5722_DEVICE_ID,
&gt;&gt;&gt; +&#xA0;&#xA0;&#xA0; .reg_config = &amp;tas5722_regmap_config,
&gt;&gt;&gt; +&#xA0;&#xA0;&#xA0; .comp_drv = &amp;soc_component_dev_tas5722,
&gt;&gt;&gt; +};
&gt;&gt;&gt; +
&gt;&gt;&gt; &#xA0;static const struct i2c_device_id tas5720_id[] = {
&gt;&gt;&gt; -&#xA0;&#xA0;&#xA0; { &quot;tas5720&quot;, TAS5720 },
&gt;&gt;&gt; -&#xA0;&#xA0;&#xA0; { &quot;tas5722&quot;, TAS5722 },
&gt;&gt;&gt; +&#xA0;&#xA0;&#xA0; { &quot;tas5720&quot;, (kernel_ulong_t)&amp;tas5720 },
&gt;&gt;&gt; +&#xA0;&#xA0;&#xA0; { &quot;tas5722&quot;, (kernel_ulong_t)&amp;tas5722 },
&gt;&gt;&gt; &#xA0;&#xA0;&#xA0;&#xA0; { }
&gt;&gt;&gt; &#xA0;};
&gt;&gt;&gt; &#xA0;MODULE_DEVICE_TABLE(i2c, tas5720_id);
&gt;&gt;&gt;
&gt;&gt;&gt; &#xA0;#if IS_ENABLED(CONFIG_OF)
&gt;&gt;&gt; &#xA0;static const struct of_device_id tas5720_of_match[] = {
&gt;&gt;&gt; -&#xA0;&#xA0;&#xA0; { .compatible = &quot;ti,tas5720&quot;, },
&gt;&gt;&gt; -&#xA0;&#xA0;&#xA0; { .compatible = &quot;ti,tas5722&quot;, },
&gt;&gt;&gt; +&#xA0;&#xA0;&#xA0; { .compatible = &quot;ti,tas5720&quot;, .data = &amp;tas5720, },
&gt;&gt;&gt; +&#xA0;&#xA0;&#xA0; { .compatible = &quot;ti,tas5722&quot;, .data = &amp;tas5722, },
&gt;&gt;&gt; &#xA0;&#xA0;&#xA0;&#xA0; { },
&gt;&gt;&gt; &#xA0;};
&gt;&gt;&gt; &#xA0;MODULE_DEVICE_TABLE(of, tas5720_of_match);
&gt;&gt;&gt;
&gt;&gt;
_______________________________________________
Alsa-devel mailing list
Alsa-devel@xxxxxxxxxxxxxxxx
<a  rel="nofollow" href="https://mailman.alsa-project.org/mailman/listinfo/alsa-devel">https://mailman.alsa-project.org/mailman/listinfo/alsa-devel</a>



</pre>
<!--X-Body-of-Message-End-->
<!--X-MsgBody-End-->
<!--X-Follow-Ups-->
</div>
<hr>
<ul><li><strong>Follow-Ups</strong>:
<ul>
<li><strong><a name="93461" href="msg93461.html">Re:  [PATCH v2 1/2] ASoC: tas5720.c: cleanup variant	management</a></strong>
<ul><li><em>From:</em> Nikolaus Voss</li></ul></li>
</ul></li></ul>
<!--X-Follow-Ups-End-->
<!--X-References-->
<ul><li><strong>References</strong>:
<ul>
<li><strong><a name="93322" href="msg93322.html">Re:  [PATCH] sound/soc/codecs/tas5720.c: add ACPI	support</a></strong>
<ul><li><em>From:</em> Mark Brown</li></ul></li>
<li><strong><a name="93457" href="msg93457.html">[PATCH v2 0/2] ASoC: tas5720.c: add ACPI enumeration	support</a></strong>
<ul><li><em>From:</em> Nikolaus Voss</li></ul></li>
<li><strong><a name="93458" href="msg93458.html">[PATCH v2 1/2] ASoC: tas5720.c: cleanup variant	management</a></strong>
<ul><li><em>From:</em> Nikolaus Voss</li></ul></li>
<li><strong><a name="93404" href="msg93404.html">Re:  [PATCH v2 1/2] ASoC: tas5720.c: cleanup variant	management</a></strong>
<ul><li><em>From:</em> Andrew F. Davis</li></ul></li>
<li><strong><a name="93460" href="msg93460.html">Re:  [PATCH v2 1/2] ASoC: tas5720.c: cleanup variant	management</a></strong>
<ul><li><em>From:</em> Nikolaus Voss</li></ul></li>
</ul></li></ul>
<!--X-References-End-->
<!--X-BotPNI-->
<ul>
<li>Prev by Date:
<strong><a href="msg93409.html">Re:  [PATCH v2 1/2] ALSA: hda: Fix widget_mutex	incomplete protection</a></strong>
</li>
<li>Next by Date:
<strong><a href="msg93411.html">[PATCH v3] ALSA: hda: Fix widget_mutex incomplete	protection</a></strong>
</li>
<li>Previous by thread:
<strong><a href="msg93460.html">Re:  [PATCH v2 1/2] ASoC: tas5720.c: cleanup variant	management</a></strong>
</li>
<li>Next by thread:
<strong><a href="msg93461.html">Re:  [PATCH v2 1/2] ASoC: tas5720.c: cleanup variant	management</a></strong>
</li>
<li>Index(es):
<ul>
<li><a href="maillist.html#93410"><strong>Date</strong></a></li>
<li><a href="threads.html#93410"><strong>Thread</strong></a></li>
</ul>
</li>
</ul>

<!--X-BotPNI-End-->
<!--X-User-Footer-->
<center>
<font size=-1>
<a href=/lists/>[Index&nbsp;of&nbsp;Archives]</a>
&nbsp;
&nbsp;
<a href=/linux/fedora/alsa-user/>[ALSA&nbsp;User]</a>
&nbsp;
&nbsp;
<a href=/lists/linux-audio-users/>[Linux&nbsp;Audio&nbsp;Users]</a>
&nbsp;
&nbsp;
<a href=/lists/pulse-audio/>[Pulse&nbsp;Audio]</a>
&nbsp;
&nbsp;
<a href=/lists/kernel/>[Kernel&nbsp;Archive]</a>
&nbsp;
&nbsp;
<a href=/lists/asterisk/>[Asterisk&nbsp;PBX]</a>
&nbsp;
&nbsp;
<a href=http://yosemitephotos.net/>[Photo&nbsp;Sharing]</a>
&nbsp;
&nbsp;
<a href=/linux/fedora/linux-sound/>[Linux&nbsp;Sound]</a>
&nbsp;
&nbsp;
<a href=/lists/linux-media/>[Video&nbsp;4&nbsp;Linux]</a>
&nbsp;
&nbsp;
<a href=/lists/gimp/>[Gimp]</a>
&nbsp;
&nbsp;
<a href=https://yosemitenews.info>[Yosemite&nbsp;News]</a>
</font>
</center>
<hr>
<p>
<div>
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<ins class="adsbygoogle"
     style="display:block"
     data-ad-format="autorelaxed"
     data-ad-client="ca-pub-3422782820843221"
     data-ad-slot="1424524564"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
</div>
<table width=100%>
<tr>
<td align=left>&nbsp;</td>
<td align=right><a href=/lists/><img src=/button_01.gif border=0 alt="Powered by Linux"></a></td>
</tr>
</table>
<!--X-User-Footer-End-->
<script type="text/javascript"> 
 function initAddThis() {
    addthis.init()
 }
initAddThis();
</script>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-760190-1', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
