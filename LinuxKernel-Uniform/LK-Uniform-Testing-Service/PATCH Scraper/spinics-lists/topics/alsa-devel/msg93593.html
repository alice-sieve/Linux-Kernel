<!-- MHonArc v2.6.19 -->
<!--X-Subject: [PATCH 2/6] ALSA: fireworks: fix wrong reference count	for stream functionality at error path of rawmidi interface -->
<!--X-From-R13: Fnxnfuv Enxnzbgb &#60;b&#45;gnxnfuvNfnxnzbppuv.wc> -->
<!--X-Date: Sat, 6 Jul 2019 22:24:39 &#45;0700 -->
<!--X-Message-Id: 20190707052011.24687&#45;3&#45;o&#45;takashi@sakamocchi.jp -->
<!--X-Content-Type: text/plain -->
<!--X-Reference: 20190707052011.24687&#45;1&#45;o&#45;takashi@sakamocchi.jp -->
<!--X-Head-End-->
<!doctype html public "-//W3C//DTD HTML//EN">
<html>
<head>
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({
          google_ad_client: "ca-pub-3422782820843221",
          enable_page_level_ads: true
     });
</script>
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="description" content="[PATCH 2/6] ALSA: fireworks: fix wrong reference count	for stream functionality at error path of rawmidi interface &mdash; ALSA Devel">
<style>
<!--
 pre {white-space: pre-wrap;}
-->
</style>
<title>[PATCH 2/6] ALSA: fireworks: fix wrong reference count	for stream functionality at error path of rawmidi interface &mdash; ALSA Devel</title>
<link rel="alternate" type="application/rss+xml" title="ALSA Devel" href="//feedproxy.google.com/AlsaDevel">
</head>
<body itemscope itemtype="//schema.org/Article" vlink=green>
<!--X-Body-Begin-->
<!--X-User-Header-->
<!--X-User-Header-End-->
<!--X-TopPNI-->
<form action="//www.google.com" id="cse-search-box" target="_blank">
  <div>
    <input type="hidden" name="cx" value="partner-pub-3422782820843221:9580497365" />
    <input type="hidden" name="ie" value="UTF-8" />
    <input type="text" name="q" size="25" />
    <input type="submit" name="sa" value="Search" />
  </div>
</form>
<script type="text/javascript" src="//www.google.com/coop/cse/brand?form=cse-search-box&amp;lang=en"></script>
<h1 itemprop="name">[PATCH 2/6] ALSA: fireworks: fix wrong reference count	for stream functionality at error path of rawmidi interface</h1>
[<a href="msg93592.html">Date Prev</a>][<a href="msg93594.html">Date Next</a>][<a href="msg93592.html">Thread Prev</a>][<a href="msg93594.html">Thread Next</a>][<a href="maillist.html#93593">Date Index</a>][<a href="threads.html#93593">Thread Index</a>]


<p>&nbsp;<br>
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- responsive test for archives -->
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-3422782820843221"
     data-ad-slot="6345952567"
     data-ad-format="auto"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>

<!--X-TopPNI-End-->
<!--X-MsgBody-->
<!--X-Subject-Header-Begin-->
<hr>
<!--X-Subject-Header-End-->
<!--X-Head-of-Message-->
<ul>
<li><em>To</em>: clemens@xxxxxxxxxx, tiwai@xxxxxxx</li>
<li><em>Subject</em>: [PATCH 2/6] ALSA: fireworks: fix wrong reference count	for stream functionality at error path of rawmidi interface</li>
<li><em>From</em>: Takashi Sakamoto &lt;o-takashi@xxxxxxxxxxxxx&gt;</li>
<li><em>Date</em>: Sun,  7 Jul 2019 14:20:07 +0900</li>
<li><em>Cc</em>: alsa-devel@xxxxxxxxxxxxxxxx</li>
<li><em>In-reply-to</em>: &lt;<a href="msg93590.html">20190707052011.24687-1-o-takashi@sakamocchi.jp</a>&gt;</li>
<li><em>References</em>: &lt;<a href="msg93590.html">20190707052011.24687-1-o-takashi@sakamocchi.jp</a>&gt;</li>
</ul>
<!--X-Head-of-Message-End-->
<!--X-Head-Body-Sep-Begin-->
<!-- AddThis Button BEGIN -->
<div class="addthis_toolbox addthis_default_style ">
<a class="addthis_button_preferred_1"></a>
<a class="addthis_button_preferred_2"></a>
<a class="addthis_button_preferred_3"></a>
<a class="addthis_button_preferred_4"></a>
<a class="addthis_button_compact"></a>
<a class="addthis_counter addthis_bubble_style"></a>
</div>
<script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5196c2ae1be43d18&async=1&domready=1" async></script>
<!-- AddThis Button END -->
<hr>
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- responsive link 1 -->
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-3422782820843221"
     data-ad-slot="8681825769"
     data-ad-format="link"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
<p>
<div class="content" itemprop="articleBody">
<!--X-Head-Body-Sep-End-->
<!--X-Body-of-Message-->
<pre>In IEC 61883-6, several types of sampling data can be multiplexed into
payload of common isochronous packet (CIP). For typical audio and music
units, PCM samples and MIDI messages are multiplexed into one packet
streaming.

ALSA fireworks driver allows applications of rawmidi interface to start
packet streaming for transmission of MIDI messages. However at error
path, the reference count of stream functionality is not operated
correctly. This can brings a bug that packet streaming is not stopped
when all referrers release the count.

This commit fixes the bug.

Fixes: 3d7250667ea9 (&quot;ALSA: fireworks: configure sampling transfer frequency in pcm.hw_params callback&quot;)
Signed-off-by: Takashi Sakamoto &lt;o-takashi@xxxxxxxxxxxxx&gt;
---
 sound/firewire/fireworks/fireworks_midi.c | 2 ++
 1 file changed, 2 insertions(+)

diff --git a/sound/firewire/fireworks/fireworks_midi.c b/sound/firewire/fireworks/fireworks_midi.c
index 6d3d942e2dce..fd17777981e4 100644
--- a/sound/firewire/fireworks/fireworks_midi.c
+++ b/sound/firewire/fireworks/fireworks_midi.c
@@ -22,6 +22,8 @@ static int midi_open(struct snd_rawmidi_substream *substream)
 	if (err &gt;= 0) {
 		++efw-&gt;substreams_counter;
 		err = snd_efw_stream_start_duplex(efw);
+		if (err &lt; 0)
+			--efw-&gt;substreams_counter;
 	}
 	mutex_unlock(&amp;efw-&gt;mutex);
 	if (err &lt; 0)
-- 
2.20.1

_______________________________________________
Alsa-devel mailing list
Alsa-devel@xxxxxxxxxxxxxxxx
<a  rel="nofollow" href="https://mailman.alsa-project.org/mailman/listinfo/alsa-devel">https://mailman.alsa-project.org/mailman/listinfo/alsa-devel</a>


</pre>
<!--X-Body-of-Message-End-->
<!--X-MsgBody-End-->
<!--X-Follow-Ups-->
</div>
<hr>
<!--X-Follow-Ups-End-->
<!--X-References-->
<ul><li><strong>References</strong>:
<ul>
<li><strong><a name="93590" href="msg93590.html">[PATCH 0/6] ALSA: firewire: fix wrong reference count	for stream functionality at error path of rawmidi interface</a></strong>
<ul><li><em>From:</em> Takashi Sakamoto</li></ul></li>
</ul></li></ul>
<!--X-References-End-->
<!--X-BotPNI-->
<ul>
<li>Prev by Date:
<strong><a href="msg93592.html">[PATCH 6/6] firewire-motu: fix wrong reference count	for stream functionality at error path of rawmidi interface</a></strong>
</li>
<li>Next by Date:
<strong><a href="msg93594.html">[PATCH 3/6] ALSA: oxfw: fix wrong reference count for	stream functionality at error path of rawmidi interface</a></strong>
</li>
<li>Previous by thread:
<strong><a href="msg93592.html">[PATCH 6/6] firewire-motu: fix wrong reference count	for stream functionality at error path of rawmidi interface</a></strong>
</li>
<li>Next by thread:
<strong><a href="msg93594.html">[PATCH 3/6] ALSA: oxfw: fix wrong reference count for	stream functionality at error path of rawmidi interface</a></strong>
</li>
<li>Index(es):
<ul>
<li><a href="maillist.html#93593"><strong>Date</strong></a></li>
<li><a href="threads.html#93593"><strong>Thread</strong></a></li>
</ul>
</li>
</ul>

<!--X-BotPNI-End-->
<!--X-User-Footer-->
<center>
<font size=-1>
<a href=/lists/>[Index&nbsp;of&nbsp;Archives]</a>
&nbsp;
&nbsp;
<a href=/linux/fedora/alsa-user/>[ALSA&nbsp;User]</a>
&nbsp;
&nbsp;
<a href=/lists/linux-audio-users/>[Linux&nbsp;Audio&nbsp;Users]</a>
&nbsp;
&nbsp;
<a href=/lists/pulse-audio/>[Pulse&nbsp;Audio]</a>
&nbsp;
&nbsp;
<a href=/lists/kernel/>[Kernel&nbsp;Archive]</a>
&nbsp;
&nbsp;
<a href=/lists/asterisk/>[Asterisk&nbsp;PBX]</a>
&nbsp;
&nbsp;
<a href=http://yosemitephotos.net/>[Photo&nbsp;Sharing]</a>
&nbsp;
&nbsp;
<a href=/linux/fedora/linux-sound/>[Linux&nbsp;Sound]</a>
&nbsp;
&nbsp;
<a href=/lists/linux-media/>[Video&nbsp;4&nbsp;Linux]</a>
&nbsp;
&nbsp;
<a href=/lists/gimp/>[Gimp]</a>
&nbsp;
&nbsp;
<a href=https://yosemitenews.info>[Yosemite&nbsp;News]</a>
</font>
</center>
<hr>
<p>
<div>
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<ins class="adsbygoogle"
     style="display:block"
     data-ad-format="autorelaxed"
     data-ad-client="ca-pub-3422782820843221"
     data-ad-slot="1424524564"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
</div>
<table width=100%>
<tr>
<td align=left>&nbsp;</td>
<td align=right><a href=/lists/><img src=/button_01.gif border=0 alt="Powered by Linux"></a></td>
</tr>
</table>
<!--X-User-Footer-End-->
<script type="text/javascript"> 
 function initAddThis() {
    addthis.init()
 }
initAddThis();
</script>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-760190-1', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
