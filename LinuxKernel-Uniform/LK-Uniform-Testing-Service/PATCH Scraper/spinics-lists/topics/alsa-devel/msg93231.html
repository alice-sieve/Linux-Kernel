<!-- MHonArc v2.6.19 -->
<!--X-Subject: [PATCH 17/46] ASoC: qcom: apq8016_sbc: consider	CPU&#45;Platform possibility -->
<!--X-From-R13: Yhavabev [bevzbgb &#60;xhavabev.zbevzbgb.tkNerarfnf.pbz> -->
<!--X-Date: Thu, 27 Jun 2019 18:58:41 &#45;0700 -->
<!--X-Message-Id: 87lfxmv5xs.wl&#45;kuninori.morimoto.gx@renesas.com -->
<!--X-Content-Type: text/plain -->
<!--X-Reference: 87a7e2wkll.wl&#45;kuninori.morimoto.gx@renesas.com -->
<!--X-Head-End-->
<!doctype html public "-//W3C//DTD HTML//EN">
<html>
<head>
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({
          google_ad_client: "ca-pub-3422782820843221",
          enable_page_level_ads: true
     });
</script>
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="description" content="[PATCH 17/46] ASoC: qcom: apq8016_sbc: consider	CPU-Platform possibility &mdash; ALSA Devel">
<style>
<!--
 pre {white-space: pre-wrap;}
-->
</style>
<title>[PATCH 17/46] ASoC: qcom: apq8016_sbc: consider	CPU-Platform possibility &mdash; ALSA Devel</title>
<link rel="alternate" type="application/rss+xml" title="ALSA Devel" href="//feedproxy.google.com/AlsaDevel">
</head>
<body itemscope itemtype="//schema.org/Article" vlink=green>
<!--X-Body-Begin-->
<!--X-User-Header-->
<!--X-User-Header-End-->
<!--X-TopPNI-->
<form action="//www.google.com" id="cse-search-box" target="_blank">
  <div>
    <input type="hidden" name="cx" value="partner-pub-3422782820843221:9580497365" />
    <input type="hidden" name="ie" value="UTF-8" />
    <input type="text" name="q" size="25" />
    <input type="submit" name="sa" value="Search" />
  </div>
</form>
<script type="text/javascript" src="//www.google.com/coop/cse/brand?form=cse-search-box&amp;lang=en"></script>
<h1 itemprop="name">[PATCH 17/46] ASoC: qcom: apq8016_sbc: consider	CPU-Platform possibility</h1>
[<a href="msg93230.html">Date Prev</a>][<a href="msg93232.html">Date Next</a>][<a href="msg93355.html">Thread Prev</a>][<a href="msg93352.html">Thread Next</a>][<a href="maillist.html#93231">Date Index</a>][<a href="threads.html#93231">Thread Index</a>]


<p>&nbsp;<br>
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- responsive test for archives -->
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-3422782820843221"
     data-ad-slot="6345952567"
     data-ad-format="auto"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>

<!--X-TopPNI-End-->
<!--X-MsgBody-->
<!--X-Subject-Header-Begin-->
<hr>
<!--X-Subject-Header-End-->
<!--X-Head-of-Message-->
<ul>
<li><em>To</em>: Mark Brown &lt;broonie@xxxxxxxxxx&gt;</li>
<li><em>Subject</em>: [PATCH 17/46] ASoC: qcom: apq8016_sbc: consider	CPU-Platform possibility</li>
<li><em>From</em>: Kuninori Morimoto &lt;kuninori.morimoto.gx@xxxxxxxxxxx&gt;</li>
<li><em>Date</em>: 28 Jun 2019 10:47:46 +0900</li>
<li><em>Cc</em>: Linux-ALSA &lt;alsa-devel@xxxxxxxxxxxxxxxx&gt;</li>
<li><em>In-reply-to</em>: &lt;<a href="msg93214.html">87a7e2wkll.wl-kuninori.morimoto.gx@renesas.com</a>&gt;</li>
<li><em>References</em>: &lt;<a href="msg93214.html">87a7e2wkll.wl-kuninori.morimoto.gx@renesas.com</a>&gt;</li>
<li><em>User-agent</em>: Wanderlust/2.15.9 Emacs/24.5 Mule/6.0</li>
</ul>
<!--X-Head-of-Message-End-->
<!--X-Head-Body-Sep-Begin-->
<!-- AddThis Button BEGIN -->
<div class="addthis_toolbox addthis_default_style ">
<a class="addthis_button_preferred_1"></a>
<a class="addthis_button_preferred_2"></a>
<a class="addthis_button_preferred_3"></a>
<a class="addthis_button_preferred_4"></a>
<a class="addthis_button_compact"></a>
<a class="addthis_counter addthis_bubble_style"></a>
</div>
<script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5196c2ae1be43d18&async=1&domready=1" async></script>
<!-- AddThis Button END -->
<hr>
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- responsive link 1 -->
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-3422782820843221"
     data-ad-slot="8681825769"
     data-ad-format="link"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
<p>
<div class="content" itemprop="articleBody">
<!--X-Head-Body-Sep-End-->
<!--X-Body-of-Message-->
<pre>From: Kuninori Morimoto &lt;kuninori.morimoto.gx@xxxxxxxxxxx&gt;

commit 564684387969 (&quot;ASoC: qcom: apq8016_sbc: don't select unnecessary
Platform&quot;)

Current ALSA SoC avoid to add duplicate component to rtd,
and this driver was selecting CPU component as Platform component.
Thus, above patch removed Platform settings from this driver,
because it assumed these are same component.

But, some CPU driver is using generic DMAEngine, in such case, both
CPU component and Platform component will have same of_node/name.
In other words, there are some components which are different but
have same of_node/name.

In such case, Card driver definitely need to select Platform even
though it is same as CPU.
It is depends on CPU driver, but is difficult to know it from Card driver.
This patch reverts above patch.

Fixes: commit 564684387969 (&quot;ASoC: qcom: apq8016_sbc: don't select unnecessary Platform&quot;)
Signed-off-by: Kuninori Morimoto &lt;kuninori.morimoto.gx@xxxxxxxxxxx&gt;
---
 sound/soc/qcom/apq8016_sbc.c | 10 +++++++---
 1 file changed, 7 insertions(+), 3 deletions(-)

diff --git a/sound/soc/qcom/apq8016_sbc.c b/sound/soc/qcom/apq8016_sbc.c
index c0b0aa8..f60a719 100644
--- a/sound/soc/qcom/apq8016_sbc.c
+++ b/sound/soc/qcom/apq8016_sbc.c
@@ -150,12 +150,15 @@ static struct apq8016_sbc_data *apq8016_sbc_parse_of(struct snd_soc_card *card)
 
 	link = data-&gt;dai_link;
 
-	dlc = devm_kzalloc(dev, sizeof(*dlc), GFP_KERNEL);
+	dlc = devm_kzalloc(dev, 2 * sizeof(*dlc), GFP_KERNEL);
 	if (!dlc)
 		return ERR_PTR(-ENOMEM);
 
-	link-&gt;cpus	= dlc;
-	link-&gt;num_cpus	= 1;
+	link-&gt;cpus	= &amp;dlc[0];
+	link-&gt;platforms	= &amp;dlc[1];
+
+	link-&gt;num_cpus		= 1;
+	link-&gt;num_platforms	= 1;
 
 	for_each_child_of_node(node, np) {
 		cpu = of_get_child_by_name(np, &quot;cpu&quot;);
@@ -187,6 +190,7 @@ static struct apq8016_sbc_data *apq8016_sbc_parse_of(struct snd_soc_card *card)
 			goto error;
 		}
 
+		link-&gt;platforms-&gt;of_node = link-&gt;cpus-&gt;of_node;
 		ret = of_property_read_string(np, &quot;link-name&quot;, &amp;link-&gt;name);
 		if (ret) {
 			dev_err(card-&gt;dev, &quot;error getting codec dai_link name\n&quot;);
-- 
2.7.4

_______________________________________________
Alsa-devel mailing list
Alsa-devel@xxxxxxxxxxxxxxxx
<a  rel="nofollow" href="https://mailman.alsa-project.org/mailman/listinfo/alsa-devel">https://mailman.alsa-project.org/mailman/listinfo/alsa-devel</a>


</pre>
<!--X-Body-of-Message-End-->
<!--X-MsgBody-End-->
<!--X-Follow-Ups-->
</div>
<hr>
<ul><li><strong>Follow-Ups</strong>:
<ul>
<li><strong><a name="93352" href="msg93352.html">Applied &quot;ASoC: qcom: apq8016_sbc: consider	CPU-Platform possibility&quot; to the asoc tree</a></strong>
<ul><li><em>From:</em> Mark Brown</li></ul></li>
</ul></li></ul>
<!--X-Follow-Ups-End-->
<!--X-References-->
<ul><li><strong>References</strong>:
<ul>
<li><strong><a name="93214" href="msg93214.html">[PATCH 00/46] ASoC: consider CPU-Platform possibility</a></strong>
<ul><li><em>From:</em> Kuninori Morimoto</li></ul></li>
</ul></li></ul>
<!--X-References-End-->
<!--X-BotPNI-->
<ul>
<li>Prev by Date:
<strong><a href="msg93230.html">[PATCH 16/46] ASoC: mxs: mxs-sgtl5000: consider	CPU-Platform possibility</a></strong>
</li>
<li>Next by Date:
<strong><a href="msg93232.html">[PATCH 18/46] ASoC: qcom: storm: consider CPU-Platform	possibility</a></strong>
</li>
<li>Previous by thread:
<strong><a href="msg93355.html">Applied &quot;ASoC: mxs: mxs-sgtl5000: consider	CPU-Platform possibility&quot; to the asoc tree</a></strong>
</li>
<li>Next by thread:
<strong><a href="msg93352.html">Applied &quot;ASoC: qcom: apq8016_sbc: consider	CPU-Platform possibility&quot; to the asoc tree</a></strong>
</li>
<li>Index(es):
<ul>
<li><a href="maillist.html#93231"><strong>Date</strong></a></li>
<li><a href="threads.html#93231"><strong>Thread</strong></a></li>
</ul>
</li>
</ul>

<!--X-BotPNI-End-->
<!--X-User-Footer-->
<center>
<font size=-1>
<a href=/lists/>[Index&nbsp;of&nbsp;Archives]</a>
&nbsp;
&nbsp;
<a href=/linux/fedora/alsa-user/>[ALSA&nbsp;User]</a>
&nbsp;
&nbsp;
<a href=/lists/linux-audio-users/>[Linux&nbsp;Audio&nbsp;Users]</a>
&nbsp;
&nbsp;
<a href=/lists/pulse-audio/>[Pulse&nbsp;Audio]</a>
&nbsp;
&nbsp;
<a href=/lists/kernel/>[Kernel&nbsp;Archive]</a>
&nbsp;
&nbsp;
<a href=/lists/asterisk/>[Asterisk&nbsp;PBX]</a>
&nbsp;
&nbsp;
<a href=http://yosemitephotos.net/>[Photo&nbsp;Sharing]</a>
&nbsp;
&nbsp;
<a href=/linux/fedora/linux-sound/>[Linux&nbsp;Sound]</a>
&nbsp;
&nbsp;
<a href=/lists/linux-media/>[Video&nbsp;4&nbsp;Linux]</a>
&nbsp;
&nbsp;
<a href=/lists/gimp/>[Gimp]</a>
&nbsp;
&nbsp;
<a href=https://yosemitenews.info>[Yosemite&nbsp;News]</a>
</font>
</center>
<hr>
<p>
<div>
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<ins class="adsbygoogle"
     style="display:block"
     data-ad-format="autorelaxed"
     data-ad-client="ca-pub-3422782820843221"
     data-ad-slot="1424524564"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
</div>
<table width=100%>
<tr>
<td align=left>&nbsp;</td>
<td align=right><a href=/lists/><img src=/button_01.gif border=0 alt="Powered by Linux"></a></td>
</tr>
</table>
<!--X-User-Footer-End-->
<script type="text/javascript"> 
 function initAddThis() {
    addthis.init()
 }
initAddThis();
</script>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-760190-1', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
