<!-- MHonArc v2.6.19 -->
<!--X-Subject: [PATCH] Allow the radio to report 0 dbm txpower without timing out -->
<!--X-From-R13: Sevp Pragyrl &#60;revp.oragyrlNynveqgrpu.pbz> -->
<!--X-Date: Mon, 29 Aug 2016 21:31:48 &#45;0700 -->
<!--X-Message-Id: 1472531450&#45;19115&#45;1&#45;git&#45;send&#45;email&#45;eric.bentley@lairdtech.com -->
<!--X-Content-Type: text/plain -->
<!--X-Head-End-->
<!doctype html public "-//W3C//DTD HTML//EN">
<html>
<head>
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({
          google_ad_client: "ca-pub-3422782820843221",
          enable_page_level_ads: true
     });
</script>
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="description" content="Linux ATH6KL: [PATCH] Allow the radio to report 0 dbm txpower without timing out">
<style>
<!--
 pre {white-space: pre-wrap;}
-->
</style>
<title>[PATCH] Allow the radio to report 0 dbm txpower without timing out (Linux ATH6KL)</title>
<link rel="alternate" type="application/rss+xml" title="Linux ATH6KL" href="//feedproxy.google.com/LinuxATH6KL">
<script type="text/javascript">
var addthis_config = addthis_config||{};
addthis_config.data_track_addressbar = false;
</script>
</head>
<body itemscope itemtype="//schema.org/Article" vlink=green>
<!--X-Body-Begin-->
<!--X-User-Header-->
<!--X-User-Header-End-->
<!--X-TopPNI-->
<form action="//www.google.com" id="cse-search-box" target="_blank">
  <div>
    <input type="hidden" name="cx" value="partner-pub-3422782820843221:6308783764" />
    <input type="hidden" name="ie" value="UTF-8" />
    <input type="text" name="q" size="55" />
    <input type="submit" name="sa" value="Search" />
  </div>
</form>
<script type="text/javascript" src="//www.google.com/coop/cse/brand?form=cse-search-box&amp;lang=en"></script>
<h1 itemprop="name">[PATCH] Allow the radio to report 0 dbm txpower without timing out</h1>
[<a href="msg00241.html">Date Prev</a>][<a href="msg00243.html">Date Next</a>][<a href="msg00240.html">Thread Prev</a>][<a href="msg00243.html">Thread Next</a>][<a href="maillist.html#00242">Date Index</a>][<a href="index.html#00242">Thread Index</a>] 


<p>&nbsp;<br>
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- responsive test for archives -->
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-3422782820843221"
     data-ad-slot="6345952567"
     data-ad-format="auto"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>

<!--X-TopPNI-End-->
<!--X-MsgBody-->
<!--X-Subject-Header-Begin-->
<hr>
<!--X-Subject-Header-End-->
<!--X-Head-of-Message-->
<ul>
<li><em>To</em>: &lt;kvalo@xxxxxxxxxxxxxxxx&gt;</li>
<li><em>Subject</em>: [PATCH] Allow the radio to report 0 dbm txpower without timing out</li>
<li><em>From</em>: Eric Bentley &lt;eric.bentley@xxxxxxxxxxxxx&gt;</li>
<li><em>Date</em>: Tue, 30 Aug 2016 00:30:50 -0400</li>
<li><em>Cc</em>: ath6kl@xxxxxxxxxxxxxxxxxxx, linux-wireless@xxxxxxxxxxxxxxx</li>
</ul>
<!--X-Head-of-Message-End-->
<!--X-Head-Body-Sep-Begin-->
<!-- AddThis Button BEGIN -->
<div class="addthis_toolbox addthis_default_style ">
<a class="addthis_button_preferred_1"></a>
<a class="addthis_button_preferred_2"></a>
<a class="addthis_button_preferred_3"></a>
<a class="addthis_button_preferred_4"></a>
<a class="addthis_button_compact"></a>
<a class="addthis_counter addthis_bubble_style"></a>
</div>
<script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5196c2ae1be43d18&async=1&domready=1" async></script>
<!-- AddThis Button END -->
<hr>
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- responsive link 1 -->
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-3422782820843221"
     data-ad-slot="8681825769"
     data-ad-format="link"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
<p>
<div class="content" itemprop="articleBody">
<!--X-Head-Body-Sep-End-->
<!--X-Body-of-Message-->
<pre>The ath6kl driver attempts to get the txpower from the radio by first
clearing the existing stored value and then watching the value to become
non-zero. However, this value is in dbm and 0 is a valid value.

APs allow setting client power to values from -127..127. However, The radio
is not capable of setting values less then 0 and so will report txpower
as 0 for both negative and 0 client power.

The 6004 defaults to 63dbm which is then limited by regulatory and
hardware limits with max of 18dbm (6003 max is 16dbm), therefore we can
use values larger then this to be able to determine when the value has
been updated.

Set the value to a nonsensical value (255) and wait for it to change.
---
 drivers/net/wireless/ath/ath6kl/cfg80211.c | 4 ++--
 1 file changed, 2 insertions(+), 2 deletions(-)

diff --git a/drivers/net/wireless/ath/ath6kl/cfg80211.c b/drivers/net/wireless/ath/ath6kl/cfg80211.c
index 72e2ec6..b7fe0af 100644
--- a/drivers/net/wireless/ath/ath6kl/cfg80211.c
+++ b/drivers/net/wireless/ath/ath6kl/cfg80211.c
@@ -1449,14 +1449,14 @@ static int ath6kl_cfg80211_get_txpower(struct wiphy *wiphy,
 		return -EIO;
 
 	if (test_bit(CONNECTED, &amp;vif-&gt;flags)) {
-		ar-&gt;tx_pwr = 0;
+		ar-&gt;tx_pwr = 255;
 
 		if (ath6kl_wmi_get_tx_pwr_cmd(ar-&gt;wmi, vif-&gt;fw_vif_idx) != 0) {
 			ath6kl_err(&quot;ath6kl_wmi_get_tx_pwr_cmd failed\n&quot;);
 			return -EIO;
 		}
 
-		wait_event_interruptible_timeout(ar-&gt;event_wq, ar-&gt;tx_pwr != 0,
+		wait_event_interruptible_timeout(ar-&gt;event_wq, ar-&gt;tx_pwr != 255,
 						 5 * HZ);
 
 		if (signal_pending(current)) {
-- 
2.6.0.GIT


_______________________________________________
ath6kl mailing list
ath6kl@xxxxxxxxxxxxxxxxxxx
<a  rel="nofollow" href="http://lists.infradead.org/mailman/listinfo/ath6kl">http://lists.infradead.org/mailman/listinfo/ath6kl</a>


</pre>
<!--X-Body-of-Message-End-->
<!--X-MsgBody-End-->
<!--X-Follow-Ups-->
</div>
<hr>
<ul><li><strong>Follow-Ups</strong>:
<ul>
<li><strong><a name="00243" href="msg00243.html">Re: [PATCH] Allow the radio to report 0 dbm txpower without timing out</a></strong>
<ul><li><em>From:</em> Valo, Kalle</li></ul></li>
</ul></li></ul>
<!--X-Follow-Ups-End-->
<!--X-References-->
<!--X-References-End-->
<!--X-BotPNI-->
<ul>
<li>Prev by Date:
<strong><a href="msg00241.html">Re: [PATCH] ath6kl: enable firmware crash dumps on the AR6004</a></strong>
</li>
<li>Next by Date:
<strong><a href="msg00243.html">Re: [PATCH] Allow the radio to report 0 dbm txpower without timing out</a></strong>
</li>
<li>Previous by thread:
<strong><a href="msg00240.html">[PATCH] ath6kl: enable firmware crash dumps on the AR6004</a></strong>
</li>
<li>Next by thread:
<strong><a href="msg00243.html">Re: [PATCH] Allow the radio to report 0 dbm txpower without timing out</a></strong>
</li>
<li>Index(es):
<ul>
<li><a href="maillist.html#00242"><strong>Date</strong></a></li>
<li><a href="index.html#00242"><strong>Thread</strong></a></li>
</ul>
</li>
</ul>

<!--X-BotPNI-End-->
<!--X-User-Footer-->
<center>
<font size=-1>
<a href=/lists/>[Index&nbsp;of&nbsp;Archives]</a>
&nbsp;
&nbsp;
<a href=/lists/kernel/>[Linux&nbsp;Kernel]</a>
&nbsp;
&nbsp;
<a href=/lists/linux-wireless/>[Linux&nbsp;Wireless]</a>
&nbsp;
&nbsp;
<a href=/lists/linux-bluetooth/>[Linux&nbsp;Bluetooth]</a>
&nbsp;
&nbsp;
<a href=/lists/linux-wpan/>[Linux&nbsp;WPAN]</a>
&nbsp;
&nbsp;
<a href=/lists/netdev/>[Linux&nbsp;Netdev]</a>
&nbsp;
&nbsp;
<a href=/lists/newbies/>[Kernel&nbsp;Newbies]</a>
&nbsp;
&nbsp;
<a href=/lists/linux-ide/>[IDE]</a>
&nbsp;
&nbsp;
<a href=/lists/security/>[Security]</a>
&nbsp;
&nbsp;
<a href=/lists/git/>[Git]</a>
&nbsp;
&nbsp;
<a href=/lists/netfilter/>[Netfilter]</a>
&nbsp;
&nbsp;
<a href=/lists/bugtraq/>[Bugtraq]</a>
&nbsp;
&nbsp;
<a href=https://yosemitenews.info/>[Yosemite&nbsp;News]</a>
&nbsp;
&nbsp;
<a href=/lists/mips/>[MIPS&nbsp;Linux]</a>
&nbsp;
&nbsp;
<a href=/lists/arm/>[ARM&nbsp;Linux]</a>
&nbsp;
&nbsp;
<a href=/lists/security/>[Linux&nbsp;Security]</a>
&nbsp;
&nbsp;
<a href=/lists/raid/>[Linux&nbsp;RAID]</a>
&nbsp;
&nbsp;
<a href=/lists/ataraid/>[Linux&nbsp;ATA&nbsp;RAID]</a>
&nbsp;
&nbsp;
<a href=/lists/samba/>[Samba]</a>
</font>
</center>
<hr>
<p>
<div>
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<ins class="adsbygoogle"
     style="display:block"
     data-ad-format="autorelaxed"
     data-ad-client="ca-pub-3422782820843221"
     data-ad-slot="1424524564"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
</div>
<table width=100%>
<tr>
<td align=left>&nbsp;</td>
<td align=right><a href=/lists/><img src=/button_01.gif border=0 alt="Powered by Linux"></a></td>
</tr>
</table>
<!--X-User-Footer-End-->
<script type="text/javascript"> 
 function initAddThis() {
    addthis.init()
 }
initAddThis();
</script>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-760190-1', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
