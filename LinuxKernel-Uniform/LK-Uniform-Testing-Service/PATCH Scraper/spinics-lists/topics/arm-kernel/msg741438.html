<!-- MHonArc v2.6.19 -->
<!--X-Subject: Re: [PATCH v3 0/5] Add NUMA&#45;awareness to qspinlock -->
<!--X-From-R13: @vpubynf Bvttva &#60;acvttvaNtznvy.pbz> -->
<!--X-Date: Tue, 16 Jul 2019 16:07:30 &#45;0700 -->
<!--X-Message-Id: 1563317552.qsi08y8lyr.astroid@bobo.none -->
<!--X-Content-Type: text/plain -->
<!--X-Reference: 20190715192536.104548&#45;1&#45;alex.kogan@oracle.com -->
<!--X-Reference: 1563277166.m9swqogbqb.astroid@bobo.none -->
<!--X-Reference: 7D29555E&#45;8F72&#45;4EDD&#45;8A87&#45;B1A59C3945A6@oracle.com -->
<!--X-Head-End-->
<!doctype html public "-//W3C//DTD HTML//EN">
<html>
<head>
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({
          google_ad_client: "ca-pub-3422782820843221",
          enable_page_level_ads: true
     });
</script>
<style>
<!--
 pre {white-space: pre-wrap;}
-->
</style>
<meta name="description" content="Linux ARM, OMAP, Xscale Kernel: Re: [PATCH v3 0/5] Add NUMA-awareness to qspinlock">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Re: [PATCH v3 0/5] Add NUMA-awareness to qspinlock &mdash; ARM, OMAP, Xscale Linux Kernel</title>
<link rel="alternate" type="application/rss+xml" title="Linux ARM Kernel" href="//feedproxy.google.com/LinuxArmKernel">
<link rel="alternate" type="application/rss+xml" title="Linux ARM Kernel" href="//feeds.feedburner.com/LinuxArmxscaleEtc">
<link rel="alternate" type="application/rss+xml" title="Fedora ARM" href="//feeds.feedburner.com/FedoraArm">
<link rel="alternate" type="application/rss+xml" title="Linux for OMAP" href="//feedproxy.google.com/LinuxOmap">
</head>
<body itemscope itemtype="//schema.org/Article" vlink=green>
<!--X-Body-Begin-->
<!--X-User-Header-->
<!--X-User-Header-End-->
<!--X-TopPNI-->
<td align=right><form action="//www.google.com/cse" id="cse-search-box" target="_blank">
  <div>
    <input type="hidden" name="cx" value="partner-pub-3422782820843221:isdiegq275o" />
    <input type="hidden" name="ie" value="ISO-8859-1" />
    <input type="text" name="q" size="37" />
    <input type="submit" name="sa" value="Search" />
  </div>
</form>
<script type="text/javascript" src="//www.google.com/cse/brand?form=cse-search-box&amp;lang=en" async></script>
<h1 itemprop="name">Re: [PATCH v3 0/5] Add NUMA-awareness to qspinlock</h1>
[<a href="msg741437.html">Date Prev</a>][<a href="msg741439.html">Date Next</a>][<a href="msg741322.html">Thread Prev</a>][<a href="msg741217.html">Thread Next</a>][<a href="maillist.html#741438">Date Index</a>][<a href="threads.html#741438">Thread Index</a>] 
<p>&nbsp;<br>
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- responsive test for archives -->
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-3422782820843221"
     data-ad-slot="6345952567"
     data-ad-format="auto"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>

<!--X-TopPNI-End-->
<!--X-MsgBody-->
<!--X-Subject-Header-Begin-->
<hr>
<!--X-Subject-Header-End-->
<!--X-Head-of-Message-->
<ul>
<li><em>Subject</em>: Re: [PATCH v3 0/5] Add NUMA-awareness to qspinlock</li>
<li><em>From</em>: Nicholas Piggin &lt;npiggin@xxxxxxxxx&gt;</li>
<li><em>Date</em>: Wed, 17 Jul 2019 09:07:09 +1000</li>
<li><em>In-reply-to</em>: &lt;7D29555E-8F72-4EDD-8A87-B1A59C3945A6@oracle.com&gt;</li>
<li><em>User-agent</em>: astroid/0.14.0 (https://github.com/astroidmail/astroid)</li>
</ul>
<!--X-Head-of-Message-End-->
<!--X-Head-Body-Sep-Begin-->
<!-- AddThis Button BEGIN -->
<div class="addthis_toolbox addthis_default_style ">
<a class="addthis_button_preferred_1"></a>
<a class="addthis_button_preferred_2"></a>
<a class="addthis_button_preferred_3"></a>
<a class="addthis_button_preferred_4"></a>
<a class="addthis_button_compact"></a>
<a class="addthis_counter addthis_bubble_style"></a>
</div>
<script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5196c2ae1be43d18&async=1&domready=1" async></script>
<!-- AddThis Button END -->
<hr>
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- responsive link 1 -->
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-3422782820843221"
     data-ad-slot="8681825769"
     data-ad-format="link"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
<div class="content" itemprop="articleBody">
<!--X-Head-Body-Sep-End-->
<!--X-Body-of-Message-->
<pre>Alex Kogan's on July 17, 2019 12:45 am:
&gt;<i> </i>
&gt;<i>&gt; On Jul 16, 2019, at 7:47 AM, Nicholas Piggin &lt;npiggin@xxxxxxxxx&gt; wrote:</i>
&gt;<i>&gt; </i>
&gt;<i>&gt; Alex Kogan's on July 16, 2019 5:25 am:</i>
&gt;<i>&gt;&gt; Our evaluation shows that CNA also improves performance of user </i>
&gt;<i>&gt;&gt; applications that have hot pthread mutexes. Those mutexes are </i>
&gt;<i>&gt;&gt; blocking, and waiting threads park and unpark via the futex </i>
&gt;<i>&gt;&gt; mechanism in the kernel. Given that kernel futex chains, which</i>
&gt;<i>&gt;&gt; are hashed by the mutex address, are each protected by a </i>
&gt;<i>&gt;&gt; chain-specific spin lock, the contention on a user-mode mutex </i>
&gt;<i>&gt;&gt; translates into contention on a kernel level spinlock. </i>
&gt;<i>&gt; </i>
&gt;<i>&gt; What applications are those, what performance numbers? Arguably that's</i>
&gt;<i>&gt; much more interesting than microbenchmarks (which are mainly useful to</i>
&gt;<i>&gt; help ensure the fast paths are not impacted IMO).</i>
&gt;<i> </i>
&gt;<i> Those are applications that use locks in which waiting threads can park (block),</i>
&gt;<i> e.g., pthread mutexes. Under (user-level) contention, the park-unpark mechanism</i>
&gt;<i> in the kernel creates contention on (kernel) spin locks protecting futex chains.</i>
&gt;<i> As an example, we experimented with LevelDB (key-value store), and included</i>
&gt;<i> performance numbers in the patch. Or you are looking for something else?</i>

Oh, no that's good. I confused myself thinking that was another will it
scale benchmark. The speedup becomes significant on readrandom, I wonder
if of it might be that you're gating which threads get to complete the 
futex operation and so the effect is amplified beyond just the critical
section of the spin lock?

Am I reading the table correctly, this test gets about 2.1x speedup when
scaling from 1 to 142 threads in the patch-CNA case?

Thanks,
Nick

_______________________________________________
linux-arm-kernel mailing list
linux-arm-kernel@xxxxxxxxxxxxxxxxxxx
<a  rel="nofollow" href="http://lists.infradead.org/mailman/listinfo/linux-arm-kernel">http://lists.infradead.org/mailman/listinfo/linux-arm-kernel</a>


</pre>
<!--X-Body-of-Message-End-->
<!--X-MsgBody-End-->
<!--X-Follow-Ups-->
</div>
<hr>
<!--X-Follow-Ups-End-->
<!--X-References-->
<ul><li><strong>References</strong>:
<ul>
<li><strong><a name="741213" href="msg741213.html">[PATCH v3 0/5] Add NUMA-awareness to qspinlock</a></strong>
<ul><li><em>From:</em> Alex Kogan</li></ul></li>
<li><strong><a name="741322" href="msg741322.html">Re: [PATCH v3 0/5] Add NUMA-awareness to qspinlock</a></strong>
<ul><li><em>From:</em> Nicholas Piggin</li></ul></li>
</ul></li></ul>
<!--X-References-End-->
<!--X-BotPNI-->
<ul>
<li>Prev by Date:
<strong><a href="msg741437.html">[PATCH] dt-bindings: pinctrl: stm32: Fix missing 'clocks' property in examples</a></strong>
</li>
<li>Next by Date:
<strong><a href="msg741439.html">Re: [PATCH v4, 23/33] drm/mediatek: add ovl0/ovl_2l0 usecase</a></strong>
</li>
<li>Previous by thread:
<strong><a href="msg741322.html">Re: [PATCH v3 0/5] Add NUMA-awareness to qspinlock</a></strong>
</li>
<li>Next by thread:
<strong><a href="msg741217.html">[PATCH] ARM: dts: gemini: Set DIR-685 SPI CS as active low</a></strong>
</li>
<li>Index(es):
<ul>
<li><a href="maillist.html#741438"><strong>Date</strong></a></li>
<li><a href="threads.html#741438"><strong>Thread</strong></a></li>
</ul>
</li>
</ul>

<!--X-BotPNI-End-->
<!--X-User-Footer-->
<center>
<font size=-1>
<a href=/lists/>[Index&nbsp;of&nbsp;Archives]</a>
&nbsp;
&nbsp;
<a href=/lists/kernel/>[Linux&nbsp;Kernel]</a>
&nbsp;
&nbsp;
<a href=/lists/linux-arm/>[Linux&nbsp;ARM&nbsp;(vger)]</a>
&nbsp;
&nbsp;
<a href=/lists/linux-arm-msm/>[Linux&nbsp;ARM&nbsp;MSM]</a>
&nbsp;
&nbsp;
<a href=/lists/linux-omap/>[Linux&nbsp;Omap]</a>
&nbsp;
&nbsp;
<a href=/lists/centos-arm-devel/>[CentOS&nbsp;ARM]</a>
&nbsp;
&nbsp;
<a href=/lists/arm/>[Linux&nbsp;Arm]</a>
&nbsp;
&nbsp;
<a href=/lists/linux-tegra/>[Linux&nbsp;Tegra]</a>
&nbsp;
&nbsp;
<a href=/linux/fedora/fedora-arm/>[Fedora&nbsp;ARM]</a>
&nbsp;
&nbsp;
<a href=/lists/linux-samsung-soc/>[Linux&nbsp;for&nbsp;Samsung&nbsp;SOC]</a>
&nbsp;
&nbsp;
<a href=/lists/ecos/>[eCos]</a>
&nbsp;
&nbsp;
<a href=/lists/fastboot/>[Linux&nbsp;Fastboot]</a>
&nbsp;
&nbsp;
<a href=/lists/gcchelp/>[Gcc&nbsp;Help]</a>
&nbsp;
&nbsp;
<a href=/lists/git/>[Git]</a>
&nbsp;
&nbsp;
<a href=/lists/dccp/>[DCCP]</a>
&nbsp;
&nbsp;
<a href=/lists/ietf-ann>[IETF&nbsp;Announce]</a>
&nbsp;
&nbsp;
<a href=/lists/security/>[Security]</a>
&nbsp;
&nbsp;
<a href=/lists/mips/>[Linux&nbsp;MIPS]</a>
</font>
</center>
<hr>
<p>
<div>
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<ins class="adsbygoogle"
     style="display:block"
     data-ad-format="autorelaxed"
     data-ad-client="ca-pub-3422782820843221"
     data-ad-slot="1424524564"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
</div>
<table width=100%>
<tr>
<td align=left>&nbsp;</td>
<td align=right><a href=/lists/><img src=/button_01.gif border=0 alt="Powered by Linux"></a></td>
</tr>
</table>
<!--X-User-Footer-End-->
<script type="text/javascript"> 
 function initAddThis() {
    addthis.init()
 }

initAddThis();
</script>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-760190-1', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
