<!-- MHonArc v2.6.19 -->
<!--X-Subject: [PATCH v2 1/9] soc: samsung: Add exynos chipid driver support -->
<!--X-From-R13: Elyjrfgre @njebpxv &#60;f.anjebpxvNfnzfhat.pbz> -->
<!--X-Date: Thu, 18 Jul 2019 07:31:55 &#45;0700 -->
<!--X-Message-Id: 20190718143044.25066&#45;2&#45;s.nawrocki@samsung.com -->
<!--X-Content-Type: text/plain -->
<!--X-Reference: 20190718143044.25066&#45;1&#45;s.nawrocki@samsung.com -->
<!--X-Reference: CGME20190718143127eucas1p13b1e2c98d270140a87f09562ef46c9a3@eucas1p1.samsung.com -->
<!--X-Head-End-->
<!doctype html public "-//W3C//DTD HTML//EN">
<html>
<head>
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({
          google_ad_client: "ca-pub-3422782820843221",
          enable_page_level_ads: true
     });
</script>
<style>
<!--
 pre {white-space: pre-wrap;}
-->
</style>
<meta name="description" content="Linux ARM, OMAP, Xscale Kernel: [PATCH v2 1/9] soc: samsung: Add exynos chipid driver support">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>[PATCH v2 1/9] soc: samsung: Add exynos chipid driver support &mdash; ARM, OMAP, Xscale Linux Kernel</title>
<link rel="alternate" type="application/rss+xml" title="Linux ARM Kernel" href="//feedproxy.google.com/LinuxArmKernel">
<link rel="alternate" type="application/rss+xml" title="Linux ARM Kernel" href="//feeds.feedburner.com/LinuxArmxscaleEtc">
<link rel="alternate" type="application/rss+xml" title="Fedora ARM" href="//feeds.feedburner.com/FedoraArm">
<link rel="alternate" type="application/rss+xml" title="Linux for OMAP" href="//feedproxy.google.com/LinuxOmap">
</head>
<body itemscope itemtype="//schema.org/Article" vlink=green>
<!--X-Body-Begin-->
<!--X-User-Header-->
<!--X-User-Header-End-->
<!--X-TopPNI-->
<td align=right><form action="//www.google.com/cse" id="cse-search-box" target="_blank">
  <div>
    <input type="hidden" name="cx" value="partner-pub-3422782820843221:isdiegq275o" />
    <input type="hidden" name="ie" value="ISO-8859-1" />
    <input type="text" name="q" size="37" />
    <input type="submit" name="sa" value="Search" />
  </div>
</form>
<script type="text/javascript" src="//www.google.com/cse/brand?form=cse-search-box&amp;lang=en" async></script>
<h1 itemprop="name">[PATCH v2 1/9] soc: samsung: Add exynos chipid driver support</h1>
[<a href="msg741771.html">Date Prev</a>][<a href="msg741773.html">Date Next</a>][<a href="msg741771.html">Thread Prev</a>][<a href="msg741773.html">Thread Next</a>][<a href="maillist.html#741772">Date Index</a>][<a href="threads.html#741772">Thread Index</a>] 
<p>&nbsp;<br>
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- responsive test for archives -->
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-3422782820843221"
     data-ad-slot="6345952567"
     data-ad-format="auto"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>

<!--X-TopPNI-End-->
<!--X-MsgBody-->
<!--X-Subject-Header-Begin-->
<hr>
<!--X-Subject-Header-End-->
<!--X-Head-of-Message-->
<ul>
<li><em>Subject</em>: [PATCH v2 1/9] soc: samsung: Add exynos chipid driver support</li>
<li><em>From</em>: Sylwester Nawrocki &lt;s.nawrocki@xxxxxxxxxxx&gt;</li>
<li><em>Date</em>: Thu, 18 Jul 2019 16:30:36 +0200</li>
<li><em>Cms-type</em>: 201P</li>
<li><em>In-reply-to</em>: &lt;<a href="msg741771.html">20190718143044.25066-1-s.nawrocki@samsung.com</a>&gt;</li>
</ul>
<!--X-Head-of-Message-End-->
<!--X-Head-Body-Sep-Begin-->
<!-- AddThis Button BEGIN -->
<div class="addthis_toolbox addthis_default_style ">
<a class="addthis_button_preferred_1"></a>
<a class="addthis_button_preferred_2"></a>
<a class="addthis_button_preferred_3"></a>
<a class="addthis_button_preferred_4"></a>
<a class="addthis_button_compact"></a>
<a class="addthis_counter addthis_bubble_style"></a>
</div>
<script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5196c2ae1be43d18&async=1&domready=1" async></script>
<!-- AddThis Button END -->
<hr>
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- responsive link 1 -->
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-3422782820843221"
     data-ad-slot="8681825769"
     data-ad-format="link"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
<div class="content" itemprop="articleBody">
<!--X-Head-Body-Sep-End-->
<!--X-Body-of-Message-->
<pre>From: Pankaj Dubey &lt;pankaj.dubey@xxxxxxxxxxx&gt;

Exynos SoCs have Chipid, for identification of product IDs and SoC
revisions. This patch intends to provide initialization code for all
these functionalities, at the same time it provides some sysfs entries
for accessing these information to user-space.

This driver uses existing binding for exynos-chipid.

Changes by Bartlomiej:
- fixed return values on errors
- removed bogus kfree_const()
- added missing Exynos4210 EVT0 id
- converted code to use EXYNOS_MASK define
- fixed np use after of_node_put()
- fixed too early use of dev_info()
- made driver fail for unknown SoC-s
- added SPDX tag
- updated Copyrights

Signed-off-by: Pankaj Dubey &lt;pankaj.dubey@xxxxxxxxxxx&gt;
[m.szyprowski: for suggestion and code snippet of product_id_to_soc_id]
Signed-off-by: Marek Szyprowski &lt;m.szyprowski@xxxxxxxxxxx&gt;
Signed-off-by: Bartlomiej Zolnierkiewicz &lt;b.zolnierkie@xxxxxxxxxxx&gt;
[s.nawrocki: updated copyright date]
Signed-off-by: Sylwester Nawrocki &lt;s.nawrocki@xxxxxxxxxxx&gt;
---
 drivers/soc/samsung/Kconfig         |   5 ++
 drivers/soc/samsung/Makefile        |   2 +
 drivers/soc/samsung/exynos-chipid.c | 111 ++++++++++++++++++++++++++++
 3 files changed, 118 insertions(+)
 create mode 100644 drivers/soc/samsung/exynos-chipid.c

diff --git a/drivers/soc/samsung/Kconfig b/drivers/soc/samsung/Kconfig
index 2186285fda92..2905f5262197 100644
--- a/drivers/soc/samsung/Kconfig
+++ b/drivers/soc/samsung/Kconfig
@@ -7,6 +7,11 @@ menuconfig SOC_SAMSUNG
 
 if SOC_SAMSUNG
 
+config EXYNOS_CHIPID
+	bool &quot;Exynos Chipid controller driver&quot; if COMPILE_TEST
+	depends on ARCH_EXYNOS || COMPILE_TEST
+	select SOC_BUS
+
 config EXYNOS_PMU
 	bool &quot;Exynos PMU controller driver&quot; if COMPILE_TEST
 	depends on ARCH_EXYNOS || ((ARM || ARM64) &amp;&amp; COMPILE_TEST)
diff --git a/drivers/soc/samsung/Makefile b/drivers/soc/samsung/Makefile
index 29f294baac6e..3b6a8797416c 100644
--- a/drivers/soc/samsung/Makefile
+++ b/drivers/soc/samsung/Makefile
@@ -1,4 +1,6 @@
 # SPDX-License-Identifier: GPL-2.0
+
+obj-$(CONFIG_EXYNOS_CHIPID)	+= exynos-chipid.o
 obj-$(CONFIG_EXYNOS_PMU)	+= exynos-pmu.o
 
 obj-$(CONFIG_EXYNOS_PMU_ARM_DRIVERS)	+= exynos3250-pmu.o exynos4-pmu.o \
diff --git a/drivers/soc/samsung/exynos-chipid.c b/drivers/soc/samsung/exynos-chipid.c
new file mode 100644
index 000000000000..78b123ee60c0
--- /dev/null
+++ b/drivers/soc/samsung/exynos-chipid.c
@@ -0,0 +1,111 @@
+// SPDX-License-Identifier: GPL-2.0
+/*
+ * Copyright (c) 2019 Samsung Electronics Co., Ltd.
+ *	      <a  rel="nofollow" href="http://www.samsung.com/">http://www.samsung.com/</a>
+ *
+ * EXYNOS - CHIP ID support
+ * Author: Pankaj Dubey &lt;pankaj.dubey@xxxxxxxxxxx&gt;
+ * Author: Bartlomiej Zolnierkiewicz &lt;b.zolnierkie@xxxxxxxxxxx&gt;
+ */
+
+#include &lt;linux/io.h&gt;
+#include &lt;linux/of.h&gt;
+#include &lt;linux/of_address.h&gt;
+#include &lt;linux/of_platform.h&gt;
+#include &lt;linux/platform_device.h&gt;
+#include &lt;linux/slab.h&gt;
+#include &lt;linux/sys_soc.h&gt;
+
+#define EXYNOS_SUBREV_MASK	(0xF &lt;&lt; 4)
+#define EXYNOS_MAINREV_MASK	(0xF &lt;&lt; 0)
+#define EXYNOS_REV_MASK		(EXYNOS_SUBREV_MASK | EXYNOS_MAINREV_MASK)
+#define EXYNOS_MASK		0xFFFFF000
+
+static const struct exynos_soc_id {
+	const char *name;
+	unsigned int id;
+} soc_ids[] = {
+	{ &quot;EXYNOS3250&quot;, 0xE3472000 },
+	{ &quot;EXYNOS4210&quot;, 0x43200000 },	/* EVT0 revision */
+	{ &quot;EXYNOS4210&quot;, 0x43210000 },
+	{ &quot;EXYNOS4212&quot;, 0x43220000 },
+	{ &quot;EXYNOS4412&quot;, 0xE4412000 },
+	{ &quot;EXYNOS5250&quot;, 0x43520000 },
+	{ &quot;EXYNOS5260&quot;, 0xE5260000 },
+	{ &quot;EXYNOS5410&quot;, 0xE5410000 },
+	{ &quot;EXYNOS5420&quot;, 0xE5420000 },
+	{ &quot;EXYNOS5440&quot;, 0xE5440000 },
+	{ &quot;EXYNOS5800&quot;, 0xE5422000 },
+	{ &quot;EXYNOS7420&quot;, 0xE7420000 },
+	{ &quot;EXYNOS5433&quot;, 0xE5433000 },
+};
+
+static const char * __init product_id_to_soc_id(unsigned int product_id)
+{
+	int i;
+
+	for (i = 0; i &lt; ARRAY_SIZE(soc_ids); i++)
+		if ((product_id &amp; EXYNOS_MASK) == soc_ids[i].id)
+			return soc_ids[i].name;
+	return NULL;
+}
+
+int __init exynos_chipid_early_init(void)
+{
+	struct soc_device_attribute *soc_dev_attr;
+	void __iomem *exynos_chipid_base;
+	struct soc_device *soc_dev;
+	struct device_node *root;
+	struct device_node *np;
+	u32 product_id;
+	u32 revision;
+
+	/* look up for chipid node */
+	np = of_find_compatible_node(NULL, NULL, &quot;samsung,exynos4210-chipid&quot;);
+	if (!np)
+		return -ENODEV;
+
+	exynos_chipid_base = of_iomap(np, 0);
+	of_node_put(np);
+
+	if (!exynos_chipid_base) {
+		pr_err(&quot;Failed to map SoC chipid\n&quot;);
+		return -ENXIO;
+	}
+
+	product_id = readl_relaxed(exynos_chipid_base);
+	revision = product_id &amp; EXYNOS_REV_MASK;
+	iounmap(exynos_chipid_base);
+
+	soc_dev_attr = kzalloc(sizeof(*soc_dev_attr), GFP_KERNEL);
+	if (!soc_dev_attr)
+		return -ENOMEM;
+
+	soc_dev_attr-&gt;family = &quot;Samsung Exynos&quot;;
+
+	root = of_find_node_by_path(&quot;/&quot;);
+	of_property_read_string(root, &quot;model&quot;, &amp;soc_dev_attr-&gt;machine);
+	of_node_put(root);
+
+	soc_dev_attr-&gt;revision = kasprintf(GFP_KERNEL, &quot;%x&quot;, revision);
+	soc_dev_attr-&gt;soc_id = product_id_to_soc_id(product_id);
+	if (!soc_dev_attr-&gt;soc_id) {
+		pr_err(&quot;Unknown SoC\n&quot;);
+		return -ENODEV;
+	}
+
+	/* please note that the actual registration will be deferred */
+	soc_dev = soc_device_register(soc_dev_attr);
+	if (IS_ERR(soc_dev)) {
+		kfree(soc_dev_attr-&gt;revision);
+		kfree(soc_dev_attr);
+		return PTR_ERR(soc_dev);
+	}
+
+	/* it is too early to use dev_info() here (soc_dev is NULL) */
+	pr_info(&quot;soc soc0: Exynos: CPU[%s] PRO_ID[0x%x] REV[0x%x] Detected\n&quot;,
+		soc_dev_attr-&gt;soc_id, product_id, revision);
+
+	return 0;
+}
+early_initcall(exynos_chipid_early_init);
-- 
2.17.1


_______________________________________________
linux-arm-kernel mailing list
linux-arm-kernel@xxxxxxxxxxxxxxxxxxx
<a  rel="nofollow" href="http://lists.infradead.org/mailman/listinfo/linux-arm-kernel">http://lists.infradead.org/mailman/listinfo/linux-arm-kernel</a>


</pre>
<!--X-Body-of-Message-End-->
<!--X-MsgBody-End-->
<!--X-Follow-Ups-->
</div>
<hr>
<!--X-Follow-Ups-End-->
<!--X-References-->
<ul><li><strong>References</strong>:
<ul>
<li><strong><a name="741771" href="msg741771.html">[PATCH v2 0/9] Exynos Adaptive Supply Voltage support</a></strong>
<ul><li><em>From:</em> Sylwester Nawrocki</li></ul></li>
</ul></li></ul>
<!--X-References-End-->
<!--X-BotPNI-->
<ul>
<li>Prev by Date:
<strong><a href="msg741771.html">[PATCH v2 0/9] Exynos Adaptive Supply Voltage support</a></strong>
</li>
<li>Next by Date:
<strong><a href="msg741773.html">[PATCH v2 2/9] soc: samsung: Convert exynos-chipid driver to use the regmap API</a></strong>
</li>
<li>Previous by thread:
<strong><a href="msg741771.html">[PATCH v2 0/9] Exynos Adaptive Supply Voltage support</a></strong>
</li>
<li>Next by thread:
<strong><a href="msg741773.html">[PATCH v2 2/9] soc: samsung: Convert exynos-chipid driver to use the regmap API</a></strong>
</li>
<li>Index(es):
<ul>
<li><a href="maillist.html#741772"><strong>Date</strong></a></li>
<li><a href="threads.html#741772"><strong>Thread</strong></a></li>
</ul>
</li>
</ul>

<!--X-BotPNI-End-->
<!--X-User-Footer-->
<center>
<font size=-1>
<a href=/lists/>[Index&nbsp;of&nbsp;Archives]</a>
&nbsp;
&nbsp;
<a href=/lists/kernel/>[Linux&nbsp;Kernel]</a>
&nbsp;
&nbsp;
<a href=/lists/linux-arm/>[Linux&nbsp;ARM&nbsp;(vger)]</a>
&nbsp;
&nbsp;
<a href=/lists/linux-arm-msm/>[Linux&nbsp;ARM&nbsp;MSM]</a>
&nbsp;
&nbsp;
<a href=/lists/linux-omap/>[Linux&nbsp;Omap]</a>
&nbsp;
&nbsp;
<a href=/lists/centos-arm-devel/>[CentOS&nbsp;ARM]</a>
&nbsp;
&nbsp;
<a href=/lists/arm/>[Linux&nbsp;Arm]</a>
&nbsp;
&nbsp;
<a href=/lists/linux-tegra/>[Linux&nbsp;Tegra]</a>
&nbsp;
&nbsp;
<a href=/linux/fedora/fedora-arm/>[Fedora&nbsp;ARM]</a>
&nbsp;
&nbsp;
<a href=/lists/linux-samsung-soc/>[Linux&nbsp;for&nbsp;Samsung&nbsp;SOC]</a>
&nbsp;
&nbsp;
<a href=/lists/ecos/>[eCos]</a>
&nbsp;
&nbsp;
<a href=/lists/fastboot/>[Linux&nbsp;Fastboot]</a>
&nbsp;
&nbsp;
<a href=/lists/gcchelp/>[Gcc&nbsp;Help]</a>
&nbsp;
&nbsp;
<a href=/lists/git/>[Git]</a>
&nbsp;
&nbsp;
<a href=/lists/dccp/>[DCCP]</a>
&nbsp;
&nbsp;
<a href=/lists/ietf-ann>[IETF&nbsp;Announce]</a>
&nbsp;
&nbsp;
<a href=/lists/security/>[Security]</a>
&nbsp;
&nbsp;
<a href=/lists/mips/>[Linux&nbsp;MIPS]</a>
</font>
</center>
<hr>
<p>
<div>
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<ins class="adsbygoogle"
     style="display:block"
     data-ad-format="autorelaxed"
     data-ad-client="ca-pub-3422782820843221"
     data-ad-slot="1424524564"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
</div>
<table width=100%>
<tr>
<td align=left>&nbsp;</td>
<td align=right><a href=/lists/><img src=/button_01.gif border=0 alt="Powered by Linux"></a></td>
</tr>
</table>
<!--X-User-Footer-End-->
<script type="text/javascript"> 
 function initAddThis() {
    addthis.init()
 }

initAddThis();
</script>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-760190-1', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
